A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\BLHeli_S.obj
ASSEMBLER INVOKED BY: D:\Software_KEILC51\C51\BIN\A51.EXE BLHeli_S SiLabs\BLHeli_S.asm SET(SMALL) DEBUG PRINT(.\Listings
                      \BLHeli_S.lst) OBJECT(.\Objects\BLHeli_S.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     $nomod51 
                       2     ;**** **** **** **** ****
                       3     ;
                       4     ; BLHeli program for controlling brushless motors in multirotors
                       5     ;
                       6     ; Copyright 2011, 2012 Steffen Skaug
                       7     ; This program is distributed under the terms of the GNU General Public License
                       8     ;
                       9     ; This file is part of BLHeli.
                      10     ;
                      11     ; BLHeli is free software: you can redistribute it and/or modify
                      12     ; it under the terms of the GNU General Public License as published by
                      13     ; the Free Software Foundation, either version 3 of the License, or
                      14     ; (at your option) any later version.
                      15     ;
                      16     ; BLHeli is distributed in the hope that it will be useful,
                      17     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                      18     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                      19     ; GNU General Public License for more details.
                      20     ;
                      21     ; You should have received a copy of the GNU General Public License
                      22     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                      23     ;
                      24     ;**** **** **** **** ****
                      25     ;
                      26     ; This software was initially designed for use with Eflite mCP X, but is now adapted to cop
                             ters/planes in general
                      27     ;
                      28     ; The software was inspired by and started from from Bernard Konze's BLMC: http://home.vers
                             anet.de/~bkonze/blc_6a/blc_6a.htm
                      29     ; And also Simon Kirby's TGY: https://github.com/sim-/tgy
                      30     ;
                      31     ; This file is best viewed with tab width set to 5
                      32     ;
                      33     ; The code is designed for multirotor applications, running damped light mode
                      34     ;
                      35     ; The input signal can be Normal (1-2ms), OneShot125 (125-250us), OneShot42 (41.7-83.3us) o
                             r Multishot (5-25us) at rates as high as allowed by the format.
                      36     ; Three Dshot signal rates are also supported, Dshot150, Dshot300 and Dshot600. A 48MHz MCU
                              is required for Dshot600.
                      37     ; The code autodetects normal, OneShot125, Oneshot42, Multishot or Dshot.
                      38     ;
                      39     ; The first lines of the software must be modified according to the chosen environment:
                      40     ; ESCNO EQU "ESC"
                      41     ; MCU_48MHZ EQU "N"
                      42     ; FETON_DELAY EQU "N"
                      43     ; 
                      44     ;**** **** **** **** ****
                      45     ; Revision history:
                      46     ; - Rev16.0 Started. Built upon rev 14.5 of base code
                      47     ;           Using hardware pwm for very smooth throttle response, silent running and suppor
                             t of very high rpms
                      48     ;           Implemented reverse bidirectional mode
                      49     ;           Implemented separate throttle gains fwd and rev in bidirectional mode
                      50     ;           Implemented support for Oneshot42 and Multishot
                      51     ; - Rev16.1 Made low rpm power limiting programmable through the startup power parameter
                      52     ; - Rev16.2 Fixed bug that prevented temperature protection
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE     2

                      53     ;           Improved robustness to very high input signal rates
                      54     ;           Beeps can be turned off by programming beep strength to 1
                      55     ;           Throttle cal difference is checked to be above required minimum before storing.
                              Throttle cal max is not stored until successful min throttle cal
                      56     ; - Rev16.3 Implemented programmable temperature protection
                      57     ;           Improved protection of bootloader and generally reduced risk of flash corruption
                      58     ;           Some small changes for improved sync hold
                      59     ; - Rev16.4 Fixed bug where bootloader operation could be blocked by a defective "eeprom" s
                             ignature
                      60     ; - Rev16.5 Added support for DShot150, DShot300 and DShot600
                      61     ; - Rev16.6 Fixed signal detection issue of multishot at 32kHz
                      62     ;           Improved bidirectional mode for high input signal rates
                      63     ; - Rev16.7 Addition of Dshot commands for beeps and temporary reverse direction (largely b
                             y brycedjohnson)
                      64     ;   
                      65     ;        
                      66     ;**** **** **** **** ****
                      67     ; Minimum 8K Bytes of In-System Self-Programmable Flash
                      68     ; Minimum 512 Bytes Internal SRAM
                      69     ;
                      70     ;**** **** **** **** ****
                      71     ; Master clock is internal 24MHz oscillator (or 48MHz, for which the times below are halved)
                      72     ; Although 24/48 are used in the code, the exact clock frequencies are 24.5MHz or 49.0 MHz
                      73     ; Timer 0 (41.67ns counts) always counts up and is used for
                      74     ; - RC pulse measurement
                      75     ; Timer 1 (41.67ns counts) always counts up and is used for
                      76     ; - DShot frame sync detection
                      77     ; Timer 2 (500ns counts) always counts up and is used for
                      78     ; - RC pulse timeout counts and commutation times
                      79     ; Timer 3 (500ns counts) always counts up and is used for
                      80     ; - Commutation timeouts
                      81     ; PCA0 (41.67ns counts) always counts up and is used for
                      82     ; - Hardware PWM generation
                      83     ;
                      84     ;**** **** **** **** ****
                      85     ; Interrupt handling
                      86     ; The C8051 does not disable interrupts when entering an interrupt routine.
                      87     ; Also some interrupt flags need to be cleared by software
                      88     ; The code disables interrupts in some interrupt routines
                      89     ; - Interrupts are disabled during beeps, to avoid audible interference from interrupts
                      90     ;
                      91     ;**** **** **** **** ****
                      92     ; Motor control:
                      93     ; - Brushless motor control with 6 states for each electrical 360 degrees
                      94     ; - An advance timing of 0deg has zero cross 30deg after one commutation and 30deg before t
                             he next
                      95     ; - Timing advance in this implementation is set to 15deg nominally
                      96     ; - Motor pwm is always damped light (aka complementary pwm, regenerative braking)
                      97     ; Motor sequence starting from zero crossing:
                      98     ; - Timer wait: Wt_Comm                 15deg   ; Time to wait from zero cross to actual co
                             mmutation
                      99     ; - Timer wait: Wt_Advance              15deg   ; Time to wait for timing advance. Nominal 
                             commutation point is after this
                     100     ; - Timer wait: Wt_Zc_Scan              7.5deg  ; Time to wait before looking for zero cross
                     101     ; - Scan for zero cross                 22.5deg ; Nominal, with some motor variations
                     102     ;
                     103     ; Motor startup:
                     104     ; There is a startup phase and an initial run phase, before normal bemf commutation run beg
                             ins.
                     105     ;
                     106     ;**** **** **** **** ****
                     107     ; List of enumerated supported ESCs
  0001               108     A_                      EQU 1     ; X  X  RC X  MC MB MA CC    X  X  Cc Cp Bc Bp Ac Ap
  0002               109     B_                      EQU 2     ; X  X  RC X  MC MB MA CC    X  X  Ap Ac Bp Bc Cp Cc
  0003               110     C_                      EQU 3     ; Ac Ap MC MB MA CC X  RC    X  X  X  X  Cc Cp Bc Bp
  0004               111     D_                      EQU 4     ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap  Com
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE     3

                              fets inverted
  0005               112     E_                      EQU 5     ; L1 L0 RC X  MC MB MA CC    X  L2 Cc Cp Bc Bp Ac Ap  A w
                             ith LEDs
  0006               113     F_                      EQU 6     ; X  X  RC X  MA MB MC CC    X  X  Cc Cp Bc Bp Ac Ap
  0007               114     G_                      EQU 7     ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap  Lik
                             e D, but noninverted com fets
  0008               115     H_                      EQU 8     ; RC X  X  X  MA MB CC MC    X  Ap Bp Cp X  Ac Bc Cc
  0009               116     I_                      EQU 9     ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
  000A               117     J_                      EQU 10  ; L2 L1 L0 RC CC MB MC MA    X  X  Cc Bc Ac Cp Bp Ap    LEDs
  000B               118     K_                      EQU 11  ; X  X  MC X  MB CC MA RC    X  X  Ap Bp Cp Cc Bc Ac    Com
                              fets inverted
  000C               119     L_                      EQU 12  ; X  X  RC X  CC MA MB MC    X  X  Ac Bc Cc Ap Bp Cp
  000D               120     M_                      EQU 13  ; MA MC CC MB RC L0 X  X     X  Cc Bc Ac Cp Bp Ap X     LED
  000E               121     N_                      EQU 14  ; X  X  RC X  MC MB MA CC    X  X  Cp Cc Bp Bc Ap Ac
  000F               122     O_                      EQU 15  ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    Lik
                             e D, but low side pwm
  0010               123     P_                      EQU 16  ; X  X  RC MA CC MB MC X     X  Cc Bc Ac Cp Bp Ap X
  0011               124     Q_                      EQU 17  ; Cp Bp Ap L1 L0 X  RC X     X  MA MB MC CC Cc Bc Ac    LEDs
  0012               125     R_                      EQU 18  ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
  0013               126     S_                      EQU 19   ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    Li
                             ke O, but com fets inverted
  0014               127     T_                      EQU 20  ; RC X  MA X  MB CC MC X     X  X  Cp Bp Ap Ac Bc Cc
  0015               128     U_                      EQU 21  ; MA MC CC MB RC L0 L1 L2    X  Cc Bc Ac Cp Bp Ap X     Lik
                             e M, but with 3 LEDs
  0016               129     V_                      EQU 22  ; Cc X  RC X  MC CC MB MA    X  Ap Ac Bp X  X  Bc Cp
  0017               130     W_                      EQU 23  ; RC MC MB X  CC MA X  X     X  Ap Bp Cp X  X  X  X     Tri
                             state gate driver
  0018               131     X_                      EQU 24  ; Reserved
  0019               132     Y_                      EQU 25  ; Reserved
  001A               133     Z_                      EQU 26   ; X  X  RC X  CC MA MC MB    X  X  Cp Cc Bp Bc Ap Ac   Lik
                             e S, but pwm fets inverted
                     134     
  001E               135     A_X_            EQU 30  ; X  X  RC CC MA MC MB X     X  X  Cc Cp Bc Bp Ac Ap    PWM fets ac
                             tive high, on low side.  COM fets active low
  001F               136     B_X_            EQU 31  ; X  X  RC CC MA MC MB X     X  X  Cp Cc Bp Bc Ap Ac    PWM fets ac
                             tive high, on high side. COM fets active high
  0020               137     C_X_            EQU 32  ; X  X  RC CC MA MC MB X     X  X  Cp Cc Bp Bc Ap Ac    PWM fets ac
                             tive low, on high side.  COM fets active high
  0021               138     D_X_            EQU 33  ; X  X  RC CC MA MC MB X     X  X  Cc Cp Bc Bp Ac Ap    PWM fets ac
                             tive high, on high side. COM fets active high
  0022               139     E_X_            EQU 34  ; X  X  RC CC MA MB MC X     X  X  Ac Bc Cc Ap Bp Cp    PWM fets ac
                             tive high, on high side. COM fets active high
                     140     
                     141     ;**** **** **** **** ****
                     142     ; Select the port mapping to use (or unselect all for use with external batch compile file)
                     143     ;ESCNO EQU A_
                     144     ;ESCNO EQU B_
                     145     ;ESCNO EQU C_
                     146     ;ESCNO EQU D_
                     147     ;ESCNO EQU E_
                     148     ;ESCNO EQU F_
                     149     ;ESCNO EQU G_
                     150     ;ESCNO EQU H_
                     151     ;ESCNO EQU I_
  000A               152     ESCNO EQU J_
                     153     ;ESCNO EQU K_
                     154     ;ESCNO EQU L_
                     155     ;ESCNO EQU M_
                     156     ;ESCNO EQU N_
                     157     ;ESCNO EQU O_
                     158     ;ESCNO EQU P_
                     159     ;ESCNO EQU Q_
                     160     ;ESCNO EQU R_
                     161     ;ESCNO EQU S_
                     162     ;ESCNO EQU T_
                     163     ;ESCNO EQU U_
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE     4

                     164     ;ESCNO EQU V_
                     165     ;ESCNO EQU W_
                     166     ;ESCNO EQU X_
                     167     ;ESCNO EQU Y_
                     168     ;ESCNO EQU Z_
                     169     ;ESCNO EQU A_X_  ; Requires MCU_48MHZ=2
                     170     ;ESCNO EQU B_X_  ; Requires MCU_48MHZ=2
                     171     ;ESCNO EQU C_X_  ; Requires MCU_48MHZ=2
                     172     ;ESCNO EQU D_X_  ; Requires MCU_48MHZ=2
                     173     ;ESCNO EQU E_X_  ; Requires MCU_48MHZ=2
                     174     
                     175     ;**** **** **** **** ****
                     176     ; Select the MCU type (or unselect for use with external batch compile file)
  0001               177     MCU_48MHZ EQU   1
                     178     
                     179     ;**** **** **** **** ****
                     180     ; Select the fet deadtime (or unselect for use with external batch compile file)
  001E               181     FETON_DELAY EQU 30      ; 20.4ns per step
                     182     
                     183     
                     184     ;**** **** **** **** ****
                     185     ; ESC selection statements
                     186     IF ESCNO == A_
                             ;$include (A.inc) ; Select pinout A
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "A"
                +1           ; X  X  RC X  MC MB MA CC    X  X  Cc Cp Bc Bp Ac Ap
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE     5

                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE     6

                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE     7

                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE     8

                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE     9

                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    10

                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    11

                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    12

                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    13

                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    14

                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    15

                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    16

                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#A_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#A_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#A_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#A_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#A_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#A_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#A_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#A_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#A_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#A_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#A_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    17

                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#A_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#A_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#A_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#A_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#A_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#A_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#A_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#A_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#A_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#A_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#A_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_C           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_A           EQU     1       ;i
                +1           Comp_Com                EQU     0       ;i
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    18

                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    19

                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    20

                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CcomFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           BcomFET         EQU     3       ;o
                +1           BpwmFET         EQU     2       ;o
                +1           AcomFET         EQU     1       ;o
                +1           ApwmFET         EQU     0       ;o
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    21

                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    22

                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #2Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    23

                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    24

                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                    1498     
                    1499     IF ESCNO == B_
                             ;$include (B.inc) ; Select pinout B
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "B". Equals "A", but with A and C fets swapped and pwm and com f
                             ets swapped
                +1           ; X  X  RC X  MC MB MA CC    X  X  Ap Ac Bp Bc Cp Cc
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    25

                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    26

                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    27

                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    28

                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    29

                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    30

                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    31

                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    32

                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    33

                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    34

                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    35

                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    36

                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#B_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#B_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#B_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#B_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#B_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#B_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#B_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#B_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    37

                +1           Eep_ESC_Layout:         DB      "#B_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#B_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#B_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#B_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#B_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#B_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#B_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#B_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#B_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#B_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#B_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#B_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#B_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#B_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    38

                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_C           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_A           EQU     1       ;i
                +1           Comp_Com                EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    39

                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #00h                           ; Pwm noninverted
                +1           ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    40

                +1                   mov     PCA0POL, #01h                           ; Damping inverted, pwm noninverted
                +1           ENDIF
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    41

                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           ApwmFET         EQU     5       ;o
                +1           AcomFET         EQU     4       ;o
                +1           BpwmFET         EQU     3       ;o
                +1           BcomFET         EQU     2       ;o
                +1           CpwmFET         EQU     1       ;o
                +1           CcomFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    42

                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #1Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #37h
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    43

                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    44

                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                    2816     
                    2817     IF ESCNO == C_
                             ;$include (C.inc) ; Select pinout C
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    45

                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "C"
                +1           ; Ac Ap MC MB MA CC X  RC    X  X  X  X  Cc Cp Bc Bp
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    46

                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    47

                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    48

                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    49

                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    50

                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    51

                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    52

                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    53

                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    54

                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    55

                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    56

                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#C_L_00#        "      ; ESC layout tag
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    57

                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#C_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#C_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#C_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#C_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#C_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#C_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#C_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#C_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#C_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#C_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#C_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#C_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#C_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#C_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#C_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#C_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#C_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#C_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#C_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#C_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#C_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    58

                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     0               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           AcomFET         EQU     7       ;o
                +1           ApwmFET         EQU     6       ;o
                +1           Mux_C           EQU     5       ;i
                +1           Mux_B           EQU     4       ;i
                +1           Mux_A           EQU     3       ;i
                +1           Comp_Com                EQU     2       ;i
                +1           ;                       EQU     1       ;i
                +1           Rcp_In          EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     NOT((1 SHL ApwmFET)+(1 SHL AcomFET))
                +1           P0_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL AcomFET)
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    59

                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    60

                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    61

                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           ;                       EQU     5       ;i
                +1           ;                       EQU     4       ;i
                +1           CcomFET         EQU     3       ;o
                +1           CpwmFET         EQU     2       ;o
                +1           BcomFET         EQU     1       ;o
                +1           BpwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     0Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P0.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P0.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P0.ApwmFET
                +1           ELSE
                +1                   clr     P0.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    62

                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P0.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P0.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P0.ApwmFET
                +1           ENDIF
                +1                   setb    P0.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P0.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P0.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P0.AcomFET
                +1                   mov     P0SKIP, #0BFh
                +1                   mov     P1SKIP, #0Fh
                +1           ELSE
                +1                   mov     P0SKIP, #03Fh
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #0Eh
                +1           ELSE
                +1                   mov     P0SKIP, #0FFh
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    63

                +1                   mov     P1SKIP, #0Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #0Bh
                +1           ELSE
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #03h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #0Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #32h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #42h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #52h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    64

                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                    4136     
                    4137     IF ESCNO == D_
                             ;$include (D.inc) ; Select pinout D
                +1           ;**** **** **** **** ****
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    65

                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "D". Com fets are active low for H/L_N driver and EN_N/PWM driver
                +1           ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    66

                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    67

                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    68

                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    69

                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    70

                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    71

                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    72

                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    73

                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    74

                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    75

                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    76

                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    77

                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#D_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#D_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#D_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#D_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#D_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#D_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#D_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#D_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#D_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#D_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#D_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#D_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#D_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#D_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#D_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#D_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#D_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#D_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#D_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#D_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#D_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#D_H_90#        "
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    78

                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Comp_Com                EQU     3       ;i
                +1           Mux_A           EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           Mux_B           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    79

                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    80

                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #00h                           ; Damping noninverted, pwm noninver
                             ted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    81

                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CcomFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           BcomFET         EQU     3       ;o
                +1           BpwmFET         EQU     2       ;o
                +1           AcomFET         EQU     1       ;o
                +1           ApwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    82

                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   setb    P1.AcomFET
                +1                   setb    P1.BcomFET
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   setb    P1.AcomFET
                +1                   setb    P1.BcomFET
                +1                   setb    P1.CcomFET
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    83

                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.AcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CcomFET
                +1                   mov     P1SKIP, #2Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    84

                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    85

                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                    5449     
                    5450     IF ESCNO == E_
                             ;$include (E.inc) ; Select pinout E
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "E". Equals "A", but with LED control. And with HIP2103/4 driver
                              initialization
                +1           ; L1 L0 RC X  MC MB MA CC    X  L2 Cc Cp Bc Bp Ac Ap
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    86

                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    87

                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    88

                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    89

                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    90

                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    91

                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    92

                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    93

                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    94

                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    95

                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    96

                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    97

                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#E_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#E_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#E_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#E_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#E_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#E_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#E_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#E_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#E_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#E_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#E_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#E_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#E_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#E_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#E_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#E_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    98

                +1           Eep_ESC_Layout:         DB      "#E_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#E_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#E_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#E_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#E_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#E_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           LED_1           EQU     7       ;o
                +1           LED_0           EQU     6       ;o
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_C           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_A           EQU     1       ;i
                +1           Comp_Com                EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     NOT((1 SHL LED_0)+(1 SHL LED_1))
                +1           P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE    99

                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   100

                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   101

                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           LED_2           EQU     6       ;o
                +1           CcomFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           BcomFET         EQU     3       ;o
                +1           BpwmFET         EQU     2       ;o
                +1           AcomFET         EQU     1       ;o
                +1           ApwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)+(1 SHL LED_2)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)+(1 SHL LED_2)
                +1           P1_SKIP         EQU     7Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   102

                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   103

                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #7Eh
                +1           ELSE
                +1                   mov     P1SKIP, #7Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #7Bh
                +1           ELSE
                +1                   mov     P1SKIP, #73h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #6Fh
                +1           ELSE
                +1                   mov     P1SKIP, #4Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   104

                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1                   All_pwmFETs_off ; For unlocking of HIP2103/4 driver circuits
                +1                   call wait100ms
                +1                   AcomFET_on
                +1                   BcomFET_on
                +1                   CcomFET_on
                +1                   call wait1ms
                +1                   All_comFETs_off
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   105

                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1                   setb    P0.LED_0
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1                   clr     P0.LED_0
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1                   setb    P0.LED_1
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1                   clr     P0.LED_1
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1                   setb    P1.LED_2
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1                   clr     P1.LED_2
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                    6775     
                    6776     IF ESCNO == F_
                             ;$include (F.inc) ; Select pinout F
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "F". Equals "A", but with Mux_A and Mux_C swapped
                +1           ; X  X  RC X  MA MB MC CC    X  X  Cc Cp Bc Bp Ac Ap
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   106

                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   107

                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   108

                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   109

                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   110

                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   111

                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   112

                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   113

                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   114

                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   115

                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   116

                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   117

                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#F_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#F_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#F_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#F_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#F_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#F_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#F_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#F_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#F_L_50#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   118

                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#F_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#F_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#F_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#F_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#F_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#F_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#F_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#F_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#F_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#F_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#F_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#F_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#F_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   119

                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_A           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           Comp_Com                EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   120

                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   121

                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   122

                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CcomFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           BcomFET         EQU     3       ;o
                +1           BpwmFET         EQU     2       ;o
                +1           AcomFET         EQU     1       ;o
                +1           ApwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   123

                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #2Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #30h    ; Set comparator multiplexer to phase A
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   124

                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   125

                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                    8088     
                    8089     IF ESCNO == G_
                             ;$include (G.inc) ; Select pinout G
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   126

                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "G"
                +1           ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   127

                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   128

                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   129

                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   130

                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   131

                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   132

                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   133

                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   134

                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   135

                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   136

                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   137

                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#G_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#G_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#G_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#G_L_15#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   138

                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#G_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#G_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#G_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#G_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#G_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#G_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#G_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#G_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#G_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#G_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#G_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#G_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#G_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#G_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#G_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#G_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#G_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#G_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   139

                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Comp_Com                EQU     3       ;i
                +1           Mux_A           EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           Mux_B           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   140

                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   141

                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   142

                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CcomFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           BcomFET         EQU     3       ;o
                +1           BpwmFET         EQU     2       ;o
                +1           AcomFET         EQU     1       ;o
                +1           ApwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   143

                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #2Fh
                +1           ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   144

                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   145

                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                    9401     
                    9402     IF ESCNO == H_
                             ;$include (H.inc) ; Select pinout H
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   146

                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "H". 
                +1           ; RC X  X  X  MA MB CC MC    X  Ap Bp Cp X  Ac Bc Cc 
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   147

                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   148

                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   149

                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   150

                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   151

                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   152

                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   153

                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   154

                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   155

                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   156

                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   157

                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   158

                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#H_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#H_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#H_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#H_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#H_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#H_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#H_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#H_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#H_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#H_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#H_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#H_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#H_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#H_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#H_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#H_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#H_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#H_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#H_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#H_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#H_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#H_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   159

                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     7               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           Rcp_In          EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           ;                       EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_A           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Comp_Com                EQU     1       ;i
                +1           Mux_C           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   160

                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   161

                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #00h                           ; Pwm noninverted
                +1           ELSE
                +1                   mov     PCA0POL, #01h                           ; Damping inverted, pwm noninverted
                +1           ENDIF
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   162

                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ApwmFET         EQU     6       ;o
                +1           BpwmFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           ;                       EQU     3       ;i
                +1           AcomFET         EQU     2       ;o 
                +1           BcomFET         EQU     1       ;o
                +1           CcomFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     7Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   163

                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Fh
                +1           ELSE
                +1                   mov     P1SKIP, #3Bh
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   164

                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #5Fh
                +1           ELSE
                +1                   mov     P1SKIP, #5Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #6Fh
                +1           ELSE
                +1                   mov     P1SKIP, #6Eh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #31h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #21h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #01h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   165

                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   166

                   10719     
                   10720     IF ESCNO == I_
                             ;$include (I.inc) ; Select pinout I
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "I"
                +1           ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   167

                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   168

                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   169

                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   170

                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   171

                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   172

                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   173

                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   174

                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   175

                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   176

                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   177

                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   178

                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#I_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#I_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#I_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#I_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#I_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#I_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#I_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#I_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#I_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#I_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#I_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#I_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#I_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#I_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#I_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#I_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#I_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#I_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#I_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#I_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   179

                +1           Eep_ESC_Layout:         DB      "#I_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#I_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_C           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_A           EQU     1       ;i
                +1           Comp_Com                EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   180

                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   181

                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   182

                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           AcomFET         EQU     5       ;o
                +1           BcomFET         EQU     4       ;o
                +1           CcomFET         EQU     3       ;o
                +1           ApwmFET         EQU     2       ;o
                +1           BpwmFET         EQU     1       ;o
                +1           CpwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   183

                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   184

                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #1Bh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #2Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #36h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   185

                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   186

                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   12031     
                   12032     IF ESCNO == J_
                   12033     ;$include (J.inc) ; Select pinout J
                +1 12034     ;**** **** **** **** ****
                +1 12035     ;
                +1 12036     ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1 12037     ;
                +1 12038     ; Copyright 2011, 2012 Steffen Skaug
                +1 12039     ; This program is distributed under the terms of the GNU General Public License
                +1 12040     ;
                +1 12041     ; This file is part of BLHeli.
                +1 12042     ;
                +1 12043     ; BLHeli is free software: you can redistribute it and/or modify
                +1 12044     ; it under the terms of the GNU General Public License as published by
                +1 12045     ; the Free Software Foundation, either version 3 of the License, or
                +1 12046     ; (at your option) any later version.
                +1 12047     ;
                +1 12048     ; BLHeli is distributed in the hope that it will be useful,
                +1 12049     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1 12050     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1 12051     ; GNU General Public License for more details.
                +1 12052     ;
                +1 12053     ; You should have received a copy of the GNU General Public License
                +1 12054     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1 12055     ;
                +1 12056     ;**** **** **** **** ****
                +1 12057     ;
                +1 12058     ; Hardware definition file "J"
                +1 12059     ; L2 L1 L0 RC CC MB MC MA    X  X  Cc Bc Ac Cp Bp Ap
                +1 12060     ;
                +1 12061     ;**** **** **** **** ****
                +1 12062     
                +1 12063     
                +1 12064     
                +1 12065     ;*********************
                +1 12066     ; Device SiLabs EFM8BB1x/2x
                +1 12067     ;*********************
                +1 12068     IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   187

                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   188

                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   189

                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   190

                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   191

                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1 12395     ;$include (SI_EFM8BB2_Defs.inc)
                +2 12396     ;------------------------------------------------------------------------------
                +2 12397     ; Copyright 2014 Silicon Laboratories, Inc.
                +2 12398     ; All rights reserved. This program and the accompanying materials
                +2 12399     ; are made available under the terms of the Silicon Laboratories End User
                +2 12400     ; License Agreement which accompanies this distribution, and is available at
                +2 12401     ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2 12402     ; Original content and implementation provided by Silicon Laboratories.
                +2 12403     ;------------------------------------------------------------------------------
                +2 12404     ;Supported Devices:
                +2 12405     ;  EFM8BB21F16G_QFN20
                +2 12406     ;  EFM8BB21F16G_QSOP24
                +2 12407     ;  EFM8BB21F16I_QFN20
                +2 12408     ;  EFM8BB21F16I_QSOP24
                +2 12409     ;  EFM8BB22F16G_QFN28
                +2 12410     ;  EFM8BB22F16I_QFN28
                +2 12411     
                +2 12412     ;-----------------------------------------------------------------------------
                +2 12413     ; Register Definitions
                +2 12414     ;-----------------------------------------------------------------------------
  00E0          +2 12415     ACC       DATA 0E0H; Accumulator                            
  00B3          +2 12416     ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
  00BC          +2 12417     ADC0CF    DATA 0BCH; ADC0 Configuration                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   192

  00E8          +2 12418     ADC0CN0   DATA 0E8H; ADC0 Control 0                         
  00B2          +2 12419     ADC0CN1   DATA 0B2H; ADC0 Control 1                         
  00C4          +2 12420     ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
  00C3          +2 12421     ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
  00BE          +2 12422     ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
  00BD          +2 12423     ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
  00C6          +2 12424     ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
  00C5          +2 12425     ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
  00BB          +2 12426     ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
  00DF          +2 12427     ADC0PWR   DATA 0DFH; ADC0 Power Control                     
  00B9          +2 12428     ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
  00F0          +2 12429     B         DATA 0F0H; B Register                             
  008E          +2 12430     CKCON0    DATA 08EH; Clock Control 0                        
  00A6          +2 12431     CKCON1    DATA 0A6H; Clock Control 1
  00A9          +2 12432     CLKSEL    DATA 0A9H; Clock Select                           
  009B          +2 12433     CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
  0099          +2 12434     CMP0CN1   DATA 099H; Comparator 0 Control 1
  009D          +2 12435     CMP0MD    DATA 09DH; Comparator 0 Mode                      
  009F          +2 12436     CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
  00BF          +2 12437     CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
  00AC          +2 12438     CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
  00AB          +2 12439     CMP1MD    DATA 0ABH; Comparator 1 Mode                      
  00AA          +2 12440     CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
  00CE          +2 12441     CRC0CN0   DATA 0CEH; CRC0 Control 0                         
  0086          +2 12442     CRC0CN1   DATA 086H; CRC0 Control 1                         
  00D3          +2 12443     CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
  00DE          +2 12444     CRC0DAT   DATA 0DEH; CRC0 Data Output                       
  00CF          +2 12445     CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
  00DD          +2 12446     CRC0IN    DATA 0DDH; CRC0 Data Input                        
  00D2          +2 12447     CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
  00AD          +2 12448     DERIVID   DATA 0ADH; Derivative Identification              
  00B5          +2 12449     DEVICEID  DATA 0B5H; Device Identification                  
  0083          +2 12450     DPH       DATA 083H; Data Pointer High                      
  0082          +2 12451     DPL       DATA 082H; Data Pointer Low                       
  00E6          +2 12452     EIE1      DATA 0E6H; Extended Interrupt Enable 1            
  00CE          +2 12453     EIE2      DATA 0CEH; Extended Interrupt Enable 2            
  00F3          +2 12454     EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
  00F5          +2 12455     EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
  00F4          +2 12456     EIP2      DATA 0F4H; Extended Interrupt Priority 2          
  00F6          +2 12457     EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
  00E7          +2 12458     EMI0CN    DATA 0E7H; External Memory Interface Control      
  00B7          +2 12459     FLKEY     DATA 0B7H; Flash Lock and Key                     
  00C7          +2 12460     HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
  00D6          +2 12461     HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
  00EF          +2 12462     HFOCN     DATA 0EFH; High Frequency Oscillator Control      
  00BA          +2 12463     I2C0CN0   DATA 0BAH; I2C0 Control                           
  00BC          +2 12464     I2C0DIN   DATA 0BCH; I2C0 Received Data                     
  00BB          +2 12465     I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
  00AD          +2 12466     I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
  00AB          +2 12467     I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
  00F5          +2 12468     I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
  00BD          +2 12469     I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
  00B9          +2 12470     I2C0STAT  DATA 0B9H; I2C0 Status                            
  00A8          +2 12471     IE        DATA 0A8H; Interrupt Enable                       
  00B8          +2 12472     IP        DATA 0B8H; Interrupt Priority                     
  00F2          +2 12473     IPH       DATA 0F2H; Interrupt Priority High                
  00E4          +2 12474     IT01CF    DATA 0E4H; INT0/INT1 Configuration                
  00B1          +2 12475     LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
  0080          +2 12476     P0        DATA 080H; Port 0 Pin Latch                       
  00FE          +2 12477     P0MASK    DATA 0FEH; Port 0 Mask                            
  00FD          +2 12478     P0MAT     DATA 0FDH; Port 0 Match                           
  00F1          +2 12479     P0MDIN    DATA 0F1H; Port 0 Input Mode                      
  00A4          +2 12480     P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
  00D4          +2 12481     P0SKIP    DATA 0D4H; Port 0 Skip                            
  0090          +2 12482     P1        DATA 090H; Port 1 Pin Latch                       
  00EE          +2 12483     P1MASK    DATA 0EEH; Port 1 Mask                            
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   193

  00ED          +2 12484     P1MAT     DATA 0EDH; Port 1 Match                           
  00F2          +2 12485     P1MDIN    DATA 0F2H; Port 1 Input Mode                      
  00A5          +2 12486     P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
  00D5          +2 12487     P1SKIP    DATA 0D5H; Port 1 Skip                            
  00A0          +2 12488     P2        DATA 0A0H; Port 2 Pin Latch                       
  00FC          +2 12489     P2MASK    DATA 0FCH; Port 2 Mask                            
  00FB          +2 12490     P2MAT     DATA 0FBH; Port 2 Match                           
  00F3          +2 12491     P2MDIN    DATA 0F3H; Port 2 Input Mode                      
  00A6          +2 12492     P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
  00CC          +2 12493     P2SKIP    DATA 0CCH; Port 2 Skip                            
  00B0          +2 12494     P3        DATA 0B0H; Port 3 Pin Latch                       
  00F4          +2 12495     P3MDIN    DATA 0F4H; Port 3 Input Mode                      
  009C          +2 12496     P3MDOUT   DATA 09CH; Port 3 Output Mode                     
  009E          +2 12497     PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
  009C          +2 12498     PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
  00D8          +2 12499     PCA0CN0   DATA 0D8H; PCA Control                            
  00FC          +2 12500     PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
  00EA          +2 12501     PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
  00EC          +2 12502     PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
  00FB          +2 12503     PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
  00E9          +2 12504     PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
  00EB          +2 12505     PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
  00DA          +2 12506     PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
  00DB          +2 12507     PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
  00DC          +2 12508     PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
  00FA          +2 12509     PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
  00F9          +2 12510     PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
  00D9          +2 12511     PCA0MD    DATA 0D9H; PCA Mode                               
  0096          +2 12512     PCA0POL   DATA 096H; PCA Output Polarity                    
  00F7          +2 12513     PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
  0087          +2 12514     PCON0     DATA 087H; Power Control                          
  009A          +2 12515     PCON1     DATA 09AH; Power Control 1                        
  00C1          +2 12516     PFE0CN    DATA 0C1H; Prefetch Engine Control                
  00F6          +2 12517     PRTDRV    DATA 0F6H; Port Drive Strength                    
  008F          +2 12518     PSCTL     DATA 08FH; Program Store Control                  
  00D0          +2 12519     PSW       DATA 0D0H; Program Status Word                    
  00D1          +2 12520     REF0CN    DATA 0D1H; Voltage Reference Control              
  00C9          +2 12521     REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
  00C6          +2 12522     REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
  00B6          +2 12523     REVID     DATA 0B6H; Revision Identifcation                 
  00EF          +2 12524     RSTSRC    DATA 0EFH; Reset Source                           
  0094          +2 12525     SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
  0096          +2 12526     SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
  0095          +2 12527     SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
  0099          +2 12528     SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
  0092          +2 12529     SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
  0098          +2 12530     SCON0     DATA 098H; UART0 Serial Port Control              
  00C8          +2 12531     SCON1     DATA 0C8H; UART1 Serial Port Control              
  00A7          +2 12532     SFRPAGE   DATA 0A7H; SFR Page                               
  00CF          +2 12533     SFRPGCN   DATA 0CFH; SFR Page Control                       
  00D7          +2 12534     SFRSTACK  DATA 0D7H; SFR Page Stack                         
  00D6          +2 12535     SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
  00D7          +2 12536     SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
  00C1          +2 12537     SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
  00C0          +2 12538     SMB0CN0   DATA 0C0H; SMBus 0 Control                        
  00C2          +2 12539     SMB0DAT   DATA 0C2H; SMBus 0 Data                           
  00C3          +2 12540     SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
  00C4          +2 12541     SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
  00EF          +2 12542     SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
  00C5          +2 12543     SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
  00AC          +2 12544     SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
  0093          +2 12545     SMOD1     DATA 093H; UART1 Mode                             
  0081          +2 12546     SP        DATA 081H; Stack Pointer                          
  00A1          +2 12547     SPI0CFG   DATA 0A1H; SPI0 Configuration                     
  00A2          +2 12548     SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
  00F8          +2 12549     SPI0CN0   DATA 0F8H; SPI0 Control                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   194

  00A3          +2 12550     SPI0DAT   DATA 0A3H; SPI0 Data                              
  009A          +2 12551     SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
  009B          +2 12552     SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
  00F7          +2 12553     SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
  0088          +2 12554     TCON      DATA 088H; Timer 0/1 Control                      
  008C          +2 12555     TH0       DATA 08CH; Timer 0 High Byte                      
  008D          +2 12556     TH1       DATA 08DH; Timer 1 High Byte                      
  008A          +2 12557     TL0       DATA 08AH; Timer 0 Low Byte                       
  008B          +2 12558     TL1       DATA 08BH; Timer 1 Low Byte                       
  0089          +2 12559     TMOD      DATA 089H; Timer 0/1 Mode                         
  00C8          +2 12560     TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
  00FD          +2 12561     TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
  00CD          +2 12562     TMR2H     DATA 0CDH; Timer 2 High Byte                      
  00CC          +2 12563     TMR2L     DATA 0CCH; Timer 2 Low Byte                       
  00CB          +2 12564     TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
  00CA          +2 12565     TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
  0091          +2 12566     TMR3CN0   DATA 091H; Timer 3 Control 0                      
  00FE          +2 12567     TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
  0095          +2 12568     TMR3H     DATA 095H; Timer 3 High Byte                      
  0094          +2 12569     TMR3L     DATA 094H; Timer 3 Low Byte                       
  0093          +2 12570     TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
  0092          +2 12571     TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
  0098          +2 12572     TMR4CN0   DATA 098H; Timer 4 Control 0                      
  00FF          +2 12573     TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
  00A5          +2 12574     TMR4H     DATA 0A5H; Timer 4 High Byte                      
  00A4          +2 12575     TMR4L     DATA 0A4H; Timer 4 Low Byte                       
  00A3          +2 12576     TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
  00A2          +2 12577     TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
  009D          +2 12578     UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
  00D8          +2 12579     UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
  00FA          +2 12580     UART1FCT  DATA 0FAH; UART1 FIFO Count                       
  009E          +2 12581     UART1LIN  DATA 09EH; UART1 LIN Configuration                
  00FF          +2 12582     VDM0CN    DATA 0FFH; Supply Monitor Control                 
  0097          +2 12583     WDTCN     DATA 097H; Watchdog Timer Control                 
  00E1          +2 12584     XBR0      DATA 0E1H; Port I/O Crossbar 0                    
  00E2          +2 12585     XBR1      DATA 0E2H; Port I/O Crossbar 1                    
  00E3          +2 12586     XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2 12587     
                +2 12588     ;------------------------------------------------------------------------------
                +2 12589     ; 16-bit Register Definitions (may not work on all compilers)
                +2 12590     ;------------------------------------------------------------------------------
  00C3          +2 12591     ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
  00BD          +2 12592     ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
  00C5          +2 12593     ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
  0082          +2 12594     DP      DATA 082H ; Data Pointer Low                     
  00FB          +2 12595     PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
  00E9          +2 12596     PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
  00EB          +2 12597     PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
  00F9          +2 12598     PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
  0095          +2 12599     SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
  00CC          +2 12600     TMR2    DATA 0CCH ; Timer 2 Low Byte                     
  00CA          +2 12601     TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
  0094          +2 12602     TMR3    DATA 094H ; Timer 3 Low Byte                     
  0092          +2 12603     TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
  00A4          +2 12604     TMR4    DATA 0A4H ; Timer 4 Low Byte                     
  00A2          +2 12605     TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2 12606     
                +2 12607     ;------------------------------------------------------------------------------
                +2 12608     ; Indirect Register Definitions
                +2 12609     ;------------------------------------------------------------------------------
                +2 12610     
                +2 12611     ;------------------------------------------------------------------------------
                +2 12612     ; Bit Definitions
                +2 12613     ;------------------------------------------------------------------------------
                +2 12614     
                +2 12615     ; ACC 0xE0 (Accumulator)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   195

  00E0          +2 12616     ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
  00E1          +2 12617     ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
  00E2          +2 12618     ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
  00E3          +2 12619     ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
  00E4          +2 12620     ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
  00E5          +2 12621     ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
  00E6          +2 12622     ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
  00E7          +2 12623     ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2 12624     
                +2 12625     ; ADC0CN0 0xE8 (ADC0 Control 0)
  00E8          +2 12626     ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
  00E9          +2 12627     ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
  00EA          +2 12628     ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
  00EB          +2 12629     ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
  00EC          +2 12630     ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
  00ED          +2 12631     ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
  00EE          +2 12632     ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
  00EF          +2 12633     ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2 12634     
                +2 12635     ; B 0xF0 (B Register)
  00F0          +2 12636     B_B0 BIT B.0 ; B Register Bit 0
  00F1          +2 12637     B_B1 BIT B.1 ; B Register Bit 1
  00F2          +2 12638     B_B2 BIT B.2 ; B Register Bit 2
  00F3          +2 12639     B_B3 BIT B.3 ; B Register Bit 3
  00F4          +2 12640     B_B4 BIT B.4 ; B Register Bit 4
  00F5          +2 12641     B_B5 BIT B.5 ; B Register Bit 5
  00F6          +2 12642     B_B6 BIT B.6 ; B Register Bit 6
  00F7          +2 12643     B_B7 BIT B.7 ; B Register Bit 7
                +2 12644     
                +2 12645     ; IE 0xA8 (Interrupt Enable)
  00A8          +2 12646     IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
  00A9          +2 12647     IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
  00AA          +2 12648     IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
  00AB          +2 12649     IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
  00AC          +2 12650     IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
  00AD          +2 12651     IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
  00AE          +2 12652     IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
  00AF          +2 12653     IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2 12654     
                +2 12655     ; IP 0xB8 (Interrupt Priority)
  00B8          +2 12656     IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
  00B9          +2 12657     IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
  00BA          +2 12658     IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
  00BB          +2 12659     IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
  00BC          +2 12660     IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
  00BD          +2 12661     IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
  00BE          +2 12662     IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2 12663     
                +2 12664     ; P0 0x80 (Port 0 Pin Latch)
  0080          +2 12665     P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
  0081          +2 12666     P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
  0082          +2 12667     P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
  0083          +2 12668     P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
  0084          +2 12669     P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
  0085          +2 12670     P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
  0086          +2 12671     P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
  0087          +2 12672     P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2 12673     
                +2 12674     ; P1 0x90 (Port 1 Pin Latch)
  0090          +2 12675     P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
  0091          +2 12676     P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
  0092          +2 12677     P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
  0093          +2 12678     P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
  0094          +2 12679     P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
  0095          +2 12680     P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
  0096          +2 12681     P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   196

  0097          +2 12682     P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2 12683     
                +2 12684     ; P2 0xA0 (Port 2 Pin Latch)
  00A0          +2 12685     P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
  00A1          +2 12686     P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
  00A2          +2 12687     P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
  00A3          +2 12688     P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2 12689     
                +2 12690     ; P3 0xB0 (Port 3 Pin Latch)
  00B0          +2 12691     P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
  00B1          +2 12692     P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2 12693     
                +2 12694     ; PCA0CN0 0xD8 (PCA Control)
  00D8          +2 12695     PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
  00D9          +2 12696     PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
  00DA          +2 12697     PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
  00DE          +2 12698     PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
  00DF          +2 12699     PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2 12700     
                +2 12701     ; PSW 0xD0 (Program Status Word)
  00D0          +2 12702     PSW_PARITY BIT PSW.0 ; Parity Flag               
  00D1          +2 12703     PSW_F1     BIT PSW.1 ; User Flag 1               
  00D2          +2 12704     PSW_OV     BIT PSW.2 ; Overflow Flag             
  00D3          +2 12705     PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
  00D4          +2 12706     PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
  00D5          +2 12707     PSW_F0     BIT PSW.5 ; User Flag 0               
  00D6          +2 12708     PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
  00D7          +2 12709     PSW_CY     BIT PSW.7 ; Carry Flag                
                +2 12710     
                +2 12711     ; SCON0 0x98 (UART0 Serial Port Control)
  0098          +2 12712     SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
  0099          +2 12713     SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
  009A          +2 12714     SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
  009B          +2 12715     SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
  009C          +2 12716     SCON0_REN   BIT SCON0.4 ; Receive Enable                     
  009D          +2 12717     SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
  009F          +2 12718     SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2 12719     
                +2 12720     ; SCON1 0xC8 (UART1 Serial Port Control)
  00C8          +2 12721     SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
  00C9          +2 12722     SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
  00CA          +2 12723     SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
  00CB          +2 12724     SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
  00CC          +2 12725     SCON1_REN  BIT SCON1.4 ; Receive Enable           
  00CE          +2 12726     SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
  00CF          +2 12727     SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2 12728     
                +2 12729     ; SMB0CN0 0xC0 (SMBus 0 Control)
  00C0          +2 12730     SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
  00C1          +2 12731     SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
  00C2          +2 12732     SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
  00C3          +2 12733     SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
  00C4          +2 12734     SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
  00C5          +2 12735     SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
  00C6          +2 12736     SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
  00C7          +2 12737     SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2 12738     
                +2 12739     ; SPI0CN0 0xF8 (SPI0 Control)
  00F8          +2 12740     SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
  00F9          +2 12741     SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
  00FA          +2 12742     SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
  00FB          +2 12743     SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
  00FC          +2 12744     SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
  00FD          +2 12745     SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
  00FE          +2 12746     SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
  00FF          +2 12747     SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   197

                +2 12748     
                +2 12749     ; TCON 0x88 (Timer 0/1 Control)
  0088          +2 12750     TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
  0089          +2 12751     TCON_IE0 BIT TCON.1 ; External Interrupt 0   
  008A          +2 12752     TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
  008B          +2 12753     TCON_IE1 BIT TCON.3 ; External Interrupt 1   
  008C          +2 12754     TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
  008D          +2 12755     TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
  008E          +2 12756     TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
  008F          +2 12757     TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2 12758     
                +2 12759     ; TMR2CN0 0xC8 (Timer 2 Control 0)
  00C8          +2 12760     TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
  00C9          +2 12761     TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
  00CA          +2 12762     TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
  00CB          +2 12763     TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
  00CC          +2 12764     TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
  00CD          +2 12765     TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
  00CE          +2 12766     TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
  00CF          +2 12767     TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2 12768     
                +2 12769     ; TMR4CN0 0x98 (Timer 4 Control 0)
  0098          +2 12770     TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
  0099          +2 12771     TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
  009A          +2 12772     TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
  009B          +2 12773     TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
  009C          +2 12774     TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
  009D          +2 12775     TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
  009E          +2 12776     TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
  009F          +2 12777     TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2 12778     
                +2 12779     ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
  00D8          +2 12780     UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
  00D9          +2 12781     UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
  00DA          +2 12782     UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
  00DB          +2 12783     UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
  00DC          +2 12784     UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
  00DD          +2 12785     UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
  00DE          +2 12786     UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
  00DF          +2 12787     UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2 12788     
                +2 12789     ;------------------------------------------------------------------------------
                +2 12790     ; Interrupt Definitions
                +2 12791     ;------------------------------------------------------------------------------
  0000          +2 12792     INT0_IRQn    EQU 0  ; External Interrupt 0      
  0001          +2 12793     TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
  0002          +2 12794     INT1_IRQn    EQU 2  ; External Interrupt 1      
  0003          +2 12795     TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
  0004          +2 12796     UART0_IRQn   EQU 4  ; UART0                     
  0005          +2 12797     TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
  0006          +2 12798     SPI0_IRQn    EQU 6  ; SPI0                      
  0007          +2 12799     SMBUS0_IRQn  EQU 7  ; SMBus 0                   
  0008          +2 12800     PMATCH_IRQn  EQU 8  ; Port Match                
  0009          +2 12801     ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
  000A          +2 12802     ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
  000B          +2 12803     PCA0_IRQn    EQU 11 ; PCA0                      
  000C          +2 12804     CMP0_IRQn    EQU 12 ; Comparator 0              
  000D          +2 12805     CMP1_IRQn    EQU 13 ; Comparator 1              
  000E          +2 12806     TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
  0011          +2 12807     UART1_IRQn   EQU 17 ; UART1                     
  0012          +2 12808     I2C0_IRQn    EQU 18 ; I2C0 Slave                
  0013          +2 12809     TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2 12810     
                +2 12811     ;------------------------------------------------------------------------------
                +2 12812     ; SFR Page Definitions
                +2 12813     ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   198

  0000          +2 12814     CRC0_PAGE       EQU 000H ; CRC0 Page       
  0000          +2 12815     LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
  0000          +2 12816     PCA0_PAGE       EQU 000H ; PCA0 Page       
  0010          +2 12817     PG2_PAGE        EQU 010H ; Page2           
  0010          +2 12818     TIMER2_PAGE     EQU 010H ; Timer 2 Page    
  0010          +2 12819     TIMER3_PAGE     EQU 010H ; Timer 3 Page    
  0010          +2 12820     TIMER4_PAGE     EQU 010H ; Timer 4 Page    
  0020          +2 12821     I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
  0020          +2 12822     PG3_PAGE        EQU 020H ; Page3           
  0020          +2 12823     SMB0_PAGE       EQU 020H ; SMBus 0 Page    
  0020          +2 12824     SPI0_PAGE       EQU 020H ; SPI0 Page       
  0020          +2 12825     UART0_PAGE      EQU 020H ; UART0 Page      
  0020          +2 12826     UART1_PAGE      EQU 020H ; UART1 Page      
                +1 12827     
                +1 12828     ENDIF
                +1 12829     
                +1 12830     
                +1 12831     ;**** **** **** **** ****
                +1 12832     ; Uses internal calibrated oscillator set to 24/48Mhz
                +1 12833     ;**** **** **** **** ****
                +1 12834     
                +1 12835     ;**** **** **** **** ****
                +1 12836     ; Constant definitions
                +1 12837     ;**** **** **** **** ****
                +1 12838     IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#J_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#J_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#J_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#J_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#J_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#J_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#J_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#J_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#J_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#J_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#J_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1 12867     
----            +1 12868     CSEG AT 1A40h
                +1 12869     IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#J_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#J_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#J_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#J_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#J_H_20#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   199

                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#J_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
1A40 234A5F48   +1 12882     Eep_ESC_Layout:         DB      "#J_H_30#        "
1A44 5F333023                
1A48 20202020                
1A4C 20202020                
                +1 12883     ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#J_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#J_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#J_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#J_H_90#        "
                +1           ENDIF
----            +1 12892     CSEG AT 1A50h
1A50 23424C48   +1 12893     Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
1A54 454C4924                
1A58 45464D38                
1A5C 42323123                
                +1 12894     ENDIF
                +1 12895     
  0031          +1 12896     TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
  0009          +1 12897     TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1 12898     
                +1 12899     ;**** **** **** **** ****
                +1 12900     ; Bootloader definitions
                +1 12901     ;**** **** **** **** ****
  0080          +1 12902     RTX_PORT                                EQU     P0              ; Receive/Transmit port
  00A4          +1 12903     RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
  00F1          +1 12904     RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
  00D4          +1 12905     RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
  0004          +1 12906     RTX_PIN                         EQU     4               ; RTX pin
                +1 12907     
  00E8          +1 12908     SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1 12909     IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
  00B2          +1 12912     SIGNATURE_002                   EQU     0B2h
                +1 12913     ENDIF
                +1 12914     
                +1 12915     ;*********************
                +1 12916     ; PORT 0 definitions *
                +1 12917     ;*********************  
  0007          +1 12918     LED_2           EQU     7       ;o
  0006          +1 12919     LED_1           EQU     6       ;o
  0005          +1 12920     LED_0           EQU     5       ;o
  0004          +1 12921     Rcp_In          EQU     4       ;i
  0003          +1 12922     Comp_Com                EQU     3       ;i
  0002          +1 12923     Mux_B           EQU     2       ;i
  0001          +1 12924     Mux_C           EQU     1       ;i
  0000          +1 12925     Mux_A           EQU     0       ;i
                +1 12926     
  FFF0          +1 12927     P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
  00FF          +1 12928     P0_INIT         EQU     0FFh
  00E0          +1 12929     P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL LED_2)
  00FF          +1 12930     P0_SKIP         EQU     0FFh
                +1 12931     
                +1 12932     Get_Rcp_Capture_Values MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   200

                +1 12933             anl     TCON, #0EFh                             ; Disable timer0
                +1 12934             mov     Temp1, TL0                              ; Get timer0 values
                +1 12935             mov     Temp2, TH0
                +1 12936     IF MCU_48MHZ == 1
                +1 12937             mov     Temp3, Timer0_X
                +1 12938             jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1 12939             inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1 12940     ENDIF
                +1 12941             mov     TL0, #0                                 ; Reset timer0
                +1 12942             mov     TH0, #0
                +1 12943     IF MCU_48MHZ == 1
                +1 12944             mov     Timer0_X, #0
                +1 12945     ENDIF
                +1 12946             orl     TCON, #10h                              ; Enable timer0 again
                +1 12947     IF MCU_48MHZ == 1
                +1 12948             mov     A, Clock_Set_At_48MHz
                +1 12949             jnz     Get_Rcp_End
                +1 12950             clr     C
                +1 12951             mov     A, Temp1
                +1 12952             rlc     A
                +1 12953             mov     Temp1, A
                +1 12954             mov     A, Temp2
                +1 12955             rlc     A
                +1 12956             mov     Temp2, A
                +1 12957             mov     A, Temp3
                +1 12958             rlc     A
                +1 12959             mov     Temp3, A
                +1 12960     Get_Rcp_End:
                +1 12961     ENDIF
                +1 12962     ENDM
                +1 12963     Decode_Dshot_2Msb MACRO
                +1 12964             movx    A, @DPTR
                +1 12965             mov     Temp6, A
                +1 12966             clr     C
                +1 12967             subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1 12968             clr     C
                +1 12969             subb    A, Temp1
                +1 12970             jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1 12971     
                +1 12972             subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1 12973             mov     A, Temp4                                        ; Shift bit into data byte
                +1 12974             rlc     A
                +1 12975             mov     Temp4, A
                +1 12976             inc     DPL                                             ; Next bit
                +1 12977             movx    A, @DPTR
                +1 12978             mov     Temp5, A
                +1 12979             clr     C
                +1 12980             subb    A, Temp6
                +1 12981             clr     C
                +1 12982             subb    A, Temp1
                +1 12983             jc      t1_int_msb_fail
                +1 12984     
                +1 12985             subb    A, Temp1
                +1 12986             mov     A, Temp4
                +1 12987             rlc     A
                +1 12988             mov     Temp4, A
                +1 12989             inc     DPL
                +1 12990     ENDM
                +1 12991     Decode_Dshot_2Lsb MACRO
                +1 12992             movx    A, @DPTR
                +1 12993             mov     Temp6, A
                +1 12994             clr     C
                +1 12995             subb    A, Temp5                                        ; Subtract previous timesta
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   201

                             mp
                +1 12996             clr     C
                +1 12997             subb    A, Temp1
                +1 12998             jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1 12999     
                +1 13000             subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1 13001             mov     A, Temp3                                        ; Shift bit into data byte
                +1 13002             rlc     A
                +1 13003             mov     Temp3, A
                +1 13004             inc     DPL                                             ; Next bit
                +1 13005             movx    A, @DPTR
                +1 13006             mov     Temp5, A
                +1 13007             clr     C
                +1 13008             subb    A, Temp6
                +1 13009             clr     C
                +1 13010             subb    A, Temp1
                +1 13011             jc      t1_int_lsb_fail
                +1 13012     
                +1 13013             subb    A, Temp1
                +1 13014             mov     A, Temp3
                +1 13015             rlc     A
                +1 13016             mov     Temp3, A
                +1 13017             inc     DPL
                +1 13018     ENDM
                +1 13019     Initialize_PCA MACRO
                +1 13020             mov     PCA0CN0, #40h                           ; PCA enabled
                +1 13021             mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1 13022     IF FETON_DELAY == 0
                +1 13023     IF MCU_48MHZ == 0
                +1 13024             mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1 13025     ELSE
                +1 13026             mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1 13027     ENDIF
                +1 13028             mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1 13029     ELSE
                +1 13030     IF MCU_48MHZ == 0
                +1 13031             mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1 13032     ELSE
                +1 13033             mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1 13034     ENDIF
                +1 13035             mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1 13036     ENDIF
                +1 13037     ENDM
                +1 13038     Set_Pwm_Polarity MACRO
                +1 13039             mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1 13040     ENDM
                +1 13041     Enable_Power_Pwm_Module MACRO
                +1 13042     IF FETON_DELAY == 0
                +1 13043             mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1 13044     ELSE
                +1 13045             mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1 13046     ENDIF
                +1 13047     ENDM
                +1 13048     Enable_Damp_Pwm_Module MACRO
                +1 13049     IF FETON_DELAY == 0
                +1 13050             mov     PCA0CPM1, #00h                          ; Disable
                +1 13051     ELSE
                +1 13052             mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1 13053     ENDIF
                +1 13054     ENDM
                +1 13055     Set_Power_Pwm_Regs MACRO
                +1 13056     IF FETON_DELAY == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   202

                +1 13057             mov     PCA0CPL0, Power_Pwm_Reg_L
                +1 13058             mov     PCA0CPH0, Power_Pwm_Reg_H
                +1 13059     ELSE
                +1 13060             clr     C
                +1 13061             mov     A, Power_Pwm_Reg_H
                +1 13062             rrc     A
                +1 13063             mov     Temp1, A
                +1 13064             mov     A, Power_Pwm_Reg_L
                +1 13065             rrc     A
                +1 13066             mov     PCA0CPL0, A
                +1 13067             mov     PCA0CPH0, Temp1
                +1 13068     ENDIF
                +1 13069     ENDM            
                +1 13070     Set_Damp_Pwm_Regs MACRO
                +1 13071     IF FETON_DELAY == 0
                +1 13072             mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1 13073             mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1 13074     ELSE
                +1 13075             clr     C
                +1 13076             mov     A, Damp_Pwm_Reg_H
                +1 13077             rrc     A
                +1 13078             mov     Temp1, A
                +1 13079             mov     A, Damp_Pwm_Reg_L
                +1 13080             rrc     A
                +1 13081             mov     PCA0CPL1, A
                +1 13082             mov     PCA0CPH1, Temp1
                +1 13083     ENDIF
                +1 13084     ENDM            
                +1 13085     Clear_COVF_Interrupt MACRO
                +1 13086             anl     PCA0PWM, #0DFh
                +1 13087     ENDM
                +1 13088     Clear_CCF_Interrupt MACRO
                +1 13089             anl     PCA0CN0, #0FEh
                +1 13090     ENDM
                +1 13091     Enable_COVF_Interrupt MACRO
                +1 13092             orl     PCA0PWM, #40h
                +1 13093     ENDM
                +1 13094     Enable_CCF_Interrupt MACRO
                +1 13095             orl     PCA0CPM0,#01h
                +1 13096     ENDM
                +1 13097     Disable_COVF_Interrupt MACRO
                +1 13098             anl     PCA0PWM, #0BFh
                +1 13099     ENDM
                +1 13100     Disable_CCF_Interrupt MACRO
                +1 13101             anl     PCA0CPM0,#0FEh
                +1 13102     ENDM
                +1 13103     
                +1 13104     ;*********************
                +1 13105     ; PORT 1 definitions *
                +1 13106     ;*********************
                +1 13107     ;                       EQU     7       ;i
                +1 13108     ;                       EQU     6       ;i
  0005          +1 13109     CcomFET         EQU     5       ;o
  0004          +1 13110     BcomFET         EQU     4       ;o
  0003          +1 13111     AcomFET         EQU     3       ;o
  0002          +1 13112     CpwmFET         EQU     2       ;o
  0001          +1 13113     BpwmFET         EQU     1       ;o
  0000          +1 13114     ApwmFET         EQU     0       ;o
                +1 13115     
  003F          +1 13116     P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
  0000          +1 13117     P1_INIT         EQU     00h             
  003F          +1 13118     P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
  003F          +1 13119     P1_SKIP         EQU     3Fh
                +1 13120     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   203

                +1 13121     ApwmFET_on MACRO
                +1 13122             setb    P1.ApwmFET
                +1 13123     IF FETON_DELAY == 0
                +1 13124             setb    P1.AcomFET
                +1 13125     ENDIF
                +1 13126     ENDM
                +1 13127     ApwmFET_off MACRO
                +1 13128     IF FETON_DELAY != 0
                +1 13129             clr     P1.ApwmFET
                +1 13130     ELSE
                +1 13131             clr     P1.AcomFET
                +1 13132     ENDIF
                +1 13133     ENDM
                +1 13134     BpwmFET_on MACRO
                +1 13135             setb    P1.BpwmFET
                +1 13136     IF FETON_DELAY == 0
                +1 13137             setb    P1.BcomFET
                +1 13138     ENDIF
                +1 13139     ENDM
                +1 13140     BpwmFET_off MACRO
                +1 13141     IF FETON_DELAY != 0
                +1 13142             clr     P1.BpwmFET
                +1 13143     ELSE
                +1 13144             clr     P1.BcomFET
                +1 13145     ENDIF
                +1 13146     ENDM
                +1 13147     CpwmFET_on MACRO
                +1 13148             setb    P1.CpwmFET
                +1 13149     IF FETON_DELAY == 0
                +1 13150             setb    P1.CcomFET
                +1 13151     ENDIF
                +1 13152     ENDM
                +1 13153     CpwmFET_off MACRO
                +1 13154     IF FETON_DELAY != 0
                +1 13155             clr     P1.CpwmFET
                +1 13156     ELSE
                +1 13157             clr     P1.CcomFET
                +1 13158     ENDIF
                +1 13159     ENDM
                +1 13160     All_pwmFETs_Off MACRO
                +1 13161     IF FETON_DELAY != 0
                +1 13162             clr     P1.ApwmFET
                +1 13163             clr     P1.BpwmFET
                +1 13164             clr     P1.CpwmFET
                +1 13165     ELSE
                +1 13166             clr     P1.AcomFET
                +1 13167             clr     P1.BcomFET
                +1 13168             clr     P1.CcomFET
                +1 13169     ENDIF
                +1 13170     ENDM
                +1 13171     
                +1 13172     AcomFET_on MACRO
                +1 13173     IF FETON_DELAY == 0
                +1 13174             clr     P1.ApwmFET
                +1 13175     ENDIF
                +1 13176             setb    P1.AcomFET
                +1 13177     ENDM
                +1 13178     AcomFET_off MACRO
                +1 13179             clr     P1.AcomFET
                +1 13180     ENDM
                +1 13181     BcomFET_on MACRO
                +1 13182     IF FETON_DELAY == 0
                +1 13183             clr     P1.BpwmFET
                +1 13184     ENDIF
                +1 13185             setb    P1.BcomFET
                +1 13186     ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   204

                +1 13187     BcomFET_off MACRO
                +1 13188             clr     P1.BcomFET
                +1 13189     ENDM
                +1 13190     CcomFET_on MACRO
                +1 13191     IF FETON_DELAY == 0
                +1 13192             clr     P1.CpwmFET
                +1 13193     ENDIF
                +1 13194             setb    P1.CcomFET
                +1 13195     ENDM
                +1 13196     CcomFET_off MACRO
                +1 13197             clr     P1.CcomFET
                +1 13198     ENDM
                +1 13199     All_comFETs_Off MACRO
                +1 13200             clr     P1.AcomFET
                +1 13201             clr     P1.BcomFET
                +1 13202             clr     P1.CcomFET
                +1 13203     ENDM
                +1 13204     
                +1 13205     Set_Pwm_A MACRO
                +1 13206     IF FETON_DELAY == 0
                +1 13207             setb    P1.AcomFET
                +1 13208             mov     P1SKIP, #3Eh
                +1 13209     ELSE
                +1 13210             mov     P1SKIP, #36h
                +1 13211     ENDIF
                +1 13212     ENDM
                +1 13213     Set_Pwm_B MACRO
                +1 13214     IF FETON_DELAY == 0
                +1 13215             setb    P1.BcomFET
                +1 13216             mov     P1SKIP, #3Dh
                +1 13217     ELSE
                +1 13218             mov     P1SKIP, #2Dh
                +1 13219     ENDIF
                +1 13220     ENDM
                +1 13221     Set_Pwm_C MACRO
                +1 13222     IF FETON_DELAY == 0
                +1 13223             setb    P1.CcomFET
                +1 13224             mov     P1SKIP, #3Bh
                +1 13225     ELSE
                +1 13226             mov     P1SKIP, #1Bh
                +1 13227     ENDIF
                +1 13228     ENDM
                +1 13229     Set_Pwms_Off MACRO
                +1 13230             mov     P1SKIP, #7Fh
                +1 13231     ENDM
                +1 13232     
                +1 13233     Set_Comp_Phase_A MACRO
                +1 13234             mov     CMP0MX, #03h    ; Set comparator multiplexer to phase A
                +1 13235     ENDM
                +1 13236     Set_Comp_Phase_B MACRO
                +1 13237             mov     CMP0MX, #23h    ; Set comparator multiplexer to phase B
                +1 13238     ENDM
                +1 13239     Set_Comp_Phase_C MACRO
                +1 13240             mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                +1 13241     ENDM
                +1 13242     Read_Comp_Out MACRO
                +1 13243             mov     A, CMP0CN0      ; Read comparator output
                +1 13244     ENDM
                +1 13245     
                +1 13246     
                +1 13247     ;*********************
                +1 13248     ; PORT 2 definitions *
                +1 13249     ;*********************
  0000          +1 13250     DebugPin                EQU     0       ;o
                +1 13251     
  0001          +1 13252     P2_PUSHPULL     EQU     (1 SHL DebugPin)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   205

                +1 13253     
                +1 13254     
                +1 13255     ;**********************
                +1 13256     ; MCU specific macros *
                +1 13257     ;**********************
                +1 13258     Interrupt_Table_Definition MACRO
                +1 13259     CSEG AT 0                               ; Code segment start
                +1 13260             jmp reset
                +1 13261     CSEG AT 03h                     ; Int0 interrupt        
                +1 13262             jmp     int0_int        
                +1 13263     IF MCU_48MHZ == 1
                +1 13264     CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1 13265             jmp     t0_int
                +1 13266     ENDIF
                +1 13267     CSEG AT 13h                     ; Int1 interrupt
                +1 13268             jmp     int1_int
                +1 13269     CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1 13270             jmp     t1_int
                +1 13271     CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1 13272             jmp     t2_int  
                +1 13273     CSEG AT 5Bh                     ; Pca interrupt
                +1 13274             jmp     pca_int
                +1 13275     CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1 13276             jmp     t3_int  
                +1 13277     ENDM
                +1 13278     
                +1 13279     Initialize_Xbar MACRO
                +1 13280             mov     XBR2, #40h      ; Xbar enabled                  
                +1 13281             mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1 13282     ENDM
                +1 13283     
                +1 13284     Initialize_Comparator MACRO
                +1 13285             mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1 13286             mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1 13287     ENDM
                +1 13288     Initialize_Adc MACRO
                +1 13289             mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1 13290     IF MCU_48MHZ == 0
                +1 13291             mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1 13292     ELSE
                +1 13293             mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1 13294     ENDIF
                +1 13295             mov     ADC0MX, #10h    ; Select temp sensor input
                +1 13296             mov     ADC0CN0, #80h   ; ADC enabled 
                +1 13297             mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1 13298     ENDM
                +1 13299     Start_Adc MACRO
                +1 13300             mov     ADC0CN0, #90h   ; ADC start
                +1 13301     ENDM
                +1 13302     Read_Adc_Result MACRO
                +1 13303             mov     Temp1, ADC0L
                +1 13304             mov     Temp2, ADC0H
                +1 13305     ENDM
                +1 13306     Stop_Adc MACRO
                +1 13307     ENDM
                +1 13308     Set_RPM_Out MACRO
                +1 13309     ENDM
                +1 13310     Clear_RPM_Out MACRO
                +1 13311     ENDM
                +1 13312     Set_MCU_Clk_24MHz MACRO
                +1 13313             mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1 13314             mov     SFRPAGE, #10h
                +1 13315             mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1 13316             mov     SFRPAGE, #00h
                +1 13317             mov     Clock_Set_At_48MHz, #0
                +1 13318     ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   206

                +1 13319     Set_MCU_Clk_48MHz MACRO
                +1 13320             mov     SFRPAGE, #10h
                +1 13321             mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1 13322             mov     SFRPAGE, #00h
                +1 13323             mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1 13324             mov     Clock_Set_At_48MHz, #1
                +1 13325     ENDM
                +1 13326     Set_LED_0 MACRO
                +1 13327             clr     P0.LED_0
                +1 13328     ENDM
                +1 13329     Clear_LED_0 MACRO
                +1 13330             setb    P0.LED_0
                +1 13331     ENDM
                +1 13332     Set_LED_1 MACRO
                +1 13333             clr     P0.LED_1
                +1 13334     ENDM
                +1 13335     Clear_LED_1 MACRO
                +1 13336             setb    P0.LED_1
                +1 13337     ENDM
                +1 13338     Set_LED_2 MACRO
                +1 13339             clr     P0.LED_2
                +1 13340     ENDM
                +1 13341     Clear_LED_2 MACRO
                +1 13342             setb    P0.LED_2
                +1 13343     ENDM
                +1 13344     Set_LED_3 MACRO
                +1 13345     ENDM
                +1 13346     Clear_LED_3 MACRO
                +1 13347     ENDM
                   13348     ENDIF
                   13349     
                   13350     IF ESCNO == K_
                             ;$include (K.inc) ; Select pinout K
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "K". Com fets are active low for H/L_N driver and EN_N/PWM driver
                +1           ; X  X  MC X  MB CC MA RC    X  X  Ap Bp Cp Cc Bc Ac    Com fets inverted
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   207

                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   208

                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   209

                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   210

                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   211

                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   212

                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   213

                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   214

                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   215

                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   216

                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   217

                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   218

                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#K_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#K_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#K_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#K_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#K_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#K_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#K_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#K_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#K_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   219

                +1           Eep_ESC_Layout:         DB      "#K_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#K_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#K_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#K_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#K_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#K_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#K_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#K_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#K_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#K_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#K_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#K_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#K_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     0               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   220

                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Mux_C           EQU     5       ;i
                +1           ;                       EQU     4       ;i
                +1           Mux_B           EQU     3       ;i
                +1           Comp_Com                EQU     2       ;i
                +1           Mux_A           EQU     1       ;i
                +1           Rcp_In          EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   221

                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #00h                           ; Damping noninverted, pwm noninver
                             ted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   222

                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   223

                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           ApwmFET         EQU     5       ;o
                +1           BpwmFET         EQU     4       ;o
                +1           CpwmFET         EQU     3       ;o
                +1           CcomFET         EQU     2       ;o
                +1           BcomFET         EQU     1       ;o
                +1           AcomFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   setb    P1.AcomFET
                +1                   setb    P1.BcomFET
                +1                   setb    P1.CcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   224

                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   setb    P1.AcomFET
                +1                   setb    P1.BcomFET
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.AcomFET
                +1                   mov     P1SKIP, #1Fh
                +1           ELSE
                +1                   mov     P1SKIP, #1Eh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BcomFET
                +1                   mov     P1SKIP, #2Fh
                +1           ELSE
                +1                   mov     P1SKIP, #2Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CcomFET
                +1                   mov     P1SKIP, #37h
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #12h    ; Set comparator multiplexer to phase A
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   225

                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #32h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #52h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   226

                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   14663     
                   14664     IF ESCNO == L_
                             ;$include (L.inc) ; Select pinout L
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   227

                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "L"
                +1           ; X  X  RC X  CC MA MB MC    X  X  Ac Bc Cc Ap Bp Cp
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   228

                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   229

                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   230

                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   231

                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   232

                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   233

                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   234

                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   235

                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   236

                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   237

                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   238

                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#L_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#L_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#L_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   239

                +1           Eep_ESC_Layout:         DB      "#L_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#L_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#L_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#L_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#L_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#L_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#L_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#L_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#L_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#L_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#L_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#L_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#L_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#L_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#L_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#L_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#L_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#L_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#L_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   240

                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Comp_Com                EQU     3       ;i
                +1           Mux_A           EQU     2       ;i
                +1           Mux_B           EQU     1       ;i
                +1           Mux_C           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   241

                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   242

                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   243

                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           AcomFET         EQU     5       ;o
                +1           BcomFET         EQU     4       ;o
                +1           CcomFET         EQU     3       ;o
                +1           ApwmFET         EQU     2       ;o
                +1           BpwmFET         EQU     1       ;o
                +1           CpwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   244

                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #1Bh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #2Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   245

                +1                   mov     P1SKIP, #36h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #13h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #03h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   246

                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   15975     
                   15976     IF ESCNO == M_
                             ;$include (M.inc) ; Select pinout M
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   247

                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "M".
                +1           ; MA MC CC MB RC L0 X  X     X  Cc Bc Ac Cp Bp Ap X     
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   248

                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   249

                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   250

                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   251

                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   252

                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   253

                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   254

                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   255

                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   256

                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   257

                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   258

                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   259

                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#M_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#M_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#M_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#M_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#M_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#M_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#M_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#M_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#M_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#M_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#M_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#M_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#M_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#M_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#M_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#M_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#M_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#M_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#M_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#M_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#M_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#M_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   260

                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     3               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           Mux_A           EQU     7       ;i
                +1           Mux_C           EQU     6       ;i
                +1           Comp_Com        EQU     5       ;i
                +1           Mux_B           EQU     4       ;i
                +1           Rcp_In          EQU     3       ;i
                +1           LED_0           EQU     2       ;i
                +1           ;                       EQU     1       ;i
                +1           ;                       EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     NOT(1 SHL LED_0)
                +1           P0_PUSHPULL     EQU     (1 SHL LED_0)
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   261

                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   262

                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   263

                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           CcomFET         EQU     6       ;o
                +1           BcomFET         EQU     5       ;o
                +1           AcomFET         EQU     4       ;o
                +1           CpwmFET         EQU     3       ;i
                +1           BpwmFET         EQU     2       ;o 
                +1           ApwmFET         EQU     1       ;o
                +1           ;                       EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     7Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   264

                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #7Dh
                +1           ELSE
                +1                   mov     P1SKIP, #6Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   265

                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #7Bh
                +1           ELSE
                +1                   mov     P1SKIP, #5Bh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #77h
                +1           ELSE
                +1                   mov     P1SKIP, #37h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #75h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #45h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #65h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   266

                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1                   setb    P0.LED_0
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1                clr        P0.LED_0
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   17292     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   267

                   17293     IF ESCNO == N_
                             ;$include (N.inc) ; Select pinout N
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "N"
                +1           ; X  X  RC X  MC MB MA CC    X  X  Cp Cc Bp Bc Ap Ac
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   268

                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   269

                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   270

                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   271

                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   272

                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   273

                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   274

                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   275

                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   276

                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   277

                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   278

                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   279

                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#N_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#N_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#N_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#N_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#N_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#N_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#N_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#N_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#N_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#N_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#N_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#N_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#N_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#N_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#N_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#N_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#N_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#N_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#N_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#N_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#N_H_70#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   280

                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#N_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_C           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_A           EQU     1       ;i
                +1           Comp_Com                EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   281

                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   282

                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #00h                           ; Pwm noninverted
                +1           ELSE
                +1                   mov     PCA0POL, #01h                           ; Damping inverted, pwm noninverted
                +1           ENDIF
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   283

                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CpwmFET         EQU     5       ;o
                +1           CcomFET         EQU     4       ;o
                +1           BpwmFET         EQU     3       ;o
                +1           BcomFET         EQU     2       ;o
                +1           ApwmFET         EQU     1       ;o
                +1           AcomFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   284

                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   285

                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #37h
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #1Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   286

                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   287

                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   18610     
                   18611     IF ESCNO == O_
                             ;$include (O.inc) ; Select pinout O
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "O". Com fets are active low for H/L_N driver and EN_N/PWM drive
                             r. Low side pwm
                +1           ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   288

                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   289

                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   290

                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   291

                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   292

                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   293

                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   294

                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   295

                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   296

                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   297

                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   298

                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   299

                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#O_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#O_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#O_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#O_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#O_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#O_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#O_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#O_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#O_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#O_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#O_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#O_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#O_H_05#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   300

                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#O_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#O_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#O_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#O_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#O_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#O_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#O_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#O_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#O_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Comp_Com                EQU     3       ;i
                +1           Mux_A           EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           Mux_B           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   301

                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   302

                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #00h                           ; Damping noninverted, pwm noninver
                             ted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   303

                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CcomFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           BcomFET         EQU     3       ;o
                +1           BpwmFET         EQU     2       ;o
                +1           AcomFET         EQU     1       ;o
                +1           ApwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   304

                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   setb    P1.AcomFET
                +1                   setb    P1.BcomFET
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   305

                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   setb    P1.AcomFET
                +1                   setb    P1.BcomFET
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.AcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CcomFET
                +1                   mov     P1SKIP, #2Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1                   cpl A
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   306

                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   307

                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   19924     
                   19925     IF ESCNO == P_
                             ;$include (P.inc) ; Select pinout P
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "P".
                +1           ; X  X  RC MA CC MB MC X     X  Cc Bc Ac Cp Bp Ap X    
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   308

                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   309

                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   310

                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   311

                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   312

                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   313

                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   314

                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   315

                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   316

                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   317

                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   318

                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   319

                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#P_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#P_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#P_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#P_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#P_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#P_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#P_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#P_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#P_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#P_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#P_L_90#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   320

                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#P_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#P_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#P_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#P_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#P_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#P_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#P_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#P_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#P_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#P_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#P_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   321

                +1           Rcp_In          EQU     5       ;i
                +1           Mux_A           EQU     4       ;i
                +1           Comp_Com                EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           ;                       EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   322

                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   323

                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   324

                +1           CcomFET         EQU     6       ;o
                +1           BcomFET         EQU     5       ;o
                +1           AcomFET         EQU     4       ;o
                +1           CpwmFET         EQU     3       ;i
                +1           BpwmFET         EQU     2       ;o 
                +1           ApwmFET         EQU     1       ;o
                +1           ;                       EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     7Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   325

                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #7Dh
                +1           ELSE
                +1                   mov     P1SKIP, #6Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #7Bh
                +1           ELSE
                +1                   mov     P1SKIP, #5Bh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #77h
                +1           ELSE
                +1                   mov     P1SKIP, #37h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #43h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #23h    ; Set comparator multiplexer to phase B
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   326

                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   327

                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   21239     
                   21240     IF ESCNO == Q_
                             ;$include (Q.inc) ; Select pinout Q
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   328

                +1           ; Hardware definition file "Q"
                +1           ; Cp Bp Ap L1 L0 X  RC X     X  MA MB MC CC Cc Bc Ac
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   329

                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   330

                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   331

                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   332

                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   333

                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   334

                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   335

                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   336

                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   337

                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   338

                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   339

                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#Q_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#Q_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#Q_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#Q_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#Q_L_20#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   340

                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#Q_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#Q_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#Q_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#Q_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#Q_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#Q_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#Q_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#Q_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#Q_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#Q_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#Q_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#Q_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#Q_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#Q_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#Q_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#Q_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#Q_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     1               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   341

                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           CpwmFET         EQU     7       ;o
                +1           BpwmFET         EQU     6       ;o
                +1           ApwmFET         EQU     5       ;o
                +1           LED_1           EQU     4       ;i
                +1           LED_0           EQU     3       ;i
                +1           ;                       EQU     2       ;i
                +1           Rcp_In          EQU     1       ;i
                +1           ;                       EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     0FFh
                +1           P0_INIT         EQU     (1 SHL Rcp_In)
                +1           P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL 
                             CpwmFET)
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   342

                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   343

                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   344

                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           Mux_A           EQU     6       ;i
                +1           Mux_B           EQU     5       ;i
                +1           Mux_C           EQU     4       ;i
                +1           Comp_Com                EQU     3       ;o
                +1           CcomFET         EQU     2       ;o
                +1           BcomFET         EQU     1       ;o
                +1           AcomFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     07h
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P0.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P0.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P0.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P0.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P0.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P0.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P0.ApwmFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   345

                +1                   clr     P0.BpwmFET
                +1                   clr     P0.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P0.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P0.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P0.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P0SKIP, #0DFh
                +1                   mov     P1SKIP, #07h
                +1           ELSE
                +1                   mov     P0SKIP, #0DFh
                +1                   mov     P1SKIP, #06h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P0SKIP, #0BFh
                +1                   mov     P1SKIP, #07h
                +1           ELSE
                +1                   mov     P0SKIP, #0BFh
                +1                   mov     P1SKIP, #05h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P0SKIP, #07Fh
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   346

                +1                   mov     P1SKIP, #07h
                +1           ELSE
                +1                   mov     P0SKIP, #07Fh
                +1                   mov     P1SKIP, #03h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #07h
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP1MX, #63h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP1MX, #53h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP1MX, #43h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP1CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP1CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP1MD, #00h    ; Comparator response time 100ns
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   347

                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1                   setb    P0.LED_0
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1                   clr     P0.LED_0
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1                   setb    P0.LED_1
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1                   clr     P0.LED_1
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   22563     
                   22564     IF ESCNO == R_
                             ;$include (R.inc) ; Select pinout R
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   348

                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "R".
                +1           ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   349

                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   350

                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   351

                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   352

                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   353

                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   354

                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   355

                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   356

                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   357

                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   358

                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   359

                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   360

                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#R_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#R_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#R_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#R_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#R_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#R_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#R_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#R_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#R_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#R_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#R_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#R_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#R_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#R_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#R_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#R_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#R_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#R_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#R_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#R_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#R_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#R_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   361

                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_C           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_A           EQU     1       ;i
                +1           Comp_Com                EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   362

                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   363

                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   364

                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           AcomFET         EQU     5       ;o
                +1           BcomFET         EQU     4       ;o
                +1           CcomFET         EQU     3       ;o
                +1           ApwmFET         EQU     2       ;o
                +1           BpwmFET         EQU     1       ;o
                +1           CpwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   365

                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Bh
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   366

                +1           ELSE
                +1                   mov     P1SKIP, #1Bh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #2Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #36h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   367

                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   368

                +1           ENDM
                             ENDIF
                   23875     
                   23876     IF ESCNO == S_
                             ;$include (S.inc) ; Select pinout S
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "S". like "O" but Com fets are active high, Pwm fets are active 
                             low
                +1           ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   369

                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   370

                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   371

                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   372

                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   373

                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   374

                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   375

                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   376

                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   377

                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   378

                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   379

                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   380

                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#S_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#S_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#S_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#S_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#S_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#S_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#S_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#S_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#S_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#S_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#S_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#S_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#S_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#S_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#S_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#S_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#S_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#S_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#S_H_40#        "
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   381

                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#S_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#S_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#S_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i
                +1           Comp_Com                EQU     3       ;i
                +1           Mux_A           EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           Mux_B           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   382

                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   383

                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #00h                           ; Pwm noninverted
                +1           ELSE
                +1                   mov     PCA0POL, #01h                           ; Damping inverted, pwm noninverted
                +1           ENDIF
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   384

                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CpwmFET         EQU     5       ;o
                +1           CcomFET         EQU     4       ;o
                +1           BpwmFET         EQU     3       ;o
                +1           BcomFET         EQU     2       ;o
                +1           ApwmFET         EQU     1       ;o
                +1           AcomFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     (0 SHL AcomFET)+(0 SHL BcomFET)+(0 SHL CcomFET)
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   385

                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   386

                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #37h
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #1Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   387

                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   388

                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   25192     
                   25193     IF ESCNO == T_
                             ;$include (T.inc) ; Select pinout T
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "T".
                +1           ; RC X  MA X  MB CC MC X     X  X  Cp Bp Ap Ac Bc Cc
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   389

                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   390

                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   391

                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   392

                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   393

                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   394

                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   395

                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   396

                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   397

                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   398

                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   399

                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   400

                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#T_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#T_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#T_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#T_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#T_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#T_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#T_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#T_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#T_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#T_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#T_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#T_H_00#        "      ; ESC layout tag
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   401

                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#T_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#T_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#T_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#T_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#T_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#T_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#T_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#T_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#T_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#T_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     7               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           Rcp_In          EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Mux_A           EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_B           EQU     3       ;i
                +1           Comp_Com                EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           ;                       EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   402

                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   403

                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #00h                           ; Pwm noninverted
                +1           ELSE
                +1                   mov     PCA0POL, #01h                           ; Damping inverted, pwm noninverted
                +1           ENDIF
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   404

                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CpwmFET         EQU     5       ;o
                +1           BpwmFET         EQU     4       ;o
                +1           ApwmFET         EQU     3       ;o
                +1           AcomFET         EQU     2       ;o 
                +1           BcomFET         EQU     1       ;o
                +1           CcomFET         EQU     0       ;o
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   405

                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   406

                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #37h
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #2Fh
                +1           ELSE
                +1                   mov     P1SKIP, #2Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #1Fh
                +1           ELSE
                +1                   mov     P1SKIP, #1Eh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #52h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #32h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #12h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   407

                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   408

                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   26510     
                   26511     IF ESCNO == U_
                             ;$include (U.inc) ; Select pinout U
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "U".
                +1           ; MA MC CC MB RC L0 L1 L2     X  Cc Bc Ac Cp Bp Ap X     
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   409

                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   410

                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   411

                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   412

                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   413

                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   414

                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   415

                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   416

                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   417

                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   418

                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   419

                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   420

                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#U_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#U_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#U_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#U_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#U_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#U_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#U_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#U_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   421

                +1           Eep_ESC_Layout:         DB      "#U_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#U_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#U_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#U_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#U_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#U_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#U_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#U_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#U_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#U_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#U_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#U_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#U_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#U_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     3               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   422

                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           Mux_A           EQU     7       ;i
                +1           Mux_C           EQU     6       ;i
                +1           Comp_Com        EQU     5       ;i
                +1           Mux_B           EQU     4       ;i
                +1           Rcp_In          EQU     3       ;i
                +1           LED_0           EQU     2       ;i
                +1           LED_1           EQU     1       ;i
                +1           LED_2           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL LED_2)
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   423

                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #02h                           ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   424

                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   425

                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           CcomFET         EQU     6       ;o
                +1           BcomFET         EQU     5       ;o
                +1           AcomFET         EQU     4       ;o
                +1           CpwmFET         EQU     3       ;i
                +1           BpwmFET         EQU     2       ;o 
                +1           ApwmFET         EQU     1       ;o
                +1           ;                       EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     7Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   426

                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #7Dh
                +1           ELSE
                +1                   mov     P1SKIP, #6Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #7Bh
                +1           ELSE
                +1                   mov     P1SKIP, #5Bh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #77h
                +1           ELSE
                +1                   mov     P1SKIP, #37h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   427

                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #75h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #45h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #65h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   428

                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1                   clr     P0.LED_0
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1                   setb    P0.LED_0
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1                   clr     P0.LED_1
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1                   setb    P0.LED_1
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1                   clr     P0.LED_2
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1                   setb    P0.LED_2
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                +1           
                             ENDIF
                   27832     
                   27833     IF ESCNO == V_
                             ;$include (V.inc) ; Select pinout V
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   429

                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "V"
                +1           ; Cc X  RC X  MC CC MB MA    X  Ap Ac Bp X  X  Bc Cp
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   430

                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   431

                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   432

                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   433

                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   434

                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   435

                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   436

                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   437

                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   438

                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   439

                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   440

                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   441

                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#V_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#V_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#V_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#V_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#V_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#V_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#V_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#V_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#V_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#V_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#V_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#V_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#V_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#V_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#V_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#V_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#V_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#V_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#V_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#V_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#V_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#V_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   442

                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           CcomFET         EQU     7       ;o
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Mux_C           EQU     3       ;i
                +1           Comp_Com        EQU     2       ;i
                +1           Mux_B           EQU     1       ;i
                +1           Mux_A           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     NOT(1 SHL CcomFET)
                +1           P0_PUSHPULL     EQU     (1 SHL CcomFET)
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   443

                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   444

                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #00h                           ; Pwm noninverted
                +1           ELSE
                +1                   mov     PCA0POL, #01h                           ; Damping inverted, pwm noninverted
                +1           ENDIF
                +1                   ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   445

                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ApwmFET         EQU     6       ;i
                +1           AcomFET         EQU     5       ;i
                +1           BpwmFET         EQU     4       ;o
                +1           ;               EQU     3       ;o
                +1           ;               EQU     2       ;o
                +1           BcomFET         EQU     1       ;o
                +1           CpwmFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)
                +1           P1_INIT         EQU     00h             
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)
                +1           P1_SKIP         EQU     7Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   446

                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P0.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P0.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P0.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P0.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P0.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P0.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #3Fh
                +1           ELSE
                +1                   mov     P0SKIP, #0FFh
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   447

                +1                   mov     P1SKIP, #1Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #6Fh
                +1           ELSE
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #6Dh
                +1           endif
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P0.CcomFET
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #7Eh
                +1           ELSE
                +1                   mov     P0SKIP, #7Fh
                +1                   mov     P1SKIP, #7Eh
                +1           endif
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P0SKIP, #0FFh
                +1                   mov     P1SKIP, #7Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #02h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #12h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #32h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   448

                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   449

                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   29156     
                   29157     IF ESCNO == W_
                             ;$include (W.inc) ; Select pinout W
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "W". This is for tristate input style FET driver chips
                +1           ; RC MC MB X CC MA X X     X  Ap Bp Cp X X X X
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   450

                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   451

                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   452

                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   453

                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   454

                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   455

                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   456

                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   457

                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   458

                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   459

                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   460

                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   461

                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#W_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#W_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#W_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#W_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#W_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#W_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#W_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#W_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#W_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#W_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#W_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#W_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#W_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#W_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#W_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#W_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#W_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   462

                +1           Eep_ESC_Layout:         DB      "#W_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#W_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#W_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#W_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#W_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     7               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           Rcp_In          EQU     7       ;i
                +1           Mux_C           EQU     6       ;i
                +1           Mux_B           EQU     5       ;i
                +1           ;               EQU     4       ;i
                +1           Comp_Com        EQU     3       ;i
                +1           Mux_A           EQU     2       ;i
                +1           ;               EQU     1       ;i
                +1           ;               EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   463

                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   464

                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #00h                           ; Pwm noninverted
                +1           ELSE
                +1                   mov     PCA0POL, #01h                           ; Damping inverted, pwm noninverted
                +1           ENDIF
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   465

                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;               EQU     7       ;i
                +1           ApwmFET         EQU     6       ;o
                +1           BpwmFET         EQU     5       ;o
                +1           CpwmFET         EQU     4       ;o
                +1           ;               EQU     3       ;i
                +1           ;               EQU     2       ;i
                +1           ;               EQU     1       ;i
                +1           ;               EQU     0       ;i
                +1           ; pwm outputs start as analog in -> floating
                +1           ; this ensures all mosfet drivers start with floating outputs
                +1           P1_DIGITAL      EQU     NOT((1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET))
                +1           P1_INIT         EQU     00h
                +1           P1_PUSHPULL     EQU     ((1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET))
                +1           ;
                +1           P1_SKIP         EQU     0FFh
                +1           
                +1           
                +1           ApwmFET_on MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   466

                +1                   setb     P1.ApwmFET             ; set pin to high
                +1                   orl P1MDIN, #(1 SHL ApwmFET)    ; enable pin driver
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1                   anl P1MDIN, #(NOT(1 SHL ApwmFET))       ; analog in -> pullup, driver and digital i
                             n is disable = floating
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb P1.BpwmFET         ; set pin to high
                +1                   orl P1MDIN, #(1 SHL BpwmFET)    ; enable pin driver
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1                   anl P1MDIN, #(NOT(1 SHL BpwmFET))       ; analog in -> pullup, driver and digital i
                             n is disable = floating
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb     P1.CpwmFET             ; set pin to high
                +1                   orl P1MDIN, #(1 SHL CpwmFET)    ; enable pin driver
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1                   anl P1MDIN, #(NOT(1 SHL CpwmFET))       ; analog in -> pullup, driver and digital i
                             n is disable = floating
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1                   anl P1MDIN, #(NOT((1 SHL ApwmFET) + (1 SHL BpwmFET) + (1 SHL CpwmFET))) ; analog in
                              -> pullup, driver and digital in is disable = floating
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1                   clr P1.ApwmFET                  ; set pin to low
                +1                   orl P1MDIN, #(1 SHL ApwmFET)    ; enable pin driver
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   anl P1MDIN, #(NOT(1 SHL ApwmFET))       ; analog in -> pullup, driver and digital i
                             n is disable = floating
                +1           ENDM
                +1           BcomFET_on MACRO
                +1                   clr P1.BpwmFET                  ; set pin to low
                +1                   orl P1MDIN, #(1 SHL BpwmFET)    ; enable pin driver
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   anl P1MDIN, #(NOT(1 SHL BpwmFET))       ; analog in -> pullup, driver and digital i
                             n is disable = floating
                +1           ENDM
                +1           CcomFET_on MACRO
                +1                   clr P1.CpwmFET                  ; set pin to low
                +1                   orl P1MDIN, #(1 SHL CpwmFET)    ; enable pin driver
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   anl P1MDIN, #(NOT(1 SHL CpwmFET))       ; analog in -> pullup, driver and digital i
                             n is disable = floating
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   anl P1MDIN, #(NOT((1 SHL ApwmFET) + (1 SHL BpwmFET) + (1 SHL CpwmFET))) ; analog in
                              -> pullup, driver and digital in is disable = floating
                +1           ENDM
                +1           Set_Pwm_A MACRO
                +1                   mov     P1SKIP, #(NOT(1 SHL ApwmFET));
                +1                   orl     P1MDIN, #(1 SHL ApwmFET)        ; enable pin driver
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1                   mov     P1SKIP, #(NOT(1 SHL BpwmFET));
                +1                   orl     P1MDIN, #(1 SHL BpwmFET)        ; enable pin driver
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1                   mov     P1SKIP, #(NOT(1 SHL CpwmFET));
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   467

                +1                   orl     P1MDIN, #(1 SHL CpwmFET)        ; enable pin driver
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #P1_SKIP;
                +1           ENDM
                +1           
                +1           
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #((Mux_A) SHL 4)+((Comp_Com) SHL 0);
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #((Mux_B) SHL 4)+((Comp_Com) SHL 0);
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #((Mux_C) SHL 4)+((Comp_Com) SHL 0);
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   468

                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   30434     
                   30435     IF ESCNO == X_
                             ;$include (X.inc)        ; Select pinout X
                             ENDIF
                   30438     
                   30439     IF ESCNO == Y_
                             ;$include (Y.inc)        ; Select pinout Y
                             ENDIF
                   30442     
                   30443     IF ESCNO == Z_
                             ;$include (Z.inc) ; Select pinout Z
                +1           ;**** **** **** **** ****
                +1           ;
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   469

                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "Z"
                +1           ; X  X  RC X  CC MA MC MB    X  X  Cp Cc Bp Bc Ap Ac
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB1x/2x
                +1           ;*********************
                +1           IF MCU_48MHZ == 0
                +1           ;$include (SI_EFM8BB1_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB10F2G
                +2           ;  EFM8BB10F2I
                +2           ;  EFM8BB10F2Y
                +2           ;  EFM8BB10F4G
                +2           ;  EFM8BB10F4I
                +2           ;  EFM8BB10F4Y
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8G
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8I
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           ;  EFM8BB10F8Y
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC      DATA 0E0H; Accumulator                            
                +2           ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF   DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0  DATA 0E8H; ADC0 Control 0                         
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   470

                +2           ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B        DATA 0F0H; B Register                             
                +2           CKCON0   DATA 08EH; Clock Control 0                        
                +2           CLKSEL   DATA 0A9H; Clock Select                           
                +2           CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0MD   DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                +2           CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN   DATA 0DDH; CRC0 Data Input                        
                +2           DERIVID  DATA 0ADH; Derivative Identification              
                +2           DEVICEID DATA 0B5H; Device Identification                  
                +2           DPH      DATA 083H; Data Pointer High                      
                +2           DPL      DATA 082H; Data Pointer Low                       
                +2           EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                +2           FLKEY    DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           IE       DATA 0A8H; Interrupt Enable                       
                +2           IP       DATA 0B8H; Interrupt Priority                     
                +2           IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0       DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK   DATA 0FEH; Port 0 Mask                            
                +2           P0MAT    DATA 0FDH; Port 0 Match                           
                +2           P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP   DATA 0D4H; Port 0 Skip                            
                +2           P1       DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK   DATA 0EEH; Port 1 Mask                            
                +2           P1MAT    DATA 0EDH; Port 1 Match                           
                +2           P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP   DATA 0D5H; Port 1 Skip                            
                +2           P2       DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                +2           PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                +2           PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0  DATA 0D8H; PCA Control                            
                +2           PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD   DATA 0D9H; PCA Mode                               
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   471

                +2           PCA0POL  DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0    DATA 087H; Power Control                          
                +2           PRTDRV   DATA 0F6H; Port Drive Strength                    
                +2           PSCTL    DATA 08FH; Program Store Control                  
                +2           PSW      DATA 0D0H; Program Status Word                    
                +2           REF0CN   DATA 0D1H; Voltage Reference Control              
                +2           REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                +2           REVID    DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC   DATA 0EFH; Reset Source                           
                +2           SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                +2           SCON0    DATA 098H; UART0 Serial Port Control              
                +2           SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                +2           SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SP       DATA 081H; Stack Pointer                          
                +2           SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0  DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT  DATA 0A3H; SPI0 Data                              
                +2           TCON     DATA 088H; Timer 0/1 Control                      
                +2           TH0      DATA 08CH; Timer 0 High Byte                      
                +2           TH1      DATA 08DH; Timer 1 High Byte                      
                +2           TL0      DATA 08AH; Timer 0 Low Byte                       
                +2           TL1      DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD     DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2H    DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                +2           TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0  DATA 091H; Timer 3 Control 0                      
                +2           TMR3H    DATA 095H; Timer 3 High Byte                      
                +2           TMR3L    DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                +2           VDM0CN   DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN    DATA 097H; Watchdog Timer Control                 
                +2           XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   472

                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   473

                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   474

                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +1           
                +1           ELSE
                +1           ;$include (SI_EFM8BB2_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB21F16G_QFN20
                +2           ;  EFM8BB21F16G_QSOP24
                +2           ;  EFM8BB21F16I_QFN20
                +2           ;  EFM8BB21F16I_QSOP24
                +2           ;  EFM8BB22F16G_QFN28
                +2           ;  EFM8BB22F16I_QFN28
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC       DATA 0E0H; Accumulator                            
                +2           ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                +2           ADC0CF    DATA 0BCH; ADC0 Configuration                     
                +2           ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                +2           ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                +2           ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                +2           ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                +2           ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                +2           ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                +2           ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                +2           ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                +2           ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                +2           ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                +2           ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                +2           B         DATA 0F0H; B Register                             
                +2           CKCON0    DATA 08EH; Clock Control 0                        
                +2           CKCON1    DATA 0A6H; Clock Control 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   475

                +2           CLKSEL    DATA 0A9H; Clock Select                           
                +2           CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                +2           CMP0CN1   DATA 099H; Comparator 0 Control 1
                +2           CMP0MD    DATA 09DH; Comparator 0 Mode                      
                +2           CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                +2           CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                +2           CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                +2           CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                +2           CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                +2           CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                +2           CRC0CN1   DATA 086H; CRC0 Control 1                         
                +2           CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                +2           CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                +2           CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                +2           CRC0IN    DATA 0DDH; CRC0 Data Input                        
                +2           CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                +2           DERIVID   DATA 0ADH; Derivative Identification              
                +2           DEVICEID  DATA 0B5H; Device Identification                  
                +2           DPH       DATA 083H; Data Pointer High                      
                +2           DPL       DATA 082H; Data Pointer Low                       
                +2           EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                +2           EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                +2           EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                +2           EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                +2           EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                +2           EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                +2           EMI0CN    DATA 0E7H; External Memory Interface Control      
                +2           FLKEY     DATA 0B7H; Flash Lock and Key                     
                +2           HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                +2           HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                +2           HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                +2           I2C0CN0   DATA 0BAH; I2C0 Control                           
                +2           I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                +2           I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                +2           I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                +2           I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                +2           I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                +2           I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                +2           I2C0STAT  DATA 0B9H; I2C0 Status                            
                +2           IE        DATA 0A8H; Interrupt Enable                       
                +2           IP        DATA 0B8H; Interrupt Priority                     
                +2           IPH       DATA 0F2H; Interrupt Priority High                
                +2           IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                +2           LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                +2           P0        DATA 080H; Port 0 Pin Latch                       
                +2           P0MASK    DATA 0FEH; Port 0 Mask                            
                +2           P0MAT     DATA 0FDH; Port 0 Match                           
                +2           P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                +2           P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                +2           P0SKIP    DATA 0D4H; Port 0 Skip                            
                +2           P1        DATA 090H; Port 1 Pin Latch                       
                +2           P1MASK    DATA 0EEH; Port 1 Mask                            
                +2           P1MAT     DATA 0EDH; Port 1 Match                           
                +2           P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                +2           P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                +2           P1SKIP    DATA 0D5H; Port 1 Skip                            
                +2           P2        DATA 0A0H; Port 2 Pin Latch                       
                +2           P2MASK    DATA 0FCH; Port 2 Mask                            
                +2           P2MAT     DATA 0FBH; Port 2 Match                           
                +2           P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                +2           P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                +2           P2SKIP    DATA 0CCH; Port 2 Skip                            
                +2           P3        DATA 0B0H; Port 3 Pin Latch                       
                +2           P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                +2           P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                +2           PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   476

                +2           PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                +2           PCA0CN0   DATA 0D8H; PCA Control                            
                +2           PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                +2           PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                +2           PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                +2           PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                +2           PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                +2           PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                +2           PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                +2           PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                +2           PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                +2           PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                +2           PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                +2           PCA0MD    DATA 0D9H; PCA Mode                               
                +2           PCA0POL   DATA 096H; PCA Output Polarity                    
                +2           PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                +2           PCON0     DATA 087H; Power Control                          
                +2           PCON1     DATA 09AH; Power Control 1                        
                +2           PFE0CN    DATA 0C1H; Prefetch Engine Control                
                +2           PRTDRV    DATA 0F6H; Port Drive Strength                    
                +2           PSCTL     DATA 08FH; Program Store Control                  
                +2           PSW       DATA 0D0H; Program Status Word                    
                +2           REF0CN    DATA 0D1H; Voltage Reference Control              
                +2           REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                +2           REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                +2           REVID     DATA 0B6H; Revision Identifcation                 
                +2           RSTSRC    DATA 0EFH; Reset Source                           
                +2           SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                +2           SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                +2           SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                +2           SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                +2           SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                +2           SCON0     DATA 098H; UART0 Serial Port Control              
                +2           SCON1     DATA 0C8H; UART1 Serial Port Control              
                +2           SFRPAGE   DATA 0A7H; SFR Page                               
                +2           SFRPGCN   DATA 0CFH; SFR Page Control                       
                +2           SFRSTACK  DATA 0D7H; SFR Page Stack                         
                +2           SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                +2           SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                +2           SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                +2           SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                +2           SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                +2           SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                +2           SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                +2           SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                +2           SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                +2           SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                +2           SMOD1     DATA 093H; UART1 Mode                             
                +2           SP        DATA 081H; Stack Pointer                          
                +2           SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                +2           SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                +2           SPI0CN0   DATA 0F8H; SPI0 Control                           
                +2           SPI0DAT   DATA 0A3H; SPI0 Data                              
                +2           SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                +2           SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                +2           SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                +2           TCON      DATA 088H; Timer 0/1 Control                      
                +2           TH0       DATA 08CH; Timer 0 High Byte                      
                +2           TH1       DATA 08DH; Timer 1 High Byte                      
                +2           TL0       DATA 08AH; Timer 0 Low Byte                       
                +2           TL1       DATA 08BH; Timer 1 Low Byte                       
                +2           TMOD      DATA 089H; Timer 0/1 Mode                         
                +2           TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                +2           TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                +2           TMR2H     DATA 0CDH; Timer 2 High Byte                      
                +2           TMR2L     DATA 0CCH; Timer 2 Low Byte                       
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   477

                +2           TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                +2           TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                +2           TMR3CN0   DATA 091H; Timer 3 Control 0                      
                +2           TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                +2           TMR3H     DATA 095H; Timer 3 High Byte                      
                +2           TMR3L     DATA 094H; Timer 3 Low Byte                       
                +2           TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                +2           TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                +2           TMR4CN0   DATA 098H; Timer 4 Control 0                      
                +2           TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                +2           TMR4H     DATA 0A5H; Timer 4 High Byte                      
                +2           TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                +2           TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                +2           TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                +2           UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                +2           UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                +2           UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                +2           UART1LIN  DATA 09EH; UART1 LIN Configuration                
                +2           VDM0CN    DATA 0FFH; Supply Monitor Control                 
                +2           WDTCN     DATA 097H; Watchdog Timer Control                 
                +2           XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                +2           XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                +2           XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP      DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                +2           TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                +2           TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3    DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                +2           ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                +2           ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   478

                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                +2           ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                +2           P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                +2           P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                +2           
                +2           ; P3 0xB0 (Port 3 Pin Latch)
                +2           P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                +2           P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   479

                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   480

                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 17 ; UART1                     
                +2           I2C0_IRQn    EQU 18 ; I2C0 Slave                
                +2           TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           CRC0_PAGE       EQU 000H ; CRC0 Page       
                +2           LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                +2           PCA0_PAGE       EQU 000H ; PCA0 Page       
                +2           PG2_PAGE        EQU 010H ; Page2           
                +2           TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                +2           TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                +2           TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                +2           I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                +2           PG3_PAGE        EQU 020H ; Page3           
                +2           SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                +2           SPI0_PAGE       EQU 020H ; SPI0 Page       
                +2           UART0_PAGE      EQU 020H ; UART0 Page      
                +2           UART1_PAGE      EQU 020H ; UART1 Page      
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   481

                +1           ENDIF
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 24/48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 0
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#Z_L_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#Z_L_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#Z_L_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#Z_L_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#Z_L_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#Z_L_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#Z_L_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#Z_L_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#Z_L_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#Z_L_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#Z_L_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (16 B
                             ytes)
                +1           
                +1           ELSE
                +1           
                +1           CSEG AT 1A40h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#Z_H_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#Z_H_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#Z_H_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#Z_H_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#Z_H_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#Z_H_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#Z_H_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#Z_H_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#Z_H_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#Z_H_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#Z_H_90#        "
                +1           ENDIF
                +1           CSEG AT 1A50h
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   482

                +1           Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (16 B
                             ytes)
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for whi
                             ch main motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                                EQU     P0              ; Receive/Transmit port
                +1           RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL            
                                          
                +1           RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL             
                                          
                +1           RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP                
                                          
                +1           RTX_PIN                         EQU     5               ; RTX pin
                +1           
                +1           SIGNATURE_001                   EQU     0E8h            ; Device signature
                +1           IF MCU_48MHZ == 0
                +1           SIGNATURE_002                   EQU     0B1h
                +1           ELSE
                +1           SIGNATURE_002                   EQU     0B2h
                +1           ENDIF
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           ;                       EQU     4       ;i 
                +1           Comp_Com                EQU     3       ;i
                +1           Mux_A           EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           Mux_B           EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1           ENDIF
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1           IF MCU_48MHZ == 1
                +1                   mov     Timer0_X, #0
                +1           ENDIF
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1           IF MCU_48MHZ == 1
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   483

                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDIF
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   484

                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1           IF MCU_48MHZ == 0
                +1                   mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1           ENDIF
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #02h                           ; Pwm inverted
                +1           ELSE
                +1                   mov     PCA0POL, #03h                           ; Damping inverted, pwm inverted
                +1           ENDIF
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   485

                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CpwmFET         EQU     5       ;o
                +1           CcomFET         EQU     4       ;o
                +1           BpwmFET         EQU     3       ;o
                +1           BcomFET         EQU     2       ;o
                +1           ApwmFET         EQU     1       ;o
                +1           AcomFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   clr             P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   setb    P1.ApwmFET
                +1           ELSE
                +1                   clr             P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   clr             P1.BpwmFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   486

                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   setb    P1.BpwmFET
                +1           ELSE
                +1                   clr             P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   clr             P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   setb    P1.CpwmFET
                +1           ELSE
                +1                   clr             P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   setb    P1.ApwmFET
                +1                   setb    P1.BpwmFET
                +1                   setb    P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   487

                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #37h
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #1Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           IF MCU_48MHZ == 1
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           ENDIF
                +1           CSEG AT 13h                     ; Int1 interrupt
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   488

                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bias
                +1           IF MCU_48MHZ == 0
                +1                   mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                +1           ELSE
                +1                   mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                +1           ENDIF
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #80h   ; ADC enabled 
                +1                   mov     ADC0CN1, #01h   ; Common mode buffer enabled
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #90h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   489

                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   31759     
                   31760     IF ESCNO == A_X_
                             ;$include (A_X.inc) ; Select pinout A_X
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "A_X"
                +1           ; X  X  RC CC MA MC MB X     X  X  Cc Cp Bc Bp Ac Ap
                +1           ; PWM fets active high, on low side
                +1           ; COM fets active low
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB5
                +1           ;*********************
                +1           ;$include (SI_EFM8BB51_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB51F16G_QFN20
                +2           ;  EFM8BB51F16G_TSSOP20
                +2           ;  EFM8BB51F16I_QFN20
                +2           ;  EFM8BB51F16I_TSSOP20
                +2           ;  EFM8BB51F8G_QFN20
                +2           ;  EFM8BB51F8G_TSSOP20
                +2           ;  EFM8BB51F8I_QFN20
                +2           ;  EFM8BB51F8I_TSSOP20
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   490

                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC        DATA 0E0H; Accumulator                              
                +2           ADC0ASAH   DATA 0B6H; ADC0 Autoscan Start Address High Byte    
                +2           ADC0ASAL   DATA 0B5H; ADC0 Autoscan Start Address Low Byte     
                +2           ADC0ASCF   DATA 0A1H; ADC0 Autoscan Configuration              
                +2           ADC0ASCT   DATA 0C7H; ADC0 Autoscan Output Count               
                +2           ADC0CF1    DATA 0B9H; ADC0 Configuration                       
                +2           ADC0CF2    DATA 0DFH; ADC0 Power Control                       
                +2           ADC0CN0    DATA 0E8H; ADC0 Control 0                           
                +2           ADC0CN1    DATA 0B2H; ADC0 Control 1                           
                +2           ADC0CN2    DATA 0B3H; ADC0 Control 2                           
                +2           ADC0GTH    DATA 0C4H; ADC0 Greater-Than High Byte              
                +2           ADC0GTL    DATA 0C3H; ADC0 Greater-Than Low Byte               
                +2           ADC0H      DATA 0BEH; ADC0 Data Word High Byte                 
                +2           ADC0L      DATA 0BDH; ADC0 Data Word Low Byte                  
                +2           ADC0LTH    DATA 0C6H; ADC0 Less-Than High Byte                 
                +2           ADC0LTL    DATA 0C5H; ADC0 Less-Than Low Byte                  
                +2           ADC0MX     DATA 0BBH; ADC0 Multiplexer Selection               
                +2           B          DATA 0F0H; B Register                               
                +2           CKCON0     DATA 08EH; Clock Control 0                          
                +2           CKCON1     DATA 0A6H; Clock Control 1                          
                +2           CLEN0      DATA 0C6H; Configurable Logic Enable 0              
                +2           CLIE0      DATA 0C7H; Configurable Logic Interrupt Enable 0    
                +2           CLIF0      DATA 0E8H; Configurable Logic Interrupt Flag 0      
                +2           CLKGRP0    DATA 0AFH; Clock Group Control                      
                +2           CLKSEL     DATA 0A9H; Clock Select                             
                +2           CLOUT0     DATA 0D1H; Configurable Logic Output 0              
                +2           CLU0CF     DATA 0B1H; Configurable Logic Unit 0 Configuration  
                +2           CLU0FN     DATA 0AFH; Configurable Logic Unit 0 Function Select
                +2           CLU0MX     DATA 084H; Configurable Logic Unit 0 Multiplexer    
                +2           CLU1CF     DATA 0B3H; Configurable Logic Unit 1 Configuration  
                +2           CLU1FN     DATA 0B2H; Configurable Logic Unit 1 Function Select
                +2           CLU1MX     DATA 085H; Configurable Logic Unit 1 Multiplexer    
                +2           CLU2CF     DATA 0B6H; Configurable Logic Unit 2 Configuration  
                +2           CLU2FN     DATA 0B5H; Configurable Logic Unit 2 Function Select
                +2           CLU2MX     DATA 091H; Configurable Logic Unit 2 Multiplexer    
                +2           CLU3CF     DATA 0BFH; Configurable Logic Unit 3 Configuration  
                +2           CLU3FN     DATA 0BEH; Configurable Logic Unit 3 Function Select
                +2           CLU3MX     DATA 0AEH; Configurable Logic Unit 3 Multiplexer    
                +2           CMP0CN0    DATA 09BH; Comparator 0 Control 0                   
                +2           CMP0CN1    DATA 099H; Comparator 0 Control 1                   
                +2           CMP0MD     DATA 09DH; Comparator 0 Mode                        
                +2           CMP0MX     DATA 09FH; Comparator 0 Multiplexer Selection       
                +2           CMP1CN0    DATA 0BFH; Comparator 1 Control 0                   
                +2           CMP1CN1    DATA 0ACH; Comparator 1 Control 1                   
                +2           CMP1MD     DATA 0ABH; Comparator 1 Mode                        
                +2           CMP1MX     DATA 0AAH; Comparator 1 Multiplexer Selection       
                +2           CP0CN      DATA 0A4H; Charge Pump Configuration                
                +2           CRC0CN0    DATA 0CEH; CRC0 Control 0                           
                +2           CRC0CN1    DATA 086H; CRC0 Control 1                           
                +2           CRC0CNT    DATA 0D3H; CRC0 Automatic Flash Sector Count        
                +2           CRC0DAT    DATA 0CBH; CRC0 Data Output                         
                +2           CRC0FLIP   DATA 0CFH; CRC0 Bit Flip                            
                +2           CRC0IN     DATA 0CAH; CRC0 Data Input                          
                +2           CRC0ST     DATA 0D2H; CRC0 Automatic Flash Sector Start        
                +2           DERIVID    DATA 0ADH; Derivative Identification                
                +2           DEVICEID   DATA 0B5H; Device Identification                    
                +2           DPH        DATA 083H; Data Pointer High                        
                +2           DPL        DATA 082H; Data Pointer Low                         
                +2           EIE1       DATA 0E6H; Extended Interrupt Enable 1              
                +2           EIE2       DATA 0F3H; Extended Interrupt Enable 2              
                +2           EIP1       DATA 0BBH; Extended Interrupt Priority 1 Low        
                +2           EIP1H      DATA 0EEH; Extended Interrupt Priority 1 High       
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   491

                +2           EIP2       DATA 0EDH; Extended Interrupt Priority 2            
                +2           EIP2H      DATA 0F6H; Extended Interrupt Priority 2 High       
                +2           EMI0CN     DATA 0E7H; External Memory Interface Control        
                +2           FLKEY      DATA 0B7H; Flash Lock and Key                       
                +2           HFO0CAL    DATA 0D6H; High Frequency Oscillator 0 Calibration  
                +2           HFO0CN     DATA 0EFH; High Frequency Oscillator Control        
                +2           HFO0TRIM0  DATA 0CCH; High Frequency Oscillator Trim           
                +2           IE         DATA 0A8H; Interrupt Enable                         
                +2           IP         DATA 0B8H; Interrupt Priority                       
                +2           IPH        DATA 0F2H; Interrupt Priority High                  
                +2           IT01CF     DATA 0E4H; INT0/INT1 Configuration                  
                +2           LFO0CN     DATA 0B1H; Low Frequency Oscillator Control         
                +2           P0         DATA 080H; Port 0 Pin Latch                         
                +2           P0MASK     DATA 0FEH; Port 0 Mask                              
                +2           P0MAT      DATA 0FDH; Port 0 Match                             
                +2           P0MDIN     DATA 0F1H; Port 0 Input Mode                        
                +2           P0MDOUT    DATA 0A4H; Port 0 Output Mode                       
                +2           P0SKIP     DATA 0D4H; Port 0 Skip                              
                +2           P1         DATA 090H; Port 1 Pin Latch                         
                +2           P1MASK     DATA 0EEH; Port 1 Mask                              
                +2           P1MAT      DATA 0EDH; Port 1 Match                             
                +2           P1MDIN     DATA 0F2H; Port 1 Input Mode                        
                +2           P1MDOUT    DATA 0A5H; Port 1 Output Mode                       
                +2           P1SKIP     DATA 0D5H; Port 1 Skip                              
                +2           P2         DATA 0A0H; Port 2 Pin Latch                         
                +2           P2MDIN     DATA 0F3H; Port 2 Input Mode                        
                +2           P2MDOUT    DATA 0A6H; Port 2 Output Mode                       
                +2           PCA0CENT   DATA 09EH; PCA Center Alignment Enable              
                +2           PCA0CLR    DATA 09CH; PCA Comparator Clear Control             
                +2           PCA0CN0    DATA 0D8H; PCA Control                              
                +2           PCA0CPH0   DATA 0FCH; PCA Channel 0 Capture Module High Byte   
                +2           PCA0CPH1   DATA 0EAH; PCA Channel 1 Capture Module High Byte   
                +2           PCA0CPH2   DATA 0ECH; PCA Channel 2 Capture Module High Byte   
                +2           PCA0CPL0   DATA 0FBH; PCA Channel 0 Capture Module Low Byte    
                +2           PCA0CPL1   DATA 0E9H; PCA Channel 1 Capture Module Low Byte    
                +2           PCA0CPL2   DATA 0EBH; PCA Channel 2 Capture Module Low Byte    
                +2           PCA0CPM0   DATA 0DAH; PCA Channel 0 Capture/Compare Mode       
                +2           PCA0CPM1   DATA 0DBH; PCA Channel 1 Capture/Compare Mode       
                +2           PCA0CPM2   DATA 0DCH; PCA Channel 2 Capture/Compare Mode       
                +2           PCA0H      DATA 0FAH; PCA Counter/Timer High Byte              
                +2           PCA0L      DATA 0F9H; PCA Counter/Timer Low Byte               
                +2           PCA0MD     DATA 0D9H; PCA Mode                                 
                +2           PCA0POL    DATA 096H; PCA Output Polarity                      
                +2           PCA0PWM    DATA 0F7H; PCA PWM Configuration                    
                +2           PCON0      DATA 087H; Power Control 0                          
                +2           PCON1      DATA 0CDH; Power Control 1                          
                +2           PFE0CN     DATA 0C1H; Prefetch Engine Control                  
                +2           PRTDRV     DATA 0F6H; Port Drive Strength                      
                +2           PSCTL      DATA 08FH; Program Store Control                    
                +2           PSTAT0     DATA 0AAH; PMU Status 0                             
                +2           PSW        DATA 0D0H; Program Status Word                      
                +2           PWMCFG0    DATA 0C2H; PWM Configuration 0                      
                +2           PWMCFG1    DATA 0C9H; PWM Configuration 1                      
                +2           PWMCFG2    DATA 0D1H; PWM Configuration 2                      
                +2           PWMCFG3    DATA 0DFH; PWM Configuration 3                      
                +2           PWMCKDIV   DATA 0E3H; PWM Clock Divider                        
                +2           PWMCPH0    DATA 09AH; Ch0 Compare Value MSB                    
                +2           PWMCPH1    DATA 0B6H; Ch1 Compare Value MSB                    
                +2           PWMCPH2    DATA 0BEH; Ch2 Compare Value MSB                    
                +2           PWMCPL0    DATA 099H; Ch0 Compare Value LSB                    
                +2           PWMCPL1    DATA 0B5H; Ch1 Compare Value LSB                    
                +2           PWMCPL2    DATA 0BDH; Ch2 Compare Value LSB                    
                +2           PWMCPUDH0  DATA 0ACH; Ch0 Compare Value Update MSB             
                +2           PWMCPUDH1  DATA 0B3H; Ch1 Compare Value Update MSB             
                +2           PWMCPUDH2  DATA 0BAH; Ch2 Compare Value Update MSB             
                +2           PWMCPUDL0  DATA 0ABH; Ch0 Compare Value Update LSB             
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   492

                +2           PWMCPUDL1  DATA 0B2H; Ch1 Compare Value Update LSB             
                +2           PWMCPUDL2  DATA 0B9H; Ch2 Compare Value Update LSB             
                +2           PWMDTINLIM DATA 0E2H; DTI Negative Limit                       
                +2           PWMDTIPLIM DATA 0E1H; DTI Positive Limit                       
                +2           PWMH       DATA 0C4H; PWM Counter MSB                          
                +2           PWMIE      DATA 09FH; PWM Interrupt Enable                     
                +2           PWMIF      DATA 09DH; PWM Interrupt Flags                      
                +2           PWML       DATA 0C3H; PWM Counter LSB                          
                +2           PWMLIMH    DATA 0C6H; PWM Counter Limit MSB                    
                +2           PWMLIML    DATA 0C5H; PWM Counter Limit LSB                    
                +2           PWMSTATUS  DATA 09BH; PWM Status                               
                +2           REF0CN     DATA 0D1H; Voltage Reference Control                
                +2           REG0CN     DATA 0C9H; Regulator 0 Control                      
                +2           REVID      DATA 0B6H; Revision Identifcation                   
                +2           RSTSRC     DATA 0EFH; Reset Source                             
                +2           SBCON1     DATA 094H; UART1 Baud Rate Generator Control        
                +2           SBRLH1     DATA 096H; UART1 Baud Rate Generator High Byte      
                +2           SBRLL1     DATA 095H; UART1 Baud Rate Generator Low Byte       
                +2           SBUF0      DATA 099H; UART0 Serial Port Data Buffer            
                +2           SBUF1      DATA 092H; UART1 Serial Port Data Buffer            
                +2           SCON0      DATA 098H; UART0 Serial Port Control                
                +2           SCON1      DATA 0C8H; UART1 Serial Port Control                
                +2           SFRPAGE    DATA 0A7H; SFR Page                                 
                +2           SFRPGCN    DATA 0BCH; SFR Page Control                         
                +2           SFRSTACK   DATA 0D7H; SFR Page Stack                           
                +2           SMB0ADM    DATA 0D6H; SMBus 0 Slave Address Mask               
                +2           SMB0ADR    DATA 0D7H; SMBus 0 Slave Address                    
                +2           SMB0CF     DATA 0C1H; SMBus 0 Configuration                    
                +2           SMB0CN0    DATA 0C0H; SMBus 0 Control                          
                +2           SMB0DAT    DATA 0C2H; SMBus 0 Data                             
                +2           SMB0FCN0   DATA 0C3H; SMBus 0 FIFO Control 0                   
                +2           SMB0FCN1   DATA 0C4H; SMBus 0 FIFO Control 1                   
                +2           SMB0FCT    DATA 0EFH; SMBus 0 FIFO Count                       
                +2           SMB0RXLN   DATA 0C5H; SMBus 0 Receive Length Counter           
                +2           SMB0TC     DATA 0ACH; SMBus 0 Timing and Pin Control           
                +2           SMOD1      DATA 093H; UART1 Mode                               
                +2           SP         DATA 081H; Stack Pointer                            
                +2           SPI0CFG    DATA 0A1H; SPI0 Configuration                       
                +2           SPI0CKR    DATA 0A2H; SPI0 Clock Rate                          
                +2           SPI0CN0    DATA 0F8H; SPI0 Control                             
                +2           SPI0DAT    DATA 0A3H; SPI0 Data                                
                +2           SPI0FCN0   DATA 09AH; SPI0 FIFO Control 0                      
                +2           SPI0FCN1   DATA 09BH; SPI0 FIFO Control 1                      
                +2           SPI0FCT    DATA 0F7H; SPI0 FIFO Count                          
                +2           SPI0PCF    DATA 0DFH; SPI0 Pin Configuration                   
                +2           TCON       DATA 088H; Timer 0/1 Control                        
                +2           TH0        DATA 08CH; Timer 0 High Byte                        
                +2           TH1        DATA 08DH; Timer 1 High Byte                        
                +2           TL0        DATA 08AH; Timer 0 Low Byte                         
                +2           TL1        DATA 08BH; Timer 1 Low Byte                         
                +2           TMOD       DATA 089H; Timer 0/1 Mode                           
                +2           TMR2CN0    DATA 0C8H; Timer 2 Control 0                        
                +2           TMR2CN1    DATA 0FDH; Timer 2 Control 1                        
                +2           TMR2H      DATA 0CFH; Timer 2 High Byte                        
                +2           TMR2L      DATA 0CEH; Timer 2 Low Byte                         
                +2           TMR2RLH    DATA 0CBH; Timer 2 Reload High Byte                 
                +2           TMR2RLL    DATA 0CAH; Timer 2 Reload Low Byte                  
                +2           TMR3CN0    DATA 091H; Timer 3 Control 0                        
                +2           TMR3CN1    DATA 0FEH; Timer 3 Control 1                        
                +2           TMR3H      DATA 095H; Timer 3 High Byte                        
                +2           TMR3L      DATA 094H; Timer 3 Low Byte                         
                +2           TMR3RLH    DATA 093H; Timer 3 Reload High Byte                 
                +2           TMR3RLL    DATA 092H; Timer 3 Reload Low Byte                  
                +2           TMR4CN0    DATA 098H; Timer 4 Control 0                        
                +2           TMR4CN1    DATA 0FFH; Timer 4 Control 1                        
                +2           TMR4H      DATA 0A5H; Timer 4 High Byte                        
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   493

                +2           TMR4L      DATA 0A4H; Timer 4 Low Byte                         
                +2           TMR4RLH    DATA 0A3H; Timer 4 Reload High Byte                 
                +2           TMR4RLL    DATA 0A2H; Timer 4 Reload Low Byte                  
                +2           TMR5CN0    DATA 0C0H; Timer 5 Control 0                        
                +2           TMR5CN1    DATA 0F1H; Timer 5 Control 1                        
                +2           TMR5H      DATA 0D5H; Timer 5 High Byte                        
                +2           TMR5L      DATA 0D4H; Timer 5 Low Byte                         
                +2           TMR5RLH    DATA 0D3H; Timer 5 Reload High Byte                 
                +2           TMR5RLL    DATA 0D2H; Timer 5 Reload Low Byte                  
                +2           UART0PCF   DATA 0D9H; UART0 Pin Configuration                  
                +2           UART1FCN0  DATA 09DH; UART1 FIFO Control 0                     
                +2           UART1FCN1  DATA 0D8H; UART1 FIFO Control 1                     
                +2           UART1FCT   DATA 0FAH; UART1 FIFO Count                         
                +2           UART1LIN   DATA 09EH; UART1 LIN Configuration                  
                +2           UART1PCF   DATA 0DAH; UART1 Pin Configuration                  
                +2           WDTCN      DATA 097H; Watchdog Timer Control                   
                +2           XBR0       DATA 0E1H; Port I/O Crossbar 0                      
                +2           XBR1       DATA 0E2H; Port I/O Crossbar 1                      
                +2           XBR2       DATA 0E3H; Port I/O Crossbar 2                      
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0ASA  DATA 0B5H ; ADC0 Autoscan Start Address Low Byte 
                +2           ADC0GT   DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0     DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT   DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP       DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0  DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1  DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2  DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0     DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           PWMCP0   DATA 099H ; Ch0 Compare Value LSB                
                +2           PWMCP1   DATA 0B5H ; Ch1 Compare Value LSB                
                +2           PWMCP2   DATA 0BDH ; Ch2 Compare Value LSB                
                +2           PWMCPUD0 DATA 0ABH ; Ch0 Compare Value Update LSB         
                +2           PWMCPUD1 DATA 0B2H ; Ch1 Compare Value Update LSB         
                +2           PWMCPUD2 DATA 0B9H ; Ch2 Compare Value Update LSB         
                +2           PWM      DATA 0C3H ; PWM Counter LSB                      
                +2           PWMLIM   DATA 0C5H ; PWM Counter Limit LSB                
                +2           TMR2     DATA 0CEH ; Timer 2 Low Byte                     
                +2           TMR2RL   DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3     DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL   DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4     DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL   DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           TMR5     DATA 0D4H ; Timer 5 Low Byte                     
                +2           TMR5RL   DATA 0D2H ; Timer 5 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   494

                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_TEMPE  BIT ADC0CN0.0 ; Temperature Sensor Enable         
                +2           ADC0CN0_ADGN0  BIT ADC0CN0.1 ; Gain Control Bit 0                
                +2           ADC0CN0_ADGN1  BIT ADC0CN0.2 ; Gain Control Bit 1                
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag     
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                          
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag
                +2           ADC0CN0_IPOEN  BIT ADC0CN0.6 ; Idle Powered-off Enable           
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                        
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; CLIF0 0xE8 (Configurable Logic Interrupt Flag 0)
                +2           CLIF0_C0FIF BIT CLIF0.0 ; CLU0 Falling Edge Flag
                +2           CLIF0_C0RIF BIT CLIF0.1 ; CLU0 Rising Edge Flag 
                +2           CLIF0_C1FIF BIT CLIF0.2 ; CLU1 Falling Edge Flag
                +2           CLIF0_C1RIF BIT CLIF0.3 ; CLU1 Rising Edge Flag 
                +2           CLIF0_C2FIF BIT CLIF0.4 ; CLU2 Falling Edge Flag
                +2           CLIF0_C2RIF BIT CLIF0.5 ; CLU2 Rising Edge Flag 
                +2           CLIF0_C3FIF BIT CLIF0.6 ; CLU3 Falling Edge Flag
                +2           CLIF0_C3RIF BIT CLIF0.7 ; CLU3 Rising Edge Flag 
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   495

                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   496

                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; TMR5CN0 0xC0 (Timer 5 Control 0)
                +2           TMR5CN0_T5XCLK0 BIT TMR5CN0.0 ; Timer 5 External Clock Select Bit 0
                +2           TMR5CN0_T5XCLK1 BIT TMR5CN0.1 ; Timer 5 External Clock Select Bit 1
                +2           TMR5CN0_TR5     BIT TMR5CN0.2 ; Timer 5 Run Control                
                +2           TMR5CN0_T5SPLIT BIT TMR5CN0.3 ; Timer 5 Split Mode Enable          
                +2           TMR5CN0_TF5CEN  BIT TMR5CN0.4 ; Timer 5 Capture Enable             
                +2           TMR5CN0_TF5LEN  BIT TMR5CN0.5 ; Timer 5 Low Byte Interrupt Enable  
                +2           TMR5CN0_TF5L    BIT TMR5CN0.6 ; Timer 5 Low Byte Overflow Flag     
                +2           TMR5CN0_TF5H    BIT TMR5CN0.7 ; Timer 5 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 15 ; UART1                     
                +2           TIMER4_IRQn  EQU 17 ; Timer 4 Overflow / Capture
                +2           TIMER5_IRQn  EQU 18 ; Timer 5 Overflow / Capture
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   497

                +2           CL0_IRQn     EQU 19 ; Configurable Logic        
                +2           PWM_IRQn     EQU 20 ; Pulse Width Modulation    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           LEGACY_PAGE  EQU 000H ; Legacy SFR Page
                +2           PG2_PAGE     EQU 010H ; Page2          
                +2           PG3_PAGE     EQU 020H ; Page3          
                +2           PG4_PAGE     EQU 030H ; Page4          
                +1           
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 2       ; BB5 requires MCU_48MHZ == 2
                +1           CSEG AT 3040h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#A_X_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#A_X_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#A_X_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#A_X_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#A_X_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#A_X_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#A_X_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#A_X_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#A_X_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#A_X_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#A_X_90#        "
                +1           ENDIF
                +1           
                +1           CSEG AT 3050h
                +1           Eep_ESC_MCU:            DB      "#BLHELI$EFM8B51#"      ; Project and MCU tag (16 Bytes)
                +1           
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU 92  ; Temperature measurement ADC value for which main 
                             motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                        EQU P0          ; Receive/Transmit port
                +1           RTX_MDOUT                       EQU     P0MDOUT ; Set to 1 for PUSHPULL
                +1           RTX_MDIN                        EQU     P0MDIN  ; Set to 1 for DIGITAL
                +1           RTX_SKIP                        EQU     P0SKIP  ; Set to 1 for SKIP
                +1           RTX_PIN                         EQU 5           ; RTX pin
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   498

                +1           SIGNATURE_001           EQU     0E8h    ; Device signature
                +1           SIGNATURE_002           EQU     0B5h
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           Comp_Com        EQU     4       ;i
                +1           Mux_A           EQU     3       ;i
                +1           Mux_C           EQU     2       ;i
                +1           Mux_B           EQU     1       ;i
                +1           ;                       EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1                   mov     Timer0_X, #0
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   499

                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1                   mov     PCA0POL, #00h                           ; Damping noninverted, pwm noninver
                             ted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   500

                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                           EQU 7       ;i
                +1           ;                           EQU 6       ;i
                +1           CcomFET   EQU 5 ;o
                +1           CpwmFET   EQU 4 ;o
                +1           BcomFET   EQU 3 ;o
                +1           BpwmFET   EQU 2 ;o
                +1           AcomFET   EQU 1 ;o
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   501

                +1           ApwmFET   EQU 0 ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   setb    P1.AcomFET
                +1                   setb    P1.BcomFET
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   clr     P1.AcomFET
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   502

                +1           AcomFET_off MACRO
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   setb    P1.AcomFET
                +1                   setb    P1.BcomFET
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.AcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CcomFET
                +1                   mov     P1SKIP, #2Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #12h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #11h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   503

                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     CLKGRP0, #18h   ; Enable SAR clock, at 12MHz
                +1                   mov     ADC0CF1, #0Ah   ; 800ns tracking time
                +1                   mov     ADC0CF2, #2Fh   ; 1.65V reference
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #85h   ; ADC enabled, gain 0.5, temp sensor enabled
                +1                   mov     ADC0CN1, #20h   ; 10bit mode
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #95h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   504

                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #10h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   32755     
                   32756     IF ESCNO == B_X_
                             ;$include (B_X.inc) ; Select pinout B_X
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "B_X"
                +1           ; X  X  RC CC MA MC MB X     X  X  Cp Cc Bp Bc Ap Ac
                +1           ; PWM fets active high, on high side
                +1           ; COM fets active high
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB5
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   505

                +1           ;*********************
                +1           ;$include (SI_EFM8BB51_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB51F16G_QFN20
                +2           ;  EFM8BB51F16G_TSSOP20
                +2           ;  EFM8BB51F16I_QFN20
                +2           ;  EFM8BB51F16I_TSSOP20
                +2           ;  EFM8BB51F8G_QFN20
                +2           ;  EFM8BB51F8G_TSSOP20
                +2           ;  EFM8BB51F8I_QFN20
                +2           ;  EFM8BB51F8I_TSSOP20
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC        DATA 0E0H; Accumulator                              
                +2           ADC0ASAH   DATA 0B6H; ADC0 Autoscan Start Address High Byte    
                +2           ADC0ASAL   DATA 0B5H; ADC0 Autoscan Start Address Low Byte     
                +2           ADC0ASCF   DATA 0A1H; ADC0 Autoscan Configuration              
                +2           ADC0ASCT   DATA 0C7H; ADC0 Autoscan Output Count               
                +2           ADC0CF1    DATA 0B9H; ADC0 Configuration                       
                +2           ADC0CF2    DATA 0DFH; ADC0 Power Control                       
                +2           ADC0CN0    DATA 0E8H; ADC0 Control 0                           
                +2           ADC0CN1    DATA 0B2H; ADC0 Control 1                           
                +2           ADC0CN2    DATA 0B3H; ADC0 Control 2                           
                +2           ADC0GTH    DATA 0C4H; ADC0 Greater-Than High Byte              
                +2           ADC0GTL    DATA 0C3H; ADC0 Greater-Than Low Byte               
                +2           ADC0H      DATA 0BEH; ADC0 Data Word High Byte                 
                +2           ADC0L      DATA 0BDH; ADC0 Data Word Low Byte                  
                +2           ADC0LTH    DATA 0C6H; ADC0 Less-Than High Byte                 
                +2           ADC0LTL    DATA 0C5H; ADC0 Less-Than Low Byte                  
                +2           ADC0MX     DATA 0BBH; ADC0 Multiplexer Selection               
                +2           B          DATA 0F0H; B Register                               
                +2           CKCON0     DATA 08EH; Clock Control 0                          
                +2           CKCON1     DATA 0A6H; Clock Control 1                          
                +2           CLEN0      DATA 0C6H; Configurable Logic Enable 0              
                +2           CLIE0      DATA 0C7H; Configurable Logic Interrupt Enable 0    
                +2           CLIF0      DATA 0E8H; Configurable Logic Interrupt Flag 0      
                +2           CLKGRP0    DATA 0AFH; Clock Group Control                      
                +2           CLKSEL     DATA 0A9H; Clock Select                             
                +2           CLOUT0     DATA 0D1H; Configurable Logic Output 0              
                +2           CLU0CF     DATA 0B1H; Configurable Logic Unit 0 Configuration  
                +2           CLU0FN     DATA 0AFH; Configurable Logic Unit 0 Function Select
                +2           CLU0MX     DATA 084H; Configurable Logic Unit 0 Multiplexer    
                +2           CLU1CF     DATA 0B3H; Configurable Logic Unit 1 Configuration  
                +2           CLU1FN     DATA 0B2H; Configurable Logic Unit 1 Function Select
                +2           CLU1MX     DATA 085H; Configurable Logic Unit 1 Multiplexer    
                +2           CLU2CF     DATA 0B6H; Configurable Logic Unit 2 Configuration  
                +2           CLU2FN     DATA 0B5H; Configurable Logic Unit 2 Function Select
                +2           CLU2MX     DATA 091H; Configurable Logic Unit 2 Multiplexer    
                +2           CLU3CF     DATA 0BFH; Configurable Logic Unit 3 Configuration  
                +2           CLU3FN     DATA 0BEH; Configurable Logic Unit 3 Function Select
                +2           CLU3MX     DATA 0AEH; Configurable Logic Unit 3 Multiplexer    
                +2           CMP0CN0    DATA 09BH; Comparator 0 Control 0                   
                +2           CMP0CN1    DATA 099H; Comparator 0 Control 1                   
                +2           CMP0MD     DATA 09DH; Comparator 0 Mode                        
                +2           CMP0MX     DATA 09FH; Comparator 0 Multiplexer Selection       
                +2           CMP1CN0    DATA 0BFH; Comparator 1 Control 0                   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   506

                +2           CMP1CN1    DATA 0ACH; Comparator 1 Control 1                   
                +2           CMP1MD     DATA 0ABH; Comparator 1 Mode                        
                +2           CMP1MX     DATA 0AAH; Comparator 1 Multiplexer Selection       
                +2           CP0CN      DATA 0A4H; Charge Pump Configuration                
                +2           CRC0CN0    DATA 0CEH; CRC0 Control 0                           
                +2           CRC0CN1    DATA 086H; CRC0 Control 1                           
                +2           CRC0CNT    DATA 0D3H; CRC0 Automatic Flash Sector Count        
                +2           CRC0DAT    DATA 0CBH; CRC0 Data Output                         
                +2           CRC0FLIP   DATA 0CFH; CRC0 Bit Flip                            
                +2           CRC0IN     DATA 0CAH; CRC0 Data Input                          
                +2           CRC0ST     DATA 0D2H; CRC0 Automatic Flash Sector Start        
                +2           DERIVID    DATA 0ADH; Derivative Identification                
                +2           DEVICEID   DATA 0B5H; Device Identification                    
                +2           DPH        DATA 083H; Data Pointer High                        
                +2           DPL        DATA 082H; Data Pointer Low                         
                +2           EIE1       DATA 0E6H; Extended Interrupt Enable 1              
                +2           EIE2       DATA 0F3H; Extended Interrupt Enable 2              
                +2           EIP1       DATA 0BBH; Extended Interrupt Priority 1 Low        
                +2           EIP1H      DATA 0EEH; Extended Interrupt Priority 1 High       
                +2           EIP2       DATA 0EDH; Extended Interrupt Priority 2            
                +2           EIP2H      DATA 0F6H; Extended Interrupt Priority 2 High       
                +2           EMI0CN     DATA 0E7H; External Memory Interface Control        
                +2           FLKEY      DATA 0B7H; Flash Lock and Key                       
                +2           HFO0CAL    DATA 0D6H; High Frequency Oscillator 0 Calibration  
                +2           HFO0CN     DATA 0EFH; High Frequency Oscillator Control        
                +2           HFO0TRIM0  DATA 0CCH; High Frequency Oscillator Trim           
                +2           IE         DATA 0A8H; Interrupt Enable                         
                +2           IP         DATA 0B8H; Interrupt Priority                       
                +2           IPH        DATA 0F2H; Interrupt Priority High                  
                +2           IT01CF     DATA 0E4H; INT0/INT1 Configuration                  
                +2           LFO0CN     DATA 0B1H; Low Frequency Oscillator Control         
                +2           P0         DATA 080H; Port 0 Pin Latch                         
                +2           P0MASK     DATA 0FEH; Port 0 Mask                              
                +2           P0MAT      DATA 0FDH; Port 0 Match                             
                +2           P0MDIN     DATA 0F1H; Port 0 Input Mode                        
                +2           P0MDOUT    DATA 0A4H; Port 0 Output Mode                       
                +2           P0SKIP     DATA 0D4H; Port 0 Skip                              
                +2           P1         DATA 090H; Port 1 Pin Latch                         
                +2           P1MASK     DATA 0EEH; Port 1 Mask                              
                +2           P1MAT      DATA 0EDH; Port 1 Match                             
                +2           P1MDIN     DATA 0F2H; Port 1 Input Mode                        
                +2           P1MDOUT    DATA 0A5H; Port 1 Output Mode                       
                +2           P1SKIP     DATA 0D5H; Port 1 Skip                              
                +2           P2         DATA 0A0H; Port 2 Pin Latch                         
                +2           P2MDIN     DATA 0F3H; Port 2 Input Mode                        
                +2           P2MDOUT    DATA 0A6H; Port 2 Output Mode                       
                +2           PCA0CENT   DATA 09EH; PCA Center Alignment Enable              
                +2           PCA0CLR    DATA 09CH; PCA Comparator Clear Control             
                +2           PCA0CN0    DATA 0D8H; PCA Control                              
                +2           PCA0CPH0   DATA 0FCH; PCA Channel 0 Capture Module High Byte   
                +2           PCA0CPH1   DATA 0EAH; PCA Channel 1 Capture Module High Byte   
                +2           PCA0CPH2   DATA 0ECH; PCA Channel 2 Capture Module High Byte   
                +2           PCA0CPL0   DATA 0FBH; PCA Channel 0 Capture Module Low Byte    
                +2           PCA0CPL1   DATA 0E9H; PCA Channel 1 Capture Module Low Byte    
                +2           PCA0CPL2   DATA 0EBH; PCA Channel 2 Capture Module Low Byte    
                +2           PCA0CPM0   DATA 0DAH; PCA Channel 0 Capture/Compare Mode       
                +2           PCA0CPM1   DATA 0DBH; PCA Channel 1 Capture/Compare Mode       
                +2           PCA0CPM2   DATA 0DCH; PCA Channel 2 Capture/Compare Mode       
                +2           PCA0H      DATA 0FAH; PCA Counter/Timer High Byte              
                +2           PCA0L      DATA 0F9H; PCA Counter/Timer Low Byte               
                +2           PCA0MD     DATA 0D9H; PCA Mode                                 
                +2           PCA0POL    DATA 096H; PCA Output Polarity                      
                +2           PCA0PWM    DATA 0F7H; PCA PWM Configuration                    
                +2           PCON0      DATA 087H; Power Control 0                          
                +2           PCON1      DATA 0CDH; Power Control 1                          
                +2           PFE0CN     DATA 0C1H; Prefetch Engine Control                  
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   507

                +2           PRTDRV     DATA 0F6H; Port Drive Strength                      
                +2           PSCTL      DATA 08FH; Program Store Control                    
                +2           PSTAT0     DATA 0AAH; PMU Status 0                             
                +2           PSW        DATA 0D0H; Program Status Word                      
                +2           PWMCFG0    DATA 0C2H; PWM Configuration 0                      
                +2           PWMCFG1    DATA 0C9H; PWM Configuration 1                      
                +2           PWMCFG2    DATA 0D1H; PWM Configuration 2                      
                +2           PWMCFG3    DATA 0DFH; PWM Configuration 3                      
                +2           PWMCKDIV   DATA 0E3H; PWM Clock Divider                        
                +2           PWMCPH0    DATA 09AH; Ch0 Compare Value MSB                    
                +2           PWMCPH1    DATA 0B6H; Ch1 Compare Value MSB                    
                +2           PWMCPH2    DATA 0BEH; Ch2 Compare Value MSB                    
                +2           PWMCPL0    DATA 099H; Ch0 Compare Value LSB                    
                +2           PWMCPL1    DATA 0B5H; Ch1 Compare Value LSB                    
                +2           PWMCPL2    DATA 0BDH; Ch2 Compare Value LSB                    
                +2           PWMCPUDH0  DATA 0ACH; Ch0 Compare Value Update MSB             
                +2           PWMCPUDH1  DATA 0B3H; Ch1 Compare Value Update MSB             
                +2           PWMCPUDH2  DATA 0BAH; Ch2 Compare Value Update MSB             
                +2           PWMCPUDL0  DATA 0ABH; Ch0 Compare Value Update LSB             
                +2           PWMCPUDL1  DATA 0B2H; Ch1 Compare Value Update LSB             
                +2           PWMCPUDL2  DATA 0B9H; Ch2 Compare Value Update LSB             
                +2           PWMDTINLIM DATA 0E2H; DTI Negative Limit                       
                +2           PWMDTIPLIM DATA 0E1H; DTI Positive Limit                       
                +2           PWMH       DATA 0C4H; PWM Counter MSB                          
                +2           PWMIE      DATA 09FH; PWM Interrupt Enable                     
                +2           PWMIF      DATA 09DH; PWM Interrupt Flags                      
                +2           PWML       DATA 0C3H; PWM Counter LSB                          
                +2           PWMLIMH    DATA 0C6H; PWM Counter Limit MSB                    
                +2           PWMLIML    DATA 0C5H; PWM Counter Limit LSB                    
                +2           PWMSTATUS  DATA 09BH; PWM Status                               
                +2           REF0CN     DATA 0D1H; Voltage Reference Control                
                +2           REG0CN     DATA 0C9H; Regulator 0 Control                      
                +2           REVID      DATA 0B6H; Revision Identifcation                   
                +2           RSTSRC     DATA 0EFH; Reset Source                             
                +2           SBCON1     DATA 094H; UART1 Baud Rate Generator Control        
                +2           SBRLH1     DATA 096H; UART1 Baud Rate Generator High Byte      
                +2           SBRLL1     DATA 095H; UART1 Baud Rate Generator Low Byte       
                +2           SBUF0      DATA 099H; UART0 Serial Port Data Buffer            
                +2           SBUF1      DATA 092H; UART1 Serial Port Data Buffer            
                +2           SCON0      DATA 098H; UART0 Serial Port Control                
                +2           SCON1      DATA 0C8H; UART1 Serial Port Control                
                +2           SFRPAGE    DATA 0A7H; SFR Page                                 
                +2           SFRPGCN    DATA 0BCH; SFR Page Control                         
                +2           SFRSTACK   DATA 0D7H; SFR Page Stack                           
                +2           SMB0ADM    DATA 0D6H; SMBus 0 Slave Address Mask               
                +2           SMB0ADR    DATA 0D7H; SMBus 0 Slave Address                    
                +2           SMB0CF     DATA 0C1H; SMBus 0 Configuration                    
                +2           SMB0CN0    DATA 0C0H; SMBus 0 Control                          
                +2           SMB0DAT    DATA 0C2H; SMBus 0 Data                             
                +2           SMB0FCN0   DATA 0C3H; SMBus 0 FIFO Control 0                   
                +2           SMB0FCN1   DATA 0C4H; SMBus 0 FIFO Control 1                   
                +2           SMB0FCT    DATA 0EFH; SMBus 0 FIFO Count                       
                +2           SMB0RXLN   DATA 0C5H; SMBus 0 Receive Length Counter           
                +2           SMB0TC     DATA 0ACH; SMBus 0 Timing and Pin Control           
                +2           SMOD1      DATA 093H; UART1 Mode                               
                +2           SP         DATA 081H; Stack Pointer                            
                +2           SPI0CFG    DATA 0A1H; SPI0 Configuration                       
                +2           SPI0CKR    DATA 0A2H; SPI0 Clock Rate                          
                +2           SPI0CN0    DATA 0F8H; SPI0 Control                             
                +2           SPI0DAT    DATA 0A3H; SPI0 Data                                
                +2           SPI0FCN0   DATA 09AH; SPI0 FIFO Control 0                      
                +2           SPI0FCN1   DATA 09BH; SPI0 FIFO Control 1                      
                +2           SPI0FCT    DATA 0F7H; SPI0 FIFO Count                          
                +2           SPI0PCF    DATA 0DFH; SPI0 Pin Configuration                   
                +2           TCON       DATA 088H; Timer 0/1 Control                        
                +2           TH0        DATA 08CH; Timer 0 High Byte                        
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   508

                +2           TH1        DATA 08DH; Timer 1 High Byte                        
                +2           TL0        DATA 08AH; Timer 0 Low Byte                         
                +2           TL1        DATA 08BH; Timer 1 Low Byte                         
                +2           TMOD       DATA 089H; Timer 0/1 Mode                           
                +2           TMR2CN0    DATA 0C8H; Timer 2 Control 0                        
                +2           TMR2CN1    DATA 0FDH; Timer 2 Control 1                        
                +2           TMR2H      DATA 0CFH; Timer 2 High Byte                        
                +2           TMR2L      DATA 0CEH; Timer 2 Low Byte                         
                +2           TMR2RLH    DATA 0CBH; Timer 2 Reload High Byte                 
                +2           TMR2RLL    DATA 0CAH; Timer 2 Reload Low Byte                  
                +2           TMR3CN0    DATA 091H; Timer 3 Control 0                        
                +2           TMR3CN1    DATA 0FEH; Timer 3 Control 1                        
                +2           TMR3H      DATA 095H; Timer 3 High Byte                        
                +2           TMR3L      DATA 094H; Timer 3 Low Byte                         
                +2           TMR3RLH    DATA 093H; Timer 3 Reload High Byte                 
                +2           TMR3RLL    DATA 092H; Timer 3 Reload Low Byte                  
                +2           TMR4CN0    DATA 098H; Timer 4 Control 0                        
                +2           TMR4CN1    DATA 0FFH; Timer 4 Control 1                        
                +2           TMR4H      DATA 0A5H; Timer 4 High Byte                        
                +2           TMR4L      DATA 0A4H; Timer 4 Low Byte                         
                +2           TMR4RLH    DATA 0A3H; Timer 4 Reload High Byte                 
                +2           TMR4RLL    DATA 0A2H; Timer 4 Reload Low Byte                  
                +2           TMR5CN0    DATA 0C0H; Timer 5 Control 0                        
                +2           TMR5CN1    DATA 0F1H; Timer 5 Control 1                        
                +2           TMR5H      DATA 0D5H; Timer 5 High Byte                        
                +2           TMR5L      DATA 0D4H; Timer 5 Low Byte                         
                +2           TMR5RLH    DATA 0D3H; Timer 5 Reload High Byte                 
                +2           TMR5RLL    DATA 0D2H; Timer 5 Reload Low Byte                  
                +2           UART0PCF   DATA 0D9H; UART0 Pin Configuration                  
                +2           UART1FCN0  DATA 09DH; UART1 FIFO Control 0                     
                +2           UART1FCN1  DATA 0D8H; UART1 FIFO Control 1                     
                +2           UART1FCT   DATA 0FAH; UART1 FIFO Count                         
                +2           UART1LIN   DATA 09EH; UART1 LIN Configuration                  
                +2           UART1PCF   DATA 0DAH; UART1 Pin Configuration                  
                +2           WDTCN      DATA 097H; Watchdog Timer Control                   
                +2           XBR0       DATA 0E1H; Port I/O Crossbar 0                      
                +2           XBR1       DATA 0E2H; Port I/O Crossbar 1                      
                +2           XBR2       DATA 0E3H; Port I/O Crossbar 2                      
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0ASA  DATA 0B5H ; ADC0 Autoscan Start Address Low Byte 
                +2           ADC0GT   DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0     DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT   DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP       DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0  DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1  DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2  DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0     DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           PWMCP0   DATA 099H ; Ch0 Compare Value LSB                
                +2           PWMCP1   DATA 0B5H ; Ch1 Compare Value LSB                
                +2           PWMCP2   DATA 0BDH ; Ch2 Compare Value LSB                
                +2           PWMCPUD0 DATA 0ABH ; Ch0 Compare Value Update LSB         
                +2           PWMCPUD1 DATA 0B2H ; Ch1 Compare Value Update LSB         
                +2           PWMCPUD2 DATA 0B9H ; Ch2 Compare Value Update LSB         
                +2           PWM      DATA 0C3H ; PWM Counter LSB                      
                +2           PWMLIM   DATA 0C5H ; PWM Counter Limit LSB                
                +2           TMR2     DATA 0CEH ; Timer 2 Low Byte                     
                +2           TMR2RL   DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3     DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL   DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4     DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL   DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           TMR5     DATA 0D4H ; Timer 5 Low Byte                     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   509

                +2           TMR5RL   DATA 0D2H ; Timer 5 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_TEMPE  BIT ADC0CN0.0 ; Temperature Sensor Enable         
                +2           ADC0CN0_ADGN0  BIT ADC0CN0.1 ; Gain Control Bit 0                
                +2           ADC0CN0_ADGN1  BIT ADC0CN0.2 ; Gain Control Bit 1                
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag     
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                          
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag
                +2           ADC0CN0_IPOEN  BIT ADC0CN0.6 ; Idle Powered-off Enable           
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                        
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; CLIF0 0xE8 (Configurable Logic Interrupt Flag 0)
                +2           CLIF0_C0FIF BIT CLIF0.0 ; CLU0 Falling Edge Flag
                +2           CLIF0_C0RIF BIT CLIF0.1 ; CLU0 Rising Edge Flag 
                +2           CLIF0_C1FIF BIT CLIF0.2 ; CLU1 Falling Edge Flag
                +2           CLIF0_C1RIF BIT CLIF0.3 ; CLU1 Rising Edge Flag 
                +2           CLIF0_C2FIF BIT CLIF0.4 ; CLU2 Falling Edge Flag
                +2           CLIF0_C2RIF BIT CLIF0.5 ; CLU2 Rising Edge Flag 
                +2           CLIF0_C3FIF BIT CLIF0.6 ; CLU3 Falling Edge Flag
                +2           CLIF0_C3RIF BIT CLIF0.7 ; CLU3 Rising Edge Flag 
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   510

                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   511

                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; TMR5CN0 0xC0 (Timer 5 Control 0)
                +2           TMR5CN0_T5XCLK0 BIT TMR5CN0.0 ; Timer 5 External Clock Select Bit 0
                +2           TMR5CN0_T5XCLK1 BIT TMR5CN0.1 ; Timer 5 External Clock Select Bit 1
                +2           TMR5CN0_TR5     BIT TMR5CN0.2 ; Timer 5 Run Control                
                +2           TMR5CN0_T5SPLIT BIT TMR5CN0.3 ; Timer 5 Split Mode Enable          
                +2           TMR5CN0_TF5CEN  BIT TMR5CN0.4 ; Timer 5 Capture Enable             
                +2           TMR5CN0_TF5LEN  BIT TMR5CN0.5 ; Timer 5 Low Byte Interrupt Enable  
                +2           TMR5CN0_TF5L    BIT TMR5CN0.6 ; Timer 5 Low Byte Overflow Flag     
                +2           TMR5CN0_TF5H    BIT TMR5CN0.7 ; Timer 5 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   512

                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 15 ; UART1                     
                +2           TIMER4_IRQn  EQU 17 ; Timer 4 Overflow / Capture
                +2           TIMER5_IRQn  EQU 18 ; Timer 5 Overflow / Capture
                +2           CL0_IRQn     EQU 19 ; Configurable Logic        
                +2           PWM_IRQn     EQU 20 ; Pulse Width Modulation    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           LEGACY_PAGE  EQU 000H ; Legacy SFR Page
                +2           PG2_PAGE     EQU 010H ; Page2          
                +2           PG3_PAGE     EQU 020H ; Page3          
                +2           PG4_PAGE     EQU 030H ; Page4          
                +1           
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 2       ; BB5 requires MCU_48MHZ == 2
                +1           CSEG AT 3040h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#B_X_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#B_X_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#B_X_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#B_X_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#B_X_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#B_X_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#B_X_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#B_X_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#B_X_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#B_X_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#B_X_90#        "
                +1           ENDIF
                +1           
                +1           CSEG AT 3050h
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   513

                +1           Eep_ESC_MCU:            DB      "#BLHELI$EFM8B51#"      ; Project and MCU tag (16 Bytes)
                +1           
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU 92  ; Temperature measurement ADC value for which main 
                             motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                        EQU P0          ; Receive/Transmit port
                +1           RTX_MDOUT                       EQU     P0MDOUT ; Set to 1 for PUSHPULL
                +1           RTX_MDIN                        EQU     P0MDIN  ; Set to 1 for DIGITAL
                +1           RTX_SKIP                        EQU     P0SKIP  ; Set to 1 for SKIP
                +1           RTX_PIN                         EQU 5           ; RTX pin
                +1           
                +1           SIGNATURE_001           EQU     0E8h    ; Device signature
                +1           SIGNATURE_002           EQU     0B5h
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           Comp_Com        EQU     4       ;i
                +1           Mux_A           EQU     3       ;i
                +1           Mux_C           EQU     2       ;i
                +1           Mux_B           EQU     1       ;i
                +1           ;                       EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1                   mov     Timer0_X, #0
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   514

                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   515

                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #00h                           ; Pwm noninverted
                +1           ELSE
                +1                   mov     PCA0POL, #01h                           ; Damping inverted, pwm noninverted
                +1           ENDIF
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   516

                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CpwmFET         EQU     5       ;o
                +1           CcomFET         EQU     4       ;o
                +1           BpwmFET         EQU     3       ;o
                +1           BcomFET         EQU     2       ;o
                +1           ApwmFET         EQU     1       ;o
                +1           AcomFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU     (0 SHL AcomFET)+(0 SHL BcomFET)+(0 SHL CcomFET)
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   517

                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #37h
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   518

                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #1Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #12h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #11h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1                   cpl     A
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   519

                +1                   mov     CLKGRP0, #18h   ; Enable SAR clock, at 12MHz
                +1                   mov     ADC0CF1, #0Ah   ; 800ns tracking time
                +1                   mov     ADC0CF2, #2Fh   ; 1.65V reference
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #85h   ; ADC enabled, gain 0.5, temp sensor enabled
                +1                   mov     ADC0CN1, #20h   ; 10bit mode
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #95h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #10h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   33756     
                   33757     IF ESCNO == C_X_
                             ;$include (C_X.inc) ; Select pinout C_X
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   520

                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "C_X"
                +1           ; X  X  RC CC MA MC MB X     X  X  Cp Cc Bp Bc Ap Ac
                +1           ; PWM fets active low, on high side
                +1           ; COM fets active high
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB5
                +1           ;*********************
                +1           ;$include (SI_EFM8BB51_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB51F16G_QFN20
                +2           ;  EFM8BB51F16G_TSSOP20
                +2           ;  EFM8BB51F16I_QFN20
                +2           ;  EFM8BB51F16I_TSSOP20
                +2           ;  EFM8BB51F8G_QFN20
                +2           ;  EFM8BB51F8G_TSSOP20
                +2           ;  EFM8BB51F8I_QFN20
                +2           ;  EFM8BB51F8I_TSSOP20
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC        DATA 0E0H; Accumulator                              
                +2           ADC0ASAH   DATA 0B6H; ADC0 Autoscan Start Address High Byte    
                +2           ADC0ASAL   DATA 0B5H; ADC0 Autoscan Start Address Low Byte     
                +2           ADC0ASCF   DATA 0A1H; ADC0 Autoscan Configuration              
                +2           ADC0ASCT   DATA 0C7H; ADC0 Autoscan Output Count               
                +2           ADC0CF1    DATA 0B9H; ADC0 Configuration                       
                +2           ADC0CF2    DATA 0DFH; ADC0 Power Control                       
                +2           ADC0CN0    DATA 0E8H; ADC0 Control 0                           
                +2           ADC0CN1    DATA 0B2H; ADC0 Control 1                           
                +2           ADC0CN2    DATA 0B3H; ADC0 Control 2                           
                +2           ADC0GTH    DATA 0C4H; ADC0 Greater-Than High Byte              
                +2           ADC0GTL    DATA 0C3H; ADC0 Greater-Than Low Byte               
                +2           ADC0H      DATA 0BEH; ADC0 Data Word High Byte                 
                +2           ADC0L      DATA 0BDH; ADC0 Data Word Low Byte                  
                +2           ADC0LTH    DATA 0C6H; ADC0 Less-Than High Byte                 
                +2           ADC0LTL    DATA 0C5H; ADC0 Less-Than Low Byte                  
                +2           ADC0MX     DATA 0BBH; ADC0 Multiplexer Selection               
                +2           B          DATA 0F0H; B Register                               
                +2           CKCON0     DATA 08EH; Clock Control 0                          
                +2           CKCON1     DATA 0A6H; Clock Control 1                          
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   521

                +2           CLEN0      DATA 0C6H; Configurable Logic Enable 0              
                +2           CLIE0      DATA 0C7H; Configurable Logic Interrupt Enable 0    
                +2           CLIF0      DATA 0E8H; Configurable Logic Interrupt Flag 0      
                +2           CLKGRP0    DATA 0AFH; Clock Group Control                      
                +2           CLKSEL     DATA 0A9H; Clock Select                             
                +2           CLOUT0     DATA 0D1H; Configurable Logic Output 0              
                +2           CLU0CF     DATA 0B1H; Configurable Logic Unit 0 Configuration  
                +2           CLU0FN     DATA 0AFH; Configurable Logic Unit 0 Function Select
                +2           CLU0MX     DATA 084H; Configurable Logic Unit 0 Multiplexer    
                +2           CLU1CF     DATA 0B3H; Configurable Logic Unit 1 Configuration  
                +2           CLU1FN     DATA 0B2H; Configurable Logic Unit 1 Function Select
                +2           CLU1MX     DATA 085H; Configurable Logic Unit 1 Multiplexer    
                +2           CLU2CF     DATA 0B6H; Configurable Logic Unit 2 Configuration  
                +2           CLU2FN     DATA 0B5H; Configurable Logic Unit 2 Function Select
                +2           CLU2MX     DATA 091H; Configurable Logic Unit 2 Multiplexer    
                +2           CLU3CF     DATA 0BFH; Configurable Logic Unit 3 Configuration  
                +2           CLU3FN     DATA 0BEH; Configurable Logic Unit 3 Function Select
                +2           CLU3MX     DATA 0AEH; Configurable Logic Unit 3 Multiplexer    
                +2           CMP0CN0    DATA 09BH; Comparator 0 Control 0                   
                +2           CMP0CN1    DATA 099H; Comparator 0 Control 1                   
                +2           CMP0MD     DATA 09DH; Comparator 0 Mode                        
                +2           CMP0MX     DATA 09FH; Comparator 0 Multiplexer Selection       
                +2           CMP1CN0    DATA 0BFH; Comparator 1 Control 0                   
                +2           CMP1CN1    DATA 0ACH; Comparator 1 Control 1                   
                +2           CMP1MD     DATA 0ABH; Comparator 1 Mode                        
                +2           CMP1MX     DATA 0AAH; Comparator 1 Multiplexer Selection       
                +2           CP0CN      DATA 0A4H; Charge Pump Configuration                
                +2           CRC0CN0    DATA 0CEH; CRC0 Control 0                           
                +2           CRC0CN1    DATA 086H; CRC0 Control 1                           
                +2           CRC0CNT    DATA 0D3H; CRC0 Automatic Flash Sector Count        
                +2           CRC0DAT    DATA 0CBH; CRC0 Data Output                         
                +2           CRC0FLIP   DATA 0CFH; CRC0 Bit Flip                            
                +2           CRC0IN     DATA 0CAH; CRC0 Data Input                          
                +2           CRC0ST     DATA 0D2H; CRC0 Automatic Flash Sector Start        
                +2           DERIVID    DATA 0ADH; Derivative Identification                
                +2           DEVICEID   DATA 0B5H; Device Identification                    
                +2           DPH        DATA 083H; Data Pointer High                        
                +2           DPL        DATA 082H; Data Pointer Low                         
                +2           EIE1       DATA 0E6H; Extended Interrupt Enable 1              
                +2           EIE2       DATA 0F3H; Extended Interrupt Enable 2              
                +2           EIP1       DATA 0BBH; Extended Interrupt Priority 1 Low        
                +2           EIP1H      DATA 0EEH; Extended Interrupt Priority 1 High       
                +2           EIP2       DATA 0EDH; Extended Interrupt Priority 2            
                +2           EIP2H      DATA 0F6H; Extended Interrupt Priority 2 High       
                +2           EMI0CN     DATA 0E7H; External Memory Interface Control        
                +2           FLKEY      DATA 0B7H; Flash Lock and Key                       
                +2           HFO0CAL    DATA 0D6H; High Frequency Oscillator 0 Calibration  
                +2           HFO0CN     DATA 0EFH; High Frequency Oscillator Control        
                +2           HFO0TRIM0  DATA 0CCH; High Frequency Oscillator Trim           
                +2           IE         DATA 0A8H; Interrupt Enable                         
                +2           IP         DATA 0B8H; Interrupt Priority                       
                +2           IPH        DATA 0F2H; Interrupt Priority High                  
                +2           IT01CF     DATA 0E4H; INT0/INT1 Configuration                  
                +2           LFO0CN     DATA 0B1H; Low Frequency Oscillator Control         
                +2           P0         DATA 080H; Port 0 Pin Latch                         
                +2           P0MASK     DATA 0FEH; Port 0 Mask                              
                +2           P0MAT      DATA 0FDH; Port 0 Match                             
                +2           P0MDIN     DATA 0F1H; Port 0 Input Mode                        
                +2           P0MDOUT    DATA 0A4H; Port 0 Output Mode                       
                +2           P0SKIP     DATA 0D4H; Port 0 Skip                              
                +2           P1         DATA 090H; Port 1 Pin Latch                         
                +2           P1MASK     DATA 0EEH; Port 1 Mask                              
                +2           P1MAT      DATA 0EDH; Port 1 Match                             
                +2           P1MDIN     DATA 0F2H; Port 1 Input Mode                        
                +2           P1MDOUT    DATA 0A5H; Port 1 Output Mode                       
                +2           P1SKIP     DATA 0D5H; Port 1 Skip                              
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   522

                +2           P2         DATA 0A0H; Port 2 Pin Latch                         
                +2           P2MDIN     DATA 0F3H; Port 2 Input Mode                        
                +2           P2MDOUT    DATA 0A6H; Port 2 Output Mode                       
                +2           PCA0CENT   DATA 09EH; PCA Center Alignment Enable              
                +2           PCA0CLR    DATA 09CH; PCA Comparator Clear Control             
                +2           PCA0CN0    DATA 0D8H; PCA Control                              
                +2           PCA0CPH0   DATA 0FCH; PCA Channel 0 Capture Module High Byte   
                +2           PCA0CPH1   DATA 0EAH; PCA Channel 1 Capture Module High Byte   
                +2           PCA0CPH2   DATA 0ECH; PCA Channel 2 Capture Module High Byte   
                +2           PCA0CPL0   DATA 0FBH; PCA Channel 0 Capture Module Low Byte    
                +2           PCA0CPL1   DATA 0E9H; PCA Channel 1 Capture Module Low Byte    
                +2           PCA0CPL2   DATA 0EBH; PCA Channel 2 Capture Module Low Byte    
                +2           PCA0CPM0   DATA 0DAH; PCA Channel 0 Capture/Compare Mode       
                +2           PCA0CPM1   DATA 0DBH; PCA Channel 1 Capture/Compare Mode       
                +2           PCA0CPM2   DATA 0DCH; PCA Channel 2 Capture/Compare Mode       
                +2           PCA0H      DATA 0FAH; PCA Counter/Timer High Byte              
                +2           PCA0L      DATA 0F9H; PCA Counter/Timer Low Byte               
                +2           PCA0MD     DATA 0D9H; PCA Mode                                 
                +2           PCA0POL    DATA 096H; PCA Output Polarity                      
                +2           PCA0PWM    DATA 0F7H; PCA PWM Configuration                    
                +2           PCON0      DATA 087H; Power Control 0                          
                +2           PCON1      DATA 0CDH; Power Control 1                          
                +2           PFE0CN     DATA 0C1H; Prefetch Engine Control                  
                +2           PRTDRV     DATA 0F6H; Port Drive Strength                      
                +2           PSCTL      DATA 08FH; Program Store Control                    
                +2           PSTAT0     DATA 0AAH; PMU Status 0                             
                +2           PSW        DATA 0D0H; Program Status Word                      
                +2           PWMCFG0    DATA 0C2H; PWM Configuration 0                      
                +2           PWMCFG1    DATA 0C9H; PWM Configuration 1                      
                +2           PWMCFG2    DATA 0D1H; PWM Configuration 2                      
                +2           PWMCFG3    DATA 0DFH; PWM Configuration 3                      
                +2           PWMCKDIV   DATA 0E3H; PWM Clock Divider                        
                +2           PWMCPH0    DATA 09AH; Ch0 Compare Value MSB                    
                +2           PWMCPH1    DATA 0B6H; Ch1 Compare Value MSB                    
                +2           PWMCPH2    DATA 0BEH; Ch2 Compare Value MSB                    
                +2           PWMCPL0    DATA 099H; Ch0 Compare Value LSB                    
                +2           PWMCPL1    DATA 0B5H; Ch1 Compare Value LSB                    
                +2           PWMCPL2    DATA 0BDH; Ch2 Compare Value LSB                    
                +2           PWMCPUDH0  DATA 0ACH; Ch0 Compare Value Update MSB             
                +2           PWMCPUDH1  DATA 0B3H; Ch1 Compare Value Update MSB             
                +2           PWMCPUDH2  DATA 0BAH; Ch2 Compare Value Update MSB             
                +2           PWMCPUDL0  DATA 0ABH; Ch0 Compare Value Update LSB             
                +2           PWMCPUDL1  DATA 0B2H; Ch1 Compare Value Update LSB             
                +2           PWMCPUDL2  DATA 0B9H; Ch2 Compare Value Update LSB             
                +2           PWMDTINLIM DATA 0E2H; DTI Negative Limit                       
                +2           PWMDTIPLIM DATA 0E1H; DTI Positive Limit                       
                +2           PWMH       DATA 0C4H; PWM Counter MSB                          
                +2           PWMIE      DATA 09FH; PWM Interrupt Enable                     
                +2           PWMIF      DATA 09DH; PWM Interrupt Flags                      
                +2           PWML       DATA 0C3H; PWM Counter LSB                          
                +2           PWMLIMH    DATA 0C6H; PWM Counter Limit MSB                    
                +2           PWMLIML    DATA 0C5H; PWM Counter Limit LSB                    
                +2           PWMSTATUS  DATA 09BH; PWM Status                               
                +2           REF0CN     DATA 0D1H; Voltage Reference Control                
                +2           REG0CN     DATA 0C9H; Regulator 0 Control                      
                +2           REVID      DATA 0B6H; Revision Identifcation                   
                +2           RSTSRC     DATA 0EFH; Reset Source                             
                +2           SBCON1     DATA 094H; UART1 Baud Rate Generator Control        
                +2           SBRLH1     DATA 096H; UART1 Baud Rate Generator High Byte      
                +2           SBRLL1     DATA 095H; UART1 Baud Rate Generator Low Byte       
                +2           SBUF0      DATA 099H; UART0 Serial Port Data Buffer            
                +2           SBUF1      DATA 092H; UART1 Serial Port Data Buffer            
                +2           SCON0      DATA 098H; UART0 Serial Port Control                
                +2           SCON1      DATA 0C8H; UART1 Serial Port Control                
                +2           SFRPAGE    DATA 0A7H; SFR Page                                 
                +2           SFRPGCN    DATA 0BCH; SFR Page Control                         
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   523

                +2           SFRSTACK   DATA 0D7H; SFR Page Stack                           
                +2           SMB0ADM    DATA 0D6H; SMBus 0 Slave Address Mask               
                +2           SMB0ADR    DATA 0D7H; SMBus 0 Slave Address                    
                +2           SMB0CF     DATA 0C1H; SMBus 0 Configuration                    
                +2           SMB0CN0    DATA 0C0H; SMBus 0 Control                          
                +2           SMB0DAT    DATA 0C2H; SMBus 0 Data                             
                +2           SMB0FCN0   DATA 0C3H; SMBus 0 FIFO Control 0                   
                +2           SMB0FCN1   DATA 0C4H; SMBus 0 FIFO Control 1                   
                +2           SMB0FCT    DATA 0EFH; SMBus 0 FIFO Count                       
                +2           SMB0RXLN   DATA 0C5H; SMBus 0 Receive Length Counter           
                +2           SMB0TC     DATA 0ACH; SMBus 0 Timing and Pin Control           
                +2           SMOD1      DATA 093H; UART1 Mode                               
                +2           SP         DATA 081H; Stack Pointer                            
                +2           SPI0CFG    DATA 0A1H; SPI0 Configuration                       
                +2           SPI0CKR    DATA 0A2H; SPI0 Clock Rate                          
                +2           SPI0CN0    DATA 0F8H; SPI0 Control                             
                +2           SPI0DAT    DATA 0A3H; SPI0 Data                                
                +2           SPI0FCN0   DATA 09AH; SPI0 FIFO Control 0                      
                +2           SPI0FCN1   DATA 09BH; SPI0 FIFO Control 1                      
                +2           SPI0FCT    DATA 0F7H; SPI0 FIFO Count                          
                +2           SPI0PCF    DATA 0DFH; SPI0 Pin Configuration                   
                +2           TCON       DATA 088H; Timer 0/1 Control                        
                +2           TH0        DATA 08CH; Timer 0 High Byte                        
                +2           TH1        DATA 08DH; Timer 1 High Byte                        
                +2           TL0        DATA 08AH; Timer 0 Low Byte                         
                +2           TL1        DATA 08BH; Timer 1 Low Byte                         
                +2           TMOD       DATA 089H; Timer 0/1 Mode                           
                +2           TMR2CN0    DATA 0C8H; Timer 2 Control 0                        
                +2           TMR2CN1    DATA 0FDH; Timer 2 Control 1                        
                +2           TMR2H      DATA 0CFH; Timer 2 High Byte                        
                +2           TMR2L      DATA 0CEH; Timer 2 Low Byte                         
                +2           TMR2RLH    DATA 0CBH; Timer 2 Reload High Byte                 
                +2           TMR2RLL    DATA 0CAH; Timer 2 Reload Low Byte                  
                +2           TMR3CN0    DATA 091H; Timer 3 Control 0                        
                +2           TMR3CN1    DATA 0FEH; Timer 3 Control 1                        
                +2           TMR3H      DATA 095H; Timer 3 High Byte                        
                +2           TMR3L      DATA 094H; Timer 3 Low Byte                         
                +2           TMR3RLH    DATA 093H; Timer 3 Reload High Byte                 
                +2           TMR3RLL    DATA 092H; Timer 3 Reload Low Byte                  
                +2           TMR4CN0    DATA 098H; Timer 4 Control 0                        
                +2           TMR4CN1    DATA 0FFH; Timer 4 Control 1                        
                +2           TMR4H      DATA 0A5H; Timer 4 High Byte                        
                +2           TMR4L      DATA 0A4H; Timer 4 Low Byte                         
                +2           TMR4RLH    DATA 0A3H; Timer 4 Reload High Byte                 
                +2           TMR4RLL    DATA 0A2H; Timer 4 Reload Low Byte                  
                +2           TMR5CN0    DATA 0C0H; Timer 5 Control 0                        
                +2           TMR5CN1    DATA 0F1H; Timer 5 Control 1                        
                +2           TMR5H      DATA 0D5H; Timer 5 High Byte                        
                +2           TMR5L      DATA 0D4H; Timer 5 Low Byte                         
                +2           TMR5RLH    DATA 0D3H; Timer 5 Reload High Byte                 
                +2           TMR5RLL    DATA 0D2H; Timer 5 Reload Low Byte                  
                +2           UART0PCF   DATA 0D9H; UART0 Pin Configuration                  
                +2           UART1FCN0  DATA 09DH; UART1 FIFO Control 0                     
                +2           UART1FCN1  DATA 0D8H; UART1 FIFO Control 1                     
                +2           UART1FCT   DATA 0FAH; UART1 FIFO Count                         
                +2           UART1LIN   DATA 09EH; UART1 LIN Configuration                  
                +2           UART1PCF   DATA 0DAH; UART1 Pin Configuration                  
                +2           WDTCN      DATA 097H; Watchdog Timer Control                   
                +2           XBR0       DATA 0E1H; Port I/O Crossbar 0                      
                +2           XBR1       DATA 0E2H; Port I/O Crossbar 1                      
                +2           XBR2       DATA 0E3H; Port I/O Crossbar 2                      
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0ASA  DATA 0B5H ; ADC0 Autoscan Start Address Low Byte 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   524

                +2           ADC0GT   DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0     DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT   DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP       DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0  DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1  DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2  DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0     DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           PWMCP0   DATA 099H ; Ch0 Compare Value LSB                
                +2           PWMCP1   DATA 0B5H ; Ch1 Compare Value LSB                
                +2           PWMCP2   DATA 0BDH ; Ch2 Compare Value LSB                
                +2           PWMCPUD0 DATA 0ABH ; Ch0 Compare Value Update LSB         
                +2           PWMCPUD1 DATA 0B2H ; Ch1 Compare Value Update LSB         
                +2           PWMCPUD2 DATA 0B9H ; Ch2 Compare Value Update LSB         
                +2           PWM      DATA 0C3H ; PWM Counter LSB                      
                +2           PWMLIM   DATA 0C5H ; PWM Counter Limit LSB                
                +2           TMR2     DATA 0CEH ; Timer 2 Low Byte                     
                +2           TMR2RL   DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3     DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL   DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4     DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL   DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           TMR5     DATA 0D4H ; Timer 5 Low Byte                     
                +2           TMR5RL   DATA 0D2H ; Timer 5 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_TEMPE  BIT ADC0CN0.0 ; Temperature Sensor Enable         
                +2           ADC0CN0_ADGN0  BIT ADC0CN0.1 ; Gain Control Bit 0                
                +2           ADC0CN0_ADGN1  BIT ADC0CN0.2 ; Gain Control Bit 1                
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag     
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                          
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag
                +2           ADC0CN0_IPOEN  BIT ADC0CN0.6 ; Idle Powered-off Enable           
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                        
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; CLIF0 0xE8 (Configurable Logic Interrupt Flag 0)
                +2           CLIF0_C0FIF BIT CLIF0.0 ; CLU0 Falling Edge Flag
                +2           CLIF0_C0RIF BIT CLIF0.1 ; CLU0 Rising Edge Flag 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   525

                +2           CLIF0_C1FIF BIT CLIF0.2 ; CLU1 Falling Edge Flag
                +2           CLIF0_C1RIF BIT CLIF0.3 ; CLU1 Rising Edge Flag 
                +2           CLIF0_C2FIF BIT CLIF0.4 ; CLU2 Falling Edge Flag
                +2           CLIF0_C2RIF BIT CLIF0.5 ; CLU2 Rising Edge Flag 
                +2           CLIF0_C3FIF BIT CLIF0.6 ; CLU3 Falling Edge Flag
                +2           CLIF0_C3RIF BIT CLIF0.7 ; CLU3 Rising Edge Flag 
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   526

                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   527

                +2           
                +2           ; TMR5CN0 0xC0 (Timer 5 Control 0)
                +2           TMR5CN0_T5XCLK0 BIT TMR5CN0.0 ; Timer 5 External Clock Select Bit 0
                +2           TMR5CN0_T5XCLK1 BIT TMR5CN0.1 ; Timer 5 External Clock Select Bit 1
                +2           TMR5CN0_TR5     BIT TMR5CN0.2 ; Timer 5 Run Control                
                +2           TMR5CN0_T5SPLIT BIT TMR5CN0.3 ; Timer 5 Split Mode Enable          
                +2           TMR5CN0_TF5CEN  BIT TMR5CN0.4 ; Timer 5 Capture Enable             
                +2           TMR5CN0_TF5LEN  BIT TMR5CN0.5 ; Timer 5 Low Byte Interrupt Enable  
                +2           TMR5CN0_TF5L    BIT TMR5CN0.6 ; Timer 5 Low Byte Overflow Flag     
                +2           TMR5CN0_TF5H    BIT TMR5CN0.7 ; Timer 5 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 15 ; UART1                     
                +2           TIMER4_IRQn  EQU 17 ; Timer 4 Overflow / Capture
                +2           TIMER5_IRQn  EQU 18 ; Timer 5 Overflow / Capture
                +2           CL0_IRQn     EQU 19 ; Configurable Logic        
                +2           PWM_IRQn     EQU 20 ; Pulse Width Modulation    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           LEGACY_PAGE  EQU 000H ; Legacy SFR Page
                +2           PG2_PAGE     EQU 010H ; Page2          
                +2           PG3_PAGE     EQU 020H ; Page3          
                +2           PG4_PAGE     EQU 030H ; Page4          
                +1           
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 2       ; BB5 requires MCU_48MHZ == 2
                +1           CSEG AT 3040h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#C_X_00#        "      ; ESC layout tag
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   528

                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#C_X_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#C_X_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#C_X_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#C_X_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#C_X_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#C_X_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#C_X_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#C_X_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#C_X_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#C_X_90#        "
                +1           ENDIF
                +1           
                +1           CSEG AT 3050h
                +1           Eep_ESC_MCU:            DB      "#BLHELI$EFM8B51#"      ; Project and MCU tag (16 Bytes)
                +1           
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU 92  ; Temperature measurement ADC value for which main 
                             motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                        EQU P0          ; Receive/Transmit port
                +1           RTX_MDOUT                       EQU     P0MDOUT ; Set to 1 for PUSHPULL
                +1           RTX_MDIN                        EQU     P0MDIN  ; Set to 1 for DIGITAL
                +1           RTX_SKIP                        EQU     P0SKIP  ; Set to 1 for SKIP
                +1           RTX_PIN                         EQU 5           ; RTX pin
                +1           
                +1           SIGNATURE_001           EQU     0E8h    ; Device signature
                +1           SIGNATURE_002           EQU     0B5h
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           Comp_Com        EQU     4       ;i
                +1           Mux_A           EQU     3       ;i
                +1           Mux_C           EQU     2       ;i
                +1           Mux_B           EQU     1       ;i
                +1           ;                       EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   529

                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1                   mov     Timer0_X, #0
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   530

                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0POL, #02h                           ; Pwm inverted
                +1           ELSE
                +1                   mov     PCA0POL, #03h                           ; Damping inverted, pwm inverted
                +1           ENDIF
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   531

                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CpwmFET         EQU     5       ;o
                +1           CcomFET         EQU     4       ;o
                +1           BpwmFET         EQU     3       ;o
                +1           BcomFET         EQU     2       ;o
                +1           ApwmFET         EQU     1       ;o
                +1           AcomFET         EQU     0       ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT         EQU (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   clr     P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   setb    P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   532

                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   clr     P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   setb    P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   clr     P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   setb    P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   setb    P1.ApwmFET
                +1                   setb    P1.BpwmFET
                +1                   setb    P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   533

                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Dh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #37h
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #1Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #12h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #11h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1                   cpl     A
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   534

                +1                   jmp     t0_int
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     CLKGRP0, #18h   ; Enable SAR clock, at 12MHz
                +1                   mov     ADC0CF1, #0Ah   ; 800ns tracking time
                +1                   mov     ADC0CF2, #2Fh   ; 1.65V reference
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #85h   ; ADC enabled, gain 0.5, temp sensor enabled
                +1                   mov     ADC0CN1, #20h   ; 10bit mode
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #95h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #10h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   535

                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   34757     
                   34758     IF ESCNO == D_X_
                             ;$include (D_X.inc) ; Select pinout D_X
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "D_X"
                +1           ; X  X  RC CC MA MC MB X     X  X  Cc Cp Bc Bp Ac Ap
                +1           ; PWM fets active high, on high side
                +1           ; COM fets active high
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB5
                +1           ;*********************
                +1           ;$include (SI_EFM8BB51_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB51F16G_QFN20
                +2           ;  EFM8BB51F16G_TSSOP20
                +2           ;  EFM8BB51F16I_QFN20
                +2           ;  EFM8BB51F16I_TSSOP20
                +2           ;  EFM8BB51F8G_QFN20
                +2           ;  EFM8BB51F8G_TSSOP20
                +2           ;  EFM8BB51F8I_QFN20
                +2           ;  EFM8BB51F8I_TSSOP20
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   536

                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC        DATA 0E0H; Accumulator                              
                +2           ADC0ASAH   DATA 0B6H; ADC0 Autoscan Start Address High Byte    
                +2           ADC0ASAL   DATA 0B5H; ADC0 Autoscan Start Address Low Byte     
                +2           ADC0ASCF   DATA 0A1H; ADC0 Autoscan Configuration              
                +2           ADC0ASCT   DATA 0C7H; ADC0 Autoscan Output Count               
                +2           ADC0CF1    DATA 0B9H; ADC0 Configuration                       
                +2           ADC0CF2    DATA 0DFH; ADC0 Power Control                       
                +2           ADC0CN0    DATA 0E8H; ADC0 Control 0                           
                +2           ADC0CN1    DATA 0B2H; ADC0 Control 1                           
                +2           ADC0CN2    DATA 0B3H; ADC0 Control 2                           
                +2           ADC0GTH    DATA 0C4H; ADC0 Greater-Than High Byte              
                +2           ADC0GTL    DATA 0C3H; ADC0 Greater-Than Low Byte               
                +2           ADC0H      DATA 0BEH; ADC0 Data Word High Byte                 
                +2           ADC0L      DATA 0BDH; ADC0 Data Word Low Byte                  
                +2           ADC0LTH    DATA 0C6H; ADC0 Less-Than High Byte                 
                +2           ADC0LTL    DATA 0C5H; ADC0 Less-Than Low Byte                  
                +2           ADC0MX     DATA 0BBH; ADC0 Multiplexer Selection               
                +2           B          DATA 0F0H; B Register                               
                +2           CKCON0     DATA 08EH; Clock Control 0                          
                +2           CKCON1     DATA 0A6H; Clock Control 1                          
                +2           CLEN0      DATA 0C6H; Configurable Logic Enable 0              
                +2           CLIE0      DATA 0C7H; Configurable Logic Interrupt Enable 0    
                +2           CLIF0      DATA 0E8H; Configurable Logic Interrupt Flag 0      
                +2           CLKGRP0    DATA 0AFH; Clock Group Control                      
                +2           CLKSEL     DATA 0A9H; Clock Select                             
                +2           CLOUT0     DATA 0D1H; Configurable Logic Output 0              
                +2           CLU0CF     DATA 0B1H; Configurable Logic Unit 0 Configuration  
                +2           CLU0FN     DATA 0AFH; Configurable Logic Unit 0 Function Select
                +2           CLU0MX     DATA 084H; Configurable Logic Unit 0 Multiplexer    
                +2           CLU1CF     DATA 0B3H; Configurable Logic Unit 1 Configuration  
                +2           CLU1FN     DATA 0B2H; Configurable Logic Unit 1 Function Select
                +2           CLU1MX     DATA 085H; Configurable Logic Unit 1 Multiplexer    
                +2           CLU2CF     DATA 0B6H; Configurable Logic Unit 2 Configuration  
                +2           CLU2FN     DATA 0B5H; Configurable Logic Unit 2 Function Select
                +2           CLU2MX     DATA 091H; Configurable Logic Unit 2 Multiplexer    
                +2           CLU3CF     DATA 0BFH; Configurable Logic Unit 3 Configuration  
                +2           CLU3FN     DATA 0BEH; Configurable Logic Unit 3 Function Select
                +2           CLU3MX     DATA 0AEH; Configurable Logic Unit 3 Multiplexer    
                +2           CMP0CN0    DATA 09BH; Comparator 0 Control 0                   
                +2           CMP0CN1    DATA 099H; Comparator 0 Control 1                   
                +2           CMP0MD     DATA 09DH; Comparator 0 Mode                        
                +2           CMP0MX     DATA 09FH; Comparator 0 Multiplexer Selection       
                +2           CMP1CN0    DATA 0BFH; Comparator 1 Control 0                   
                +2           CMP1CN1    DATA 0ACH; Comparator 1 Control 1                   
                +2           CMP1MD     DATA 0ABH; Comparator 1 Mode                        
                +2           CMP1MX     DATA 0AAH; Comparator 1 Multiplexer Selection       
                +2           CP0CN      DATA 0A4H; Charge Pump Configuration                
                +2           CRC0CN0    DATA 0CEH; CRC0 Control 0                           
                +2           CRC0CN1    DATA 086H; CRC0 Control 1                           
                +2           CRC0CNT    DATA 0D3H; CRC0 Automatic Flash Sector Count        
                +2           CRC0DAT    DATA 0CBH; CRC0 Data Output                         
                +2           CRC0FLIP   DATA 0CFH; CRC0 Bit Flip                            
                +2           CRC0IN     DATA 0CAH; CRC0 Data Input                          
                +2           CRC0ST     DATA 0D2H; CRC0 Automatic Flash Sector Start        
                +2           DERIVID    DATA 0ADH; Derivative Identification                
                +2           DEVICEID   DATA 0B5H; Device Identification                    
                +2           DPH        DATA 083H; Data Pointer High                        
                +2           DPL        DATA 082H; Data Pointer Low                         
                +2           EIE1       DATA 0E6H; Extended Interrupt Enable 1              
                +2           EIE2       DATA 0F3H; Extended Interrupt Enable 2              
                +2           EIP1       DATA 0BBH; Extended Interrupt Priority 1 Low        
                +2           EIP1H      DATA 0EEH; Extended Interrupt Priority 1 High       
                +2           EIP2       DATA 0EDH; Extended Interrupt Priority 2            
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   537

                +2           EIP2H      DATA 0F6H; Extended Interrupt Priority 2 High       
                +2           EMI0CN     DATA 0E7H; External Memory Interface Control        
                +2           FLKEY      DATA 0B7H; Flash Lock and Key                       
                +2           HFO0CAL    DATA 0D6H; High Frequency Oscillator 0 Calibration  
                +2           HFO0CN     DATA 0EFH; High Frequency Oscillator Control        
                +2           HFO0TRIM0  DATA 0CCH; High Frequency Oscillator Trim           
                +2           IE         DATA 0A8H; Interrupt Enable                         
                +2           IP         DATA 0B8H; Interrupt Priority                       
                +2           IPH        DATA 0F2H; Interrupt Priority High                  
                +2           IT01CF     DATA 0E4H; INT0/INT1 Configuration                  
                +2           LFO0CN     DATA 0B1H; Low Frequency Oscillator Control         
                +2           P0         DATA 080H; Port 0 Pin Latch                         
                +2           P0MASK     DATA 0FEH; Port 0 Mask                              
                +2           P0MAT      DATA 0FDH; Port 0 Match                             
                +2           P0MDIN     DATA 0F1H; Port 0 Input Mode                        
                +2           P0MDOUT    DATA 0A4H; Port 0 Output Mode                       
                +2           P0SKIP     DATA 0D4H; Port 0 Skip                              
                +2           P1         DATA 090H; Port 1 Pin Latch                         
                +2           P1MASK     DATA 0EEH; Port 1 Mask                              
                +2           P1MAT      DATA 0EDH; Port 1 Match                             
                +2           P1MDIN     DATA 0F2H; Port 1 Input Mode                        
                +2           P1MDOUT    DATA 0A5H; Port 1 Output Mode                       
                +2           P1SKIP     DATA 0D5H; Port 1 Skip                              
                +2           P2         DATA 0A0H; Port 2 Pin Latch                         
                +2           P2MDIN     DATA 0F3H; Port 2 Input Mode                        
                +2           P2MDOUT    DATA 0A6H; Port 2 Output Mode                       
                +2           PCA0CENT   DATA 09EH; PCA Center Alignment Enable              
                +2           PCA0CLR    DATA 09CH; PCA Comparator Clear Control             
                +2           PCA0CN0    DATA 0D8H; PCA Control                              
                +2           PCA0CPH0   DATA 0FCH; PCA Channel 0 Capture Module High Byte   
                +2           PCA0CPH1   DATA 0EAH; PCA Channel 1 Capture Module High Byte   
                +2           PCA0CPH2   DATA 0ECH; PCA Channel 2 Capture Module High Byte   
                +2           PCA0CPL0   DATA 0FBH; PCA Channel 0 Capture Module Low Byte    
                +2           PCA0CPL1   DATA 0E9H; PCA Channel 1 Capture Module Low Byte    
                +2           PCA0CPL2   DATA 0EBH; PCA Channel 2 Capture Module Low Byte    
                +2           PCA0CPM0   DATA 0DAH; PCA Channel 0 Capture/Compare Mode       
                +2           PCA0CPM1   DATA 0DBH; PCA Channel 1 Capture/Compare Mode       
                +2           PCA0CPM2   DATA 0DCH; PCA Channel 2 Capture/Compare Mode       
                +2           PCA0H      DATA 0FAH; PCA Counter/Timer High Byte              
                +2           PCA0L      DATA 0F9H; PCA Counter/Timer Low Byte               
                +2           PCA0MD     DATA 0D9H; PCA Mode                                 
                +2           PCA0POL    DATA 096H; PCA Output Polarity                      
                +2           PCA0PWM    DATA 0F7H; PCA PWM Configuration                    
                +2           PCON0      DATA 087H; Power Control 0                          
                +2           PCON1      DATA 0CDH; Power Control 1                          
                +2           PFE0CN     DATA 0C1H; Prefetch Engine Control                  
                +2           PRTDRV     DATA 0F6H; Port Drive Strength                      
                +2           PSCTL      DATA 08FH; Program Store Control                    
                +2           PSTAT0     DATA 0AAH; PMU Status 0                             
                +2           PSW        DATA 0D0H; Program Status Word                      
                +2           PWMCFG0    DATA 0C2H; PWM Configuration 0                      
                +2           PWMCFG1    DATA 0C9H; PWM Configuration 1                      
                +2           PWMCFG2    DATA 0D1H; PWM Configuration 2                      
                +2           PWMCFG3    DATA 0DFH; PWM Configuration 3                      
                +2           PWMCKDIV   DATA 0E3H; PWM Clock Divider                        
                +2           PWMCPH0    DATA 09AH; Ch0 Compare Value MSB                    
                +2           PWMCPH1    DATA 0B6H; Ch1 Compare Value MSB                    
                +2           PWMCPH2    DATA 0BEH; Ch2 Compare Value MSB                    
                +2           PWMCPL0    DATA 099H; Ch0 Compare Value LSB                    
                +2           PWMCPL1    DATA 0B5H; Ch1 Compare Value LSB                    
                +2           PWMCPL2    DATA 0BDH; Ch2 Compare Value LSB                    
                +2           PWMCPUDH0  DATA 0ACH; Ch0 Compare Value Update MSB             
                +2           PWMCPUDH1  DATA 0B3H; Ch1 Compare Value Update MSB             
                +2           PWMCPUDH2  DATA 0BAH; Ch2 Compare Value Update MSB             
                +2           PWMCPUDL0  DATA 0ABH; Ch0 Compare Value Update LSB             
                +2           PWMCPUDL1  DATA 0B2H; Ch1 Compare Value Update LSB             
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   538

                +2           PWMCPUDL2  DATA 0B9H; Ch2 Compare Value Update LSB             
                +2           PWMDTINLIM DATA 0E2H; DTI Negative Limit                       
                +2           PWMDTIPLIM DATA 0E1H; DTI Positive Limit                       
                +2           PWMH       DATA 0C4H; PWM Counter MSB                          
                +2           PWMIE      DATA 09FH; PWM Interrupt Enable                     
                +2           PWMIF      DATA 09DH; PWM Interrupt Flags                      
                +2           PWML       DATA 0C3H; PWM Counter LSB                          
                +2           PWMLIMH    DATA 0C6H; PWM Counter Limit MSB                    
                +2           PWMLIML    DATA 0C5H; PWM Counter Limit LSB                    
                +2           PWMSTATUS  DATA 09BH; PWM Status                               
                +2           REF0CN     DATA 0D1H; Voltage Reference Control                
                +2           REG0CN     DATA 0C9H; Regulator 0 Control                      
                +2           REVID      DATA 0B6H; Revision Identifcation                   
                +2           RSTSRC     DATA 0EFH; Reset Source                             
                +2           SBCON1     DATA 094H; UART1 Baud Rate Generator Control        
                +2           SBRLH1     DATA 096H; UART1 Baud Rate Generator High Byte      
                +2           SBRLL1     DATA 095H; UART1 Baud Rate Generator Low Byte       
                +2           SBUF0      DATA 099H; UART0 Serial Port Data Buffer            
                +2           SBUF1      DATA 092H; UART1 Serial Port Data Buffer            
                +2           SCON0      DATA 098H; UART0 Serial Port Control                
                +2           SCON1      DATA 0C8H; UART1 Serial Port Control                
                +2           SFRPAGE    DATA 0A7H; SFR Page                                 
                +2           SFRPGCN    DATA 0BCH; SFR Page Control                         
                +2           SFRSTACK   DATA 0D7H; SFR Page Stack                           
                +2           SMB0ADM    DATA 0D6H; SMBus 0 Slave Address Mask               
                +2           SMB0ADR    DATA 0D7H; SMBus 0 Slave Address                    
                +2           SMB0CF     DATA 0C1H; SMBus 0 Configuration                    
                +2           SMB0CN0    DATA 0C0H; SMBus 0 Control                          
                +2           SMB0DAT    DATA 0C2H; SMBus 0 Data                             
                +2           SMB0FCN0   DATA 0C3H; SMBus 0 FIFO Control 0                   
                +2           SMB0FCN1   DATA 0C4H; SMBus 0 FIFO Control 1                   
                +2           SMB0FCT    DATA 0EFH; SMBus 0 FIFO Count                       
                +2           SMB0RXLN   DATA 0C5H; SMBus 0 Receive Length Counter           
                +2           SMB0TC     DATA 0ACH; SMBus 0 Timing and Pin Control           
                +2           SMOD1      DATA 093H; UART1 Mode                               
                +2           SP         DATA 081H; Stack Pointer                            
                +2           SPI0CFG    DATA 0A1H; SPI0 Configuration                       
                +2           SPI0CKR    DATA 0A2H; SPI0 Clock Rate                          
                +2           SPI0CN0    DATA 0F8H; SPI0 Control                             
                +2           SPI0DAT    DATA 0A3H; SPI0 Data                                
                +2           SPI0FCN0   DATA 09AH; SPI0 FIFO Control 0                      
                +2           SPI0FCN1   DATA 09BH; SPI0 FIFO Control 1                      
                +2           SPI0FCT    DATA 0F7H; SPI0 FIFO Count                          
                +2           SPI0PCF    DATA 0DFH; SPI0 Pin Configuration                   
                +2           TCON       DATA 088H; Timer 0/1 Control                        
                +2           TH0        DATA 08CH; Timer 0 High Byte                        
                +2           TH1        DATA 08DH; Timer 1 High Byte                        
                +2           TL0        DATA 08AH; Timer 0 Low Byte                         
                +2           TL1        DATA 08BH; Timer 1 Low Byte                         
                +2           TMOD       DATA 089H; Timer 0/1 Mode                           
                +2           TMR2CN0    DATA 0C8H; Timer 2 Control 0                        
                +2           TMR2CN1    DATA 0FDH; Timer 2 Control 1                        
                +2           TMR2H      DATA 0CFH; Timer 2 High Byte                        
                +2           TMR2L      DATA 0CEH; Timer 2 Low Byte                         
                +2           TMR2RLH    DATA 0CBH; Timer 2 Reload High Byte                 
                +2           TMR2RLL    DATA 0CAH; Timer 2 Reload Low Byte                  
                +2           TMR3CN0    DATA 091H; Timer 3 Control 0                        
                +2           TMR3CN1    DATA 0FEH; Timer 3 Control 1                        
                +2           TMR3H      DATA 095H; Timer 3 High Byte                        
                +2           TMR3L      DATA 094H; Timer 3 Low Byte                         
                +2           TMR3RLH    DATA 093H; Timer 3 Reload High Byte                 
                +2           TMR3RLL    DATA 092H; Timer 3 Reload Low Byte                  
                +2           TMR4CN0    DATA 098H; Timer 4 Control 0                        
                +2           TMR4CN1    DATA 0FFH; Timer 4 Control 1                        
                +2           TMR4H      DATA 0A5H; Timer 4 High Byte                        
                +2           TMR4L      DATA 0A4H; Timer 4 Low Byte                         
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   539

                +2           TMR4RLH    DATA 0A3H; Timer 4 Reload High Byte                 
                +2           TMR4RLL    DATA 0A2H; Timer 4 Reload Low Byte                  
                +2           TMR5CN0    DATA 0C0H; Timer 5 Control 0                        
                +2           TMR5CN1    DATA 0F1H; Timer 5 Control 1                        
                +2           TMR5H      DATA 0D5H; Timer 5 High Byte                        
                +2           TMR5L      DATA 0D4H; Timer 5 Low Byte                         
                +2           TMR5RLH    DATA 0D3H; Timer 5 Reload High Byte                 
                +2           TMR5RLL    DATA 0D2H; Timer 5 Reload Low Byte                  
                +2           UART0PCF   DATA 0D9H; UART0 Pin Configuration                  
                +2           UART1FCN0  DATA 09DH; UART1 FIFO Control 0                     
                +2           UART1FCN1  DATA 0D8H; UART1 FIFO Control 1                     
                +2           UART1FCT   DATA 0FAH; UART1 FIFO Count                         
                +2           UART1LIN   DATA 09EH; UART1 LIN Configuration                  
                +2           UART1PCF   DATA 0DAH; UART1 Pin Configuration                  
                +2           WDTCN      DATA 097H; Watchdog Timer Control                   
                +2           XBR0       DATA 0E1H; Port I/O Crossbar 0                      
                +2           XBR1       DATA 0E2H; Port I/O Crossbar 1                      
                +2           XBR2       DATA 0E3H; Port I/O Crossbar 2                      
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0ASA  DATA 0B5H ; ADC0 Autoscan Start Address Low Byte 
                +2           ADC0GT   DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0     DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT   DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP       DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0  DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1  DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2  DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0     DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           PWMCP0   DATA 099H ; Ch0 Compare Value LSB                
                +2           PWMCP1   DATA 0B5H ; Ch1 Compare Value LSB                
                +2           PWMCP2   DATA 0BDH ; Ch2 Compare Value LSB                
                +2           PWMCPUD0 DATA 0ABH ; Ch0 Compare Value Update LSB         
                +2           PWMCPUD1 DATA 0B2H ; Ch1 Compare Value Update LSB         
                +2           PWMCPUD2 DATA 0B9H ; Ch2 Compare Value Update LSB         
                +2           PWM      DATA 0C3H ; PWM Counter LSB                      
                +2           PWMLIM   DATA 0C5H ; PWM Counter Limit LSB                
                +2           TMR2     DATA 0CEH ; Timer 2 Low Byte                     
                +2           TMR2RL   DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3     DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL   DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4     DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL   DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           TMR5     DATA 0D4H ; Timer 5 Low Byte                     
                +2           TMR5RL   DATA 0D2H ; Timer 5 Reload Low Byte              
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   540

                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_TEMPE  BIT ADC0CN0.0 ; Temperature Sensor Enable         
                +2           ADC0CN0_ADGN0  BIT ADC0CN0.1 ; Gain Control Bit 0                
                +2           ADC0CN0_ADGN1  BIT ADC0CN0.2 ; Gain Control Bit 1                
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag     
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                          
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag
                +2           ADC0CN0_IPOEN  BIT ADC0CN0.6 ; Idle Powered-off Enable           
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                        
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; CLIF0 0xE8 (Configurable Logic Interrupt Flag 0)
                +2           CLIF0_C0FIF BIT CLIF0.0 ; CLU0 Falling Edge Flag
                +2           CLIF0_C0RIF BIT CLIF0.1 ; CLU0 Rising Edge Flag 
                +2           CLIF0_C1FIF BIT CLIF0.2 ; CLU1 Falling Edge Flag
                +2           CLIF0_C1RIF BIT CLIF0.3 ; CLU1 Rising Edge Flag 
                +2           CLIF0_C2FIF BIT CLIF0.4 ; CLU2 Falling Edge Flag
                +2           CLIF0_C2RIF BIT CLIF0.5 ; CLU2 Rising Edge Flag 
                +2           CLIF0_C3FIF BIT CLIF0.6 ; CLU3 Falling Edge Flag
                +2           CLIF0_C3RIF BIT CLIF0.7 ; CLU3 Rising Edge Flag 
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   541

                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   542

                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; TMR5CN0 0xC0 (Timer 5 Control 0)
                +2           TMR5CN0_T5XCLK0 BIT TMR5CN0.0 ; Timer 5 External Clock Select Bit 0
                +2           TMR5CN0_T5XCLK1 BIT TMR5CN0.1 ; Timer 5 External Clock Select Bit 1
                +2           TMR5CN0_TR5     BIT TMR5CN0.2 ; Timer 5 Run Control                
                +2           TMR5CN0_T5SPLIT BIT TMR5CN0.3 ; Timer 5 Split Mode Enable          
                +2           TMR5CN0_TF5CEN  BIT TMR5CN0.4 ; Timer 5 Capture Enable             
                +2           TMR5CN0_TF5LEN  BIT TMR5CN0.5 ; Timer 5 Low Byte Interrupt Enable  
                +2           TMR5CN0_TF5L    BIT TMR5CN0.6 ; Timer 5 Low Byte Overflow Flag     
                +2           TMR5CN0_TF5H    BIT TMR5CN0.7 ; Timer 5 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 15 ; UART1                     
                +2           TIMER4_IRQn  EQU 17 ; Timer 4 Overflow / Capture
                +2           TIMER5_IRQn  EQU 18 ; Timer 5 Overflow / Capture
                +2           CL0_IRQn     EQU 19 ; Configurable Logic        
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   543

                +2           PWM_IRQn     EQU 20 ; Pulse Width Modulation    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           LEGACY_PAGE  EQU 000H ; Legacy SFR Page
                +2           PG2_PAGE     EQU 010H ; Page2          
                +2           PG3_PAGE     EQU 020H ; Page3          
                +2           PG4_PAGE     EQU 030H ; Page4          
                +1           
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 2       ; BB5 requires MCU_48MHZ == 2
                +1           CSEG AT 3040h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#D_X_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#D_X_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#D_X_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#D_X_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#D_X_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#D_X_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#D_X_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#D_X_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#D_X_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#D_X_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#D_X_90#        "
                +1           ENDIF
                +1           
                +1           CSEG AT 3050h
                +1           Eep_ESC_MCU:            DB      "#BLHELI$EFM8B51#"      ; Project and MCU tag (16 Bytes)
                +1           
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU 92  ; Temperature measurement ADC value for which main 
                             motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                        EQU P0          ; Receive/Transmit port
                +1           RTX_MDOUT                       EQU     P0MDOUT ; Set to 1 for PUSHPULL
                +1           RTX_MDIN                        EQU     P0MDIN  ; Set to 1 for DIGITAL
                +1           RTX_SKIP                        EQU     P0SKIP  ; Set to 1 for SKIP
                +1           RTX_PIN                         EQU 5           ; RTX pin
                +1           
                +1           SIGNATURE_001           EQU     0E8h    ; Device signature
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   544

                +1           SIGNATURE_002           EQU     0B5h
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           Comp_Com        EQU     4       ;i
                +1           Mux_A           EQU     3       ;i
                +1           Mux_C           EQU     2       ;i
                +1           Mux_B           EQU     1       ;i
                +1           ;                       EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1                   mov     Timer0_X, #0
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   545

                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1             mov PCA0POL, #02h       ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   546

                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           CcomFET   EQU 5 ;o
                +1           CpwmFET   EQU 4 ;o
                +1           BcomFET   EQU 3 ;o
                +1           BpwmFET   EQU 2 ;o
                +1           AcomFET   EQU 1 ;o
                +1           ApwmFET   EQU 0 ;o
                +1           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   547

                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT   EQU   00h
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   548

                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1                   mov     P1SKIP, #3Eh
                +1           ELSE
                +1                   mov     P1SKIP, #3Ch
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1                   mov     P1SKIP, #3Bh
                +1           ELSE
                +1                   mov     P1SKIP, #33h
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1                   mov     P1SKIP, #2Fh
                +1           ELSE
                +1                   mov     P1SKIP, #0Fh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #12h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #11h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1                   cpl     A
                +1           ENDM
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   549

                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     CLKGRP0, #18h   ; Enable SAR clock, at 12MHz
                +1                   mov     ADC0CF1, #0Ah   ; 800ns tracking time
                +1                   mov     ADC0CF2, #2Fh   ; 1.65V reference
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #85h   ; ADC enabled, gain 0.5, temp sensor enabled
                +1                   mov     ADC0CN1, #20h   ; 10bit mode
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #95h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   550

                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #10h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   35754     
                   35755     IF ESCNO == E_X_
                             ;$include (E_X.inc) ; Select pinout E_X
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1           ;
                +1           ; Copyright 2011, 2012 Steffen Skaug
                +1           ; This program is distributed under the terms of the GNU General Public License
                +1           ;
                +1           ; This file is part of BLHeli.
                +1           ;
                +1           ; BLHeli is free software: you can redistribute it and/or modify
                +1           ; it under the terms of the GNU General Public License as published by
                +1           ; the Free Software Foundation, either version 3 of the License, or
                +1           ; (at your option) any later version.
                +1           ;
                +1           ; BLHeli is distributed in the hope that it will be useful,
                +1           ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1           ; GNU General Public License for more details.
                +1           ;
                +1           ; You should have received a copy of the GNU General Public License
                +1           ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1           ;
                +1           ;**** **** **** **** ****
                +1           ;
                +1           ; Hardware definition file "E_X"
                +1           ; X  X  RC CC MA MB MC X     X  X  Ac Bc Cc Ap Bp Cp
                +1           ; PWM fets active high, on high side
                +1           ; COM fets active high
                +1           ;
                +1           ;**** **** **** **** ****
                +1           
                +1           
                +1           
                +1           ;*********************
                +1           ; Device SiLabs EFM8BB5
                +1           ;*********************
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   551

                +1           ;$include (SI_EFM8BB51_Defs.inc)
                +2           ;------------------------------------------------------------------------------
                +2           ; Copyright 2014 Silicon Laboratories, Inc.
                +2           ; All rights reserved. This program and the accompanying materials
                +2           ; are made available under the terms of the Silicon Laboratories End User
                +2           ; License Agreement which accompanies this distribution, and is available at
                +2           ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.txt
                +2           ; Original content and implementation provided by Silicon Laboratories.
                +2           ;------------------------------------------------------------------------------
                +2           ;Supported Devices:
                +2           ;  EFM8BB51F16G_QFN20
                +2           ;  EFM8BB51F16G_TSSOP20
                +2           ;  EFM8BB51F16I_QFN20
                +2           ;  EFM8BB51F16I_TSSOP20
                +2           ;  EFM8BB51F8G_QFN20
                +2           ;  EFM8BB51F8G_TSSOP20
                +2           ;  EFM8BB51F8I_QFN20
                +2           ;  EFM8BB51F8I_TSSOP20
                +2           
                +2           ;-----------------------------------------------------------------------------
                +2           ; Register Definitions
                +2           ;-----------------------------------------------------------------------------
                +2           ACC        DATA 0E0H; Accumulator                              
                +2           ADC0ASAH   DATA 0B6H; ADC0 Autoscan Start Address High Byte    
                +2           ADC0ASAL   DATA 0B5H; ADC0 Autoscan Start Address Low Byte     
                +2           ADC0ASCF   DATA 0A1H; ADC0 Autoscan Configuration              
                +2           ADC0ASCT   DATA 0C7H; ADC0 Autoscan Output Count               
                +2           ADC0CF1    DATA 0B9H; ADC0 Configuration                       
                +2           ADC0CF2    DATA 0DFH; ADC0 Power Control                       
                +2           ADC0CN0    DATA 0E8H; ADC0 Control 0                           
                +2           ADC0CN1    DATA 0B2H; ADC0 Control 1                           
                +2           ADC0CN2    DATA 0B3H; ADC0 Control 2                           
                +2           ADC0GTH    DATA 0C4H; ADC0 Greater-Than High Byte              
                +2           ADC0GTL    DATA 0C3H; ADC0 Greater-Than Low Byte               
                +2           ADC0H      DATA 0BEH; ADC0 Data Word High Byte                 
                +2           ADC0L      DATA 0BDH; ADC0 Data Word Low Byte                  
                +2           ADC0LTH    DATA 0C6H; ADC0 Less-Than High Byte                 
                +2           ADC0LTL    DATA 0C5H; ADC0 Less-Than Low Byte                  
                +2           ADC0MX     DATA 0BBH; ADC0 Multiplexer Selection               
                +2           B          DATA 0F0H; B Register                               
                +2           CKCON0     DATA 08EH; Clock Control 0                          
                +2           CKCON1     DATA 0A6H; Clock Control 1                          
                +2           CLEN0      DATA 0C6H; Configurable Logic Enable 0              
                +2           CLIE0      DATA 0C7H; Configurable Logic Interrupt Enable 0    
                +2           CLIF0      DATA 0E8H; Configurable Logic Interrupt Flag 0      
                +2           CLKGRP0    DATA 0AFH; Clock Group Control                      
                +2           CLKSEL     DATA 0A9H; Clock Select                             
                +2           CLOUT0     DATA 0D1H; Configurable Logic Output 0              
                +2           CLU0CF     DATA 0B1H; Configurable Logic Unit 0 Configuration  
                +2           CLU0FN     DATA 0AFH; Configurable Logic Unit 0 Function Select
                +2           CLU0MX     DATA 084H; Configurable Logic Unit 0 Multiplexer    
                +2           CLU1CF     DATA 0B3H; Configurable Logic Unit 1 Configuration  
                +2           CLU1FN     DATA 0B2H; Configurable Logic Unit 1 Function Select
                +2           CLU1MX     DATA 085H; Configurable Logic Unit 1 Multiplexer    
                +2           CLU2CF     DATA 0B6H; Configurable Logic Unit 2 Configuration  
                +2           CLU2FN     DATA 0B5H; Configurable Logic Unit 2 Function Select
                +2           CLU2MX     DATA 091H; Configurable Logic Unit 2 Multiplexer    
                +2           CLU3CF     DATA 0BFH; Configurable Logic Unit 3 Configuration  
                +2           CLU3FN     DATA 0BEH; Configurable Logic Unit 3 Function Select
                +2           CLU3MX     DATA 0AEH; Configurable Logic Unit 3 Multiplexer    
                +2           CMP0CN0    DATA 09BH; Comparator 0 Control 0                   
                +2           CMP0CN1    DATA 099H; Comparator 0 Control 1                   
                +2           CMP0MD     DATA 09DH; Comparator 0 Mode                        
                +2           CMP0MX     DATA 09FH; Comparator 0 Multiplexer Selection       
                +2           CMP1CN0    DATA 0BFH; Comparator 1 Control 0                   
                +2           CMP1CN1    DATA 0ACH; Comparator 1 Control 1                   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   552

                +2           CMP1MD     DATA 0ABH; Comparator 1 Mode                        
                +2           CMP1MX     DATA 0AAH; Comparator 1 Multiplexer Selection       
                +2           CP0CN      DATA 0A4H; Charge Pump Configuration                
                +2           CRC0CN0    DATA 0CEH; CRC0 Control 0                           
                +2           CRC0CN1    DATA 086H; CRC0 Control 1                           
                +2           CRC0CNT    DATA 0D3H; CRC0 Automatic Flash Sector Count        
                +2           CRC0DAT    DATA 0CBH; CRC0 Data Output                         
                +2           CRC0FLIP   DATA 0CFH; CRC0 Bit Flip                            
                +2           CRC0IN     DATA 0CAH; CRC0 Data Input                          
                +2           CRC0ST     DATA 0D2H; CRC0 Automatic Flash Sector Start        
                +2           DERIVID    DATA 0ADH; Derivative Identification                
                +2           DEVICEID   DATA 0B5H; Device Identification                    
                +2           DPH        DATA 083H; Data Pointer High                        
                +2           DPL        DATA 082H; Data Pointer Low                         
                +2           EIE1       DATA 0E6H; Extended Interrupt Enable 1              
                +2           EIE2       DATA 0F3H; Extended Interrupt Enable 2              
                +2           EIP1       DATA 0BBH; Extended Interrupt Priority 1 Low        
                +2           EIP1H      DATA 0EEH; Extended Interrupt Priority 1 High       
                +2           EIP2       DATA 0EDH; Extended Interrupt Priority 2            
                +2           EIP2H      DATA 0F6H; Extended Interrupt Priority 2 High       
                +2           EMI0CN     DATA 0E7H; External Memory Interface Control        
                +2           FLKEY      DATA 0B7H; Flash Lock and Key                       
                +2           HFO0CAL    DATA 0D6H; High Frequency Oscillator 0 Calibration  
                +2           HFO0CN     DATA 0EFH; High Frequency Oscillator Control        
                +2           HFO0TRIM0  DATA 0CCH; High Frequency Oscillator Trim           
                +2           IE         DATA 0A8H; Interrupt Enable                         
                +2           IP         DATA 0B8H; Interrupt Priority                       
                +2           IPH        DATA 0F2H; Interrupt Priority High                  
                +2           IT01CF     DATA 0E4H; INT0/INT1 Configuration                  
                +2           LFO0CN     DATA 0B1H; Low Frequency Oscillator Control         
                +2           P0         DATA 080H; Port 0 Pin Latch                         
                +2           P0MASK     DATA 0FEH; Port 0 Mask                              
                +2           P0MAT      DATA 0FDH; Port 0 Match                             
                +2           P0MDIN     DATA 0F1H; Port 0 Input Mode                        
                +2           P0MDOUT    DATA 0A4H; Port 0 Output Mode                       
                +2           P0SKIP     DATA 0D4H; Port 0 Skip                              
                +2           P1         DATA 090H; Port 1 Pin Latch                         
                +2           P1MASK     DATA 0EEH; Port 1 Mask                              
                +2           P1MAT      DATA 0EDH; Port 1 Match                             
                +2           P1MDIN     DATA 0F2H; Port 1 Input Mode                        
                +2           P1MDOUT    DATA 0A5H; Port 1 Output Mode                       
                +2           P1SKIP     DATA 0D5H; Port 1 Skip                              
                +2           P2         DATA 0A0H; Port 2 Pin Latch                         
                +2           P2MDIN     DATA 0F3H; Port 2 Input Mode                        
                +2           P2MDOUT    DATA 0A6H; Port 2 Output Mode                       
                +2           PCA0CENT   DATA 09EH; PCA Center Alignment Enable              
                +2           PCA0CLR    DATA 09CH; PCA Comparator Clear Control             
                +2           PCA0CN0    DATA 0D8H; PCA Control                              
                +2           PCA0CPH0   DATA 0FCH; PCA Channel 0 Capture Module High Byte   
                +2           PCA0CPH1   DATA 0EAH; PCA Channel 1 Capture Module High Byte   
                +2           PCA0CPH2   DATA 0ECH; PCA Channel 2 Capture Module High Byte   
                +2           PCA0CPL0   DATA 0FBH; PCA Channel 0 Capture Module Low Byte    
                +2           PCA0CPL1   DATA 0E9H; PCA Channel 1 Capture Module Low Byte    
                +2           PCA0CPL2   DATA 0EBH; PCA Channel 2 Capture Module Low Byte    
                +2           PCA0CPM0   DATA 0DAH; PCA Channel 0 Capture/Compare Mode       
                +2           PCA0CPM1   DATA 0DBH; PCA Channel 1 Capture/Compare Mode       
                +2           PCA0CPM2   DATA 0DCH; PCA Channel 2 Capture/Compare Mode       
                +2           PCA0H      DATA 0FAH; PCA Counter/Timer High Byte              
                +2           PCA0L      DATA 0F9H; PCA Counter/Timer Low Byte               
                +2           PCA0MD     DATA 0D9H; PCA Mode                                 
                +2           PCA0POL    DATA 096H; PCA Output Polarity                      
                +2           PCA0PWM    DATA 0F7H; PCA PWM Configuration                    
                +2           PCON0      DATA 087H; Power Control 0                          
                +2           PCON1      DATA 0CDH; Power Control 1                          
                +2           PFE0CN     DATA 0C1H; Prefetch Engine Control                  
                +2           PRTDRV     DATA 0F6H; Port Drive Strength                      
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   553

                +2           PSCTL      DATA 08FH; Program Store Control                    
                +2           PSTAT0     DATA 0AAH; PMU Status 0                             
                +2           PSW        DATA 0D0H; Program Status Word                      
                +2           PWMCFG0    DATA 0C2H; PWM Configuration 0                      
                +2           PWMCFG1    DATA 0C9H; PWM Configuration 1                      
                +2           PWMCFG2    DATA 0D1H; PWM Configuration 2                      
                +2           PWMCFG3    DATA 0DFH; PWM Configuration 3                      
                +2           PWMCKDIV   DATA 0E3H; PWM Clock Divider                        
                +2           PWMCPH0    DATA 09AH; Ch0 Compare Value MSB                    
                +2           PWMCPH1    DATA 0B6H; Ch1 Compare Value MSB                    
                +2           PWMCPH2    DATA 0BEH; Ch2 Compare Value MSB                    
                +2           PWMCPL0    DATA 099H; Ch0 Compare Value LSB                    
                +2           PWMCPL1    DATA 0B5H; Ch1 Compare Value LSB                    
                +2           PWMCPL2    DATA 0BDH; Ch2 Compare Value LSB                    
                +2           PWMCPUDH0  DATA 0ACH; Ch0 Compare Value Update MSB             
                +2           PWMCPUDH1  DATA 0B3H; Ch1 Compare Value Update MSB             
                +2           PWMCPUDH2  DATA 0BAH; Ch2 Compare Value Update MSB             
                +2           PWMCPUDL0  DATA 0ABH; Ch0 Compare Value Update LSB             
                +2           PWMCPUDL1  DATA 0B2H; Ch1 Compare Value Update LSB             
                +2           PWMCPUDL2  DATA 0B9H; Ch2 Compare Value Update LSB             
                +2           PWMDTINLIM DATA 0E2H; DTI Negative Limit                       
                +2           PWMDTIPLIM DATA 0E1H; DTI Positive Limit                       
                +2           PWMH       DATA 0C4H; PWM Counter MSB                          
                +2           PWMIE      DATA 09FH; PWM Interrupt Enable                     
                +2           PWMIF      DATA 09DH; PWM Interrupt Flags                      
                +2           PWML       DATA 0C3H; PWM Counter LSB                          
                +2           PWMLIMH    DATA 0C6H; PWM Counter Limit MSB                    
                +2           PWMLIML    DATA 0C5H; PWM Counter Limit LSB                    
                +2           PWMSTATUS  DATA 09BH; PWM Status                               
                +2           REF0CN     DATA 0D1H; Voltage Reference Control                
                +2           REG0CN     DATA 0C9H; Regulator 0 Control                      
                +2           REVID      DATA 0B6H; Revision Identifcation                   
                +2           RSTSRC     DATA 0EFH; Reset Source                             
                +2           SBCON1     DATA 094H; UART1 Baud Rate Generator Control        
                +2           SBRLH1     DATA 096H; UART1 Baud Rate Generator High Byte      
                +2           SBRLL1     DATA 095H; UART1 Baud Rate Generator Low Byte       
                +2           SBUF0      DATA 099H; UART0 Serial Port Data Buffer            
                +2           SBUF1      DATA 092H; UART1 Serial Port Data Buffer            
                +2           SCON0      DATA 098H; UART0 Serial Port Control                
                +2           SCON1      DATA 0C8H; UART1 Serial Port Control                
                +2           SFRPAGE    DATA 0A7H; SFR Page                                 
                +2           SFRPGCN    DATA 0BCH; SFR Page Control                         
                +2           SFRSTACK   DATA 0D7H; SFR Page Stack                           
                +2           SMB0ADM    DATA 0D6H; SMBus 0 Slave Address Mask               
                +2           SMB0ADR    DATA 0D7H; SMBus 0 Slave Address                    
                +2           SMB0CF     DATA 0C1H; SMBus 0 Configuration                    
                +2           SMB0CN0    DATA 0C0H; SMBus 0 Control                          
                +2           SMB0DAT    DATA 0C2H; SMBus 0 Data                             
                +2           SMB0FCN0   DATA 0C3H; SMBus 0 FIFO Control 0                   
                +2           SMB0FCN1   DATA 0C4H; SMBus 0 FIFO Control 1                   
                +2           SMB0FCT    DATA 0EFH; SMBus 0 FIFO Count                       
                +2           SMB0RXLN   DATA 0C5H; SMBus 0 Receive Length Counter           
                +2           SMB0TC     DATA 0ACH; SMBus 0 Timing and Pin Control           
                +2           SMOD1      DATA 093H; UART1 Mode                               
                +2           SP         DATA 081H; Stack Pointer                            
                +2           SPI0CFG    DATA 0A1H; SPI0 Configuration                       
                +2           SPI0CKR    DATA 0A2H; SPI0 Clock Rate                          
                +2           SPI0CN0    DATA 0F8H; SPI0 Control                             
                +2           SPI0DAT    DATA 0A3H; SPI0 Data                                
                +2           SPI0FCN0   DATA 09AH; SPI0 FIFO Control 0                      
                +2           SPI0FCN1   DATA 09BH; SPI0 FIFO Control 1                      
                +2           SPI0FCT    DATA 0F7H; SPI0 FIFO Count                          
                +2           SPI0PCF    DATA 0DFH; SPI0 Pin Configuration                   
                +2           TCON       DATA 088H; Timer 0/1 Control                        
                +2           TH0        DATA 08CH; Timer 0 High Byte                        
                +2           TH1        DATA 08DH; Timer 1 High Byte                        
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   554

                +2           TL0        DATA 08AH; Timer 0 Low Byte                         
                +2           TL1        DATA 08BH; Timer 1 Low Byte                         
                +2           TMOD       DATA 089H; Timer 0/1 Mode                           
                +2           TMR2CN0    DATA 0C8H; Timer 2 Control 0                        
                +2           TMR2CN1    DATA 0FDH; Timer 2 Control 1                        
                +2           TMR2H      DATA 0CFH; Timer 2 High Byte                        
                +2           TMR2L      DATA 0CEH; Timer 2 Low Byte                         
                +2           TMR2RLH    DATA 0CBH; Timer 2 Reload High Byte                 
                +2           TMR2RLL    DATA 0CAH; Timer 2 Reload Low Byte                  
                +2           TMR3CN0    DATA 091H; Timer 3 Control 0                        
                +2           TMR3CN1    DATA 0FEH; Timer 3 Control 1                        
                +2           TMR3H      DATA 095H; Timer 3 High Byte                        
                +2           TMR3L      DATA 094H; Timer 3 Low Byte                         
                +2           TMR3RLH    DATA 093H; Timer 3 Reload High Byte                 
                +2           TMR3RLL    DATA 092H; Timer 3 Reload Low Byte                  
                +2           TMR4CN0    DATA 098H; Timer 4 Control 0                        
                +2           TMR4CN1    DATA 0FFH; Timer 4 Control 1                        
                +2           TMR4H      DATA 0A5H; Timer 4 High Byte                        
                +2           TMR4L      DATA 0A4H; Timer 4 Low Byte                         
                +2           TMR4RLH    DATA 0A3H; Timer 4 Reload High Byte                 
                +2           TMR4RLL    DATA 0A2H; Timer 4 Reload Low Byte                  
                +2           TMR5CN0    DATA 0C0H; Timer 5 Control 0                        
                +2           TMR5CN1    DATA 0F1H; Timer 5 Control 1                        
                +2           TMR5H      DATA 0D5H; Timer 5 High Byte                        
                +2           TMR5L      DATA 0D4H; Timer 5 Low Byte                         
                +2           TMR5RLH    DATA 0D3H; Timer 5 Reload High Byte                 
                +2           TMR5RLL    DATA 0D2H; Timer 5 Reload Low Byte                  
                +2           UART0PCF   DATA 0D9H; UART0 Pin Configuration                  
                +2           UART1FCN0  DATA 09DH; UART1 FIFO Control 0                     
                +2           UART1FCN1  DATA 0D8H; UART1 FIFO Control 1                     
                +2           UART1FCT   DATA 0FAH; UART1 FIFO Count                         
                +2           UART1LIN   DATA 09EH; UART1 LIN Configuration                  
                +2           UART1PCF   DATA 0DAH; UART1 Pin Configuration                  
                +2           WDTCN      DATA 097H; Watchdog Timer Control                   
                +2           XBR0       DATA 0E1H; Port I/O Crossbar 0                      
                +2           XBR1       DATA 0E2H; Port I/O Crossbar 1                      
                +2           XBR2       DATA 0E3H; Port I/O Crossbar 2                      
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; 16-bit Register Definitions (may not work on all compilers)
                +2           ;------------------------------------------------------------------------------
                +2           ADC0ASA  DATA 0B5H ; ADC0 Autoscan Start Address Low Byte 
                +2           ADC0GT   DATA 0C3H ; ADC0 Greater-Than Low Byte           
                +2           ADC0     DATA 0BDH ; ADC0 Data Word Low Byte              
                +2           ADC0LT   DATA 0C5H ; ADC0 Less-Than Low Byte              
                +2           DP       DATA 082H ; Data Pointer Low                     
                +2           PCA0CP0  DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                +2           PCA0CP1  DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                +2           PCA0CP2  DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                +2           PCA0     DATA 0F9H ; PCA Counter/Timer Low Byte           
                +2           PWMCP0   DATA 099H ; Ch0 Compare Value LSB                
                +2           PWMCP1   DATA 0B5H ; Ch1 Compare Value LSB                
                +2           PWMCP2   DATA 0BDH ; Ch2 Compare Value LSB                
                +2           PWMCPUD0 DATA 0ABH ; Ch0 Compare Value Update LSB         
                +2           PWMCPUD1 DATA 0B2H ; Ch1 Compare Value Update LSB         
                +2           PWMCPUD2 DATA 0B9H ; Ch2 Compare Value Update LSB         
                +2           PWM      DATA 0C3H ; PWM Counter LSB                      
                +2           PWMLIM   DATA 0C5H ; PWM Counter Limit LSB                
                +2           TMR2     DATA 0CEH ; Timer 2 Low Byte                     
                +2           TMR2RL   DATA 0CAH ; Timer 2 Reload Low Byte              
                +2           TMR3     DATA 094H ; Timer 3 Low Byte                     
                +2           TMR3RL   DATA 092H ; Timer 3 Reload Low Byte              
                +2           TMR4     DATA 0A4H ; Timer 4 Low Byte                     
                +2           TMR4RL   DATA 0A2H ; Timer 4 Reload Low Byte              
                +2           TMR5     DATA 0D4H ; Timer 5 Low Byte                     
                +2           TMR5RL   DATA 0D2H ; Timer 5 Reload Low Byte              
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   555

                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Indirect Register Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Bit Definitions
                +2           ;------------------------------------------------------------------------------
                +2           
                +2           ; ACC 0xE0 (Accumulator)
                +2           ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                +2           ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                +2           ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                +2           ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                +2           ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                +2           ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                +2           ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                +2           ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                +2           
                +2           ; ADC0CN0 0xE8 (ADC0 Control 0)
                +2           ADC0CN0_TEMPE  BIT ADC0CN0.0 ; Temperature Sensor Enable         
                +2           ADC0CN0_ADGN0  BIT ADC0CN0.1 ; Gain Control Bit 0                
                +2           ADC0CN0_ADGN1  BIT ADC0CN0.2 ; Gain Control Bit 1                
                +2           ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag     
                +2           ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                          
                +2           ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag
                +2           ADC0CN0_IPOEN  BIT ADC0CN0.6 ; Idle Powered-off Enable           
                +2           ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                        
                +2           
                +2           ; B 0xF0 (B Register)
                +2           B_B0 BIT B.0 ; B Register Bit 0
                +2           B_B1 BIT B.1 ; B Register Bit 1
                +2           B_B2 BIT B.2 ; B Register Bit 2
                +2           B_B3 BIT B.3 ; B Register Bit 3
                +2           B_B4 BIT B.4 ; B Register Bit 4
                +2           B_B5 BIT B.5 ; B Register Bit 5
                +2           B_B6 BIT B.6 ; B Register Bit 6
                +2           B_B7 BIT B.7 ; B Register Bit 7
                +2           
                +2           ; CLIF0 0xE8 (Configurable Logic Interrupt Flag 0)
                +2           CLIF0_C0FIF BIT CLIF0.0 ; CLU0 Falling Edge Flag
                +2           CLIF0_C0RIF BIT CLIF0.1 ; CLU0 Rising Edge Flag 
                +2           CLIF0_C1FIF BIT CLIF0.2 ; CLU1 Falling Edge Flag
                +2           CLIF0_C1RIF BIT CLIF0.3 ; CLU1 Rising Edge Flag 
                +2           CLIF0_C2FIF BIT CLIF0.4 ; CLU2 Falling Edge Flag
                +2           CLIF0_C2RIF BIT CLIF0.5 ; CLU2 Rising Edge Flag 
                +2           CLIF0_C3FIF BIT CLIF0.6 ; CLU3 Falling Edge Flag
                +2           CLIF0_C3RIF BIT CLIF0.7 ; CLU3 Rising Edge Flag 
                +2           
                +2           ; IE 0xA8 (Interrupt Enable)
                +2           IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                +2           IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                +2           IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                +2           IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                +2           IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                +2           IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                +2           IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                +2           IE_EA    BIT IE.7 ; All Interrupts Enable      
                +2           
                +2           ; IP 0xB8 (Interrupt Priority)
                +2           IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                +2           IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                +2           IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                +2           IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                +2           IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                +2           IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   556

                +2           IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                +2           
                +2           ; P0 0x80 (Port 0 Pin Latch)
                +2           P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                +2           P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                +2           P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                +2           P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                +2           P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                +2           P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                +2           P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                +2           P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                +2           
                +2           ; P1 0x90 (Port 1 Pin Latch)
                +2           P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                +2           P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                +2           P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                +2           P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                +2           P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                +2           P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                +2           P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                +2           
                +2           ; P2 0xA0 (Port 2 Pin Latch)
                +2           P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                +2           
                +2           ; PCA0CN0 0xD8 (PCA Control)
                +2           PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                +2           PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                +2           PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                +2           PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                +2           PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                +2           
                +2           ; PSW 0xD0 (Program Status Word)
                +2           PSW_PARITY BIT PSW.0 ; Parity Flag               
                +2           PSW_F1     BIT PSW.1 ; User Flag 1               
                +2           PSW_OV     BIT PSW.2 ; Overflow Flag             
                +2           PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                +2           PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                +2           PSW_F0     BIT PSW.5 ; User Flag 0               
                +2           PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                +2           PSW_CY     BIT PSW.7 ; Carry Flag                
                +2           
                +2           ; SCON0 0x98 (UART0 Serial Port Control)
                +2           SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                +2           SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                +2           SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                +2           SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                +2           SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                +2           SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                +2           SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                +2           
                +2           ; SCON1 0xC8 (UART1 Serial Port Control)
                +2           SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                +2           SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                +2           SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                +2           SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                +2           SCON1_REN  BIT SCON1.4 ; Receive Enable           
                +2           SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                +2           SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                +2           
                +2           ; SMB0CN0 0xC0 (SMBus 0 Control)
                +2           SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                +2           SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                +2           SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                +2           SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                +2           SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                +2           SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   557

                +2           SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                +2           SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                +2           
                +2           ; SPI0CN0 0xF8 (SPI0 Control)
                +2           SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                +2           SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                +2           SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                +2           SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                +2           SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                +2           SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                +2           SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                +2           SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                +2           
                +2           ; TCON 0x88 (Timer 0/1 Control)
                +2           TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                +2           TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                +2           TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                +2           TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                +2           TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                +2           TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                +2           TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                +2           TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                +2           
                +2           ; TMR2CN0 0xC8 (Timer 2 Control 0)
                +2           TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                +2           TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                +2           TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                +2           TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                +2           TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                +2           TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                +2           TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                +2           TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                +2           
                +2           ; TMR4CN0 0x98 (Timer 4 Control 0)
                +2           TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                +2           TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                +2           TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                +2           TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                +2           TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                +2           TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                +2           TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                +2           TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                +2           
                +2           ; TMR5CN0 0xC0 (Timer 5 Control 0)
                +2           TMR5CN0_T5XCLK0 BIT TMR5CN0.0 ; Timer 5 External Clock Select Bit 0
                +2           TMR5CN0_T5XCLK1 BIT TMR5CN0.1 ; Timer 5 External Clock Select Bit 1
                +2           TMR5CN0_TR5     BIT TMR5CN0.2 ; Timer 5 Run Control                
                +2           TMR5CN0_T5SPLIT BIT TMR5CN0.3 ; Timer 5 Split Mode Enable          
                +2           TMR5CN0_TF5CEN  BIT TMR5CN0.4 ; Timer 5 Capture Enable             
                +2           TMR5CN0_TF5LEN  BIT TMR5CN0.5 ; Timer 5 Low Byte Interrupt Enable  
                +2           TMR5CN0_TF5L    BIT TMR5CN0.6 ; Timer 5 Low Byte Overflow Flag     
                +2           TMR5CN0_TF5H    BIT TMR5CN0.7 ; Timer 5 High Byte Overflow Flag    
                +2           
                +2           ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                +2           UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                +2           UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                +2           UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                +2           UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                +2           UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                +2           UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                +2           UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                +2           UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; Interrupt Definitions
                +2           ;------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   558

                +2           INT0_IRQn    EQU 0  ; External Interrupt 0      
                +2           TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                +2           INT1_IRQn    EQU 2  ; External Interrupt 1      
                +2           TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                +2           UART0_IRQn   EQU 4  ; UART0                     
                +2           TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                +2           SPI0_IRQn    EQU 6  ; SPI0                      
                +2           SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                +2           PMATCH_IRQn  EQU 8  ; Port Match                
                +2           ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                +2           ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                +2           PCA0_IRQn    EQU 11 ; PCA0                      
                +2           CMP0_IRQn    EQU 12 ; Comparator 0              
                +2           CMP1_IRQn    EQU 13 ; Comparator 1              
                +2           TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                +2           UART1_IRQn   EQU 15 ; UART1                     
                +2           TIMER4_IRQn  EQU 17 ; Timer 4 Overflow / Capture
                +2           TIMER5_IRQn  EQU 18 ; Timer 5 Overflow / Capture
                +2           CL0_IRQn     EQU 19 ; Configurable Logic        
                +2           PWM_IRQn     EQU 20 ; Pulse Width Modulation    
                +2           
                +2           ;------------------------------------------------------------------------------
                +2           ; SFR Page Definitions
                +2           ;------------------------------------------------------------------------------
                +2           LEGACY_PAGE  EQU 000H ; Legacy SFR Page
                +2           PG2_PAGE     EQU 010H ; Page2          
                +2           PG3_PAGE     EQU 020H ; Page3          
                +2           PG4_PAGE     EQU 030H ; Page4          
                +1           
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Uses internal calibrated oscillator set to 48Mhz
                +1           ;**** **** **** **** ****
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Constant definitions
                +1           ;**** **** **** **** ****
                +1           IF MCU_48MHZ == 2       ; BB5 requires MCU_48MHZ == 2
                +1           CSEG AT 3040h
                +1           IF FETON_DELAY == 0
                +1           Eep_ESC_Layout:         DB      "#E_X_00#        "      ; ESC layout tag
                +1           ELSEIF FETON_DELAY == 5
                +1           Eep_ESC_Layout:         DB      "#E_X_05#        "
                +1           ELSEIF FETON_DELAY == 10
                +1           Eep_ESC_Layout:         DB      "#E_X_10#        "
                +1           ELSEIF FETON_DELAY == 15
                +1           Eep_ESC_Layout:         DB      "#E_X_15#        "
                +1           ELSEIF FETON_DELAY == 20
                +1           Eep_ESC_Layout:         DB      "#E_X_20#        "
                +1           ELSEIF FETON_DELAY == 25
                +1           Eep_ESC_Layout:         DB      "#E_X_25#        "
                +1           ELSEIF FETON_DELAY == 30
                +1           Eep_ESC_Layout:         DB      "#E_X_30#        "
                +1           ELSEIF FETON_DELAY == 40
                +1           Eep_ESC_Layout:         DB      "#E_X_40#        "
                +1           ELSEIF FETON_DELAY == 50
                +1           Eep_ESC_Layout:         DB      "#E_X_50#        "
                +1           ELSEIF FETON_DELAY == 70
                +1           Eep_ESC_Layout:         DB      "#E_X_70#        "
                +1           ELSEIF FETON_DELAY == 90
                +1           Eep_ESC_Layout:         DB      "#E_X_90#        "
                +1           ENDIF
                +1           
                +1           CSEG AT 3050h
                +1           Eep_ESC_MCU:            DB      "#BLHELI$EFM8B51#"      ; Project and MCU tag (16 Bytes)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   559

                +1           
                +1           ENDIF
                +1           
                +1           TEMP_LIMIT                      EQU 92  ; Temperature measurement ADC value for which main 
                             motor power is limited at 80degC (low byte, assuming high byte is 1)
                +1           TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment for a
                             nother 10degC
                +1           
                +1           
                +1           ;**** **** **** **** ****
                +1           ; Bootloader definitions
                +1           ;**** **** **** **** ****
                +1           RTX_PORT                        EQU P0          ; Receive/Transmit port
                +1           RTX_MDOUT                       EQU     P0MDOUT ; Set to 1 for PUSHPULL
                +1           RTX_MDIN                        EQU     P0MDIN  ; Set to 1 for DIGITAL
                +1           RTX_SKIP                        EQU     P0SKIP  ; Set to 1 for SKIP
                +1           RTX_PIN                         EQU 5           ; RTX pin
                +1           
                +1           SIGNATURE_001           EQU     0E8h    ; Device signature
                +1           SIGNATURE_002           EQU     0B5h
                +1           
                +1           ;*********************
                +1           ; PORT 0 definitions *
                +1           ;*********************  
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           Rcp_In          EQU     5       ;i
                +1           Comp_Com        EQU     4       ;i
                +1           Mux_A           EQU     3       ;i
                +1           Mux_B           EQU     2       ;i
                +1           Mux_C           EQU     1       ;i
                +1           ;                       EQU     0       ;i
                +1           
                +1           P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                +1           P0_INIT         EQU     0FFh
                +1           P0_PUSHPULL     EQU     0
                +1           P0_SKIP         EQU     0FFh
                +1           
                +1           Get_Rcp_Capture_Values MACRO
                +1                   anl     TCON, #0EFh                             ; Disable timer0
                +1                   mov     Temp1, TL0                              ; Get timer0 values
                +1                   mov     Temp2, TH0
                +1                   mov     Temp3, Timer0_X
                +1                   jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                +1                   inc     Temp3                                   ; If it is pending, then timer has 
                             already wrapped
                +1                   mov     TL0, #0                                 ; Reset timer0
                +1                   mov     TH0, #0
                +1                   mov     Timer0_X, #0
                +1                   orl     TCON, #10h                              ; Enable timer0 again
                +1                   mov     A, Clock_Set_At_48MHz
                +1                   jnz     Get_Rcp_End
                +1                   clr     C
                +1                   mov     A, Temp1
                +1                   rlc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Temp2
                +1                   rlc     A
                +1                   mov     Temp2, A
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1           Get_Rcp_End:
                +1           ENDM
                +1           Decode_Dshot_2Msb MACRO
                +1                   movx    A, @DPTR
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   560

                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp4                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_msb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp4
                +1                   rlc     A
                +1                   mov     Temp4, A
                +1                   inc     DPL
                +1           ENDM
                +1           Decode_Dshot_2Lsb MACRO
                +1                   movx    A, @DPTR
                +1                   mov     Temp6, A
                +1                   clr     C
                +1                   subb    A, Temp5                                        ; Subtract previous timesta
                             mp
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                +1           
                +1                   subb    A, Temp1                                        ; Check if bit is zero or o
                             ne
                +1                   mov     A, Temp3                                        ; Shift bit into data byte
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL                                             ; Next bit
                +1                   movx    A, @DPTR
                +1                   mov     Temp5, A
                +1                   clr     C
                +1                   subb    A, Temp6
                +1                   clr     C
                +1                   subb    A, Temp1
                +1                   jc      t1_int_lsb_fail
                +1           
                +1                   subb    A, Temp1
                +1                   mov     A, Temp3
                +1                   rlc     A
                +1                   mov     Temp3, A
                +1                   inc     DPL
                +1           ENDM
                +1           Initialize_PCA MACRO
                +1                   mov     PCA0CN0, #40h                           ; PCA enabled
                +1                   mov     PCA0MD, #08h                            ; PCA clock is system clock
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                +1                   mov     PCA0CENT, #00h                          ; Edge aligned pwm
                +1           ELSE
                +1                   mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   561

                +1                   mov     PCA0CENT, #03h                          ; Center aligned pwm
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_Polarity MACRO
                +1             mov PCA0POL, #02h       ; Damping inverted, pwm noninverted
                +1           ENDM
                +1           Enable_Power_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, enab
                             le match, set pwm mode
                +1           ELSE
                +1                   mov     PCA0CPM0, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Enable_Damp_Pwm_Module MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPM1, #00h                          ; Disable
                +1           ELSE
                +1                   mov     PCA0CPM1, #42h                          ; Enable comparator of module, set 
                             pwm mode
                +1           ENDIF
                +1           ENDM
                +1           Set_Power_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL0, Power_Pwm_Reg_L
                +1                   mov     PCA0CPH0, Power_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Power_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Power_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL0, A
                +1                   mov     PCA0CPH0, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Set_Damp_Pwm_Regs MACRO
                +1           IF FETON_DELAY == 0
                +1                   mov     PCA0CPL1, Damp_Pwm_Reg_L
                +1                   mov     PCA0CPH1, Damp_Pwm_Reg_H
                +1           ELSE
                +1                   clr     C
                +1                   mov     A, Damp_Pwm_Reg_H
                +1                   rrc     A
                +1                   mov     Temp1, A
                +1                   mov     A, Damp_Pwm_Reg_L
                +1                   rrc     A
                +1                   mov     PCA0CPL1, A
                +1                   mov     PCA0CPH1, Temp1
                +1           ENDIF
                +1           ENDM            
                +1           Clear_COVF_Interrupt MACRO
                +1                   anl     PCA0PWM, #0DFh
                +1           ENDM
                +1           Clear_CCF_Interrupt MACRO
                +1                   anl     PCA0CN0, #0FEh
                +1           ENDM
                +1           Enable_COVF_Interrupt MACRO
                +1                   orl     PCA0PWM, #40h
                +1           ENDM
                +1           Enable_CCF_Interrupt MACRO
                +1                   orl     PCA0CPM0,#01h
                +1           ENDM
                +1           Disable_COVF_Interrupt MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   562

                +1                   anl     PCA0PWM, #0BFh
                +1           ENDM
                +1           Disable_CCF_Interrupt MACRO
                +1                   anl     PCA0CPM0,#0FEh
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 1 definitions *
                +1           ;*********************
                +1           ;                       EQU     7       ;i
                +1           ;                       EQU     6       ;i
                +1           AcomFET   EQU 5 ;o
                +1           BcomFET   EQU 4 ;o
                +1           CcomFET   EQU 3 ;o
                +1           ApwmFET   EQU 2 ;o
                +1           BpwmFET   EQU 1 ;o
                +1           CpwmFET   EQU 0 ;o
                +1           
                +1           P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_INIT   EQU   00h
                +1           P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+(1 
                             SHL BcomFET)+(1 SHL CcomFET)
                +1           P1_SKIP         EQU     3Fh
                +1           
                +1           ApwmFET_on MACRO
                +1                   setb    P1.ApwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           ApwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_on MACRO
                +1                   setb    P1.BpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           BpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.BpwmFET
                +1           ELSE
                +1                   clr     P1.BcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_on MACRO
                +1                   setb    P1.CpwmFET
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           CpwmFET_off MACRO
                +1           IF FETON_DELAY != 0
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           All_pwmFETs_Off MACRO
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   563

                +1           IF FETON_DELAY != 0
                +1                   clr     P1.ApwmFET
                +1                   clr     P1.BpwmFET
                +1                   clr     P1.CpwmFET
                +1           ELSE
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDIF
                +1           ENDM
                +1           
                +1           AcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.ApwmFET
                +1           ENDIF
                +1                   setb    P1.AcomFET
                +1           ENDM
                +1           AcomFET_off MACRO
                +1                   clr     P1.AcomFET
                +1           ENDM
                +1           BcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.BpwmFET
                +1           ENDIF
                +1                   setb    P1.BcomFET
                +1           ENDM
                +1           BcomFET_off MACRO
                +1                   clr     P1.BcomFET
                +1           ENDM
                +1           CcomFET_on MACRO
                +1           IF FETON_DELAY == 0
                +1                   clr     P1.CpwmFET
                +1           ENDIF
                +1                   setb    P1.CcomFET
                +1           ENDM
                +1           CcomFET_off MACRO
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           All_comFETs_Off MACRO
                +1                   clr     P1.AcomFET
                +1                   clr     P1.BcomFET
                +1                   clr     P1.CcomFET
                +1           ENDM
                +1           
                +1           Set_Pwm_A MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.AcomFET
                +1             mov P1SKIP, #3Bh
                +1           ELSE
                +1             mov P1SKIP, #1Bh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_B MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.BcomFET
                +1             mov P1SKIP, #3Dh
                +1           ELSE
                +1             mov P1SKIP, #2Dh
                +1           ENDIF
                +1           ENDM
                +1           Set_Pwm_C MACRO
                +1           IF FETON_DELAY == 0
                +1                   setb    P1.CcomFET
                +1             mov P1SKIP, #3Eh
                +1           ELSE
                +1             mov P1SKIP, #36h
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   564

                +1           ENDIF
                +1           ENDM
                +1           Set_Pwms_Off MACRO
                +1                   mov     P1SKIP, #3Fh
                +1           ENDM
                +1           
                +1           Set_Comp_Phase_A MACRO
                +1                   mov     CMP0MX, #12h    ; Set comparator multiplexer to phase A
                +1           ENDM
                +1           Set_Comp_Phase_B MACRO
                +1                   mov     CMP0MX, #11h    ; Set comparator multiplexer to phase B
                +1           ENDM
                +1           Set_Comp_Phase_C MACRO
                +1                   mov     CMP0MX, #10h    ; Set comparator multiplexer to phase C
                +1           ENDM
                +1           Read_Comp_Out MACRO
                +1                   mov     A, CMP0CN0      ; Read comparator output
                +1                   cpl     A
                +1           ENDM
                +1           
                +1           
                +1           ;*********************
                +1           ; PORT 2 definitions *
                +1           ;*********************
                +1           DebugPin                EQU     0       ;o
                +1           
                +1           P2_PUSHPULL     EQU     (1 SHL DebugPin)
                +1           
                +1           
                +1           ;**********************
                +1           ; MCU specific macros *
                +1           ;**********************
                +1           Interrupt_Table_Definition MACRO
                +1           CSEG AT 0                               ; Code segment start
                +1                   jmp reset
                +1           CSEG AT 03h                     ; Int0 interrupt        
                +1                   jmp     int0_int        
                +1           CSEG AT 0Bh                     ; Timer0 overflow interrupt
                +1                   jmp     t0_int
                +1           CSEG AT 13h                     ; Int1 interrupt
                +1                   jmp     int1_int
                +1           CSEG AT 1Bh                     ; Timer1 overflow interrupt
                +1                   jmp     t1_int
                +1           CSEG AT 2Bh                     ; Timer2 overflow interrupt
                +1                   jmp     t2_int  
                +1           CSEG AT 5Bh                     ; Pca interrupt
                +1                   jmp     pca_int
                +1           CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                +1                   jmp     t3_int  
                +1           ENDM
                +1           
                +1           Initialize_Xbar MACRO
                +1                   mov     XBR2, #40h      ; Xbar enabled                  
                +1                   mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                +1           ENDM
                +1           
                +1           Initialize_Comparator MACRO
                +1                   mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                +1                   mov     CMP0MD, #00h    ; Comparator response time 100ns
                +1           ENDM
                +1           Initialize_Adc MACRO
                +1                   mov     CLKGRP0, #18h   ; Enable SAR clock, at 12MHz
                +1                   mov     ADC0CF1, #0Ah   ; 800ns tracking time
                +1                   mov     ADC0CF2, #2Fh   ; 1.65V reference
                +1                   mov     ADC0MX, #10h    ; Select temp sensor input
                +1                   mov     ADC0CN0, #85h   ; ADC enabled, gain 0.5, temp sensor enabled
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   565

                +1                   mov     ADC0CN1, #20h   ; 10bit mode
                +1           ENDM
                +1           Start_Adc MACRO
                +1                   mov     ADC0CN0, #95h   ; ADC start
                +1           ENDM
                +1           Read_Adc_Result MACRO
                +1                   mov     Temp1, ADC0L
                +1                   mov     Temp2, ADC0H
                +1           ENDM
                +1           Stop_Adc MACRO
                +1           ENDM
                +1           Set_RPM_Out MACRO
                +1           ENDM
                +1           Clear_RPM_Out MACRO
                +1           ENDM
                +1           Set_MCU_Clk_24MHz MACRO
                +1                   mov     CLKSEL, #13h            ; Set clock to 24MHz
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     Clock_Set_At_48MHz, #0
                +1           ENDM
                +1           Set_MCU_Clk_48MHz MACRO
                +1                   mov     SFRPAGE, #10h
                +1                   mov     PFE0CN, #10h            ; Set flash timing for 48MHz
                +1                   mov     SFRPAGE, #00h
                +1                   mov     CLKSEL, #03h            ; Set clock to 48MHz
                +1                   mov     Clock_Set_At_48MHz, #1
                +1           ENDM
                +1           Set_LED_0 MACRO
                +1           ENDM
                +1           Clear_LED_0 MACRO
                +1           ENDM
                +1           Set_LED_1 MACRO
                +1           ENDM
                +1           Clear_LED_1 MACRO
                +1           ENDM
                +1           Set_LED_2 MACRO
                +1           ENDM
                +1           Clear_LED_2 MACRO
                +1           ENDM
                +1           Set_LED_3 MACRO
                +1           ENDM
                +1           Clear_LED_3 MACRO
                +1           ENDM
                             ENDIF
                   36751     
                   36752     
                   36753     ;**** **** **** **** ****
                   36754     ; Programming defaults
                   36755     ;
  000D             36756     DEFAULT_PGM_STARTUP_PWR                                 EQU 13  ; 1=0.031 2=0.047 3=0.063 4
                             =0.094 5=0.125 6=0.188       7=0.25  8=0.38  9=0.50  10=0.75 11=1.00 12=1.25 13=1.50
  0003             36757     DEFAULT_PGM_COMM_TIMING                         EQU 3   ; 1=Low                 2=MediumLow
                                  3=Medium                4=MediumHigh    5=High
  0002             36758     DEFAULT_PGM_DEMAG_COMP                          EQU 2   ; 1=Disabled    2=Low           3=H
                             igh
  0002             36759     DEFAULT_PGM_DIRECTION                           EQU 2   ; 1=Normal      2=Reversed      3=B
                             idir         4=Bidir rev
  0001             36760     DEFAULT_PGM_BEEP_STRENGTH                       EQU 1   ; Beep strength
  0050             36761     DEFAULT_PGM_BEACON_STRENGTH                     EQU 80  ; Beacon strength
  0004             36762     DEFAULT_PGM_BEACON_DELAY                                EQU 4   ; 1=1m          2=2m       
                                          3=5m                    4=10m           5=Infinite
                   36763     
                   36764     ; COMMON
  0001             36765     DEFAULT_PGM_ENABLE_TX_PROGRAM           EQU 1   ; 1=Enabled     0=Disabled
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   566

  001B             36766     DEFAULT_PGM_MIN_THROTTLE                                EQU 27  ; 4*37+1000=1148
  00FA             36767     DEFAULT_PGM_MAX_THROTTLE                                EQU 250 ; 4*208+1000=1832
  007A             36768     DEFAULT_PGM_CENTER_THROTTLE                     EQU 122 ; 4*122+1000=1488 (used in bidirect
                             ional mode)
  0007             36769     DEFAULT_PGM_ENABLE_TEMP_PROT                    EQU 7   ; 0=Disabled    1=80C   2=90C   3=1
                             00C  4=110C  5=120C  6=130C  7=140C
  0001             36770     DEFAULT_PGM_ENABLE_POWER_PROT           EQU 1   ; 1=Enabled     0=Disabled
  0000             36771     DEFAULT_PGM_BRAKE_ON_STOP                       EQU 0   ; 1=Enabled     0=Disabled
  0000             36772     DEFAULT_PGM_LED_CONTROL                         EQU 0   ; Byte for LED control. 2bits per L
                             ED, 0=Off, 1=On
                   36773     
                   36774     ;**** **** **** **** ****
                   36775     ; Temporary register definitions
  REG              36776     Temp1           EQU     R0
  REG              36777     Temp2           EQU     R1
  REG              36778     Temp3           EQU     R2
  REG              36779     Temp4           EQU     R3
  REG              36780     Temp5           EQU     R4
  REG              36781     Temp6           EQU     R5
  REG              36782     Temp7           EQU     R6
  REG              36783     Temp8           EQU     R7
                   36784     
                   36785     ;**** **** **** **** ****
                   36786     ; Register definitions
----               36787     DSEG AT 20h                                     ; Variables segment 
                   36788     
0020               36789     Bit_Access:                             DS      1               ; MUST BE AT THIS ADDRESS. 
                             Variable at bit accessible address (for non interrupt routines)
0021               36790     Bit_Access_Int:                 DS      1               ; Variable at bit accessible addres
                             s (for interrupts)
                   36791     
0022               36792     Rcp_Outside_Range_Cnt:          DS      1               ; RC pulse outside range counter (i
                             ncrementing) 
0023               36793     Rcp_Timeout_Cntd:                       DS      1               ; RC pulse timeout counter 
                             (decrementing) 
                   36794     
                   36795     
0024               36796     Flags0:                                 DS      1       ; State flags. Reset upon init_start
  0000             36797     T3_PENDING                              EQU     0               ; Timer 3 pending flag
  0001             36798     DEMAG_DETECTED                          EQU     1               ; Set when excessive demag 
                             time is detected
  0002             36799     COMP_TIMED_OUT                          EQU     2               ; Set when comparator readi
                             ng timed out
                   36800     ;                                               EQU     3
                   36801     ;                                               EQU     4
                   36802     ;                                               EQU     5       
                   36803     ;                                               EQU     6       
                   36804     ;                                               EQU     7       
                   36805     
                   36806     
0025               36807     Flags1:                                 DS      1       ; State flags. Reset upon init_star
                             t 
  0000             36808     STARTUP_PHASE                           EQU     0               ; Set when in startup phase
  0001             36809     INITIAL_RUN_PHASE                       EQU     1               ; Set when in initial run p
                             hase, before synchronized run is achieved
  0002             36810     MOTOR_STARTED                           EQU     2               ; Set when motor is started
  0003             36811     DIR_CHANGE_BRAKE                        EQU     3               ; Set when braking before d
                             irection change
  0004             36812     HIGH_RPM                                        EQU     4               ; Set when motor rp
                             m is high (Comm_Period4x_H less than 2)
                   36813     ;                                               EQU     5
                   36814     ;                                               EQU     6       
                   36815     ;                                               EQU     7       
                   36816     
0026               36817     Flags2:                                 DS      1               ; State flags. NOT reset up
                             on init_start
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   567

  0000             36818     RCP_UPDATED                             EQU     0               ; New RC pulse length value
                              available
  0001             36819     RCP_ONESHOT125                          EQU     1               ; RC pulse input is OneShot
                             125 (125-250us)
  0002             36820     RCP_ONESHOT42                           EQU     2               ; RC pulse input is OneShot
                             42 (41.67-83us)
  0003             36821     RCP_MULTISHOT                           EQU     3               ; RC pulse input is Multish
                             ot (5-25us)
  0004             36822     RCP_DSHOT                                       EQU     4               ; RC pulse input is
                              digital shot
  0005             36823     RCP_DIR_REV                             EQU     5               ; RC pulse direction in bid
                             irectional mode
  0006             36824     RCP_FULL_RANGE                          EQU     6               ; When set full input signa
                             l range is used (1000-2000us) and stored calibration values are ignored
                   36825     ;                                               EQU     7       
                   36826     
0027               36827     Flags3:                                 DS      1               ; State flags. NOT reset up
                             on init_start
  0000             36828     PGM_DIR_REV                             EQU     0               ; Programmed direction. 0=n
                             ormal, 1=reversed
  0001             36829     PGM_BIDIR_REV                           EQU     1               ; Programmed bidirectional 
                             direction. 0=normal, 1=reversed
  0002             36830     PGM_BIDIR                                       EQU     2               ; Programmed bidire
                             ctional operation. 0=normal, 1=bidirectional
                   36831     ;                                               EQU     3
                   36832     ;                                               EQU     4       
                   36833     ;                                               EQU     5       
                   36834     ;                                               EQU     6       
                   36835     ;                                               EQU     7       
                   36836     
                   36837     
                   36838     ;**** **** **** **** ****
                   36839     ; RAM definitions
----               36840     DSEG AT 30h                                             ; Ram data segment, direct addressi
                             ng
0030               36841     Initial_Arm:                            DS      1               ; Variable that is set duri
                             ng the first arm sequence after power on
                   36842     
0031               36843     Min_Throttle_L:                 DS      1               ; Minimum throttle scaled (lo byte)
0032               36844     Min_Throttle_H:                 DS      1               ; Minimum throttle scaled (hi byte)
0033               36845     Center_Throttle_L:                      DS      1               ; Center throttle scaled (l
                             o byte)
0034               36846     Center_Throttle_H:                      DS      1               ; Center throttle scaled (h
                             i byte)
0035               36847     Max_Throttle_L:                 DS      1               ; Maximum throttle scaled (lo byte)
0036               36848     Max_Throttle_H:                 DS      1               ; Maximum throttle scaled (hi byte)
                   36849     
0037               36850     Power_On_Wait_Cnt_L:            DS      1               ; Power on wait counter (lo byte)
0038               36851     Power_On_Wait_Cnt_H:            DS      1               ; Power on wait counter (hi byte)
                   36852     
0039               36853     Startup_Cnt:                            DS      1               ; Startup phase commutation
                             s counter (incrementing)
003A               36854     Startup_Zc_Timeout_Cntd:                DS      1               ; Startup zero cross timeou
                             t counter (decrementing)
003B               36855     Initial_Run_Rot_Cntd:           DS      1               ; Initial run rotations counter (de
                             crementing)
003C               36856     Stall_Cnt:                              DS      1               ; Counts start/run attempts
                              that resulted in stall. Reset upon a proper stop
003D               36857     Demag_Detected_Metric:          DS      1               ; Metric used to gauge demag event 
                             frequency
003E               36858     Demag_Pwr_Off_Thresh:           DS      1               ; Metric threshold above which powe
                             r is cut
003F               36859     Low_Rpm_Pwr_Slope:                      DS      1               ; Sets the slope of power i
                             ncrease for low rpms
                   36860     
0040               36861     Timer0_X:                                       DS      1               ; Timer 0 extended 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   568

                             byte
0041               36862     Timer2_X:                                       DS      1               ; Timer 2 extended 
                             byte
0042               36863     Prev_Comm_L:                            DS      1               ; Previous commutation time
                             r 3 timestamp (lo byte)
0043               36864     Prev_Comm_H:                            DS      1               ; Previous commutation time
                             r 3 timestamp (hi byte)
0044               36865     Prev_Comm_X:                            DS      1               ; Previous commutation time
                             r 3 timestamp (ext byte)
0045               36866     Prev_Prev_Comm_L:                       DS      1               ; Pre-previous commutation 
                             timer 3 timestamp (lo byte)
0046               36867     Prev_Prev_Comm_H:                       DS      1               ; Pre-previous commutation 
                             timer 3 timestamp (hi byte)
0047               36868     Comm_Period4x_L:                        DS      1               ; Timer 3 counts between th
                             e last 4 commutations (lo byte)
0048               36869     Comm_Period4x_H:                        DS      1               ; Timer 3 counts between th
                             e last 4 commutations (hi byte)
0049               36870     Comparator_Read_Cnt:            DS      1               ; Number of comparator reads done
                   36871     
004A               36872     Wt_Adv_Start_L:                 DS      1               ; Timer 3 start point for commutati
                             on advance timing (lo byte)
004B               36873     Wt_Adv_Start_H:                 DS      1               ; Timer 3 start point for commutati
                             on advance timing (hi byte)
004C               36874     Wt_Zc_Scan_Start_L:                     DS      1               ; Timer 3 start point from 
                             commutation to zero cross scan (lo byte)
004D               36875     Wt_Zc_Scan_Start_H:                     DS      1               ; Timer 3 start point from 
                             commutation to zero cross scan (hi byte)
004E               36876     Wt_Zc_Tout_Start_L:                     DS      1               ; Timer 3 start point for z
                             ero cross scan timeout (lo byte)
004F               36877     Wt_Zc_Tout_Start_H:                     DS      1               ; Timer 3 start point for z
                             ero cross scan timeout (hi byte)
0050               36878     Wt_Comm_Start_L:                        DS      1               ; Timer 3 start point from 
                             zero cross to commutation (lo byte)
0051               36879     Wt_Comm_Start_H:                        DS      1               ; Timer 3 start point from 
                             zero cross to commutation (hi byte)
                   36880     
0052               36881     Dshot_Cmd:                              DS      1               ; Dshot command
0053               36882     Dshot_Cmd_Cnt:                          DS      1               ; Dshot command count
                   36883     
0054               36884     New_Rcp:                                        DS      1               ; New RC pulse valu
                             e in pca counts
0055               36885     Rcp_Stop_Cnt:                           DS      1               ; Counter for RC pulses bel
                             ow stop value
                   36886     
0056               36887     Power_Pwm_Reg_L:                        DS      1               ; Power pwm register settin
                             g (lo byte)
0057               36888     Power_Pwm_Reg_H:                        DS      1               ; Power pwm register settin
                             g (hi byte). 0x3F is minimum power
0058               36889     Damp_Pwm_Reg_L:                 DS      1               ; Damping pwm register setting (lo 
                             byte)
0059               36890     Damp_Pwm_Reg_H:                 DS      1               ; Damping pwm register setting (hi 
                             byte)
005A               36891     Current_Power_Pwm_Reg_H:                DS      1               ; Current power pwm registe
                             r setting that is loaded in the PCA register (hi byte)
                   36892     
005B               36893     Pwm_Limit:                              DS      1               ; Maximum allowed pwm 
005C               36894     Pwm_Limit_By_Rpm:                       DS      1               ; Maximum allowed pwm for l
                             ow or high rpms
005D               36895     Pwm_Limit_Beg:                          DS      1               ; Initial pwm limit
                   36896     
005E               36897     Adc_Conversion_Cnt:                     DS      1               ; Adc conversion counter
                   36898     
005F               36899     Current_Average_Temp:           DS      1               ; Current average temperature (lo b
                             yte ADC reading, assuming hi byte is 1)
                   36900     
0060               36901     Throttle_Gain:                          DS      1               ; Gain to be applied to RCP
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   569

                              value
0061               36902     Throttle_Gain_M:                        DS      1               ; Gain to be applied to RCP
                              value (multiplier 0=1x, 1=2x, 2=4x etc))
0062               36903     Throttle_Gain_BD_Rev:           DS      1               ; Gain to be applied to RCP value f
                             or reverse direction in bidirectional mode
0063               36904     Throttle_Gain_BD_Rev_M:         DS      1               ; Gain to be applied to RCP value f
                             or reverse direction in bidirectional mode (multiplier 0=1x, 1=2x, 2=4x etc)
0064               36905     Beep_Strength:                          DS      1               ; Strength of beeps
                   36906     
0065               36907     Skip_T2_Int:                            DS      1               ; Set for 48MHz MCUs when t
                             imer 2 interrupt shall be ignored
0066               36908     Clock_Set_At_48MHz:                     DS      1               ; Variable set if 48MHz MCU
                             s run at 48MHz
                   36909     
0067               36910     Flash_Key_1:                            DS      1               ; Flash key one
0068               36911     Flash_Key_2:                            DS      1               ; Flash key two
                   36912     
0069               36913     Temp_Prot_Limit:                        DS      1               ; Temperature protection li
                             mit
                   36914     
006A               36915     DShot_Pwm_Thr:                          DS      1               ; DShot pulse width thresho
                             ld value
006B               36916     DShot_Timer_Preset:                     DS      1               ; DShot timer preset for fr
                             ame sync detection
006C               36917     DShot_Frame_Start_L:            DS      1               ; DShot frame start timestamp (lo b
                             yte)
006D               36918     DShot_Frame_Start_H:            DS      1               ; DShot frame start timestamp (hi b
                             yte)
006E               36919     DShot_Frame_Length_Thr:         DS      1               ; DShot frame length criteria (in u
                             nits of 4 timer 2 ticks)
                   36920     
                   36921     ; Indirect addressing data segment. The variables below must be in this sequence
----               36922     ISEG AT 080h                                    
0080               36923     _Pgm_Gov_P_Gain:                        DS      1               ; Programmed governor P gain
0081               36924     _Pgm_Gov_I_Gain:                        DS      1               ; Programmed governor I gain
0082               36925     _Pgm_Gov_Mode:                          DS      1               ; Programmed governor mode
0083               36926     _Pgm_Low_Voltage_Lim:           DS      1               ; Programmed low voltage limit
0084               36927     _Pgm_Motor_Gain:                        DS      1               ; Programmed motor gain
0085               36928     _Pgm_Motor_Idle:                        DS      1               ; Programmed motor idle spe
                             ed
0086               36929     Pgm_Startup_Pwr:                        DS      1               ; Programmed startup power
0087               36930     _Pgm_Pwm_Freq:                          DS      1               ; Programmed pwm frequency
0088               36931     Pgm_Direction:                          DS      1               ; Programmed rotation direc
                             tion
0089               36932     Pgm_Input_Pol:                          DS      1               ; Programmed input pwm pola
                             rity
008A               36933     Initialized_L_Dummy:            DS      1               ; Place holder
008B               36934     Initialized_H_Dummy:            DS      1               ; Place holder
008C               36935     Pgm_Enable_TX_Program:          DS      1               ; Programmed enable/disable value f
                             or TX programming
008D               36936     _Pgm_Main_Rearm_Start:          DS      1               ; Programmed enable/disable re-armi
                             ng main every start 
008E               36937     _Pgm_Gov_Setup_Target:          DS      1               ; Programmed main governor setup ta
                             rget
008F               36938     _Pgm_Startup_Rpm:                       DS      1               ; Programmed startup rpm (u
                             nused - place holder)
0090               36939     _Pgm_Startup_Accel:                     DS      1               ; Programmed startup accele
                             ration (unused - place holder)
0091               36940     _Pgm_Volt_Comp:                 DS      1               ; Place holder
0092               36941     Pgm_Comm_Timing:                        DS      1               ; Programmed commutation ti
                             ming
0093               36942     _Pgm_Damping_Force:                     DS      1               ; Programmed damping force 
                             (unused - place holder)
0094               36943     _Pgm_Gov_Range:                 DS      1               ; Programmed governor range
0095               36944     _Pgm_Startup_Method:            DS      1               ; Programmed startup method (unused
                              - place holder)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   570

0096               36945     Pgm_Min_Throttle:                       DS      1               ; Programmed throttle minim
                             um
0097               36946     Pgm_Max_Throttle:                       DS      1               ; Programmed throttle maxim
                             um
0098               36947     Pgm_Beep_Strength:                      DS      1               ; Programmed beep strength
0099               36948     Pgm_Beacon_Strength:            DS      1               ; Programmed beacon strength
009A               36949     Pgm_Beacon_Delay:                       DS      1               ; Programmed beacon delay
009B               36950     _Pgm_Throttle_Rate:                     DS      1               ; Programmed throttle rate 
                             (unused - place holder)
009C               36951     Pgm_Demag_Comp:                 DS      1               ; Programmed demag compensation
009D               36952     _Pgm_BEC_Voltage_High:          DS      1               ; Programmed BEC voltage
009E               36953     Pgm_Center_Throttle:            DS      1               ; Programmed throttle center (in bi
                             directional mode)
009F               36954     _Pgm_Main_Spoolup_Time:         DS      1               ; Programmed main spoolup time
00A0               36955     Pgm_Enable_Temp_Prot:           DS      1               ; Programmed temperature protection
                              enable
00A1               36956     Pgm_Enable_Power_Prot:          DS      1               ; Programmed low rpm power protecti
                             on enable
00A2               36957     _Pgm_Enable_Pwm_Input:          DS      1               ; Programmed PWM input signal enable
00A3               36958     _Pgm_Pwm_Dither:                        DS      1               ; Programmed output PWM dit
                             her
00A4               36959     Pgm_Brake_On_Stop:                      DS      1               ; Programmed braking when t
                             hrottle is zero
00A5               36960     Pgm_LED_Control:                        DS      1               ; Programmed LED control
                   36961     
                   36962     ; The sequence of the variables below is no longer of importance
00A6               36963     Pgm_Startup_Pwr_Decoded:                DS      1               ; Programmed startup power 
                             decoded
                   36964     
                   36965     
                   36966     ; Indirect addressing data segment
----               36967     ISEG AT 0D0h                                    
00D0               36968     Temp_Storage:                           DS      48              ; Temporary storage
                   36969     
                   36970     ;**** **** **** **** ****
                   36971     IF MCU_48MHZ == 2
                             CSEG AT 3000h            ; "Eeprom" segment
                             ELSE
----               36974     CSEG AT 1A00h            ; "Eeprom" segment
                   36975     ENDIF
  0010             36976     EEPROM_FW_MAIN_REVISION         EQU     16              ; Main revision of the firmware
  0007             36977     EEPROM_FW_SUB_REVISION          EQU     7               ; Sub revision of the firmware
  0021             36978     EEPROM_LAYOUT_REVISION          EQU     33              ; Revision of the EEPROM layout
                   36979     
1A00 10            36980     Eep_FW_Main_Revision:           DB      EEPROM_FW_MAIN_REVISION                 ; EEPROM fi
                             rmware main revision number
1A01 07            36981     Eep_FW_Sub_Revision:            DB      EEPROM_FW_SUB_REVISION                  ; EEPROM fi
                             rmware sub revision number
1A02 21            36982     Eep_Layout_Revision:            DB      EEPROM_LAYOUT_REVISION                  ; EEPROM la
                             yout revision number
                   36983     
1A03 FF            36984     _Eep_Pgm_Gov_P_Gain:            DB      0FFh    
1A04 FF            36985     _Eep_Pgm_Gov_I_Gain:            DB      0FFh    
1A05 FF            36986     _Eep_Pgm_Gov_Mode:                      DB      0FFh    
1A06 FF            36987     _Eep_Pgm_Low_Voltage_Lim:       DB      0FFh                                               
                                  
1A07 FF            36988     _Eep_Pgm_Motor_Gain:            DB      0FFh    
1A08 FF            36989     _Eep_Pgm_Motor_Idle:            DB      0FFh                                            
1A09 0D            36990     Eep_Pgm_Startup_Pwr:            DB      DEFAULT_PGM_STARTUP_PWR                 ; EEPROM co
                             py of programmed startup power
1A0A FF            36991     _Eep_Pgm_Pwm_Freq:                      DB      0FFh    
1A0B 02            36992     Eep_Pgm_Direction:                      DB      DEFAULT_PGM_DIRECTION                   ; E
                             EPROM copy of programmed rotation direction
1A0C FF            36993     _Eep_Pgm_Input_Pol:                     DB      0FFh
1A0D 55            36994     Eep_Initialized_L:                      DB      055h                                       
                                          ; EEPROM initialized signature low byte
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   571

1A0E AA            36995     Eep_Initialized_H:                      DB      0AAh                                       
                                          ; EEPROM initialized signature high byte
1A0F 01            36996     Eep_Enable_TX_Program:          DB      DEFAULT_PGM_ENABLE_TX_PROGRAM           ; EEPROM TX
                              programming enable
1A10 FF            36997     _Eep_Main_Rearm_Start:          DB      0FFh                                               
                                  
1A11 FF            36998     _Eep_Pgm_Gov_Setup_Target:      DB      0FFh                                               
                                  
1A12 FF            36999     _Eep_Pgm_Startup_Rpm:           DB      0FFh
1A13 FF            37000     _Eep_Pgm_Startup_Accel:         DB      0FFh
1A14 FF            37001     _Eep_Pgm_Volt_Comp:                     DB      0FFh    
1A15 03            37002     Eep_Pgm_Comm_Timing:            DB      DEFAULT_PGM_COMM_TIMING                 ; EEPROM co
                             py of programmed commutation timing
1A16 FF            37003     _Eep_Pgm_Damping_Force:         DB      0FFh
1A17 FF            37004     _Eep_Pgm_Gov_Range:                     DB      0FFh    
1A18 FF            37005     _Eep_Pgm_Startup_Method:                DB      0FFh
1A19 1B            37006     Eep_Pgm_Min_Throttle:           DB      DEFAULT_PGM_MIN_THROTTLE                        ; E
                             EPROM copy of programmed minimum throttle
1A1A FA            37007     Eep_Pgm_Max_Throttle:           DB      DEFAULT_PGM_MAX_THROTTLE                        ; E
                             EPROM copy of programmed minimum throttle
1A1B 01            37008     Eep_Pgm_Beep_Strength:          DB      DEFAULT_PGM_BEEP_STRENGTH               ; EEPROM co
                             py of programmed beep strength
1A1C 50            37009     Eep_Pgm_Beacon_Strength:                DB      DEFAULT_PGM_BEACON_STRENGTH             ; E
                             EPROM copy of programmed beacon strength
1A1D 04            37010     Eep_Pgm_Beacon_Delay:           DB      DEFAULT_PGM_BEACON_DELAY                        ; E
                             EPROM copy of programmed beacon delay
1A1E FF            37011     _Eep_Pgm_Throttle_Rate:         DB      0FFh
1A1F 02            37012     Eep_Pgm_Demag_Comp:                     DB      DEFAULT_PGM_DEMAG_COMP                  ; E
                             EPROM copy of programmed demag compensation
1A20 FF            37013     _Eep_Pgm_BEC_Voltage_High:      DB      0FFh    
1A21 7A            37014     Eep_Pgm_Center_Throttle:                DB      DEFAULT_PGM_CENTER_THROTTLE             ; E
                             EPROM copy of programmed center throttle
1A22 FF            37015     _Eep_Pgm_Main_Spoolup_Time:     DB      0FFh
1A23 07            37016     Eep_Pgm_Temp_Prot_Enable:       DB      DEFAULT_PGM_ENABLE_TEMP_PROT            ; EEPROM co
                             py of programmed temperature protection enable
1A24 01            37017     Eep_Pgm_Enable_Power_Prot:      DB      DEFAULT_PGM_ENABLE_POWER_PROT           ; EEPROM co
                             py of programmed low rpm power protection enable
1A25 FF            37018     _Eep_Pgm_Enable_Pwm_Input:      DB      0FFh    
1A26 FF            37019     _Eep_Pgm_Pwm_Dither:            DB      0FFh    
1A27 00            37020     Eep_Pgm_Brake_On_Stop:          DB      DEFAULT_PGM_BRAKE_ON_STOP               ; EEPROM co
                             py of programmed braking when throttle is zero
1A28 00            37021     Eep_Pgm_LED_Control:            DB      DEFAULT_PGM_LED_CONTROL                 ; EEPROM co
                             py of programmed LED control
                   37022     
1A29 FF            37023     Eep_Dummy:                              DB      0FFh                                       
                                          ; EEPROM address for safety reason
                   37024     
                   37025     IF MCU_48MHZ == 2
                             CSEG AT 3060h
                             ELSE
----               37028     CSEG AT 1A60h
                   37029     ENDIF
1A60 20202020      37030     Eep_Name:                                       DB      "                "                 
                                          ; Name tag (16 Bytes)
1A64 20202020                
1A68 20202020                
1A6C 20202020                
                   37031     
                   37032     ;**** **** **** **** ****
                   37033     Interrupt_Table_Definition              ; SiLabs interrupts
----               37052     CSEG AT 80h                     ; Code segment after interrupt vectors 
                   37053     
                   37054     ;**** **** **** **** ****
                   37055     
                   37056     ; Table definitions
0080 0406080C      37057     STARTUP_POWER_TABLE:    DB      04h, 06h, 08h, 0Ch, 10h, 18h, 20h, 30h, 40h, 60h, 80h, 0A0h
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   572

                             , 0C0h
0084 10182030                
0088 406080A0                
008C C0                      
                   37058     
                   37059     
                   37060     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   37061     ;
                   37062     ; Timer 0 interrupt routine
                   37063     ;
                   37064     ; No assumptions
                   37065     ;
                   37066     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   37067     IF MCU_48MHZ >= 1
008D               37068     t0_int:
008D 0540          37069             inc     Timer0_X
008F 32            37070             reti
                   37071     ENDIF
                   37072     
                   37073     
                   37074     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   37075     ;
                   37076     ; Timer 1 interrupt routine
                   37077     ;
                   37078     ; No assumptions
                   37079     ;
                   37080     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0090               37081     t1_int:
0090 C2AF          37082             clr     IE_EA
0092 C2A8          37083             clr     IE_EX0                  ; Disable int0 interrupts
0094 53E6EF        37084             anl     EIE1, #0EFh             ; Disable pca interrupts
0097 C28E          37085             clr     TCON_TR1                        ; Stop timer 1
0099 856B8B        37086             mov     TL1, DShot_Timer_Preset ; Reset sync timer
009C C0D0          37087             push    PSW
009E D2D3          37088             setb    PSW.3                   ; Select register bank 1 for this interrupt
00A0 C0E0          37089             push    ACC
00A2 C0F0          37090             push    B                               ; Will be pop'ed by int0 exit
00A4 C2CA          37091             clr     TMR2CN0_TR2             ; Timer 2 disabled
00A6 A8CC          37092             mov     Temp1, TMR2L            ; Read timer value
00A8 A9CD          37093             mov     Temp2, TMR2H
00AA D2CA          37094             setb    TMR2CN0_TR2             ; Timer 2 enabled
00AC D2AF          37095             setb    IE_EA
                   37096             ; Reset timer 0
00AE 758A00        37097             mov     TL0, #0
                   37098             ; Check frame time length
00B1 C3            37099             clr     C
00B2 E8            37100             mov     A, Temp1
00B3 956C          37101             subb    A, DShot_Frame_Start_L
00B5 F8            37102             mov     Temp1, A
00B6 E9            37103             mov     A, Temp2
00B7 956D          37104             subb    A, DShot_Frame_Start_H
00B9 F9            37105             mov     Temp2, A
                   37106             ; Divide by 2 (or 4 for 48MHz). Unit is then us
00BA C3            37107             clr     C
00BB E9            37108             mov     A, Temp2
00BC 13            37109             rrc     A
00BD F9            37110             mov     Temp2, A
00BE E8            37111             mov     A, Temp1
00BF 13            37112             rrc     A
00C0 F8            37113             mov     Temp1, A
00C1 E566          37114             mov     A, Clock_Set_At_48MHz
00C3 6007          37115             jz      t1_int_frame_time_scaled
                   37116     
00C5 C3            37117             clr     C
00C6 E9            37118             mov     A, Temp2
00C7 13            37119             rrc     A
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   573

00C8 F9            37120             mov     Temp2, A
00C9 E8            37121             mov     A, Temp1
00CA 13            37122             rrc     A
00CB F8            37123             mov     Temp1, A
                   37124     
00CC               37125     t1_int_frame_time_scaled:
00CC E9            37126             mov     A, Temp2
00CD 7025          37127             jnz     t1_int_msb_fail ; Frame too long
00CF E8            37128             mov     A, Temp1
00D0 956E          37129             subb    A, DShot_Frame_Length_Thr
00D2 4020          37130             jc      t1_int_msb_fail ; Frame too short
00D4 956E          37131             subb    A, DShot_Frame_Length_Thr
00D6 501C          37132             jnc     t1_int_msb_fail ; Frame too long
                   37133     
                   37134             ; Check that correct number of pulses is received
00D8 E582          37135             mov     A, DPL                  ; Read current pointer
00DA B41017        37136             cjne    A, #16, t1_int_msb_fail
                   37137     
                   37138             ; Decode transmitted data
00DD 7C00          37139             mov     Temp5, #0                       ; Reset timestamp
00DF 7B00          37140             mov     Temp4, #0                       ; High byte of receive buffer
00E1 7A00          37141             mov     Temp3, #0                       ; Low byte of receive buffer
00E3 7908          37142             mov     Temp2, #8                       ; Number of bits per byte
00E5 900000        37143             mov     DPTR, #0                        ; Set pointer
00E8 A86A          37144             mov     Temp1, DShot_Pwm_Thr; DShot pulse width criteria
00EA E566          37145             mov     A, Clock_Set_At_48MHz
00EC 7004          37146             jnz     t1_int_decode
                   37147     
00EE C3            37148             clr     C
00EF E8            37149             mov     A, Temp1                        ; Scale pulse width criteria
00F0 13            37150             rrc     A
00F1 F8            37151             mov     Temp1, A
                   37152     
00F2               37153     t1_int_decode:
00F2 01FD          37154             ajmp    t1_int_decode_msb
                   37155     
00F4               37156     t1_int_msb_fail:
00F4 900000        37157             mov     DPTR, #0                        ; Set pointer to start
00F7 D2A8          37158             setb    IE_EX0                  ; Enable int0 interrupts
00F9 D2AA          37159             setb    IE_EX1                  ; Enable int1 interrupts
00FB 61E7          37160             ajmp int0_int_outside_range
                   37161     
00FD               37162     t1_int_decode_msb:
                   37163             ; Decode DShot data Msb. Use more code space to save time (by not using loop)
                   37164             Decode_DShot_2Msb
                   37191             Decode_DShot_2Msb
                   37218             Decode_DShot_2Msb
                   37245             Decode_DShot_2Msb
016D 2178          37272             ajmp    t1_int_decode_lsb
                   37273     
016F               37274     t1_int_lsb_fail:
016F 900000        37275             mov     DPTR, #0                        ; Set pointer to start
0172 D2A8          37276             setb    IE_EX0                  ; Enable int0 interrupts
0174 D2AA          37277             setb    IE_EX1                  ; Enable int1 interrupts
0176 61E7          37278             ajmp int0_int_outside_range
                   37279     
0178               37280     t1_int_decode_lsb:
                   37281             ; Decode DShot data Lsb
                   37282             Decode_DShot_2Lsb
                   37309             Decode_DShot_2Lsb
                   37336             Decode_DShot_2Lsb
                   37363             Decode_DShot_2Lsb
                   37390             ; XOR check (in inverted data, which is ok)
01E8 EB            37391             mov     A, Temp4
01E9 C4            37392             swap    A
01EA 6B            37393             xrl     A, Temp4
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   574

01EB 6A            37394             xrl     A, Temp3
01EC 54F0          37395             anl     A, #0F0h
01EE F9            37396             mov     Temp2, A
01EF EA            37397             mov     A, Temp3
01F0 C4            37398             swap    A
01F1 54F0          37399             anl     A, #0F0h
01F3 C3            37400             clr     C
01F4 99            37401             subb    A, Temp2
01F5 6009          37402             jz      t1_int_xor_ok           ; XOR check
                   37403     
01F7 900000        37404             mov     DPTR, #0                        ; Set pointer to start
01FA D2A8          37405             setb    IE_EX0                  ; Enable int0 interrupts
01FC D2AA          37406             setb    IE_EX1                  ; Enable int1 interrupts
01FE 61E7          37407             ajmp int0_int_outside_range
                   37408     
0200               37409     t1_int_xor_ok:
                   37410             ; Swap to be LSB aligned to 12 bits (and invert)
0200 EB            37411             mov     A, Temp4
0201 F4            37412             cpl     A
0202 C4            37413             swap A
0203 54F0          37414             anl     A, #0F0h                        ; Low nibble of high byte
0205 F9            37415             mov     Temp2, A
0206 EA            37416             mov     A, Temp3
0207 F4            37417             cpl     A
0208 C4            37418             swap    A
0209 540F          37419             anl     A, #0Fh                 ; High nibble of low byte 
020B 49            37420             orl     A, Temp2
020C FA            37421             mov     Temp3, A
020D EB            37422             mov     A, Temp4                        ; High nibble of high byte
020E F4            37423             cpl     A
020F C4            37424             swap A
0210 540F          37425             anl     A, #0Fh
0212 FB            37426             mov     Temp4, A
                   37427             ; Subtract 96 (still 12 bits)
0213 C3            37428             clr     C
0214 EA            37429             mov     A, Temp3
0215 F9            37430             mov     Temp2, A
0216 9460          37431             subb    A, #96
0218 FA            37432             mov     Temp3, A
0219 EB            37433             mov     A, Temp4
021A 9400          37434             subb    A, #0
021C FB            37435             mov     Temp4, A
021D 5020          37436             jnc     t1_normal_range
                   37437     
021F C3            37438             clr     C       
0220 E9            37439             mov     A, Temp2                ; Check for 0 or dshot command
0221 7B00          37440             mov     Temp4, #0
0223 7A00          37441             mov     Temp3, #0
0225 7900          37442             mov     Temp2, #0
0227 6016          37443             jz      t1_normal_range
                   37444             
0229 C3            37445             clr     C                               ; We are in the special dshot range
022A 13            37446             rrc     A                               ; Divide by 2
022B 5006          37447             jnc     t1_dshot_set_cmd        ; Check for tlm bit set (if not telemetry, Temp2 wi
                             ll be zero and result in invalid command)
                   37448     
022D F9            37449             mov     Temp2, A
022E C3            37450             clr     C
022F 9552          37451             subb A, Dshot_Cmd
0231 600A          37452             jz      t1_dshot_inc_cmd_cnt
                   37453     
0233               37454     t1_dshot_set_cmd:
0233 E9            37455             mov     A, Temp2
0234 F552          37456             mov     Dshot_Cmd, A
0236 755300        37457             mov     Dshot_Cmd_Cnt, #0
0239 7900          37458             mov     Temp2, #0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   575

023B 8002          37459             jmp     t1_normal_range
                   37460             
023D               37461     t1_dshot_inc_cmd_cnt:
023D 0553          37462             inc     Dshot_Cmd_Cnt
                   37463             
023F               37464     t1_normal_range:
                   37465             ; Check for bidirectional operation (0=stop, 96-2095->fwd, 2096-4095->rev)
023F 303A27        37466             jnb     Flags3.PGM_BIDIR, t1_int_not_bidir      ; If not bidirectional operation - 
                             branch
                   37467     
                   37468             ; Subtract 2000 (still 12 bits)
0242 C3            37469             clr     C
0243 EA            37470             mov     A, Temp3
0244 94D0          37471             subb    A, #0D0h
0246 F8            37472             mov     Temp1, A
0247 EB            37473             mov     A, Temp4
0248 9407          37474             subb    A, #07h
024A F9            37475             mov     Temp2, A
024B 400B          37476             jc      t1_int_bidir_fwd                                ; If result is negative - b
                             ranch
                   37477     
024D E8            37478             mov     A, Temp1
024E FA            37479             mov     Temp3, A
024F E9            37480             mov     A, Temp2
0250 FB            37481             mov     Temp4, A
0251 203509        37482             jb      Flags2.RCP_DIR_REV, t1_int_bidir_rev_chk        ; If same direction - branch
                   37483     
0254 D235          37484             setb    Flags2.RCP_DIR_REV
0256 415D          37485             ajmp    t1_int_bidir_rev_chk
                   37486     
0258               37487     t1_int_bidir_fwd:
0258 303502        37488             jnb     Flags2.RCP_DIR_REV, t1_int_bidir_rev_chk        ; If same direction - branch
                   37489     
025B C235          37490             clr     Flags2.RCP_DIR_REV
                   37491     
025D               37492     t1_int_bidir_rev_chk:
025D 203902        37493             jb      Flags3.PGM_BIDIR_REV, ($+5)
                   37494     
0260 B235          37495             cpl     Flags2.RCP_DIR_REV
                   37496     
0262 C3            37497             clr     C                                                       ; Multiply throttle
                              value by 2
0263 EA            37498             mov     A, Temp3
0264 33            37499             rlc     A
0265 FA            37500             mov     Temp3, A
0266 EB            37501             mov     A, Temp4
0267 33            37502             rlc     A
0268 FB            37503             mov     Temp4, A
0269               37504     t1_int_not_bidir:
                   37505             ; Generate 4/256
0269 EB            37506             mov     A, Temp4
026A 2B            37507             add     A, Temp4
026B 3B            37508             addc    A, Temp4
026C 3B            37509             addc    A, Temp4
026D F9            37510             mov     Temp2, A
                   37511             ; Align to 11 bits
026E C3            37512             clr     C
026F EB            37513             mov     A, Temp4
0270 13            37514             rrc     A
0271 FB            37515             mov     Temp4, A
0272 EA            37516             mov     A, Temp3
0273 13            37517             rrc     A
0274 FA            37518             mov     Temp3, A
                   37519             ; Scale from 2000 to 2048
0275 EA            37520             mov     A, Temp3
0276 29            37521             add     A, Temp2        ; Holds 4/128
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   576

0277 FA            37522             mov     Temp3, A
0278 EB            37523             mov     A, Temp4
0279 3400          37524             addc    A, #0
027B FB            37525             mov     Temp4, A
027C 30E304        37526             jnb     ACC.3, ($+7)
                   37527     
027F 7AFF          37528             mov     Temp3, #0FFh
0281 7BFF          37529             mov     Temp4, #0FFh
                   37530     
                   37531             ; Boost pwm during direct start
0283 E525          37532             mov     A, Flags1
0285 5403          37533             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
0287 601B          37534             jz      t1_int_startup_boosted
                   37535     
0289 202A18        37536             jb      Flags1.MOTOR_STARTED, t1_int_startup_boosted    ; Do not boost when changin
                             g direction in bidirectional mode
                   37537     
028C E55D          37538             mov     A, Pwm_Limit_Beg                                ; Set 25% of max startup po
                             wer as minimum power
028E 33            37539             rlc     A
028F F9            37540             mov     Temp2, A
0290 EB            37541             mov     A, Temp4
0291 7007          37542             jnz     t1_int_startup_boost_stall
                   37543     
0293 C3            37544             clr     C
0294 E9            37545             mov     A, Temp2
0295 9A            37546             subb    A, Temp3
0296 4002          37547             jc      t1_int_startup_boost_stall
                   37548     
0298 E9            37549             mov     A, Temp2
0299 FA            37550             mov     Temp3, A
                   37551     
029A               37552     t1_int_startup_boost_stall:
029A E53C          37553             mov     A, Stall_Cnt                                    ; Add an extra power boost 
                             during start
029C C4            37554             swap    A
029D 33            37555             rlc     A
029E 2A            37556             add     A, Temp3
029F FA            37557             mov     Temp3, A
02A0 EB            37558             mov     A, Temp4
02A1 3400          37559             addc    A, #0
02A3 FB            37560             mov     Temp4, A
                   37561     
02A4               37562     t1_int_startup_boosted:
                   37563             ; Set 8bit value
02A4 C3            37564             clr     C
02A5 EA            37565             mov     A, Temp3
02A6 33            37566             rlc     A
02A7 C4            37567             swap    A
02A8 540F          37568             anl     A, #0Fh
02AA F8            37569             mov     Temp1, A
02AB EB            37570             mov     A, Temp4
02AC 33            37571             rlc     A
02AD C4            37572             swap    A
02AE 54F0          37573             anl     A, #0F0h
02B0 48            37574             orl     A, Temp1
02B1 F8            37575             mov     Temp1, A
02B2 7005          37576             jnz     t1_int_zero_rcp_checked ; New_Rcp (Temp1) is only zero if all 11 bits are z
                             ero
                   37577     
02B4 EA            37578             mov     A, Temp3
02B5 6002          37579             jz      t1_int_zero_rcp_checked
                   37580     
02B7 7801          37581             mov     Temp1, #1
                   37582     
02B9               37583     t1_int_zero_rcp_checked:
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   577

                   37584             ; Align to 10 bits for 24MHz MCU
                   37585     IF MCU_48MHZ == 0
                                     clr     C
                                     mov     A, Temp4
                                     rrc     A
                                     mov     Temp4, A
                                     mov     A, Temp3
                                     rrc     A
                                     mov     Temp3, A
                             ENDIF
02B9 900000        37594             mov     DPTR, #0                                        ; Set pointer to start
02BC D2A8          37595             setb    IE_EX0                                  ; Enable int0 interrupts
02BE D2AA          37596             setb    IE_EX1                                  ; Enable int1 interrupts
                   37597             ; Decrement outside range counter
02C0 E522          37598             mov     A, Rcp_Outside_Range_Cnt
02C2 6002          37599             jz      ($+4)
                   37600     
02C4 1522          37601             dec     Rcp_Outside_Range_Cnt
                   37602     
02C6 81D4          37603             ajmp    int0_int_pulse_ready
                   37604     
02C8               37605     t1_int_frame_fail:
02C8 900000        37606             mov     DPTR, #0                                        ; Set pointer to start
02CB D2A8          37607             setb    IE_EX0                                  ; Enable int0 interrupts
02CD D2AA          37608             setb    IE_EX1                                  ; Enable int1 interrupts
02CF 61E7          37609             ajmp int0_int_outside_range
                   37610     
                   37611     
                   37612     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   37613     ;
                   37614     ; Timer 2 interrupt routine
                   37615     ;
                   37616     ; No assumptions
                   37617     ; Requirements: Temp variables can NOT be used since PSW.x is not set
                   37618     ;
                   37619     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
02D1               37620     t2_int: ; Happens every 32ms
02D1 C0D0          37621             push    PSW                     ; Preserve registers through interrupt
02D3 C0E0          37622             push    ACC
02D5 C2CF          37623             clr     TMR2CN0_TF2H                            ; Clear interrupt flag
02D7 0541          37624             inc     Timer2_X
                   37625     IF MCU_48MHZ >= 1
02D9 E566          37626             mov     A, Clock_Set_At_48MHz
02DB 6009          37627             jz      t2_int_start
                   37628     
                   37629             ; Check skip variable
02DD E565          37630             mov     A, Skip_T2_Int
02DF 6005          37631             jz      t2_int_start                            ; Execute this interrupt
                   37632     
02E1 756500        37633             mov     Skip_T2_Int, #0
02E4 6104          37634             ajmp    t2_int_exit
                   37635     
02E6               37636     t2_int_start:
02E6 756501        37637             mov     Skip_T2_Int, #1                 ; Skip next interrupt
                   37638     ENDIF
                   37639             ; Update RC pulse timeout counter 
02E9 E523          37640             mov     A, Rcp_Timeout_Cntd                     ; RC pulse timeout count zero?
02EB 6002          37641             jz      ($+4)                                   ; Yes - do not decrement
                   37642     
02ED 1523          37643             dec     Rcp_Timeout_Cntd                        ; No decrement
                   37644     
                   37645             ; Check RC pulse against stop value
02EF C3            37646             clr     C
02F0 E554          37647             mov     A, New_Rcp                              ; Load new pulse value
02F2 6005          37648             jz      t2_int_rcp_stop                 ; Check if pulse is below stop value
                   37649     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   578

                   37650             ; RC pulse higher than stop value, reset stop counter
02F4 755500        37651             mov     Rcp_Stop_Cnt, #0                        ; Reset rcp stop counter
02F7 6104          37652             ajmp    t2_int_exit
                   37653     
02F9               37654     t2_int_rcp_stop:
                   37655             ; RC pulse less than stop value
02F9 E555          37656             mov     A, Rcp_Stop_Cnt                 ; Increment stop counter
02FB 2401          37657             add     A, #1
02FD F555          37658             mov     Rcp_Stop_Cnt, A
02FF 5003          37659             jnc     ($+5)                                   ; Branch if counter has not wrapped
                   37660     
0301 7555FF        37661             mov     Rcp_Stop_Cnt, #0FFh                     ; Set stop counter to max
                   37662     
0304               37663     t2_int_exit:
0304 D0E0          37664             pop     ACC                     ; Restore preserved registers
0306 D0D0          37665             pop     PSW
0308 32            37666             reti
                   37667     
                   37668     
                   37669     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   37670     ;
                   37671     ; Timer 3 interrupt routine
                   37672     ;
                   37673     ; No assumptions
                   37674     ; Requirements: Temp variables can NOT be used since PSW.x is not set
                   37675     ;               ACC can not be used, as it is not pushed to stack
                   37676     ;
                   37677     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0309               37678     t3_int: ; Used for commutation timing
0309 C2AF          37679             clr     IE_EA                   ; Disable all interrupts
030B 53E67F        37680             anl     EIE1, #7Fh              ; Disable timer 3 interrupts
030E 7592FA        37681             mov     TMR3RLL, #0FAh          ; Set a short delay before next interrupt
0311 7593FF        37682             mov     TMR3RLH, #0FFh
0314 C220          37683             clr     Flags0.T3_PENDING       ; Flag that timer has wrapped
0316 53917F        37684             anl     TMR3CN0, #07Fh          ; Timer 3 interrupt flag cleared
0319 D2AF          37685             setb    IE_EA                   ; Enable all interrupts
031B 32            37686             reti
                   37687     
                   37688     
                   37689     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   37690     ;
                   37691     ; Int0 interrupt routine
                   37692     ;
                   37693     ; No assumptions
                   37694     ;
                   37695     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
031C               37696     int0_int:       ; Used for RC pulse timing
031C C0E0          37697             push    ACC
031E E58A          37698             mov     A, TL0                  ; Read pwm for DShot immediately
                   37699             ; Test for DShot
0320 303408        37700             jnb     Flags2.RCP_DSHOT, int0_int_not_dshot
                   37701     
0323 856B8B        37702             mov     TL1, DShot_Timer_Preset ; Reset sync timer
0326 F0            37703             movx    @DPTR, A                        ; Store pwm
0327 A3            37704             inc     DPTR
0328 D0E0          37705             pop     ACC
032A 32            37706             reti
                   37707     
                   37708             ; Not DShot
032B               37709     int0_int_not_dshot:
032B D0E0          37710             pop     ACC
032D C2AF          37711             clr     IE_EA
032F 53E6EF        37712             anl     EIE1, #0EFh             ; Disable pca interrupts
0332 C0D0          37713             push    PSW                             ; Preserve registers through interrupt
0334 C0E0          37714             push    ACC
0336 C0F0          37715             push    B
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   579

0338 D2D3          37716             setb    PSW.3                   ; Select register bank 1 for this interrupt 
033A D2AF          37717             setb    IE_EA
                   37718             ; Get the counter values
                   37719             Get_Rcp_Capture_Values
                   37749             ; Scale down to 10 bits (for 24MHz, and 11 bits for 48MHz)
0363 30331F        37750             jnb     Flags2.RCP_MULTISHOT, int0_int_fall_not_multishot
                   37751     
                   37752             ; Multishot - Multiply by 2 and add 1/16 and 1/32
0366 E8            37753             mov     A, Temp1                ; Divide by 16
0367 C4            37754             swap A
0368 540F          37755             anl     A, #0Fh
036A FA            37756             mov     Temp3, A
036B E9            37757             mov     A, Temp2
036C C4            37758             swap    A
036D 54F0          37759             anl     A, #0F0h
036F 4A            37760             orl     A, Temp3
0370 FA            37761             mov     Temp3, A
0371 C3            37762             clr     C                       ; Make divided by 32
0372 13            37763             rrc     A
0373 2A            37764             add     A, Temp3                ; Add 1/16 to 1/32
0374 FA            37765             mov     Temp3, A
0375 C3            37766             clr     C                       ; Multiply by 2
0376 E8            37767             mov     A, Temp1
0377 33            37768             rlc     A
0378 F8            37769             mov     Temp1, A
0379 E9            37770             mov     A, Temp2
037A 33            37771             rlc     A
037B F9            37772             mov     Temp2, A
037C E8            37773             mov     A, Temp1                ; Add 1/16 and 1/32
037D 2A            37774             add     A, Temp3
037E FA            37775             mov     Temp3, A
037F E9            37776             mov     A, Temp2
                   37777     IF MCU_48MHZ == 0
                                     addc    A, #03h         ; Add to low end, to make signal look like 20-40us
                             ELSE
0380 3406          37780             addc    A, #06h
                   37781     ENDIF
0382 FB            37782             mov     Temp4, A
0383 61D8          37783             ajmp    int0_int_fall_gain_done
                   37784     
0385               37785     int0_int_fall_not_multishot:
0385 30320F        37786             jnb     Flags2.RCP_ONESHOT42, int0_int_fall_not_oneshot_42
                   37787     
                   37788             ; Oneshot42 - Add 2/256
0388 C3            37789             clr     C
0389 E8            37790             mov     A, Temp1
038A 33            37791             rlc     A
038B E9            37792             mov     A, Temp2
038C 33            37793             rlc     A
038D FA            37794             mov     Temp3, A
038E E8            37795             mov     A, Temp1
038F 2A            37796             add     A, Temp3
0390 FA            37797             mov     Temp3, A
0391 E9            37798             mov     A, Temp2
0392 3400          37799             addc    A, #0
0394 FB            37800             mov     Temp4, A
0395 61D8          37801             ajmp    int0_int_fall_gain_done
                   37802     
0397               37803     int0_int_fall_not_oneshot_42:
0397 303115        37804             jnb     Flags2.RCP_ONESHOT125, int0_int_fall_not_oneshot_125
                   37805     
                   37806             ; Oneshot125 - multiply by 86/256
039A E8            37807             mov     A, Temp1                ; Multiply by 86 and divide by 256
039B 75F056        37808             mov     B, #56h
039E A4            37809             mul     AB
039F AAF0          37810             mov     Temp3, B
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   580

03A1 E9            37811             mov     A, Temp2
03A2 75F056        37812             mov     B, #56h
03A5 A4            37813             mul     AB
03A6 2A            37814             add     A, Temp3
03A7 FA            37815             mov     Temp3, A
03A8 C5F0          37816             xch     A, B
03AA 3400          37817             addc    A, #0
03AC FB            37818             mov     Temp4, A
03AD 61D8          37819             ajmp    int0_int_fall_gain_done
                   37820     
03AF               37821     int0_int_fall_not_oneshot_125:
                   37822             ; Regular signal - multiply by 43/1024
                   37823     IF MCU_48MHZ >= 1
03AF C3            37824             clr     C
03B0 EA            37825             mov     A, Temp3                ; Divide by 2
03B1 13            37826             rrc     A
03B2 FA            37827             mov     Temp3, A
03B3 E9            37828             mov     A, Temp2
03B4 13            37829             rrc     A
03B5 F9            37830             mov     Temp2, A
03B6 E8            37831             mov     A, Temp1
03B7 13            37832             rrc     A
03B8 F8            37833             mov     Temp1, A
                   37834     ENDIF
03B9 E8            37835             mov     A, Temp1                ; Multiply by 43 and divide by 1024
                   37836     IF MCU_48MHZ == 0
                                     mov     B, #2Bh
                             ELSE
03BA 75F056        37839             mov     B, #56h         ; Multiply by 86
                   37840     ENDIF
03BD A4            37841             mul     AB
03BE AAF0          37842             mov     Temp3, B
03C0 E9            37843             mov     A, Temp2
                   37844     IF MCU_48MHZ == 0
                                     mov     B, #2Bh
                             ELSE
03C1 75F056        37847             mov     B, #56h         ; Multiply by 86
                   37848     ENDIF
03C4 A4            37849             mul     AB
03C5 2A            37850             add     A, Temp3
03C6 FA            37851             mov     Temp3, A
03C7 C5F0          37852             xch     A, B
03C9 3400          37853             addc    A, #0
03CB C3            37854             clr     C       
03CC 13            37855             rrc     A                       ; Divide by 2 for total 512
03CD FB            37856             mov     Temp4, A
03CE EA            37857             mov     A, Temp3
03CF 13            37858             rrc     A
03D0 FA            37859             mov     Temp3, A
03D1 C3            37860             clr     C
03D2 EB            37861             mov     A, Temp4                ; Divide by 2 for total 1024
03D3 13            37862             rrc     A                                               
03D4 FB            37863             mov     Temp4, A
03D5 EA            37864             mov     A, Temp3
03D6 13            37865             rrc     A
03D7 FA            37866             mov     Temp3, A
                   37867     
03D8               37868     int0_int_fall_gain_done:
                   37869             ; Check if 2235us or above (in order to ignore false pulses)
03D8 C3            37870             clr     C
03D9 EB            37871             mov     A, Temp4                                                ; Is pulse 2235us o
                             r higher?
                   37872     IF MCU_48MHZ == 0
                                     subb A, #09h
                             ELSE
03DA 9412          37875             subb A, #12h
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   581

                   37876     ENDIF
03DC 5009          37877             jnc     int0_int_outside_range                  ; Yes - ignore pulse
                   37878     
                   37879             ; Check if below 900us (in order to ignore false pulses)
03DE C3            37880             clr     C
03DF EA            37881             mov     A, Temp3
                   37882     IF MCU_48MHZ == 0
                                     subb A, #9Ah
                             ELSE
03E0 9434          37885             subb A, #34h
                   37886     ENDIF
03E2 EB            37887             mov     A, Temp4
                   37888     IF MCU_48MHZ == 0
                                     subb A, #03h
                             ELSE
03E3 9407          37891             subb A, #07h
                   37892     ENDIF
03E5 5016          37893             jnc     int0_int_check_full_range               ; No - proceed
                   37894     
03E7               37895     int0_int_outside_range:
03E7 0522          37896             inc     Rcp_Outside_Range_Cnt
03E9 E522          37897             mov     A, Rcp_Outside_Range_Cnt
03EB 7002          37898             jnz     ($+4)
                   37899     
03ED 1522          37900             dec     Rcp_Outside_Range_Cnt
                   37901     
03EF C3            37902             clr     C
03F0 E522          37903             mov     A, Rcp_Outside_Range_Cnt
03F2 9432          37904             subb    A, #50                                          ; Allow a given number of o
                             utside pulses
03F4 5002          37905             jnc     ($+4)
03F6 A128          37906             ajmp    int0_int_set_timeout                    ; If outside limits - ignore first 
                             pulses
                   37907     
03F8 755400        37908             mov     New_Rcp, #0                                     ; Set pulse length to zero
03FB A12B          37909             ajmp    int0_int_exit                                   ; Exit without reseting tim
                             eout
                   37910     
03FD               37911     int0_int_check_full_range:
                   37912             ; Decrement outside range counter
03FD E522          37913             mov     A, Rcp_Outside_Range_Cnt
03FF 6002          37914             jz      ($+4)
                   37915     
0401 1522          37916             dec     Rcp_Outside_Range_Cnt
                   37917     
                   37918             ; Calculate "1000us" plus throttle minimum
0403 303606        37919             jnb     Flags2.RCP_FULL_RANGE, int0_int_set_min ; Check if full range is chosen
                   37920     
0406 7C00          37921             mov     Temp5, #0                                               ; Set 1000us as def
                             ault minimum
                   37922     IF MCU_48MHZ == 0
                                     mov     Temp6, #4
                             ELSE
0408 7D08          37925             mov     Temp6, #8
                   37926     ENDIF
040A 8117          37927             ajmp    int0_int_calculate
                   37928     
040C               37929     int0_int_set_min:
040C AC31          37930             mov     Temp5, Min_Throttle_L                   ; Min throttle value scaled
040E AD32          37931             mov     Temp6, Min_Throttle_H
0410 303A04        37932             jnb     Flags3.PGM_BIDIR, ($+7)
                   37933     
0413 AC33          37934             mov     Temp5, Center_Throttle_L                        ; Center throttle value sca
                             led
0415 AD34          37935             mov     Temp6, Center_Throttle_H
                   37936     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   582

0417               37937     int0_int_calculate:
0417 C3            37938             clr     C
0418 EA            37939             mov     A, Temp3                                                ; Subtract minimum
0419 9C            37940             subb    A, Temp5
041A FA            37941             mov     Temp3, A
041B EB            37942             mov     A, Temp4                                        
041C 9D            37943             subb    A, Temp6
041D FB            37944             mov     Temp4, A
041E 9208          37945             mov     Bit_Access_Int.0, C
0420 AE60          37946             mov     Temp7, Throttle_Gain                            ; Load Temp7/Temp8 with thr
                             ottle gain
0422 AF61          37947             mov     Temp8, Throttle_Gain_M
0424 303A42        37948             jnb     Flags3.PGM_BIDIR, int0_int_not_bidir    ; If not bidirectional operation - 
                             branch
                   37949     
0427 5007          37950             jnc     int0_int_bidir_fwd                                      ; If result is posi
                             tive - branch
                   37951     
0429 203509        37952             jb      Flags2.RCP_DIR_REV, int0_int_bidir_rev_chk      ; If same direction - branch
                   37953     
042C D235          37954             setb    Flags2.RCP_DIR_REV
042E 8135          37955             ajmp    int0_int_bidir_rev_chk
                   37956     
0430               37957     int0_int_bidir_fwd:
0430 303502        37958             jnb     Flags2.RCP_DIR_REV, int0_int_bidir_rev_chk      ; If same direction - branch
                   37959     
0433 C235          37960             clr     Flags2.RCP_DIR_REV
                   37961     
0435               37962     int0_int_bidir_rev_chk:
0435 303504        37963             jnb     Flags2.RCP_DIR_REV, ($+7)
                   37964     
0438 AE62          37965             mov     Temp7, Throttle_Gain_BD_Rev             ; Load Temp7/Temp8 with throttle ga
                             in for bidirectional reverse
043A AF63          37966             mov     Temp8, Throttle_Gain_BD_Rev_M
                   37967     
043C 203902        37968             jb      Flags3.PGM_BIDIR_REV, ($+5)
                   37969     
043F B235          37970             cpl     Flags2.RCP_DIR_REV
                   37971     
0441 C3            37972             clr     C                                                       ; Multiply throttle
                              value by 2
0442 EA            37973             mov     A, Temp3
0443 33            37974             rlc     A
0444 FA            37975             mov     Temp3, A
0445 EB            37976             mov     A, Temp4
0446 33            37977             rlc     A
0447 FB            37978             mov     Temp4, A
0448 A208          37979             mov     C, Bit_Access_Int.0
044A 500A          37980             jnc     int0_int_bidir_do_deadband              ; If result is positive - branch
                   37981     
044C EA            37982             mov     A, Temp3                                                ; Change sign
044D F4            37983             cpl     A
044E 2401          37984             add     A, #1
0450 FA            37985             mov     Temp3, A
0451 EB            37986             mov     A, Temp4
0452 F4            37987             cpl     A
0453 3400          37988             addc    A, #0
0455 FB            37989             mov     Temp4, A
                   37990     
0456               37991     int0_int_bidir_do_deadband:
0456 C3            37992             clr     C                                                       ; Subtract deadband
0457 EA            37993             mov     A, Temp3
                   37994     IF MCU_48MHZ == 0
                                     subb    A, #40
                             ELSE
0458 9450          37997             subb    A, #80
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   583

                   37998     ENDIF
045A FA            37999             mov     Temp3, A
045B EB            38000             mov     A, Temp4
045C 9400          38001             subb    A, #0
045E FB            38002             mov     Temp4, A
045F 5014          38003             jnc     int0_int_do_throttle_gain
                   38004     
0461 7800          38005             mov     Temp1, #0
0463 7A00          38006             mov     Temp3, #0
0465 7B00          38007             mov     Temp4, #0
0467 8175          38008             ajmp    int0_int_do_throttle_gain
                   38009     
0469               38010     int0_int_not_bidir:
0469 A208          38011             mov     C, Bit_Access_Int.0
046B 5008          38012             jnc     int0_int_do_throttle_gain               ; If result is positive - branch
                   38013     
046D               38014     int0_int_unidir_neg:
046D 7800          38015             mov     Temp1, #0                                               ; Yes - set to mini
                             mum
046F 7A00          38016             mov     Temp3, #0
0471 7B00          38017             mov     Temp4, #0
0473 81D4          38018             ajmp    int0_int_pulse_ready
                   38019     
0475               38020     int0_int_do_throttle_gain:
                   38021             ; Boost pwm during direct start
0475 E525          38022             mov     A, Flags1
0477 5403          38023             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
0479 601B          38024             jz      int0_int_startup_boosted
                   38025     
047B 202A18        38026             jb      Flags1.MOTOR_STARTED, int0_int_startup_boosted  ; Do not boost when changin
                             g direction in bidirectional mode
                   38027     
047E E55D          38028             mov     A, Pwm_Limit_Beg                                ; Set 25% of max startup po
                             wer as minimum power
                   38029     IF MCU_48MHZ >= 1
0480 33            38030             rlc     A
                   38031     ENDIF
0481 F9            38032             mov     Temp2, A
0482 EB            38033             mov     A, Temp4
0483 7007          38034             jnz     int0_int_startup_boost_stall
                   38035     
0485 C3            38036             clr     C
0486 E9            38037             mov     A, Temp2
0487 9A            38038             subb    A, Temp3
0488 4002          38039             jc      int0_int_startup_boost_stall
                   38040     
048A E9            38041             mov     A, Temp2
048B FA            38042             mov     Temp3, A
                   38043     
048C               38044     int0_int_startup_boost_stall:
048C E53C          38045             mov     A, Stall_Cnt                                    ; Add an extra power boost 
                             during start
048E C4            38046             swap    A
                   38047     IF MCU_48MHZ >= 1
048F 33            38048             rlc     A
                   38049     ENDIF
0490 2A            38050             add     A, Temp3
0491 FA            38051             mov     Temp3, A
0492 EB            38052             mov     A, Temp4
0493 3400          38053             addc    A, #0
0495 FB            38054             mov     Temp4, A
                   38055     
0496               38056     int0_int_startup_boosted:
0496 EA            38057             mov     A, Temp3                                                ; Multiply throttle
                              value by throttle gain
0497 8EF0          38058             mov     B, Temp7                                                ; Temp7 has Throttl
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   584

                             e_Gain
0499 A4            38059             mul     AB
049A F9            38060             mov     Temp2, A
049B AAF0          38061             mov     Temp3, B
049D EB            38062             mov     A, Temp4
049E 8EF0          38063             mov     B, Temp7                                                ; Temp7 has Throttl
                             e_Gain
04A0 A4            38064             mul     AB
04A1 2A            38065             add     A, Temp3
04A2 FA            38066             mov     Temp3, A
04A3 C5F0          38067             xch     A, B
04A5 3400          38068             addc    A, #0
04A7 FB            38069             mov     Temp4, A
04A8 C3            38070             clr     C                                                       ; Generate 8bit num
                             ber
04A9 EB            38071             mov     A, Temp4
04AA 13            38072             rrc     A
04AB FD            38073             mov     Temp6, A
04AC EA            38074             mov     A, Temp3
04AD 13            38075             rrc     A
04AE F8            38076             mov     Temp1, A
                   38077     IF MCU_48MHZ >= 1
04AF C3            38078             clr     C
04B0 ED            38079             mov     A, Temp6
04B1 13            38080             rrc     A
04B2 FD            38081             mov     Temp6, A
04B3 E8            38082             mov     A, Temp1
04B4 13            38083             rrc     A
04B5 F8            38084             mov     Temp1, A
                   38085     ENDIF
04B6 0F            38086             inc     Temp8                                           ; Temp8 has Throttle_Gain_M
04B7               38087     int0_int_gain_loop:
04B7 EF            38088             mov     A, Temp8
04B8 14            38089             dec     A
04B9 6004          38090             jz      int0_int_gain_rcp_done                  ; Skip one multiply by 2 of New_Rcp
                   38091     
04BB C3            38092             clr     C
04BC E8            38093             mov     A, Temp1                                                ; Multiply New_Rcp 
                             by 2
04BD 33            38094             rlc     A
04BE F8            38095             mov     Temp1, A
                   38096     
04BF               38097     int0_int_gain_rcp_done:
04BF C3            38098             clr     C
04C0 E9            38099             mov     A, Temp2                                                ; Multiply pwm by 2
04C1 33            38100             rlc     A
04C2 EA            38101             mov     A, Temp3
04C3 33            38102             rlc     A
04C4 FA            38103             mov     Temp3, A
04C5 EB            38104             mov     A, Temp4
04C6 33            38105             rlc     A
04C7 FB            38106             mov     Temp4, A
04C8 DFED          38107             djnz    Temp8, int0_int_gain_loop
                   38108     
04CA EB            38109             mov     A, Temp4
                   38110     IF MCU_48MHZ == 0
                                     jnb     ACC.2, int0_int_pulse_ready             ; Check that RC pulse is within leg
                             al range
                             ELSE
04CB 30E306        38113             jnb     ACC.3, int0_int_pulse_ready
                   38114     ENDIF
                   38115     
04CE 78FF          38116             mov     Temp1, #0FFh
04D0 7AFF          38117             mov     Temp3, #0FFh
                   38118     IF MCU_48MHZ == 0
                                     mov     Temp4, #3
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   585

                             ELSE
04D2 7B07          38121             mov     Temp4, #7
                   38122     ENDIF
                   38123     
04D4               38124     int0_int_pulse_ready:
04D4 8854          38125             mov     New_Rcp, Temp1                                  ; Store new pulse length
04D6 D230          38126             setb    Flags2.RCP_UPDATED                              ; Set updated flag
                   38127             ; Check if zero
04D8 E8            38128             mov     A, Temp1                                                ; Load new pulse va
                             lue
04D9 6003          38129             jz      ($+5)                                           ; Check if pulse is zero
                   38130     
04DB 755500        38131             mov     Rcp_Stop_Cnt, #0                                ; Reset rcp stop counter
                   38132     
                   38133             ; Set pwm limit
04DE C3            38134             clr     C
04DF E55B          38135             mov     A, Pwm_Limit                                    ; Limit to the smallest
04E1 FC            38136             mov     Temp5, A                                                ; Store limit in Te
                             mp5
04E2 955C          38137             subb    A, Pwm_Limit_By_Rpm
04E4 4002          38138             jc      ($+4)
                   38139     
04E6 AC5C          38140             mov     Temp5, Pwm_Limit_By_Rpm                 
                   38141     
                   38142             ; Check against limit
04E8 C3            38143             clr     C
04E9 EC            38144             mov     A, Temp5
04EA 9554          38145             subb    A, New_Rcp
04EC 5008          38146             jnc     int0_int_set_pwm_registers
                   38147     
04EE EC            38148             mov     A, Temp5                                                ; Multiply limit by
                              4 (8 for 48MHz MCUs)
                   38149     IF MCU_48MHZ == 0
                                     mov     B, #4
                             ELSE
04EF 75F008        38152             mov     B, #8
                   38153     ENDIF
04F2 A4            38154             mul     AB
04F3 FA            38155             mov     Temp3, A
04F4 ABF0          38156             mov     Temp4, B
                   38157     
04F6               38158     int0_int_set_pwm_registers:
04F6 EA            38159             mov     A, Temp3
04F7 F4            38160             cpl     A
04F8 F8            38161             mov     Temp1, A
04F9 EB            38162             mov     A, Temp4
04FA F4            38163             cpl     A
                   38164     IF MCU_48MHZ == 0
                                     anl     A, #3
                             ELSE
04FB 5407          38167             anl     A, #7
                   38168     ENDIF
04FD F9            38169             mov     Temp2, A
                   38170     IF FETON_DELAY != 0
04FE C3            38171             clr     C
04FF E8            38172             mov     A, Temp1                                                ; Skew damping fet 
                             timing
                   38173     IF MCU_48MHZ == 0
                                     subb    A, #FETON_DELAY
                             ELSE
0500 943C          38176             subb    A, #(FETON_DELAY SHL 1)
                   38177     ENDIF
0502 FA            38178             mov     Temp3, A
0503 E9            38179             mov     A, Temp2
0504 9400          38180             subb    A, #0   
0506 FB            38181             mov     Temp4, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   586

0507 5004          38182             jnc     int0_int_set_pwm_damp_set
                   38183     
0509 7A00          38184             mov     Temp3, #0
050B 7B00          38185             mov     Temp4, #0
                   38186     
050D               38187     int0_int_set_pwm_damp_set:
                   38188     ENDIF
050D 8856          38189             mov     Power_Pwm_Reg_L, Temp1
050F 8957          38190             mov     Power_Pwm_Reg_H, Temp2
                   38191     IF FETON_DELAY != 0
0511 8A58          38192             mov     Damp_Pwm_Reg_L, Temp3
0513 8B59          38193             mov     Damp_Pwm_Reg_H, Temp4
                   38194     ENDIF
0515 75230A        38195             mov     Rcp_Timeout_Cntd, #10                   ; Set timeout count
                   38196     IF FETON_DELAY != 0
0518 D0F0          38197             pop     B                                                       ; Restore preserved
                              registers
051A D0E0          38198             pop     ACC
051C D0D0          38199             pop     PSW
                   38200             Clear_COVF_Interrupt
                   38202             Enable_COVF_Interrupt                           ; Generate a pca interrupt
0524 43E610        38204             orl     EIE1, #10h                                      ; Enable pca interrupts
0527 32            38205             reti
                   38206     ELSE
                                     mov     A, Current_Power_Pwm_Reg_H
                             IF MCU_48MHZ == 0
                                     jnb     ACC.1, int0_int_set_pca_int_hi_pwm
                             ELSE
                                     jnb     ACC.2, int0_int_set_pca_int_hi_pwm
                             ENDIF
                             
                                     pop     B                                                       ; Restore preserved
                              registers
                                     pop     ACC
                                     pop     PSW
                                     Clear_COVF_Interrupt
                                     Enable_COVF_Interrupt                           ; Generate a pca interrupt
                                     orl     EIE1, #10h                                      ; Enable pca interrupts
                                     reti
                             
                             int0_int_set_pca_int_hi_pwm:
                                     pop     B                                                       ; Restore preserved
                              registers
                                     pop     ACC
                                     pop     PSW
                                     Clear_CCF_Interrupt
                                     Enable_CCF_Interrupt                            ; Generate pca interrupt
                                     orl     EIE1, #10h                                      ; Enable pca interrupts
                                     reti
                             ENDIF
                   38231     
0528               38232     int0_int_set_timeout:
0528 75230A        38233             mov     Rcp_Timeout_Cntd, #10                   ; Set timeout count
052B               38234     int0_int_exit:
052B D0F0          38235             pop     B                                                       ; Restore preserved
                              registers
052D D0E0          38236             pop     ACC
052F D0D0          38237             pop     PSW
0531 43E610        38238             orl     EIE1, #10h                                      ; Enable pca interrupts
0534 32            38239             reti
                   38240     
                   38241     
                   38242     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   38243     ;
                   38244     ; Int1 interrupt routine
                   38245     ;
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   587

                   38246     ; No assumptions
                   38247     ;
                   38248     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0535               38249     int1_int:       ; Used for RC pulse timing
0535 C2AA          38250             clr     IE_EX1                  ; Disable int1 interrupts
0537 D28E          38251             setb    TCON_TR1                        ; Start timer 1
0539 C2CA          38252             clr     TMR2CN0_TR2                             ; Timer 2 disabled
053B 85CC6C        38253             mov     DShot_Frame_Start_L, TMR2L      ; Read timer value
053E 85CD6D        38254             mov     DShot_Frame_Start_H, TMR2H
0541 D2CA          38255             setb    TMR2CN0_TR2                             ; Timer 2 enabled
0543 32            38256     reti
                   38257     
                   38258     
                   38259     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   38260     ;
                   38261     ; PCA interrupt routine
                   38262     ;
                   38263     ; No assumptions
                   38264     ;
                   38265     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0544               38266     pca_int:        ; Used for setting pwm registers
0544 C2AF          38267             clr     IE_EA
0546 C0D0          38268             push    PSW                             ; Preserve registers through interrupt
0548 C0E0          38269             push    ACC
054A D2D3          38270             setb    PSW.3                   ; Select register bank 1 for this interrupt
                   38271     
                   38272     IF FETON_DELAY != 0                                     ; HI/LO enable style drivers
                   38273     
054C A8F9          38274             mov     Temp1, PCA0L                            ; Read low byte, to transfer high b
                             yte to holding register
054E E55A          38275             mov     A, Current_Power_Pwm_Reg_H
                   38276     IF MCU_48MHZ == 0
                                     jnb     ACC.1, pca_int_hi_pwm
                             ELSE
0550 30E20A        38279             jnb     ACC.2, pca_int_hi_pwm
                   38280     ENDIF
0553 E5FA          38281             mov     A, PCA0H
                   38282     IF MCU_48MHZ == 0
                                     jb      ACC.1, pca_int_exit                     ; Power below 50%, update pca in th
                             e 0x00-0x0F range
                                     jb      ACC.0, pca_int_exit
                             ELSE
0555 20E235        38286             jb      ACC.2, pca_int_exit
0558 20E132        38287             jb      ACC.1, pca_int_exit
                   38288     ENDIF
055B A165          38289             ajmp    pca_int_set_pwm
                   38290     
055D               38291     pca_int_hi_pwm:
055D E5FA          38292             mov     A, PCA0H
                   38293     IF MCU_48MHZ == 0
                                     jnb     ACC.1, pca_int_exit                     ; Power above 50%, update pca in th
                             e 0x20-0x2F range
                                     jb      ACC.0, pca_int_exit
                             ELSE
055F 30E22B        38297             jnb     ACC.2, pca_int_exit
0562 20E128        38298             jb      ACC.1, pca_int_exit
                   38299     ENDIF
                   38300     
0565               38301     pca_int_set_pwm:
                   38302             Set_Power_Pwm_Regs
                   38316             Set_Damp_Pwm_Regs
057D 85575A        38330             mov     Current_Power_Pwm_Reg_H, Power_Pwm_Reg_H
                   38331             Disable_COVF_Interrupt
                   38333     
                   38334     ELSE                                                            ; EN/PWM style drivers
                                     Set_Power_Pwm_Regs
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   588

                                     mov     Current_Power_Pwm_Reg_H, Power_Pwm_Reg_H
                                     Disable_COVF_Interrupt
                                     Disable_CCF_Interrupt
                             
                             ENDIF
                   38341     
                   38342             ; Pwm updated, enable/disable interrupts
0583 D2A8          38343             setb    IE_EX0                                  ; Enable int0 interrupts
0585 303402        38344             jnb     Flags2.RCP_DSHOT, ($+5)
0588 D2AA          38345             setb    IE_EX1                                  ; Enable int1 interrupts (DShot onl
                             y)
058A 53E6EF        38346             anl     EIE1, #0EFh                             ; Disable pca interrupts
058D               38347     pca_int_exit:
                   38348             Clear_COVF_Interrupt
                   38350     IF FETON_DELAY == 0
                                     Clear_CCF_Interrupt
                             ENDIF
0590 D0E0          38353             pop     ACC                                             ; Restore preserved registe
                             rs
0592 D0D0          38354             pop     PSW
0594 D2AF          38355             setb    IE_EA
0596 32            38356             reti
                   38357     
                   38358     
                   38359     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   38360     ;
                   38361     ; Wait xms ~(x*4*250)  (Different entry points) 
                   38362     ;
                   38363     ; No assumptions
                   38364     ;
                   38365     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0597               38366     wait1ms:        
0597 7901          38367             mov     Temp2, #1
0599 8014          38368             jmp     waitxms_o
                   38369     
059B               38370     wait3ms:        
059B 7903          38371             mov     Temp2, #3
059D 8010          38372             jmp     waitxms_o
                   38373     
059F               38374     wait10ms:       
059F 790A          38375             mov     Temp2, #10
05A1 800C          38376             jmp     waitxms_o
                   38377     
05A3               38378     wait30ms:       
05A3 791E          38379             mov     Temp2, #30
05A5 8008          38380             jmp     waitxms_o
                   38381     
05A7               38382     wait100ms:      
05A7 7964          38383             mov     Temp2, #100
05A9 8004          38384             jmp     waitxms_o
                   38385     
05AB               38386     wait200ms:      
05AB 79C8          38387             mov     Temp2, #200
05AD 8000          38388             jmp     waitxms_o
                   38389     
05AF               38390     waitxms_o:      ; Outer loop
05AF 7817          38391             mov     Temp1, #23
05B1               38392     waitxms_m:      ; Middle loop
05B1 E4            38393             clr     A
05B2 D5E0FD        38394             djnz    ACC, $  ; Inner loop (42.7us - 1024 cycles)
05B5 D8FA          38395             djnz    Temp1, waitxms_m
05B7 D9F6          38396             djnz    Temp2, waitxms_o
05B9 22            38397             ret
                   38398     
                   38399     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   38400     ;
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   589

                   38401     ; Set pwm limit low rpm
                   38402     ;
                   38403     ; No assumptions
                   38404     ;
                   38405     ; Sets power limit for low rpms and disables demag for low rpms
                   38406     ;
                   38407     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
05BA               38408     set_pwm_limit_low_rpm:
                   38409             ; Set pwm limit
05BA 78FF          38410             mov     Temp1, #0FFh                                    ; Default full power
05BC 202828        38411             jb      Flags1.STARTUP_PHASE, set_pwm_limit_low_rpm_exit        ; Exit if startup p
                             hase set
                   38412     
05BF 79A1          38413             mov     Temp2, #Pgm_Enable_Power_Prot           ; Check if low RPM power protection
                              is enabled
05C1 E7            38414             mov     A, @Temp2
05C2 6023          38415             jz      set_pwm_limit_low_rpm_exit              ; Exit if disabled
                   38416     
05C4 E548          38417             mov     A, Comm_Period4x_H
05C6 601F          38418             jz      set_pwm_limit_low_rpm_exit              ; Avoid divide by zero
                   38419     
05C8 74FF          38420             mov     A, #255                                         ; Divide 255 by Comm_Period
                             4x_H
05CA 8548F0        38421             mov     B, Comm_Period4x_H
05CD 84            38422             div     AB
05CE 853FF0        38423             mov     B, Low_Rpm_Pwr_Slope                    ; Multiply by slope
05D1 302903        38424             jnb     Flags1.INITIAL_RUN_PHASE, ($+6) ; More protection for initial run phase 
05D4 75F005        38425             mov     B, #5
05D7 A4            38426             mul     AB
05D8 F8            38427             mov     Temp1, A                                                ; Set new limit    
                                                  
05D9 C5F0          38428             xch     A, B
05DB 6002          38429             jz      ($+4)                                           ; Limit to max
                   38430             
05DD 78FF          38431             mov     Temp1, #0FFh                            
                   38432     
05DF C3            38433             clr     C
05E0 E8            38434             mov     A, Temp1                                                ; Limit to min
05E1 955D          38435             subb    A, Pwm_Limit_Beg
05E3 5002          38436             jnc     set_pwm_limit_low_rpm_exit
                   38437     
05E5 A85D          38438             mov     Temp1, Pwm_Limit_Beg
                   38439     
05E7               38440     set_pwm_limit_low_rpm_exit:
05E7 885C          38441             mov     Pwm_Limit_By_Rpm, Temp1                         
05E9 22            38442             ret
                   38443             
                   38444     
                   38445     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   38446     ;
                   38447     ; Set pwm limit high rpm
                   38448     ;
                   38449     ; No assumptions
                   38450     ;
                   38451     ; Sets power limit for high rpms
                   38452     ;
                   38453     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
05EA               38454     set_pwm_limit_high_rpm:
                   38455     IF MCU_48MHZ >= 1
05EA C3            38456             clr     C
05EB E547          38457             mov     A, Comm_Period4x_L
05ED 94A0          38458             subb    A, #0A0h                                ; Limit Comm_Period to 160, which i
                             s 500k erpm
05EF E548          38459             mov     A, Comm_Period4x_H
05F1 9400          38460             subb    A, #00h
                   38461     ELSE
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   590

                                     clr     C
                                     mov     A, Comm_Period4x_L
                                     subb    A, #0E4h                                ; Limit Comm_Period to 228, which i
                             s 350k erpm
                                     mov     A, Comm_Period4x_H
                                     subb    A, #00h
                             ENDIF
05F3 E55C          38468             mov     A, Pwm_Limit_By_Rpm
05F5 5003          38469             jnc     set_pwm_limit_high_rpm_inc_limit
                   38470             
05F7 14            38471             dec     A
05F8 A1FB          38472             ajmp    set_pwm_limit_high_rpm_store
                   38473             
05FA               38474     set_pwm_limit_high_rpm_inc_limit:
05FA 04            38475             inc     A
05FB               38476     set_pwm_limit_high_rpm_store:
05FB 6002          38477             jz      ($+4)
                   38478     
05FD F55C          38479             mov     Pwm_Limit_By_Rpm, A
                   38480     
05FF 22            38481             ret
                   38482     
                   38483     
                   38484     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   38485     ;
                   38486     ; Start ADC conversion
                   38487     ;
                   38488     ; No assumptions
                   38489     ;
                   38490     ; Start conversion used for measuring power supply voltage
                   38491     ;
                   38492     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0600               38493     start_adc_conversion:
                   38494             ; Start adc
                   38495             Start_Adc 
0603 22            38497             ret
                   38498     
                   38499     
                   38500     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   38501     ;
                   38502     ; Check temperature, power supply voltage and limit power
                   38503     ;
                   38504     ; No assumptions
                   38505     ;
                   38506     ; Used to limit main motor power in order to maintain the required voltage
                   38507     ;
                   38508     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0604               38509     check_temp_voltage_and_limit_power:
0604 055E          38510             inc     Adc_Conversion_Cnt                      ; Increment conversion counter
0606 C3            38511             clr     C
0607 E55E          38512             mov     A, Adc_Conversion_Cnt           ; Is conversion count equal to temp rate?
0609 9408          38513             subb    A, #8
060B 4053          38514             jc      check_voltage_start                     ; No - check voltage
                   38515     
                   38516             ; Wait for ADC conversion to complete
060D 30EDF4        38517             jnb     ADC0CN0_ADINT, check_temp_voltage_and_limit_power
                   38518             ; Read ADC result
                   38519             Read_Adc_Result
                   38522             ; Stop ADC
                   38523             Stop_Adc
                   38524     
0614 755E00        38525             mov     Adc_Conversion_Cnt, #0          ; Yes - temperature check. Reset counter
0617 E9            38526             mov     A, Temp2                                        ; Move ADC MSB to Temp3
0618 FA            38527             mov     Temp3, A
0619 79A0          38528             mov     Temp2, #Pgm_Enable_Temp_Prot    ; Is temp protection enabled?
061B E7            38529             mov     A, @Temp2
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   591

061C 6041          38530             jz      temp_check_exit                 ; No - branch
                   38531     
061E EA            38532             mov     A, Temp3                                        ; Is temperature reading be
                             low 256?
061F 7006          38533             jnz     temp_average_inc_dec            ; No - proceed
                   38534     
0621 E55F          38535             mov     A, Current_Average_Temp         ; Yes -  decrement average
0623 6018          38536             jz      temp_average_updated            ; Already zero - no change
0625 800C          38537             jmp     temp_average_dec                        ; Decrement 
                   38538     
0627               38539     temp_average_inc_dec:
0627 C3            38540             clr     C
0628 E8            38541             mov     A, Temp1                                        ; Check if current temperat
                             ure is above or below average
0629 955F          38542             subb    A, Current_Average_Temp
062B 600E          38543             jz      temp_average_updated_load_acc   ; Equal - no change
                   38544     
062D E55F          38545             mov     A, Current_Average_Temp         ; Above - increment average
062F 5005          38546             jnc     temp_average_inc                                
                   38547     
0631 600A          38548             jz      temp_average_updated            ; Below - decrement average if average is n
                             ot already zero
0633               38549     temp_average_dec:
0633 14            38550             dec     A                                               ; Decrement average
0634 8007          38551             jmp     temp_average_updated
                   38552     
0636               38553     temp_average_inc:
0636 04            38554             inc     A                                               ; Increment average
0637 60FA          38555             jz      temp_average_dec
0639 8002          38556             jmp     temp_average_updated
                   38557     
063B               38558     temp_average_updated_load_acc:
063B E55F          38559             mov     A, Current_Average_Temp
063D               38560     temp_average_updated:
063D F55F          38561             mov     Current_Average_Temp, A
063F C3            38562             clr     C
0640 9569          38563             subb    A, Temp_Prot_Limit                      ; Is temperature below first limit?
0642 401B          38564             jc      temp_check_exit                 ; Yes - exit
                   38565     
0644 755BC0        38566             mov  Pwm_Limit, #192                    ; No - limit pwm
                   38567     
0647 C3            38568             clr     C
0648 9404          38569             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below second limit
064A 4013          38570             jc      temp_check_exit                 ; Yes - exit
                   38571     
064C 755B80        38572             mov  Pwm_Limit, #128                    ; No - limit pwm
                   38573     
064F C3            38574             clr     C
0650 9404          38575             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below third limit
0652 400B          38576             jc      temp_check_exit                 ; Yes - exit
                   38577     
0654 755B40        38578             mov  Pwm_Limit, #64                             ; No - limit pwm
                   38579     
0657 C3            38580             clr     C
0658 9404          38581             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below final limit
065A 4003          38582             jc      temp_check_exit                 ; Yes - exit
                   38583     
065C 755B00        38584             mov  Pwm_Limit, #0                              ; No - limit pwm
                   38585     
065F               38586     temp_check_exit:
065F 22            38587             ret
                   38588     
0660               38589     check_voltage_start:
                   38590             ; Increase pwm limit
0660 E55B          38591             mov  A, Pwm_Limit
0662 2410          38592             add     A, #16                  
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   592

0664 5002          38593             jnc     ($+4)                                   ; If not max - branch
                   38594     
0666 74FF          38595             mov     A, #255
                   38596     
0668 F55B          38597             mov     Pwm_Limit, A                            ; Increment limit 
066A 22            38598             ret
                   38599     
                   38600     
                   38601     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   38602     ;
                   38603     ; Set startup PWM routine
                   38604     ;
                   38605     ; Either the SETTLE_PHASE or the STEPPER_PHASE flag must be set
                   38606     ;
                   38607     ; Used for pwm control during startup
                   38608     ;
                   38609     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
066B               38610     set_startup_pwm:        
                   38611             ; Adjust startup power
066B 7432          38612             mov     A, #50                                          ; Set power
066D 79A6          38613             mov     Temp2, #Pgm_Startup_Pwr_Decoded
066F 87F0          38614             mov     B, @Temp2
0671 A4            38615             mul     AB
0672 C5F0          38616             xch     A, B
0674 A2F7          38617             mov     C, B.7                                          ; Multiply result by 2 (uni
                             ty gain is 128)
0676 33            38618             rlc     A
0677 F55D          38619             mov     Pwm_Limit_Beg, A                                ; Set initial pwm limit
0679 22            38620             ret
                   38621     
                   38622     
                   38623     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   38624     ;
                   38625     ; Initialize timing routine
                   38626     ;
                   38627     ; No assumptions
                   38628     ;
                   38629     ; Part of initialization before motor start
                   38630     ;
                   38631     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
067A               38632     initialize_timing: 
067A 754700        38633             mov     Comm_Period4x_L, #00h                           ; Set commutation period re
                             gisters
067D 7548F0        38634             mov     Comm_Period4x_H, #0F0h
0680 22            38635             ret
                   38636     
                   38637     
                   38638     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   38639     ;
                   38640     ; Calculate next commutation timing routine
                   38641     ;
                   38642     ; No assumptions
                   38643     ;
                   38644     ; Called immediately after each commutation
                   38645     ; Also sets up timer 3 to wait advance timing
                   38646     ; Two entry points are used
                   38647     ;
                   38648     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0681               38649     calc_next_comm_timing:          ; Entry point for run phase
                   38650             ; Read commutation time
0681 C2AF          38651             clr     IE_EA
0683 C2CA          38652             clr     TMR2CN0_TR2             ; Timer 2 disabled
0685 A8CC          38653             mov     Temp1, TMR2L            ; Load timer value
0687 A9CD          38654             mov     Temp2, TMR2H    
0689 AA41          38655             mov     Temp3, Timer2_X
068B 30CF01        38656             jnb     TMR2CN0_TF2H, ($+4)     ; Check if interrupt is pending
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   593

068E 0A            38657             inc     Temp3                   ; If it is pending, then timer has already wrapped
068F D2CA          38658             setb    TMR2CN0_TR2             ; Timer 2 enabled
0691 D2AF          38659             setb    IE_EA
                   38660     IF MCU_48MHZ >= 1
0693 C3            38661             clr     C
0694 EA            38662             mov     A, Temp3
0695 13            38663             rrc     A
0696 FA            38664             mov     Temp3, A
0697 E9            38665             mov     A, Temp2
0698 13            38666             rrc     A
0699 F9            38667             mov     Temp2, A
069A E8            38668             mov     A, Temp1
069B 13            38669             rrc     A
069C F8            38670             mov     Temp1, A
                   38671     ENDIF
                   38672             ; Calculate this commutation time
069D AB42          38673             mov     Temp4, Prev_Comm_L
069F AC43          38674             mov     Temp5, Prev_Comm_H
06A1 8842          38675             mov     Prev_Comm_L, Temp1              ; Store timestamp as previous commutation
06A3 8943          38676             mov     Prev_Comm_H, Temp2
06A5 C3            38677             clr     C
06A6 E8            38678             mov     A, Temp1
06A7 9B            38679             subb    A, Temp4                                ; Calculate the new commutation time
06A8 F8            38680             mov     Temp1, A
06A9 E9            38681             mov     A, Temp2
06AA 9C            38682             subb    A, Temp5
06AB 20280A        38683             jb      Flags1.STARTUP_PHASE, calc_next_comm_startup
                   38684     
                   38685     IF MCU_48MHZ >= 1
06AE 547F          38686             anl     A, #7Fh
                   38687     ENDIF
06B0 F9            38688             mov     Temp2, A
06B1 302C02        38689             jnb     Flags1.HIGH_RPM, ($+5)  ; Branch if high rpm
06B4 E19F          38690             ajmp    calc_next_comm_timing_fast
                   38691     
06B6 C1F8          38692             ajmp    calc_next_comm_normal
                   38693     
06B8               38694     calc_next_comm_startup:
06B8 AD44          38695             mov     Temp6, Prev_Comm_X
06BA 8A44          38696             mov     Prev_Comm_X, Temp3              ; Store extended timestamp as previous comm
                             utation
06BC F9            38697             mov     Temp2, A
06BD EA            38698             mov     A, Temp3
06BE 9D            38699             subb    A, Temp6                                ; Calculate the new extended commut
                             ation time
                   38700     IF MCU_48MHZ >= 1
06BF 547F          38701             anl     A, #7Fh
                   38702     ENDIF
06C1 FA            38703             mov     Temp3, A
06C2 6006          38704             jz      calc_next_comm_startup_no_X
                   38705     
06C4 78FF          38706             mov     Temp1, #0FFh
06C6 79FF          38707             mov     Temp2, #0FFh
06C8 C1DD          38708             ajmp    calc_next_comm_startup_average
                   38709     
06CA               38710     calc_next_comm_startup_no_X:
06CA AE45          38711             mov     Temp7, Prev_Prev_Comm_L
06CC AF46          38712             mov     Temp8, Prev_Prev_Comm_H
06CE 8B45          38713             mov     Prev_Prev_Comm_L, Temp4
06D0 8C46          38714             mov     Prev_Prev_Comm_H, Temp5
06D2 A842          38715             mov     Temp1, Prev_Comm_L              ; Reload this commutation time  
06D4 A943          38716             mov     Temp2, Prev_Comm_H
06D6 C3            38717             clr     C
06D7 E8            38718             mov     A, Temp1
06D8 9E            38719             subb    A, Temp7                                ; Calculate the new commutation tim
                             e based upon the two last commutations (to reduce sensitivity to offset)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   594

06D9 F8            38720             mov     Temp1, A
06DA E9            38721             mov     A, Temp2
06DB 9F            38722             subb    A, Temp8
06DC F9            38723             mov     Temp2, A
                   38724     
06DD               38725     calc_next_comm_startup_average:
06DD C3            38726             clr     C
06DE E548          38727             mov     A, Comm_Period4x_H              ; Average with previous and save
06E0 13            38728             rrc     A
06E1 FB            38729             mov     Temp4, A
06E2 E547          38730             mov     A, Comm_Period4x_L
06E4 13            38731             rrc     A
06E5 FA            38732             mov     Temp3, A
06E6 E8            38733             mov     A, Temp1                        
06E7 2A            38734             add     A, Temp3
06E8 F547          38735             mov     Comm_Period4x_L, A
06EA E9            38736             mov     A, Temp2
06EB 3B            38737             addc    A, Temp4
06EC F548          38738             mov     Comm_Period4x_H, A
06EE 5006          38739             jnc     ($+8)
                   38740     
06F0 7547FF        38741             mov     Comm_Period4x_L, #0FFh
06F3 7548FF        38742             mov     Comm_Period4x_H, #0FFh
                   38743     
06F6 E145          38744             ajmp    calc_new_wait_times_setup
                   38745     
06F8               38746     calc_next_comm_normal:
                   38747             ; Calculate new commutation time 
06F8 AA47          38748             mov     Temp3, Comm_Period4x_L  ; Comm_Period4x(-l-h) holds the time of 4 commutati
                             ons
06FA AB48          38749             mov     Temp4, Comm_Period4x_H
06FC AC47          38750             mov     Temp5, Comm_Period4x_L  ; Copy variables
06FE AD48          38751             mov     Temp6, Comm_Period4x_H
0700 7E04          38752             mov     Temp7, #4                               ; Divide Comm_Period4x 4 times as d
                             efault
0702 7F02          38753             mov     Temp8, #2                               ; Divide new commutation time 2 tim
                             es as default
0704 C3            38754             clr     C
0705 EB            38755             mov     A, Temp4
0706 9404          38756             subb    A, #04h
0708 400D          38757             jc      calc_next_comm_avg_period_div
                   38758     
070A 1E            38759             dec     Temp7                           ; Reduce averaging time constant for low sp
                             eeds
070B 1F            38760             dec     Temp8
                   38761     
070C C3            38762             clr     C
070D EB            38763             mov     A, Temp4
070E 9408          38764             subb    A, #08h
0710 4005          38765             jc      calc_next_comm_avg_period_div
                   38766     
0712 202902        38767             jb      Flags1.INITIAL_RUN_PHASE, calc_next_comm_avg_period_div ; Do not average ve
                             ry fast during initial run
                   38768     
0715 1E            38769             dec     Temp7                           ; Reduce averaging time constant more for e
                             ven lower speeds
0716 1F            38770             dec     Temp8
                   38771     
0717               38772     calc_next_comm_avg_period_div:
0717 C3            38773             clr     C
0718 ED            38774             mov     A, Temp6                                        
0719 13            38775             rrc     A                                       ; Divide by 2
071A FD            38776             mov     Temp6, A        
071B EC            38777             mov     A, Temp5                                
071C 13            38778             rrc     A
071D FC            38779             mov     Temp5, A
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   595

071E DEF7          38780             djnz    Temp7, calc_next_comm_avg_period_div
                   38781     
0720 C3            38782             clr     C
0721 EA            38783             mov     A, Temp3
0722 9C            38784             subb    A, Temp5                                ; Subtract a fraction
0723 FA            38785             mov     Temp3, A
0724 EB            38786             mov     A, Temp4
0725 9D            38787             subb    A, Temp6
0726 FB            38788             mov     Temp4, A
0727 EF            38789             mov     A, Temp8                                ; Divide new time
0728 6009          38790             jz      calc_next_comm_new_period_div_done
                   38791     
072A               38792     calc_next_comm_new_period_div:
072A C3            38793             clr     C
072B E9            38794             mov     A, Temp2                                        
072C 13            38795             rrc     A                                       ; Divide by 2
072D F9            38796             mov     Temp2, A        
072E E8            38797             mov     A, Temp1                                
072F 13            38798             rrc     A
0730 F8            38799             mov     Temp1, A
0731 DFF7          38800             djnz    Temp8, calc_next_comm_new_period_div
                   38801     
0733               38802     calc_next_comm_new_period_div_done:
0733 EA            38803             mov     A, Temp3
0734 28            38804             add     A, Temp1                                ; Add the divided new time
0735 FA            38805             mov     Temp3, A
0736 EB            38806             mov     A, Temp4
0737 39            38807             addc    A, Temp2
0738 FB            38808             mov     Temp4, A
0739 8A47          38809             mov     Comm_Period4x_L, Temp3  ; Store Comm_Period4x_X
073B 8B48          38810             mov     Comm_Period4x_H, Temp4
073D 5006          38811             jnc     calc_new_wait_times_setup; If period larger than 0xffff - go to slow case
                   38812     
073F 7BFF          38813             mov     Temp4, #0FFh
0741 8B47          38814             mov     Comm_Period4x_L, Temp4  ; Set commutation period registers to very slow tim
                             ing (0xffff)
0743 8B48          38815             mov     Comm_Period4x_H, Temp4
                   38816     
0745               38817     calc_new_wait_times_setup:      
                   38818             ; Set high rpm bit (if above 156k erpm)
0745 C3            38819             clr     C
0746 EB            38820             mov     A, Temp4
0747 9402          38821             subb    A, #2
0749 5002          38822             jnc     ($+4)
                   38823     
074B D22C          38824             setb    Flags1.HIGH_RPM                 ; Set high rpm bit
                   38825             
                   38826             ; Load programmed commutation timing
074D 302804        38827             jnb     Flags1.STARTUP_PHASE, calc_new_wait_per_startup_done    ; Set dedicated tim
                             ing during startup
                   38828     
0750 7F03          38829             mov     Temp8, #3
0752 E170          38830             ajmp    calc_new_wait_per_demag_done
                   38831     
0754               38832     calc_new_wait_per_startup_done:
0754 7892          38833             mov     Temp1, #Pgm_Comm_Timing ; Load timing setting
0756 E6            38834             mov     A, @Temp1                               
0757 FF            38835             mov     Temp8, A                                ; Store in Temp8
0758 C3            38836             clr     C
0759 E53D          38837             mov     A, Demag_Detected_Metric        ; Check demag metric
075B 9482          38838             subb    A, #130
075D 4011          38839             jc      calc_new_wait_per_demag_done
                   38840     
075F 0F            38841             inc     Temp8                           ; Increase timing
                   38842     
0760 C3            38843             clr     C
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   596

0761 E53D          38844             mov     A, Demag_Detected_Metric
0763 94A0          38845             subb    A, #160
0765 4001          38846             jc      ($+3)
                   38847     
0767 0F            38848             inc     Temp8                           ; Increase timing again
                   38849     
0768 C3            38850             clr     C
0769 EF            38851             mov     A, Temp8                                ; Limit timing to max
076A 9406          38852             subb    A, #6
076C 4002          38853             jc      ($+4)
                   38854     
076E 7F05          38855             mov     Temp8, #5                               ; Set timing to max
                   38856     
0770               38857     calc_new_wait_per_demag_done:
                   38858             ; Set timing reduction
0770 7E02          38859             mov     Temp7, #2
                   38860             ; Load current commutation timing
0772 E548          38861             mov     A, Comm_Period4x_H              ; Divide 4 times
0774 C4            38862             swap    A
0775 540F          38863             anl     A, #00Fh
0777 F9            38864             mov     Temp2, A
0778 E548          38865             mov     A, Comm_Period4x_H
077A C4            38866             swap    A
077B 54F0          38867             anl     A, #0F0h
077D F8            38868             mov     Temp1, A
077E E547          38869             mov     A, Comm_Period4x_L
0780 C4            38870             swap    A
0781 540F          38871             anl     A, #00Fh
0783 28            38872             add     A, Temp1
0784 F8            38873             mov     Temp1, A
                   38874     
0785 C3            38875             clr     C
0786 E8            38876             mov     A, Temp1
0787 9E            38877             subb    A, Temp7
0788 FA            38878             mov     Temp3, A
0789 E9            38879             mov     A, Temp2                                
078A 9400          38880             subb    A, #0
078C FB            38881             mov     Temp4, A
078D 4009          38882             jc      load_min_time                   ; Check that result is still positive
                   38883     
078F C3            38884             clr     C
0790 EA            38885             mov     A, Temp3
0791 9401          38886             subb    A, #1
0793 EB            38887             mov     A, Temp4                        
0794 9400          38888             subb    A, #0
0796 5004          38889             jnc     calc_new_wait_times_exit        ; Check that result is still above minumum
                   38890     
0798               38891     load_min_time:
0798 7A01          38892             mov     Temp3, #1
079A E4            38893             clr     A
079B FB            38894             mov     Temp4, A 
                   38895     
079C               38896     calc_new_wait_times_exit:       
079C 0207EB        38897             ljmp    wait_advance_timing
                   38898     
                   38899     
                   38900     ; Fast calculation (Comm_Period4x_H less than 2)
079F               38901     calc_next_comm_timing_fast:                     
                   38902             ; Calculate new commutation time
079F AA47          38903             mov     Temp3, Comm_Period4x_L  ; Comm_Period4x(-l-h) holds the time of 4 commutati
                             ons
07A1 AB48          38904             mov     Temp4, Comm_Period4x_H
07A3 EB            38905             mov     A, Temp4                                ; Divide by 2 4 times
07A4 C4            38906             swap    A
07A5 FE            38907             mov     Temp7, A
07A6 EA            38908             mov     A, Temp3
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   597

07A7 C4            38909             swap A
07A8 540F          38910             anl     A, #0Fh
07AA 4E            38911             orl     A, Temp7
07AB FC            38912             mov     Temp5, A
07AC C3            38913             clr     C
07AD EA            38914             mov     A, Temp3                                ; Subtract a fraction
07AE 9C            38915             subb    A, Temp5
07AF FA            38916             mov     Temp3, A
07B0 EB            38917             mov     A, Temp4                                
07B1 9400          38918             subb    A, #0
07B3 FB            38919             mov     Temp4, A
07B4 C3            38920             clr     C
07B5 E8            38921             mov     A, Temp1
07B6 13            38922             rrc     A                                       ; Divide by 2 2 times
07B7 C3            38923             clr     C
07B8 13            38924             rrc     A
07B9 F8            38925             mov     Temp1, A
07BA EA            38926             mov     A, Temp3                                ; Add the divided new time
07BB 28            38927             add     A, Temp1
07BC FA            38928             mov     Temp3, A
07BD EB            38929             mov     A, Temp4
07BE 3400          38930             addc    A, #0
07C0 FB            38931             mov     Temp4, A
07C1 8A47          38932             mov     Comm_Period4x_L, Temp3  ; Store Comm_Period4x_X
07C3 8B48          38933             mov     Comm_Period4x_H, Temp4
07C5 C3            38934             clr     C
07C6 EB            38935             mov     A, Temp4                                ; If erpm below 156k - go to normal
                              case
07C7 9402          38936             subb    A, #2
07C9 4002          38937             jc      ($+4)
                   38938     
07CB C22C          38939             clr     Flags1.HIGH_RPM                 ; Clear high rpm bit
                   38940     
                   38941             ; Set timing reduction
07CD 7802          38942             mov     Temp1, #2
07CF EB            38943             mov     A, Temp4                                ; Divide by 2 4 times
07D0 C4            38944             swap    A
07D1 FE            38945             mov     Temp7, A
07D2 7B00          38946             mov     Temp4, #0
07D4 EA            38947             mov     A, Temp3
07D5 C4            38948             swap A
07D6 540F          38949             anl     A, #0Fh
07D8 4E            38950             orl     A, Temp7
07D9 FA            38951             mov     Temp3, A
07DA C3            38952             clr     C
07DB EA            38953             mov     A, Temp3
07DC 98            38954             subb    A, Temp1
07DD FA            38955             mov     Temp3, A
07DE 4005          38956             jc      load_min_time_fast              ; Check that result is still positive
                   38957     
07E0 C3            38958             clr     C
07E1 9401          38959             subb    A, #1
07E3 5002          38960             jnc     calc_new_wait_times_fast_done   ; Check that result is still above minumum
                   38961     
07E5               38962     load_min_time_fast:
07E5 7A01          38963             mov     Temp3, #1
                   38964     
07E7               38965     calc_new_wait_times_fast_done:  
07E7 7892          38966             mov     Temp1, #Pgm_Comm_Timing ; Load timing setting
07E9 E6            38967             mov     A, @Temp1                               
07EA FF            38968             mov     Temp8, A                                ; Store in Temp8
                   38969     
                   38970     
                   38971     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   38972     ;
                   38973     ; Wait advance timing routine
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   598

                   38974     ;
                   38975     ; No assumptions
                   38976     ; NOTE: Be VERY careful if using temp registers. They are passed over this routine
                   38977     ;
                   38978     ; Waits for the advance timing to elapse and sets up the next zero cross wait
                   38979     ;
                   38980     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
07EB               38981     wait_advance_timing:    
07EB 302002        38982             jnb     Flags0.T3_PENDING, ($+5)
07EE E1EB          38983             ajmp    wait_advance_timing
                   38984     
                   38985             ; Setup next wait time
07F0 854E92        38986             mov     TMR3RLL, Wt_ZC_Tout_Start_L
07F3 854F93        38987             mov     TMR3RLH, Wt_ZC_Tout_Start_H
07F6 D220          38988             setb    Flags0.T3_PENDING
07F8 43E680        38989             orl     EIE1, #80h      ; Enable timer 3 interrupts
                   38990     
                   38991     
                   38992     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   38993     ;
                   38994     ; Calculate new wait times routine
                   38995     ;
                   38996     ; No assumptions
                   38997     ;
                   38998     ; Calculates new wait times
                   38999     ;
                   39000     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
07FB               39001     calc_new_wait_times:    
07FB C3            39002             clr     C
07FC E4            39003             clr     A
07FD 9A            39004             subb    A, Temp3                                ; Negate
07FE F8            39005             mov     Temp1, A        
07FF E4            39006             clr     A
0800 9B            39007             subb    A, Temp4                                
0801 F9            39008             mov     Temp2, A        
                   39009     IF MCU_48MHZ >= 1
0802 C3            39010             clr     C
0803 E8            39011             mov     A, Temp1                                ; Multiply by 2
0804 33            39012             rlc     A
0805 F8            39013             mov     Temp1, A
0806 E9            39014             mov     A, Temp2
0807 33            39015             rlc     A
0808 F9            39016             mov     Temp2, A
                   39017     ENDIF
0809 302C03        39018             jnb     Flags1.HIGH_RPM, ($+6)  ; Branch if high rpm
080C 020880        39019             ljmp    calc_new_wait_times_fast
                   39020     
080F E8            39021             mov     A, Temp1                                ; Copy values
0810 FA            39022             mov     Temp3, A
0811 E9            39023             mov     A, Temp2
0812 FB            39024             mov     Temp4, A
0813 D3            39025             setb    C                                       ; Negative numbers - set carry
0814 E9            39026             mov     A, Temp2                                
0815 13            39027             rrc     A                                       ; Divide by 2
0816 FD            39028             mov     Temp6, A
0817 E8            39029             mov     A, Temp1
0818 13            39030             rrc     A
0819 FC            39031             mov     Temp5, A
081A 884E          39032             mov     Wt_Zc_Tout_Start_L, Temp1; Set 15deg time for zero cross scan timeout
081C 894F          39033             mov     Wt_Zc_Tout_Start_H, Temp2
081E C3            39034             clr     C
081F EF            39035             mov     A, Temp8                                ; (Temp8 has Pgm_Comm_Timing)
0820 9403          39036             subb    A, #3                           ; Is timing normal?
0822 6038          39037             jz      store_times_decrease    ; Yes - branch
                   39038     
0824 EF            39039             mov     A, Temp8                                
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   599

0825 20E00C        39040             jb      ACC.0, adjust_timing_two_steps  ; If an odd number - branch
                   39041     
0828 E8            39042             mov     A, Temp1                                ; Add 7.5deg and store in Temp1/2
0829 2C            39043             add     A, Temp5
082A F8            39044             mov     Temp1, A
082B E9            39045             mov     A, Temp2
082C 3D            39046             addc    A, Temp6
082D F9            39047             mov     Temp2, A
082E EC            39048             mov     A, Temp5                                ; Store 7.5deg in Temp3/4
082F FA            39049             mov     Temp3, A
0830 ED            39050             mov     A, Temp6                        
0831 FB            39051             mov     Temp4, A
0832 8013          39052             jmp     store_times_up_or_down
                   39053     
0834               39054     adjust_timing_two_steps:
0834 E8            39055             mov     A, Temp1                                ; Add 15deg and store in Temp1/2
0835 28            39056             add     A, Temp1
0836 F8            39057             mov     Temp1, A
0837 E9            39058             mov     A, Temp2
0838 39            39059             addc    A, Temp2
0839 F9            39060             mov     Temp2, A
083A C3            39061             clr     C
083B E8            39062             mov     A, Temp1
083C 2401          39063             add     A, #1
083E F8            39064             mov     Temp1, A
083F E9            39065             mov     A, Temp2
0840 3400          39066             addc    A, #0
0842 F9            39067             mov     Temp2, A
0843 7AFF          39068             mov     Temp3, #-1                              ; Store minimum time in Temp3/4
0845 7BFF          39069             mov     Temp4, #0FFh
                   39070     
0847               39071     store_times_up_or_down:
0847 C3            39072             clr     C
0848 EF            39073             mov     A, Temp8                                
0849 9403          39074             subb    A, #3                                   ; Is timing higher than normal?
084B 400F          39075             jc      store_times_decrease            ; No - branch
                   39076     
084D               39077     store_times_increase:
084D 8A50          39078             mov     Wt_Comm_Start_L, Temp3          ; Now commutation time (~60deg) divided by 
                             4 (~15deg nominal)
084F 8B51          39079             mov     Wt_Comm_Start_H, Temp4
0851 884A          39080             mov     Wt_Adv_Start_L, Temp1           ; New commutation advance time (~15deg nomi
                             nal)
0853 894B          39081             mov     Wt_Adv_Start_H, Temp2
0855 8C4C          39082             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan delay 
                             (7.5deg)
0857 8D4D          39083             mov     Wt_Zc_Scan_Start_H, Temp6
0859 0208B5        39084             ljmp    wait_before_zc_scan
                   39085     
085C               39086     store_times_decrease:
085C 8850          39087             mov     Wt_Comm_Start_L, Temp1          ; Now commutation time (~60deg) divided by 
                             4 (~15deg nominal)
085E 8951          39088             mov     Wt_Comm_Start_H, Temp2
0860 8A4A          39089             mov     Wt_Adv_Start_L, Temp3           ; New commutation advance time (~15deg nomi
                             nal)
0862 8B4B          39090             mov     Wt_Adv_Start_H, Temp4
0864 8C4C          39091             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan delay 
                             (7.5deg)
0866 8D4D          39092             mov     Wt_Zc_Scan_Start_H, Temp6
0868 302812        39093             jnb     Flags1.STARTUP_PHASE, store_times_exit
                   39094     
086B 7550F0        39095             mov     Wt_Comm_Start_L, #0F0h          ; Set very short delays for all but advance
                              time during startup, in order to widen zero cross capture range
086E 7551FF        39096             mov     Wt_Comm_Start_H, #0FFh
0871 754CF0        39097             mov     Wt_Zc_Scan_Start_L, #0F0h
0874 754DFF        39098             mov     Wt_Zc_Scan_Start_H, #0FFh
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   600

0877 754EF0        39099             mov     Wt_Zc_Tout_Start_L, #0F0h
087A 754FFF        39100             mov     Wt_Zc_Tout_Start_H, #0FFh
                   39101     
087D               39102     store_times_exit:
087D 0208B5        39103             ljmp    wait_before_zc_scan
                   39104     
                   39105     
0880               39106     calc_new_wait_times_fast:       
0880 E8            39107             mov     A, Temp1                                ; Copy values
0881 FA            39108             mov     Temp3, A
0882 D3            39109             setb    C                                       ; Negative numbers - set carry
0883 E8            39110             mov     A, Temp1                                ; Divide by 2
0884 13            39111             rrc     A
0885 FC            39112             mov     Temp5, A
0886 884E          39113             mov     Wt_Zc_Tout_Start_L, Temp1; Set 15deg time for zero cross scan timeout
0888 C3            39114             clr     C
0889 EF            39115             mov     A, Temp8                                ; (Temp8 has Pgm_Comm_Timing)
088A 9403          39116             subb    A, #3                           ; Is timing normal?
088C 6021          39117             jz      store_times_decrease_fast; Yes - branch
                   39118     
088E EF            39119             mov     A, Temp8                                
088F 20E007        39120             jb      ACC.0, adjust_timing_two_steps_fast     ; If an odd number - branch
                   39121     
0892 E8            39122             mov     A, Temp1                                ; Add 7.5deg and store in Temp1
0893 2C            39123             add     A, Temp5
0894 F8            39124             mov     Temp1, A
0895 EC            39125             mov     A, Temp5                                ; Store 7.5deg in Temp3
0896 FA            39126             mov     Temp3, A
0897 01A0          39127             ajmp    store_times_up_or_down_fast
                   39128     
0899               39129     adjust_timing_two_steps_fast:
0899 E8            39130             mov     A, Temp1                                ; Add 15deg and store in Temp1
089A 28            39131             add     A, Temp1
089B 2401          39132             add     A, #1
089D F8            39133             mov     Temp1, A
089E 7AFF          39134             mov     Temp3, #-1                      ; Store minimum time in Temp3
                   39135     
08A0               39136     store_times_up_or_down_fast:
08A0 C3            39137             clr     C
08A1 EF            39138             mov     A, Temp8                                
08A2 9403          39139             subb    A, #3                           ; Is timing higher than normal?
08A4 4009          39140             jc      store_times_decrease_fast; No - branch
                   39141     
08A6               39142     store_times_increase_fast:
08A6 8A50          39143             mov     Wt_Comm_Start_L, Temp3          ; Now commutation time (~60deg) divided by 
                             4 (~15deg nominal)
08A8 884A          39144             mov     Wt_Adv_Start_L, Temp1           ; New commutation advance time (~15deg nomi
                             nal)
08AA 8C4C          39145             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan delay 
                             (7.5deg)
08AC 0208B5        39146             ljmp    wait_before_zc_scan
                   39147     
08AF               39148     store_times_decrease_fast:
08AF 8850          39149             mov     Wt_Comm_Start_L, Temp1          ; Now commutation time (~60deg) divided by 
                             4 (~15deg nominal)
08B1 8A4A          39150             mov     Wt_Adv_Start_L, Temp3           ; New commutation advance time (~15deg nomi
                             nal)
08B3 8C4C          39151             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan delay 
                             (7.5deg)
                   39152     
                   39153     
                   39154     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   39155     ;
                   39156     ; Wait before zero cross scan routine
                   39157     ;
                   39158     ; No assumptions
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   601

                   39159     ;
                   39160     ; Waits for the zero cross scan wait time to elapse
                   39161     ; Also sets up timer 3 for the zero cross scan timeout time
                   39162     ;
                   39163     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
08B5               39164     wait_before_zc_scan:    
08B5 302002        39165             jnb     Flags0.T3_PENDING, ($+5)
08B8 01B5          39166             ajmp    wait_before_zc_scan
                   39167     
08BA 753A02        39168             mov     Startup_Zc_Timeout_Cntd, #2
08BD               39169     setup_zc_scan_timeout:
08BD D220          39170             setb    Flags0.T3_PENDING
08BF 43E680        39171             orl     EIE1, #80h                      ; Enable timer 3 interrupts
08C2 E525          39172             mov     A, Flags1
08C4 5403          39173             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
08C6 602D          39174             jz      wait_before_zc_scan_exit                
                   39175     
08C8 A847          39176             mov     Temp1, Comm_Period4x_L  ; Set long timeout when starting
08CA A948          39177             mov     Temp2, Comm_Period4x_H
08CC C3            39178             clr     C
08CD E9            39179             mov     A, Temp2
08CE 13            39180             rrc     A
08CF F9            39181             mov     Temp2, A
08D0 E8            39182             mov     A, Temp1
08D1 13            39183             rrc     A
08D2 F8            39184             mov     Temp1, A
                   39185     IF MCU_48MHZ == 0
                                     clr     C
                                     mov     A, Temp2
                                     rrc     A
                                     mov     Temp2, A
                                     mov     A, Temp1
                                     rrc     A
                                     mov     Temp1, A
                             ENDIF
08D3 302804        39194             jnb     Flags1.STARTUP_PHASE, setup_zc_scan_timeout_startup_done
                   39195     
08D6 E9            39196             mov     A, Temp2
08D7 2440          39197             add     A, #40h                         ; Increase timeout somewhat to avoid false 
                             wind up
08D9 F9            39198             mov     Temp2, A
                   39199     
08DA               39200     setup_zc_scan_timeout_startup_done:
08DA C2AF          39201             clr     IE_EA
08DC 53E67F        39202             anl     EIE1, #7Fh                      ; Disable timer 3 interrupts
08DF 759100        39203             mov     TMR3CN0, #00h                   ; Timer 3 disabled and interrupt flag clear
                             ed
08E2 C3            39204             clr     C
08E3 E4            39205             clr     A
08E4 98            39206             subb    A, Temp1                                ; Set timeout
08E5 F594          39207             mov     TMR3L, A
08E7 E4            39208             clr     A
08E8 99            39209             subb    A, Temp2                
08E9 F595          39210             mov     TMR3H, A
08EB 759104        39211             mov     TMR3CN0, #04h                   ; Timer 3 enabled and interrupt flag cleared
08EE D220          39212             setb    Flags0.T3_PENDING
08F0 43E680        39213             orl     EIE1, #80h                      ; Enable timer 3 interrupts
08F3 D2AF          39214             setb    IE_EA
                   39215     
08F5               39216     wait_before_zc_scan_exit:          
08F5 22            39217             ret
                   39218     
                   39219     
                   39220     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   39221     ;
                   39222     ; Wait for comparator to go low/high routines
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   602

                   39223     ;
                   39224     ; No assumptions
                   39225     ;
                   39226     ; Waits for the zero cross scan wait time to elapse
                   39227     ; Then scans for comparator going low/high
                   39228     ;
                   39229     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
08F6               39230     wait_for_comp_out_low:
08F6 D221          39231             setb    Flags0.DEMAG_DETECTED           ; Set demag detected flag as default
08F8 754900        39232             mov     Comparator_Read_Cnt, #0         ; Reset number of comparator reads
08FB 752000        39233             mov     Bit_Access, #00h                        ; Desired comparator output
08FE 302B03        39234             jnb     Flags1.DIR_CHANGE_BRAKE, ($+6)
0901 752040        39235             mov     Bit_Access, #40h                
0904 2114          39236             ajmp    wait_for_comp_out_start
                   39237     
0906               39238     wait_for_comp_out_high:
0906 D221          39239             setb    Flags0.DEMAG_DETECTED           ; Set demag detected flag as default
0908 754900        39240             mov     Comparator_Read_Cnt, #0         ; Reset number of comparator reads
090B 752040        39241             mov     Bit_Access, #40h                        ; Desired comparator output
090E 302B03        39242             jnb     Flags1.DIR_CHANGE_BRAKE, ($+6)
0911 752000        39243             mov     Bit_Access, #00h                
                   39244     
0914               39245     wait_for_comp_out_start:
                   39246             ; Set number of comparator readings
0914 7801          39247             mov     Temp1, #1                                       ; Number of OK readings req
                             uired
0916 7901          39248             mov     Temp2, #1                                       ; Max number of readings re
                             quired
0918 202C20        39249             jb      Flags1.HIGH_RPM, comp_scale_samples     ; Branch if high rpm
                   39250     
091B E525          39251             mov     A, Flags1                                       ; Clear demag detected flag
                              if start phases
091D 5403          39252             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
091F 6002          39253             jz      ($+4)
                   39254                     
0921 C221          39255             clr     Flags0.DEMAG_DETECTED
                   39256     
0923 7914          39257             mov     Temp2, #20                              ; Too low value (~<15) causes rough
                              running at pwm harmonics. Too high a value (~>35) causes the RCT4215 630 to run rough on full throttle
0925 E548          39258             mov     A, Comm_Period4x_H                      ; Set number of readings higher for
                              lower speeds
0927 C3            39259             clr     C
0928 13            39260             rrc     A
0929 7001          39261             jnz     ($+3)
092B 04            39262             inc     A
092C F8            39263             mov     Temp1, A
092D C3            39264             clr     C                                               
092E 9414          39265             subb    A, #20
0930 4002          39266             jc      ($+4)
                   39267     
0932 7814          39268             mov     Temp1, #20
                   39269             
0934 302804        39270             jnb     Flags1.STARTUP_PHASE, comp_scale_samples
                   39271     
0937 781B          39272             mov     Temp1, #27                              ; Set many samples during startup, 
                             approximately one pwm period
0939 791B          39273             mov     Temp2, #27
                   39274     
093B               39275     comp_scale_samples:
                   39276     IF MCU_48MHZ >= 1
093B C3            39277             clr     C
093C E8            39278             mov     A, Temp1
093D 33            39279             rlc     A
093E F8            39280             mov     Temp1, A
093F C3            39281             clr     C
0940 E9            39282             mov     A, Temp2
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   603

0941 33            39283             rlc     A
0942 F9            39284             mov     Temp2, A
                   39285     ENDIF
0943               39286     comp_check_timeout:
0943 202010        39287             jb      Flags0.T3_PENDING, comp_check_timeout_not_timed_out             ; Has zero 
                             cross scan timeout elapsed?
                   39288     
0946 E549          39289             mov     A, Comparator_Read_Cnt                  ; Check that comparator has been re
                             ad
0948 600C          39290             jz      comp_check_timeout_not_timed_out        ; If not read - branch
                   39291     
094A 302803        39292             jnb     Flags1.STARTUP_PHASE, comp_check_timeout_timeout_extended       ; Extend ti
                             meout during startup
                   39293     
094D D53A04        39294             djnz    Startup_Zc_Timeout_Cntd, comp_check_timeout_extend_timeout
                   39295     
0950               39296     comp_check_timeout_timeout_extended:
0950 D222          39297             setb    Flags0.COMP_TIMED_OUT
0952 21C7          39298             ajmp    setup_comm_wait
                   39299     
0954               39300     comp_check_timeout_extend_timeout:
0954 11BD          39301             call    setup_zc_scan_timeout
0956               39302     comp_check_timeout_not_timed_out:
0956 0549          39303             inc     Comparator_Read_Cnt                     ; Increment comparator read count
                   39304             Read_Comp_Out                                   ; Read comparator output
095A 5440          39306             anl     A, #40h
095C B52002        39307             cjne    A, Bit_Access, comp_read_wrong
095F 21B1          39308             ajmp    comp_read_ok
                   39309             
0961               39310     comp_read_wrong:
0961 302809        39311             jnb     Flags1.STARTUP_PHASE, comp_read_wrong_not_startup
                   39312     
0964 08            39313             inc     Temp1                                   ; Increment number of OK readings r
                             equired
0965 C3            39314             clr     C
0966 E8            39315             mov     A, Temp1
0967 99            39316             subb    A, Temp2                                        ; If above initial requirem
                             ent - do not increment further
0968 4001          39317             jc      ($+3)
096A 18            39318             dec     Temp1
                   39319     
096B 2143          39320             ajmp    comp_check_timeout                      ; Continue to look for good ones
                   39321     
096D               39322     comp_read_wrong_not_startup:
096D 20210A        39323             jb      Flags0.DEMAG_DETECTED, comp_read_wrong_extend_timeout
                   39324     
0970 08            39325             inc     Temp1                                   ; Increment number of OK readings r
                             equired
0971 C3            39326             clr     C
0972 E8            39327             mov     A, Temp1
0973 99            39328             subb    A, Temp2                                        
0974 4002          39329             jc      ($+4)
0976 2114          39330             ajmp    wait_for_comp_out_start         ; If above initial requirement - go back an
                             d restart
                   39331     
0978 2143          39332             ajmp    comp_check_timeout                      ; Otherwise - take another reading
                   39333     
097A               39334     comp_read_wrong_extend_timeout:
097A C221          39335             clr     Flags0.DEMAG_DETECTED           ; Clear demag detected flag
097C 53E67F        39336             anl     EIE1, #7Fh                              ; Disable timer 3 interrupts
097F 759100        39337             mov     TMR3CN0, #00h                           ; Timer 3 disabled and interrupt fl
                             ag cleared
0982 302C11        39338             jnb     Flags1.HIGH_RPM, comp_read_wrong_low_rpm        ; Branch if not high rpm
                   39339     
0985 759400        39340             mov     TMR3L, #00h                             ; Set timeout to ~1ms
                   39341     IF MCU_48MHZ >= 1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   604

0988 7595F0        39342             mov     TMR3H, #0F0h
                   39343     ELSE
                                     mov     TMR3H, #0F8h
                             ENDIF
098B               39346     comp_read_wrong_timeout_set:
098B 759104        39347             mov     TMR3CN0, #04h                           ; Timer 3 enabled and interrupt fla
                             g cleared
098E D220          39348             setb    Flags0.T3_PENDING
0990 43E680        39349             orl     EIE1, #80h                              ; Enable timer 3 interrupts
0993 020914        39350             ljmp    wait_for_comp_out_start         ; If comparator output is not correct - go 
                             back and restart
                   39351     
0996               39352     comp_read_wrong_low_rpm:
0996 E548          39353             mov     A, Comm_Period4x_H                      ; Set timeout to ~4x comm period 4x
                              value
0998 7EFF          39354             mov     Temp7, #0FFh                            ; Default to long
                   39355     IF MCU_48MHZ >= 1
099A C3            39356             clr     C
099B 33            39357             rlc     A
099C 4009          39358             jc      comp_read_wrong_load_timeout
                   39359     
                   39360     ENDIF
099E C3            39361             clr     C
099F 33            39362             rlc     A
09A0 4005          39363             jc      comp_read_wrong_load_timeout
                   39364     
09A2 C3            39365             clr     C
09A3 33            39366             rlc     A
09A4 4001          39367             jc      comp_read_wrong_load_timeout
                   39368     
09A6 FE            39369             mov     Temp7, A
                   39370     
09A7               39371     comp_read_wrong_load_timeout:
09A7 C3            39372             clr     C
09A8 E4            39373             clr     A
09A9 9E            39374             subb    A, Temp7
09AA 759400        39375             mov     TMR3L, #0
09AD F595          39376             mov     TMR3H, A
09AF 218B          39377             ajmp    comp_read_wrong_timeout_set
                   39378     
09B1               39379     comp_read_ok:
09B1 C3            39380             clr     C
09B2 E539          39381             mov     A, Startup_Cnt                          ; Force a timeout for the first com
                             mutation
09B4 9401          39382             subb    A, #1
09B6 5002          39383             jnc     ($+4)
09B8 2114          39384             ajmp    wait_for_comp_out_start
                   39385     
09BA 302102        39386             jnb     Flags0.DEMAG_DETECTED, ($+5)    ; Do not accept correct comparator output i
                             f it is demag
09BD 2114          39387             ajmp    wait_for_comp_out_start
                   39388     
09BF D802          39389             djnz    Temp1, comp_read_ok_jmp         ; Decrement readings counter - repeat compa
                             rator reading if not zero
09C1 21C5          39390             ajmp    ($+4)
                   39391     
09C3               39392     comp_read_ok_jmp:
09C3 2143          39393             ajmp    comp_check_timeout
                   39394     
09C5 C222          39395             clr     Flags0.COMP_TIMED_OUT
                   39396     
                   39397     
                   39398     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   39399     ;
                   39400     ; Setup commutation timing routine
                   39401     ;
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   605

                   39402     ; No assumptions
                   39403     ;
                   39404     ; Sets up and starts wait from commutation to zero cross
                   39405     ;
                   39406     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
09C7               39407     setup_comm_wait:
09C7 C2AF          39408             clr     IE_EA
09C9 53E67F        39409             anl     EIE1, #7Fh              ; Disable timer 3 interrupts
09CC 759100        39410             mov     TMR3CN0, #00h           ; Timer 3 disabled and interrupt flag cleared
09CF 855094        39411             mov     TMR3L, Wt_Comm_Start_L
09D2 855195        39412             mov     TMR3H, Wt_Comm_Start_H
09D5 759104        39413             mov     TMR3CN0, #04h           ; Timer 3 enabled and interrupt flag cleared
                   39414             ; Setup next wait time
09D8 854A92        39415             mov     TMR3RLL, Wt_Adv_Start_L
09DB 854B93        39416             mov     TMR3RLH, Wt_Adv_Start_H
09DE D220          39417             setb    Flags0.T3_PENDING
09E0 43E680        39418             orl     EIE1, #80h              ; Enable timer 3 interrupts
09E3 D2AF          39419             setb    IE_EA                   ; Enable interrupts again
                   39420     
                   39421     
                   39422     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   39423     ;
                   39424     ; Evaluate comparator integrity
                   39425     ;
                   39426     ; No assumptions
                   39427     ;
                   39428     ; Checks comparator signal behaviour versus expected behaviour
                   39429     ;
                   39430     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
09E5               39431     evaluate_comparator_integrity:
09E5 E525          39432             mov     A, Flags1
09E7 5403          39433             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
09E9 6007          39434             jz      eval_comp_check_timeout
                   39435     
09EB 202902        39436             jb      Flags1.INITIAL_RUN_PHASE, ($+5) ; Do not increment beyond startup phase
09EE 0539          39437             inc     Startup_Cnt                                     ; Increment counter
09F0 8010          39438             jmp     eval_comp_exit
                   39439     
09F2               39440     eval_comp_check_timeout:
09F2 30220D        39441             jnb     Flags0.COMP_TIMED_OUT, eval_comp_exit   ; Has timeout elapsed?
09F5 202B0A        39442             jb      Flags1.DIR_CHANGE_BRAKE, eval_comp_exit ; Do not exit run mode if it is bra
                             king
09F8 202107        39443             jb      Flags0.DEMAG_DETECTED, eval_comp_exit   ; Do not exit run mode if it is a d
                             emag situation
09FB 1581          39444             dec     SP                                                              ; Routine e
                             xit without "ret" command
09FD 1581          39445             dec     SP
09FF 0213DB        39446             ljmp    run_to_wait_for_power_on_fail                   ; Yes - exit run mode
                   39447     
0A02               39448     eval_comp_exit:
0A02 22            39449             ret
                   39450     
                   39451     
                   39452     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   39453     ;
                   39454     ; Wait for commutation routine
                   39455     ;
                   39456     ; No assumptions
                   39457     ;
                   39458     ; Waits from zero cross to commutation 
                   39459     ;
                   39460     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0A03               39461     wait_for_comm: 
                   39462             ; Update demag metric
0A03 7800          39463             mov     Temp1, #0
0A05 302102        39464             jnb     Flags0.DEMAG_DETECTED, ($+5)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   606

                   39465     
0A08 7801          39466             mov     Temp1, #1
                   39467     
0A0A E53D          39468             mov     A, Demag_Detected_Metric        ; Sliding average of 8, 256 when demag and 
                             0 when not. Limited to minimum 120
0A0C 75F007        39469             mov     B, #7
0A0F A4            39470             mul     AB                                      ; Multiply by 7
0A10 F9            39471             mov     Temp2, A
0A11 E5F0          39472             mov     A, B                                    ; Add new value for current demag s
                             tatus
0A13 28            39473             add     A, Temp1                                
0A14 F5F0          39474             mov     B, A
0A16 E9            39475             mov     A, Temp2
0A17 A2F0          39476             mov     C, B.0                          ; Divide by 8
0A19 13            39477             rrc     A                                       
0A1A A2F1          39478             mov     C, B.1
0A1C 13            39479             rrc     A
0A1D A2F2          39480             mov     C, B.2
0A1F 13            39481             rrc     A
0A20 F53D          39482             mov     Demag_Detected_Metric, A
0A22 C3            39483             clr     C
0A23 9478          39484             subb    A, #120                         ; Limit to minimum 120
0A25 5003          39485             jnc     ($+5)
                   39486     
0A27 753D78        39487             mov     Demag_Detected_Metric, #120
                   39488     
0A2A C3            39489             clr     C
0A2B E53D          39490             mov     A, Demag_Detected_Metric        ; Check demag metric
0A2D 953E          39491             subb    A, Demag_Pwr_Off_Thresh
0A2F 4009          39492             jc      wait_for_comm_wait              ; Cut power if many consecutive demags. Thi
                             s will help retain sync during hard accelerations
                   39493     
                   39494             All_pwmFETs_off
                   39504             Set_Pwms_Off
                   39506     
0A3A               39507     wait_for_comm_wait:
0A3A 302002        39508             jnb Flags0.T3_PENDING, ($+5)                    
0A3D 413A          39509             ajmp    wait_for_comm_wait
                   39510     
                   39511             ; Setup next wait time
0A3F 854C92        39512             mov     TMR3RLL, Wt_Zc_Scan_Start_L
0A42 854D93        39513             mov     TMR3RLH, Wt_Zc_Scan_Start_H
0A45 D220          39514             setb    Flags0.T3_PENDING
0A47 43E680        39515             orl     EIE1, #80h                      ; Enable timer 3 interrupts
0A4A 22            39516             ret
                   39517     
                   39518     
                   39519     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   39520     ;
                   39521     ; Commutation routines
                   39522     ;
                   39523     ; No assumptions
                   39524     ;
                   39525     ; Performs commutation switching 
                   39526     ;
                   39527     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   39528     ; Comm phase 1 to comm phase 2
0A4B               39529     comm1comm2:     
                   39530             Set_RPM_Out
0A4B 203810        39531             jb      Flags3.PGM_DIR_REV, comm12_rev
                   39532     
0A4E C2AF          39533             clr     IE_EA                           ; Disable all interrupts
                   39534             BcomFET_off                             ; Turn off comfet
                   39536             AcomFET_on                              ; Turn on comfet
                   39541             Set_Pwm_C                                       ; To reapply power after a demag cut
0A57 D2AF          39548             setb    IE_EA
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   607

                   39549             Set_Comp_Phase_B                        ; Set comparator phase
0A5C 611B          39551             jmp     comm_exit
                   39552     
0A5E               39553     comm12_rev:     
0A5E C2AF          39554             clr     IE_EA                           ; Disable all interrupts
                   39555             BcomFET_off                             ; Turn off comfet
                   39557             CcomFET_on                              ; Turn on comfet (reverse)
                   39562             Set_Pwm_A                                       ; To reapply power after a demag cut
0A67 D2AF          39569             setb    IE_EA
                   39570             Set_Comp_Phase_B                        ; Set comparator phase
0A6C 611B          39572             jmp     comm_exit
                   39573     
                   39574     
                   39575     ; Comm phase 2 to comm phase 3
0A6E               39576     comm2comm3:     
                   39577             Clear_RPM_Out
0A6E 203810        39578             jb      Flags3.PGM_DIR_REV, comm23_rev
                   39579     
0A71 C2AF          39580             clr     IE_EA                           ; Disable all interrupts
                   39581             CpwmFET_off                             ; Turn off pwmfet
                   39587             Set_Pwm_B                                       ; To reapply power after a demag cut
                   39594             AcomFET_on
0A7A D2AF          39599             setb    IE_EA
                   39600             Set_Comp_Phase_C                        ; Set comparator phase
0A7F 611B          39602             ajmp    comm_exit
                   39603     
0A81               39604     comm23_rev:
0A81 C2AF          39605             clr     IE_EA                           ; Disable all interrupts
                   39606             ApwmFET_off                             ; Turn off pwmfet (reverse)
                   39612             Set_Pwm_B                                       ; To reapply power after a demag cut
                   39619             CcomFET_on
0A8A D2AF          39624             setb    IE_EA
                   39625             Set_Comp_Phase_A                        ; Set comparator phase (reverse)
0A8F 611B          39627             ajmp    comm_exit
                   39628     
                   39629     
                   39630     ; Comm phase 3 to comm phase 4
0A91               39631     comm3comm4:     
                   39632             Set_RPM_Out
0A91 203810        39633             jb      Flags3.PGM_DIR_REV, comm34_rev
                   39634     
0A94 C2AF          39635             clr     IE_EA                           ; Disable all interrupts
                   39636             AcomFET_off                             ; Turn off comfet
                   39638             CcomFET_on                              ; Turn on comfet
                   39643             Set_Pwm_B                                       ; To reapply power after a demag cut
0A9D D2AF          39650             setb    IE_EA
                   39651             Set_Comp_Phase_A                        ; Set comparator phase
0AA2 8077          39653             jmp     comm_exit
                   39654     
0AA4               39655     comm34_rev:     
0AA4 C2AF          39656             clr     IE_EA                           ; Disable all interrupts
                   39657             CcomFET_off                             ; Turn off comfet (reverse)
                   39659             AcomFET_on                              ; Turn on comfet (reverse)
                   39664             Set_Pwm_B                                       ; To reapply power after a demag cut
0AAD D2AF          39671             setb    IE_EA
                   39672             Set_Comp_Phase_C                        ; Set comparator phase (reverse)
0AB2 8067          39674             jmp     comm_exit
                   39675     
                   39676     
                   39677     ; Comm phase 4 to comm phase 5
0AB4               39678     comm4comm5:     
                   39679             Clear_RPM_Out
0AB4 203810        39680             jb      Flags3.PGM_DIR_REV, comm45_rev
                   39681     
0AB7 C2AF          39682             clr     IE_EA                           ; Disable all interrupts
                   39683             BpwmFET_off                             ; Turn off pwmfet
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   608

                   39689             Set_Pwm_A                                       ; To reapply power after a demag cut
                   39696             CcomFET_on
0AC0 D2AF          39701             setb    IE_EA
                   39702             Set_Comp_Phase_B                        ; Set comparator phase
0AC5 8054          39704             jmp     comm_exit
                   39705     
0AC7               39706     comm45_rev:
0AC7 C2AF          39707             clr     IE_EA                           ; Disable all interrupts
                   39708             BpwmFET_off                             ; Turn off pwmfet
                   39714             Set_Pwm_C
                   39721             AcomFET_on                              ; To reapply power after a demag cut
0AD0 D2AF          39726             setb    IE_EA
                   39727             Set_Comp_Phase_B                        ; Set comparator phase
0AD5 8044          39729             jmp     comm_exit
                   39730     
                   39731     
                   39732     ; Comm phase 5 to comm phase 6
0AD7               39733     comm5comm6:     
                   39734             Set_RPM_Out
0AD7 203810        39735             jb      Flags3.PGM_DIR_REV, comm56_rev
                   39736     
0ADA C2AF          39737             clr     IE_EA                           ; Disable all interrupts
                   39738             CcomFET_off                             ; Turn off comfet
                   39740             BcomFET_on                              ; Turn on comfet
                   39745             Set_Pwm_A                                       ; To reapply power after a demag cut
0AE3 D2AF          39752             setb    IE_EA
                   39753             Set_Comp_Phase_C                        ; Set comparator phase
0AE8 8031          39755             jmp     comm_exit
                   39756     
0AEA               39757     comm56_rev:
0AEA C2AF          39758             clr     IE_EA                           ; Disable all interrupts
                   39759             AcomFET_off                             ; Turn off comfet (reverse)
                   39761             BcomFET_on                              ; Turn on comfet
                   39766             Set_Pwm_C                                       ; To reapply power after a demag cut
0AF3 D2AF          39773             setb    IE_EA
                   39774             Set_Comp_Phase_A                        ; Set comparator phase (reverse)
0AF8 8021          39776             jmp     comm_exit
                   39777     
                   39778     
                   39779     ; Comm phase 6 to comm phase 1
0AFA               39780     comm6comm1:     
                   39781             Clear_RPM_Out
0AFA 203810        39782             jb      Flags3.PGM_DIR_REV, comm61_rev
                   39783     
0AFD C2AF          39784             clr     IE_EA                           ; Disable all interrupts
                   39785             ApwmFET_off                             ; Turn off pwmfet
                   39791             Set_Pwm_C
                   39798             BcomFET_on                              ; To reapply power after a demag cut
0B06 D2AF          39803             setb    IE_EA
                   39804             Set_Comp_Phase_A                        ; Set comparator phase
0B0B 800E          39806             jmp     comm_exit
                   39807     
0B0D               39808     comm61_rev:
0B0D C2AF          39809             clr     IE_EA                           ; Disable all interrupts
                   39810             CpwmFET_off                             ; Turn off pwmfet (reverse)
                   39816             Set_Pwm_A
                   39823             BcomFET_on                              ; To reapply power after a demag cut
0B16 D2AF          39828             setb    IE_EA
                   39829             Set_Comp_Phase_C                        ; Set comparator phase (reverse)
                   39831     
0B1B               39832     comm_exit:
0B1B 22            39833             ret
                   39834     
                   39835     
                   39836     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   39837     ;
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   609

                   39838     ; Beeper routines (4 different entry points) 
                   39839     ;
                   39840     ; No assumptions
                   39841     ;
                   39842     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0B1C               39843     beep_f1:        ; Entry point 1, load beeper frequency 1 settings
0B1C 7A14          39844             mov     Temp3, #20      ; Off wait loop length
0B1E 7B78          39845             mov     Temp4, #120     ; Number of beep pulses
0B20 8012          39846             jmp     beep
                   39847     
0B22               39848     beep_f2:        ; Entry point 2, load beeper frequency 2 settings
0B22 7A10          39849             mov     Temp3, #16
0B24 7B8C          39850             mov     Temp4, #140
0B26 800C          39851             jmp     beep
                   39852     
0B28               39853     beep_f3:        ; Entry point 3, load beeper frequency 3 settings
0B28 7A0D          39854             mov     Temp3, #13
0B2A 7BB4          39855             mov     Temp4, #180
0B2C 8006          39856             jmp     beep
                   39857     
0B2E               39858     beep_f4:        ; Entry point 4, load beeper frequency 4 settings
0B2E 7A0B          39859             mov     Temp3, #11
0B30 7BC8          39860             mov     Temp4, #200
0B32 8000          39861             jmp     beep
                   39862     
0B34               39863     beep:   ; Beep loop start
0B34 E564          39864             mov     A, Beep_Strength
0B36 D5E001        39865             djnz    ACC, beep_start
0B39 22            39866             ret
                   39867     
0B3A               39868     beep_start:
0B3A 7902          39869             mov     Temp2, #2
0B3C               39870     beep_onoff:
0B3C E4            39871             clr     A
                   39872             BcomFET_off             ; BcomFET off
0B3F D5E0FD        39874             djnz    ACC, $          ; Allow some time after comfet is turned off
                   39875             BpwmFET_on              ; BpwmFET on (in order to charge the driver of the BcomFET)
0B44 D5E0FD        39880             djnz    ACC, $          ; Let the pwmfet be turned on a while
                   39881             BpwmFET_off             ; BpwmFET off again
0B49 D5E0FD        39887             djnz    ACC, $          ; Allow some time after pwmfet is turned off
                   39888             BcomFET_on              ; BcomFET on
0B4E D5E0FD        39893             djnz    ACC, $          ; Allow some time after comfet is turned on
                   39894             ; Turn on pwmfet
0B51 E9            39895             mov     A, Temp2
0B52 20E002        39896             jb      ACC.0, beep_apwmfet_on
                   39897             ApwmFET_on              ; ApwmFET on
0B57               39902     beep_apwmfet_on:
0B57 30E002        39903             jnb     ACC.0, beep_cpwmfet_on
                   39904             CpwmFET_on              ; CpwmFET on
0B5C               39909     beep_cpwmfet_on:
0B5C E564          39910             mov     A, Beep_Strength
0B5E D5E0FD        39911             djnz    ACC, $          
                   39912             ; Turn off pwmfet
0B61 E9            39913             mov     A, Temp2
0B62 20E002        39914             jb      ACC.0, beep_apwmfet_off
                   39915             ApwmFET_off             ; ApwmFET off
0B67               39921     beep_apwmfet_off:
0B67 30E002        39922             jnb     ACC.0, beep_cpwmfet_off
                   39923             CpwmFET_off             ; CpwmFET off
0B6C               39929     beep_cpwmfet_off:
0B6C 7496          39930             mov     A, #150         ; 25us off
0B6E D5E0FD        39931             djnz    ACC, $          
0B71 D9C9          39932             djnz    Temp2, beep_onoff
                   39933             ; Copy variable
0B73 EA            39934             mov     A, Temp3
0B74 F8            39935             mov     Temp1, A        
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   610

0B75               39936     beep_off:               ; Fets off loop
0B75 D5E0FD        39937             djnz    ACC, $
0B78 D8FB          39938             djnz    Temp1,  beep_off
0B7A DBB8          39939             djnz    Temp4,  beep
                   39940             BcomFET_off             ; BcomFET off
0B7E 22            39942             ret
                   39943     
                   39944     
                   39945     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   39946     ;
                   39947     ; Switch power off routine
                   39948     ;
                   39949     ; No assumptions
                   39950     ;
                   39951     ; Switches all fets off 
                   39952     ;
                   39953     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0B7F               39954     switch_power_off:
                   39955             All_pwmFETs_Off         ; Turn off all pwm fets
                   39965             All_comFETs_Off         ; Turn off all commutation fets
                   39969             Set_Pwms_Off
0B8E 22            39971             ret                     
                   39972     
                   39973     
                   39974     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   39975     ;
                   39976     ; Set default parameters
                   39977     ;
                   39978     ; No assumptions
                   39979     ;
                   39980     ; Sets default programming parameters
                   39981     ;
                   39982     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0B8F               39983     set_default_parameters:
0B8F 7880          39984             mov     Temp1, #_Pgm_Gov_P_Gain
0B91 76FF          39985             mov     @Temp1, #0FFh   ; Governor P gain
0B93 08            39986             inc     Temp1
0B94 76FF          39987             mov     @Temp1, #0FFh   ; Governor I gain
0B96 08            39988             inc     Temp1
0B97 76FF          39989             mov     @Temp1, #0FFh   ; Governor mode
0B99 08            39990             inc     Temp1
0B9A 76FF          39991             mov     @Temp1, #0FFh   ; Low voltage limit
0B9C 08            39992             inc     Temp1
0B9D 76FF          39993             mov     @Temp1, #0FFh   ; Multi gain
0B9F 08            39994             inc     Temp1
0BA0 76FF          39995             mov     @Temp1, #0FFh   
0BA2 08            39996             inc     Temp1
0BA3 760D          39997             mov     @Temp1, #DEFAULT_PGM_STARTUP_PWR
0BA5 08            39998             inc     Temp1
0BA6 76FF          39999             mov     @Temp1, #0FFh   ; Pwm freq
0BA8 08            40000             inc     Temp1
0BA9 7602          40001             mov     @Temp1, #DEFAULT_PGM_DIRECTION
                   40002     
0BAB 788C          40003             mov     Temp1, #Pgm_Enable_TX_Program
0BAD 7601          40004             mov     @Temp1, #DEFAULT_PGM_ENABLE_TX_PROGRAM
0BAF 08            40005             inc     Temp1
0BB0 76FF          40006             mov     @Temp1, #0FFh   ; Main rearm start
0BB2 08            40007             inc     Temp1
0BB3 76FF          40008             mov     @Temp1, #0FFh   ; Governor setup target
0BB5 08            40009             inc     Temp1
0BB6 76FF          40010             mov     @Temp1, #0FFh   ; Startup rpm   
0BB8 08            40011             inc     Temp1
0BB9 76FF          40012             mov     @Temp1, #0FFh   ; Startup accel
0BBB 08            40013             inc     Temp1
0BBC 76FF          40014             mov     @Temp1, #0FFh   ; Voltage comp
0BBE 08            40015             inc     Temp1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   611

0BBF 7603          40016             mov     @Temp1, #DEFAULT_PGM_COMM_TIMING
0BC1 08            40017             inc     Temp1
0BC2 76FF          40018             mov     @Temp1, #0FFh   ; Damping force 
0BC4 08            40019             inc     Temp1
0BC5 76FF          40020             mov     @Temp1, #0FFh   ; Governor range
0BC7 08            40021             inc     Temp1
0BC8 76FF          40022             mov     @Temp1, #0FFh   ; Startup method        
0BCA 08            40023             inc     Temp1
0BCB 761B          40024             mov     @Temp1, #DEFAULT_PGM_MIN_THROTTLE
0BCD 08            40025             inc     Temp1
0BCE 76FA          40026             mov     @Temp1, #DEFAULT_PGM_MAX_THROTTLE
0BD0 08            40027             inc     Temp1
0BD1 7601          40028             mov     @Temp1, #DEFAULT_PGM_BEEP_STRENGTH
0BD3 08            40029             inc     Temp1
0BD4 7650          40030             mov     @Temp1, #DEFAULT_PGM_BEACON_STRENGTH
0BD6 08            40031             inc     Temp1
0BD7 7604          40032             mov     @Temp1, #DEFAULT_PGM_BEACON_DELAY
0BD9 08            40033             inc     Temp1
0BDA 76FF          40034             mov     @Temp1, #0FFh   ; Throttle rate 
0BDC 08            40035             inc     Temp1
0BDD 7602          40036             mov     @Temp1, #DEFAULT_PGM_DEMAG_COMP
0BDF 08            40037             inc     Temp1
0BE0 76FF          40038             mov     @Temp1, #0FFh   ; Bec voltage high
0BE2 08            40039             inc     Temp1
0BE3 767A          40040             mov     @Temp1, #DEFAULT_PGM_CENTER_THROTTLE
0BE5 08            40041             inc     Temp1
0BE6 76FF          40042             mov     @Temp1, #0FFh   
0BE8 08            40043             inc     Temp1
0BE9 7607          40044             mov     @Temp1, #DEFAULT_PGM_ENABLE_TEMP_PROT
0BEB 08            40045             inc     Temp1
0BEC 7601          40046             mov     @Temp1, #DEFAULT_PGM_ENABLE_POWER_PROT
0BEE 08            40047             inc     Temp1
0BEF 76FF          40048             mov     @Temp1, #0FFh   ; Enable pwm input
0BF1 08            40049             inc     Temp1
0BF2 76FF          40050             mov     @Temp1, #0FFh   ; Pwm dither
0BF4 08            40051             inc     Temp1
0BF5 7600          40052             mov     @Temp1, #DEFAULT_PGM_BRAKE_ON_STOP
0BF7 08            40053             inc     Temp1
0BF8 7600          40054             mov     @Temp1, #DEFAULT_PGM_LED_CONTROL
0BFA 22            40055             ret
                   40056     
                   40057     
                   40058     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   40059     ;
                   40060     ; Scale throttle cal
                   40061     ;
                   40062     ; No assumptions
                   40063     ;
                   40064     ; Scales a throttle cal value
                   40065     ; Input is ACC, output is Temp2/Temp1
                   40066     ;
                   40067     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0BFB               40068     scale_throttle_cal:
0BFB FA            40069             mov     Temp3, A
0BFC 75F00C        40070             mov     B, #0Ch                 ; Calculate "3%" (for going from 1000us to numerica
                             l 1024)
0BFF A4            40071             mul     AB
0C00 ABF0          40072             mov     Temp4, B
0C02 EA            40073             mov     A, Temp3
0C03 C3            40074             clr     C                               ; Shift to 9 bits
0C04 33            40075             rlc     A
0C05 F8            40076             mov     Temp1, A
0C06 7401          40077             mov     A, #1
0C08 33            40078             rlc     A
0C09 F9            40079             mov     Temp2, A
0C0A E8            40080             mov     A, Temp1                        ; Shift to 10 bits
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   612

0C0B C3            40081             clr     C
0C0C 33            40082             rlc     A
0C0D F8            40083             mov     Temp1, A
0C0E E9            40084             mov     A, Temp2
0C0F 33            40085             rlc     A
0C10 F9            40086             mov     Temp2, A
0C11 E8            40087             mov     A, Temp1                        ; Add "3%"
0C12 C3            40088             clr     C
0C13 2B            40089             add     A, Temp4
0C14 F8            40090             mov     Temp1, A
0C15 E9            40091             mov     A, Temp2
0C16 3400          40092             addc    A, #0
0C18 F9            40093             mov     Temp2, A
                   40094     IF MCU_48MHZ >= 1
0C19 E8            40095             mov     A, Temp1                        ; Shift to 11 bits
0C1A C3            40096             clr     C
0C1B 33            40097             rlc     A
0C1C F8            40098             mov     Temp1, A
0C1D E9            40099             mov     A, Temp2
0C1E 33            40100             rlc     A
0C1F F9            40101             mov     Temp2, A
                   40102     ENDIF
0C20 22            40103     ret
                   40104     
                   40105     
                   40106     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   40107     ;
                   40108     ; Decode settings
                   40109     ;
                   40110     ; No assumptions
                   40111     ;
                   40112     ; Decodes various settings
                   40113     ;
                   40114     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0C21               40115     decode_settings:
                   40116             ; Load programmed direction
0C21 7888          40117             mov     Temp1, #Pgm_Direction   
0C23 E6            40118             mov     A, @Temp1                               
0C24 C3            40119             clr     C
0C25 9403          40120             subb    A, #3
0C27 D23A          40121             setb    Flags3.PGM_BIDIR
0C29 5002          40122             jnc     ($+4)
                   40123     
0C2B C23A          40124             clr     Flags3.PGM_BIDIR
                   40125     
0C2D C238          40126             clr     Flags3.PGM_DIR_REV
0C2F E6            40127             mov     A, @Temp1                               
0C30 30E102        40128             jnb     ACC.1, ($+5)
0C33 D238          40129             setb    Flags3.PGM_DIR_REV
0C35 A238          40130             mov     C, Flags3.PGM_DIR_REV
0C37 9239          40131             mov     Flags3.PGM_BIDIR_REV, C
                   40132             ; Decode startup power
0C39 7886          40133             mov     Temp1, #Pgm_Startup_Pwr         
0C3B E6            40134             mov     A, @Temp1                               
0C3C 14            40135             dec     A       
0C3D 900080        40136             mov     DPTR, #STARTUP_POWER_TABLE
0C40 93            40137             movc A, @A+DPTR 
0C41 78A6          40138             mov     Temp1, #Pgm_Startup_Pwr_Decoded
0C43 F6            40139             mov     @Temp1, A       
                   40140             ; Decode low rpm power slope
0C44 7886          40141             mov     Temp1, #Pgm_Startup_Pwr
0C46 E6            40142             mov     A, @Temp1
0C47 F53F          40143             mov     Low_Rpm_Pwr_Slope, A
0C49 C3            40144             clr     C
0C4A 9402          40145             subb    A, #2
0C4C 5003          40146             jnc     ($+5)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   613

0C4E 753F02        40147             mov     Low_Rpm_Pwr_Slope, #2
                   40148             ; Decode demag compensation
0C51 789C          40149             mov     Temp1, #Pgm_Demag_Comp          
0C53 E6            40150             mov     A, @Temp1                               
0C54 753EFF        40151             mov     Demag_Pwr_Off_Thresh, #255      ; Set default
                   40152     
0C57 B40203        40153             cjne    A, #2, decode_demag_high
                   40154     
0C5A 753EA0        40155             mov     Demag_Pwr_Off_Thresh, #160      ; Settings for demag comp low
                   40156     
0C5D               40157     decode_demag_high:
0C5D B40303        40158             cjne    A, #3, decode_demag_done
                   40159     
0C60 753E82        40160             mov     Demag_Pwr_Off_Thresh, #130      ; Settings for demag comp high
                   40161     
0C63               40162     decode_demag_done:
                   40163             ; Decode temperature protection limit
0C63 78A0          40164             mov     Temp1, #Pgm_Enable_Temp_Prot
0C65 E6            40165             mov     A, @Temp1
0C66 F8            40166             mov     Temp1, A
0C67 6006          40167             jz      decode_temp_done
                   40168     
0C69 7428          40169             mov     A, #(TEMP_LIMIT-TEMP_LIMIT_STEP)
0C6B               40170     decode_temp_step:
0C6B 2409          40171             add     A, #TEMP_LIMIT_STEP
0C6D D8FC          40172             djnz    Temp1, decode_temp_step
                   40173     
0C6F               40174     decode_temp_done:
0C6F F569          40175             mov     Temp_Prot_Limit, A
                   40176             ; Decode throttle cal
0C71 7896          40177             mov     Temp1, #Pgm_Min_Throttle                ; Throttle cal is in 4us units
0C73 E6            40178             mov     A, @Temp1
0C74 71FB          40179             call    scale_throttle_cal
0C76 8831          40180             mov     Min_Throttle_L, Temp1
0C78 8932          40181             mov     Min_Throttle_H, Temp2
0C7A 789E          40182             mov     Temp1, #Pgm_Center_Throttle     ; Throttle cal is in 4us units
0C7C E6            40183             mov     A, @Temp1
0C7D 71FB          40184             call    scale_throttle_cal
0C7F 8833          40185             mov     Center_Throttle_L, Temp1
0C81 8934          40186             mov     Center_Throttle_H, Temp2
0C83 7897          40187             mov     Temp1, #Pgm_Max_Throttle                ; Throttle cal is in 4us units
0C85 E6            40188             mov     A, @Temp1
0C86 71FB          40189             call    scale_throttle_cal
0C88 8835          40190             mov     Max_Throttle_L, Temp1
0C8A 8936          40191             mov     Max_Throttle_H, Temp2
0C8C 717F          40192             call    switch_power_off
0C8E 22            40193             ret
                   40194     
                   40195     
                   40196     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   40197     ;
                   40198     ; Find throttle gains
                   40199     ;
                   40200     ; No assumptions
                   40201     ;
                   40202     ; Finds throttle gains for both directions in bidirectional mode
                   40203     ;
                   40204     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0C8F               40205     find_throttle_gains:
                   40206             ; Check if full range is chosen
0C8F 303611        40207             jnb     Flags2.RCP_FULL_RANGE, find_throttle_gains_normal
                   40208     
0C92 7A00          40209             mov     Temp3, #0               ; Min throttle
0C94 7B00          40210             mov     Temp4, #0
0C96 7CFF          40211             mov     Temp5, #255     ; Max throttle
0C98 7D00          40212             mov     Temp6, #0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   614

0C9A 7E00          40213             mov     Temp7, #0               ; Deadband
0C9C 91F5          40214             call    find_throttle_gain
0C9E 8B61          40215             mov     Throttle_Gain_M, Temp4
0CA0 8A60          40216             mov     Throttle_Gain, Temp3
0CA2 22            40217             ret
                   40218     
0CA3               40219     find_throttle_gains_normal:
                   40220             ; Check if bidirectional operation
0CA3 303A22        40221             jnb     Flags3.PGM_BIDIR, find_throttle_gains_bidir_done
                   40222     
0CA6 7896          40223             mov     Temp1, #Pgm_Min_Throttle
0CA8 E6            40224             mov     A, @Temp1
0CA9 FA            40225             mov     Temp3, A
0CAA 7B00          40226             mov     Temp4, #0
0CAC 789E          40227             mov     Temp1, #Pgm_Center_Throttle
0CAE E6            40228             mov     A, @Temp1
0CAF FC            40229             mov     Temp5, A
0CB0 7D00          40230             mov     Temp6, #0
0CB2 C3            40231             clr     C
0CB3 EA            40232             mov     A, Temp3                        ; Scale gains in bidirectional
0CB4 33            40233             rlc     A
0CB5 FA            40234             mov     Temp3, A
0CB6 EB            40235             mov     A, Temp4
0CB7 33            40236             rlc     A
0CB8 FB            40237             mov     Temp4, A
0CB9 C3            40238             clr     C
0CBA EC            40239             mov     A, Temp5
0CBB 33            40240             rlc     A
0CBC FC            40241             mov     Temp5, A
0CBD ED            40242             mov     A, Temp6
0CBE 33            40243             rlc     A
0CBF FD            40244             mov     Temp6, A
0CC0 7E0A          40245             mov     Temp7, #10              ; Compensate for deadband in bidirectional
0CC2 91F5          40246             call    find_throttle_gain
0CC4 8B63          40247             mov     Throttle_Gain_BD_Rev_M, Temp4
0CC6 8A62          40248             mov     Throttle_Gain_BD_Rev, Temp3
                   40249     
0CC8               40250     find_throttle_gains_bidir_done:
0CC8 7896          40251             mov     Temp1, #Pgm_Min_Throttle
0CCA 303A02        40252             jnb     Flags3.PGM_BIDIR, ($+5)
                   40253     
0CCD 789E          40254             mov     Temp1, #Pgm_Center_Throttle
                   40255     
0CCF E6            40256             mov     A, @Temp1
0CD0 FA            40257             mov     Temp3, A
0CD1 7B00          40258             mov     Temp4, #0
0CD3 7897          40259             mov     Temp1, #Pgm_Max_Throttle
0CD5 E6            40260             mov     A, @Temp1
0CD6 FC            40261             mov     Temp5, A
0CD7 7D00          40262             mov     Temp6, #0
0CD9 7E00          40263             mov     Temp7, #0                       ; No deadband
0CDB 303A10        40264             jnb     Flags3.PGM_BIDIR, find_throttle_gain_fwd
                   40265     
0CDE C3            40266             clr     C
0CDF EA            40267             mov     A, Temp3                        ; Scale gains in bidirectional
0CE0 33            40268             rlc     A
0CE1 FA            40269             mov     Temp3, A
0CE2 EB            40270             mov     A, Temp4
0CE3 33            40271             rlc     A
0CE4 FB            40272             mov     Temp4, A
0CE5 C3            40273             clr     C
0CE6 EC            40274             mov     A, Temp5
0CE7 33            40275             rlc     A
0CE8 FC            40276             mov     Temp5, A
0CE9 ED            40277             mov     A, Temp6
0CEA 33            40278             rlc     A
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   615

0CEB FD            40279             mov     Temp6, A
0CEC 7E0A          40280             mov     Temp7, #10              ; Compensate for deadband in bidirectional
                   40281     
0CEE               40282     find_throttle_gain_fwd:
0CEE 91F5          40283             call    find_throttle_gain
0CF0 8B61          40284             mov     Throttle_Gain_M, Temp4
0CF2 8A60          40285             mov     Throttle_Gain, Temp3
0CF4 22            40286             ret
                   40287     
                   40288     
                   40289     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   40290     ;
                   40291     ; Find throttle gain
                   40292     ;
                   40293     ; The difference between max and min throttle must be more than 140us (a Pgm_xxx_Throttle d
                             ifference of 35)
                   40294     ; Temp4/3 holds min throttle, Temp6/5 holds max throttle, Temp7 holds deadband, Temp4/Temp3
                              gives resulting gain
                   40295     ;
                   40296     ; Finds throttle gain from throttle calibration values
                   40297     ;
                   40298     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0CF5               40299     find_throttle_gain:
                   40300             ; Subtract deadband from max
0CF5 C3            40301             clr     C
0CF6 EC            40302             mov     A, Temp5
0CF7 9E            40303             subb    A, Temp7
0CF8 FC            40304             mov     Temp5, A
0CF9 ED            40305             mov     A, Temp6
0CFA 9400          40306             subb    A, #0
0CFC FD            40307             mov     Temp6, A
                   40308             ; Calculate difference
0CFD C3            40309             clr     C
0CFE EC            40310             mov     A, Temp5
0CFF 9A            40311             subb    A, Temp3
0D00 FC            40312             mov     Temp5, A
0D01 ED            40313             mov     A, Temp6
0D02 9B            40314             subb    A, Temp4
0D03 FD            40315             mov     Temp6, A
                   40316             ; Check that difference is minimum 35
0D04 C3            40317             clr     C
0D05 EC            40318             mov     A, Temp5
0D06 9423          40319             subb    A, #35
0D08 ED            40320             mov     A, Temp6
0D09 9400          40321             subb    A, #0
0D0B 5004          40322             jnc     ($+6)
                   40323     
0D0D 7C23          40324             mov     Temp5, #35
0D0F 7D00          40325             mov     Temp6, #0
                   40326     
                   40327             ; Check that difference is maximum 511
0D11 C3            40328             clr     C
0D12 EC            40329             mov     A, Temp5
0D13 94FF          40330             subb    A, #255
0D15 ED            40331             mov     A, Temp6
0D16 9401          40332             subb    A, #1
0D18 4004          40333             jc      ($+6)
                   40334     
0D1A 7CFF          40335             mov     Temp5, #255
0D1C 7D01          40336             mov     Temp6, #1
                   40337     
                   40338             ; Find gain
0D1E 7BFF          40339             mov     Temp4, #0FFh
0D20               40340     find_throttle_gain_loop:
0D20 0B            40341             inc     Temp4
0D21 7A00          40342             mov     Temp3, #0
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   616

0D23               40343     test_throttle_gain:
0D23 0A            40344             inc     Temp3
0D24 EA            40345             mov     A, Temp3
0D25 7009          40346             jnz     test_throttle_gain_mult
                   40347     
0D27 C3            40348             clr     C
0D28 EC            40349             mov     A, Temp5                        ; Set multiplier x2 and range /2
0D29 33            40350             rlc     A
0D2A FC            40351             mov     Temp5, A
0D2B ED            40352             mov     A, Temp6
0D2C 33            40353             rlc     A
0D2D FD            40354             mov     Temp6, A
0D2E A120          40355             ajmp    find_throttle_gain_loop
                   40356     
0D30               40357     test_throttle_gain_mult:
0D30 EC            40358             mov     A, Temp5                        ; A has difference, B has gain
0D31 8AF0          40359             mov     B, Temp3
0D33 A4            40360             mul     AB
0D34 AEF0          40361             mov     Temp7, B
0D36 ED            40362             mov     A, Temp6
0D37 8AF0          40363             mov     B, Temp3
0D39 A4            40364             mul     AB
0D3A 2E            40365             add     A, Temp7
0D3B 947C          40366             subb    A, #124
0D3D 40E4          40367             jc      test_throttle_gain
                   40368     
0D3F EA            40369             mov     A, Temp3
0D40 F4            40370             cpl     A
0D41 60DD          40371             jz      find_throttle_gain_loop
                   40372     
0D43 22            40373             ret
                   40374     
                   40375     
                   40376     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   40377     ;
                   40378     ; Average throttle 
                   40379     ;
                   40380     ; Outputs result in Temp8
                   40381     ;
                   40382     ; Averages throttle calibration readings
                   40383     ;
                   40384     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0D44               40385     average_throttle:
0D44 D236          40386             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
0D46 918F          40387             call    find_throttle_gains     ; Set throttle gains
0D48 1205A3        40388             call wait30ms           
0D4B 1205A3        40389             call wait30ms
0D4E 7A00          40390             mov     Temp3, #0
0D50 7B00          40391             mov     Temp4, #0
0D52 7C10          40392             mov     Temp5, #16              ; Average 16 measurments
0D54               40393     average_throttle_meas:
0D54 12059B        40394             call    wait3ms                 ; Wait for new RC pulse value
0D57 E554          40395             mov     A, New_Rcp              ; Get new RC pulse value
0D59 2A            40396             add     A, Temp3
0D5A FA            40397             mov     Temp3, A
0D5B 7400          40398             mov     A, #0
0D5D 3B            40399             addc A, Temp4
0D5E FB            40400             mov     Temp4, A
0D5F DCF3          40401             djnz    Temp5, average_throttle_meas
                   40402     
0D61 7C04          40403             mov     Temp5, #4                       ; Shift 4 times
0D63               40404     average_throttle_div:
0D63 C3            40405             clr     C
0D64 EB            40406             mov     A, Temp4                ; Shift right 
0D65 13            40407             rrc     A      
0D66 FB            40408             mov     Temp4, A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   617

0D67 EA            40409             mov     A, Temp3   
0D68 13            40410             rrc     A      
0D69 FA            40411             mov     Temp3, A   
0D6A DCF7          40412             djnz    Temp5, average_throttle_div
                   40413     
0D6C FF            40414             mov     Temp8, A                ; Copy to Temp8
0D6D EB            40415             mov     A, Temp4
0D6E 6002          40416             jz      ($+4)
                   40417     
0D70 7FFF          40418             mov     Temp8, #0FFh
                   40419     
0D72 C236          40420             clr     Flags2.RCP_FULL_RANGE
0D74 918F          40421             call    find_throttle_gains     ; Set throttle gains
0D76 22            40422             ret
                   40423     
                   40424     
                   40425     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   40426     ;
                   40427     ; LED control
                   40428     ;
                   40429     ; No assumptions
                   40430     ;
                   40431     ; Controls LEDs
                   40432     ;
                   40433     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0D77               40434     led_control:
0D77 78A5          40435             mov     Temp1, #Pgm_LED_Control
0D79 E6            40436             mov     A, @Temp1
0D7A F9            40437             mov     Temp2, A
0D7B 5403          40438             anl     A, #03h
                   40439             Set_LED_0
0D7F 7002          40441             jnz     led_0_done
                   40442             Clear_LED_0
0D83               40444     led_0_done:
0D83 E9            40445             mov     A, Temp2
0D84 540C          40446             anl     A, #0Ch
                   40447             Set_LED_1
0D88 7002          40449             jnz     led_1_done
                   40450             Clear_LED_1
0D8C               40452     led_1_done:
0D8C E9            40453             mov     A, Temp2
0D8D 5430          40454             anl     A, #030h
                   40455             Set_LED_2
0D91 7002          40457             jnz     led_2_done
                   40458             Clear_LED_2
0D95               40460     led_2_done:
0D95 E9            40461             mov     A, Temp2
0D96 54C0          40462             anl     A, #0C0h
                   40463             Set_LED_3
0D98 7000          40464             jnz     led_3_done
                   40465             Clear_LED_3
0D9A               40466     led_3_done:
0D9A 22            40467             ret
                   40468     
                   40469     
                   40470     
                   40471     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   40472     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   40473     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   40474     ;
                   40475     ; Main program start
                   40476     ;
                   40477     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   40478     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   40479     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   40480     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   618

0D9B               40481     pgm_start:
                   40482             ; Initialize flash keys to invalid values
0D9B 756700        40483             mov     Flash_Key_1, #0
0D9E 756800        40484             mov     Flash_Key_2, #0
                   40485             ; Disable the WDT.
0DA1 7597DE        40486             mov     WDTCN, #0DEh            ; Disable watchdog
0DA4 7597AD        40487             mov     WDTCN, #0ADh            
                   40488             ; Initialize stack
0DA7 7581C0        40489             mov     SP, #0c0h                       ; Stack = 64 upper bytes of RAM
                   40490             ; Initialize VDD monitor
                   40491     IF MCU_48MHZ < 2
0DAA 43FF80        40492             orl     VDM0CN, #080h           ; Enable the VDD monitor
                   40493     ENDIF
0DAD 75EF06        40494             mov     RSTSRC, #06h    ; Set missing clock and VDD monitor as a reset source if no
                             t 1S capable
                   40495             ; Set clock frequency
0DB0 75A900        40496             mov     CLKSEL, #00h            ; Set clock divider to 1
                   40497             ; Switch power off
0DB3 717F          40498             call    switch_power_off
                   40499             ; Ports initialization
0DB5 7580FF        40500             mov     P0, #P0_INIT
0DB8 75F1F0        40501             mov     P0MDIN, #P0_DIGITAL
0DBB 75A4E0        40502             mov     P0MDOUT, #P0_PUSHPULL
0DBE 7580FF        40503             mov     P0, #P0_INIT
0DC1 75D4FF        40504             mov     P0SKIP, #P0_SKIP                                
0DC4 759000        40505             mov     P1, #P1_INIT
0DC7 75F23F        40506             mov     P1MDIN, #P1_DIGITAL
0DCA 75A53F        40507             mov     P1MDOUT, #P1_PUSHPULL
0DCD 759000        40508             mov     P1, #P1_INIT
0DD0 75D53F        40509             mov     P1SKIP, #P1_SKIP                                
0DD3 75A601        40510             mov     P2MDOUT, #P2_PUSHPULL                           
                   40511             ; Initialize the XBAR and related functionality
                   40512             Initialize_Xbar
                   40515             ; Switch power off again, after initializing ports
0DDC 717F          40516             call    switch_power_off
                   40517             ; Clear RAM
0DDE E4            40518             clr     A                               ; Clear accumulator
0DDF F8            40519             mov     Temp1, A                        ; Clear Temp1
0DE0               40520             clear_ram:      
0DE0 F6            40521             mov     @Temp1, A                       ; Clear RAM
0DE1 D8FD          40522             djnz Temp1, clear_ram   ; Is A not zero? - jump
                   40523             ; Set default programmed parameters
0DE3 718F          40524             call    set_default_parameters
                   40525             ; Read all programmed parameters
0DE5 12141F        40526             call read_all_eeprom_parameters
                   40527             ; Set beep strength
0DE8 7898          40528             mov     Temp1, #Pgm_Beep_Strength
0DEA 8664          40529             mov     Beep_Strength, @Temp1
                   40530             ; Set initial arm variable
0DEC 753001        40531             mov     Initial_Arm, #1
                   40532             ; Initializing beep
0DEF C2AF          40533             clr     IE_EA                   ; Disable interrupts explicitly
0DF1 1205AB        40534             call wait200ms  
0DF4 711C          40535             call beep_f1
0DF6 1205A3        40536             call wait30ms
0DF9 7122          40537             call beep_f2
0DFB 1205A3        40538             call wait30ms
0DFE 7128          40539             call beep_f3
0E00 1205A3        40540             call wait30ms
0E03 B177          40541             call    led_control
                   40542     
                   40543     
                   40544     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   40545     ;
                   40546     ; No signal entry point
                   40547     ;
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   619

                   40548     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0E05               40549     init_no_signal:
                   40550             ; Disable interrupts explicitly
0E05 C2AF          40551             clr     IE_EA
                   40552             ; Initialize flash keys to invalid values
0E07 756700        40553             mov     Flash_Key_1, #0
0E0A 756800        40554             mov     Flash_Key_2, #0
                   40555             ; Check if input signal is high for more than 15ms
0E0D 78FA          40556             mov     Temp1, #250
0E0F               40557     input_high_check_1:
0E0F 79FA          40558             mov     Temp2, #250
0E11               40559     input_high_check_2:
0E11 308407        40560             jnb     RTX_PORT.RTX_PIN, bootloader_done       ; Look for low
0E14 D9FB          40561             djnz    Temp2, input_high_check_2
0E16 D8F7          40562             djnz    Temp1, input_high_check_1
                   40563     
                   40564     IF MCU_48MHZ == 2
                                     ljmp    0F000h                  ; Jump to bootloader
                             ELSE
0E18 021C00        40567             ljmp    1C00h                   ; Jump to bootloader
                   40568     ENDIF
                   40569     
0E1B               40570     bootloader_done:
                   40571             ; Decode settings
0E1B 9121          40572             call    decode_settings
                   40573             ; Find throttle gain from stored min and max settings
0E1D 918F          40574             call    find_throttle_gains
                   40575             ; Set beep strength
0E1F 7898          40576             mov     Temp1, #Pgm_Beep_Strength
0E21 8664          40577             mov     Beep_Strength, @Temp1
                   40578             ; Switch power off
0E23 717F          40579             call    switch_power_off
                   40580             ; Set clock frequency
                   40581     IF MCU_48MHZ >= 1
                   40582             Set_MCU_Clk_24MHz
                   40588     ENDIF
                   40589             ; Setup timers for pwm input
0E34 75E404        40590             mov     IT01CF, #RTX_PIN        ; Route RCP input to INT0
0E37 758811        40591             mov     TCON, #11h              ; Timer 0 run and INT0 edge triggered
0E3A 758E04        40592             mov     CKCON0, #04h            ; Timer 0 clock is system clock
0E3D 758909        40593             mov     TMOD, #09h              ; Timer 0 set to 16bits and gated by INT0
0E40 75C804        40594             mov     TMR2CN0, #04h           ; Timer 2 enabled
0E43 759104        40595             mov     TMR3CN0, #04h           ; Timer 3 enabled
                   40596             Initialize_PCA                  ; Initialize PCA
                   40614             Set_Pwm_Polarity                ; Set pwm polarity
                   40616             Enable_Power_Pwm_Module ; Enable power pwm module
                   40622             Enable_Damp_Pwm_Module  ; Enable damping pwm module
                   40628             ; Enable interrupts
                   40629     IF MCU_48MHZ == 0
                                     mov     IE, #21h                        ; Enable timer 2 interrupts and INT0 interr
                             upts
                             ELSE
0E5B 75A823        40632             mov     IE, #23h                        ; Enable timer 0, timer 2 interrupts and IN
                             T0 interrupts
                   40633     ENDIF
0E5E 75E690        40634             mov     EIE1, #90h              ; Enable timer 3 and PCA0 interrupts
0E61 75B801        40635             mov     IP, #01h                        ; High priority to INT0 interrupts
                   40636             ; Initialize comparator
                   40637             Initialize_Comparator   ; Initialize comparator
                   40640             ; Initialize ADC
                   40641             Initialize_Adc                  ; Initialize ADC operation
0E79 120597        40651             call    wait1ms
0E7C D2AF          40652             setb    IE_EA                   ; Enable all interrupts
                   40653             ; Reset stall count
0E7E 753C00        40654             mov     Stall_Cnt, #0
                   40655             ; Initialize RC pulse
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   620

0E81 C230          40656             clr     Flags2.RCP_UPDATED                      ; Clear updated flag
0E83 1205AB        40657             call wait200ms
                   40658             ; Clear all shot flags
0E86 C231          40659             clr     Flags2.RCP_ONESHOT125                   ; Clear OneShot125 flag
0E88 C232          40660             clr     Flags2.RCP_ONESHOT42                    ; Clear OneShot42 flag
0E8A C233          40661             clr     Flags2.RCP_MULTISHOT                    ; Clear Multishot flag
0E8C C234          40662             clr     Flags2.RCP_DSHOT                                ; Clear DShot flag
0E8E 755200        40663             mov     Dshot_Cmd, #0                                   ; Clear Dshot command
0E91 755300        40664             mov     Dshot_Cmd_Cnt, #0                               ; Clear Dshot command count
                   40665             ; Test whether signal is regular pwm
0E94 752200        40666             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
0E97 1205A7        40667             call wait100ms                                          ; Wait for new RC pulse
0E9A C3            40668             clr     C
0E9B E522          40669             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses wer
                             e outside normal range ("900-2235us")
0E9D 940A          40670             subb    A, #10                                          
0E9F 5002          40671             jnc     ($+4)
0EA1 E16B          40672             ajmp    validate_rcp_start
                   40673     
                   40674             ; Test whether signal is OneShot125
0EA3 D231          40675             setb    Flags2.RCP_ONESHOT125                   ; Set OneShot125 flag
0EA5 752200        40676             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
0EA8 1205A7        40677             call wait100ms                                          ; Wait for new RC pulse
0EAB C3            40678             clr     C
0EAC E522          40679             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses wer
                             e outside normal range ("900-2235us")
0EAE 940A          40680             subb    A, #10
0EB0 5002          40681             jnc     ($+4)
0EB2 E16B          40682             ajmp    validate_rcp_start
                   40683     
                   40684             ; Test whether signal is OneShot42
0EB4 C231          40685             clr     Flags2.RCP_ONESHOT125
0EB6 D232          40686             setb    Flags2.RCP_ONESHOT42                    ; Set OneShot42 flag
0EB8 752200        40687             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
0EBB 1205A7        40688             call wait100ms                                          ; Wait for new RC pulse
0EBE C3            40689             clr     C
0EBF E522          40690             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses wer
                             e outside normal range ("900-2235us")
0EC1 940A          40691             subb    A, #10
0EC3 5002          40692             jnc     ($+4)
0EC5 E16B          40693             ajmp    validate_rcp_start
                   40694     
                   40695             ; Setup timers for DShot
0EC7 75E4C4        40696             mov     IT01CF, #(80h+(RTX_PIN SHL 4)+(RTX_PIN))        ; Route RCP input to INT0/1
                             , with INT1 inverted
0ECA 758851        40697             mov     TCON, #51h              ; Timer 0/1 run and INT0 edge triggered
0ECD 758E01        40698             mov     CKCON0, #01h            ; Timer 0/1 clock is system clock divided by 4 (for
                              DShot150)
0ED0 7589AA        40699             mov     TMOD, #0AAh             ; Timer 0/1 set to 8bits auto reload and gated by I
                             NT0
0ED3 758C00        40700             mov     TH0, #0                 ; Auto reload value zero
0ED6 758D00        40701             mov     TH1, #0
                   40702             ; Setup interrupts for DShot
0ED9 C2A9          40703             clr     IE_ET0                  ; Disable timer 0 interrupts
0EDB D2AB          40704             setb    IE_ET1                  ; Enable timer 1 interrupts
0EDD D2AA          40705             setb    IE_EX1                  ; Enable int1 interrupts
                   40706             ; Setup variables for DSshot150
                   40707     IF MCU_48MHZ >= 1
0EDF 756B80        40708             mov     DShot_Timer_Preset, #128                        ; Load DShot sync timer pre
                             set (for DShot150)
                   40709     ELSE
                                     mov     DShot_Timer_Preset, #192
                             ENDIF
0EE2 756A14        40712             mov     DShot_Pwm_Thr, #20                              ; Load DShot qualification 
                             pwm threshold (for DShot150)
0EE5 756E50        40713             mov     DShot_Frame_Length_Thr, #80             ; Load DShot frame length criteria
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   621

                   40714             ; Test whether signal is DShot150
0EE8 C232          40715             clr     Flags2.RCP_ONESHOT42
0EEA D234          40716             setb    Flags2.RCP_DSHOT
0EEC 75220A        40717             mov     Rcp_Outside_Range_Cnt, #10              ; Set out of range counter
0EEF 1205A7        40718             call wait100ms                                          ; Wait for new RC pulse
0EF2 756A10        40719             mov     DShot_Pwm_Thr, #16                              ; Load DShot regular pwm th
                             reshold
0EF5 C3            40720             clr     C
0EF6 E522          40721             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were acce
                             pted
0EF8 940A          40722             subb    A, #10
0EFA 755200        40723             mov     Dshot_Cmd, #0
0EFD 755300        40724             mov     Dshot_Cmd_Cnt, #0
0F00 4069          40725             jc      validate_rcp_start
                   40726     
                   40727             ; Setup variables for DShot300
0F02 758E0C        40728             mov     CKCON0, #0Ch                                    ; Timer 0/1 clock is system
                              clock (for DShot300)
                   40729     IF MCU_48MHZ >= 1
0F05 756B00        40730             mov     DShot_Timer_Preset, #0                  ; Load DShot sync timer preset (for
                              DShot300)
                   40731     ELSE
                                     mov     DShot_Timer_Preset, #128
                             ENDIF
0F08 756A28        40734             mov     DShot_Pwm_Thr, #40                              ; Load DShot qualification 
                             pwm threshold (for DShot300)
0F0B 756E28        40735             mov     DShot_Frame_Length_Thr, #40             ; Load DShot frame length criteria
                   40736             ; Test whether signal is DShot300
0F0E 75220A        40737             mov     Rcp_Outside_Range_Cnt, #10              ; Set out of range counter
0F11 1205A7        40738             call wait100ms                                          ; Wait for new RC pulse
0F14 756A20        40739             mov     DShot_Pwm_Thr, #32                              ; Load DShot regular pwm th
                             reshold
0F17 C3            40740             clr     C
0F18 E522          40741             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were acce
                             pted
0F1A 940A          40742             subb    A, #10
0F1C 755200        40743             mov     Dshot_Cmd, #0
0F1F 755300        40744             mov     Dshot_Cmd_Cnt, #0
0F22 4047          40745             jc      validate_rcp_start
                   40746     
                   40747             ; Setup variables for DShot600
0F24 758E0C        40748             mov     CKCON0, #0Ch                                    ; Timer 0/1 clock is system
                              clock (for DShot600)
                   40749     IF MCU_48MHZ >= 1
0F27 756B80        40750             mov     DShot_Timer_Preset, #128                        ; Load DShot sync timer pre
                             set (for DShot600)
                   40751     ELSE
                                     mov     DShot_Timer_Preset, #192
                             ENDIF
0F2A 756A14        40754             mov     DShot_Pwm_Thr, #20                              ; Load DShot qualification 
                             pwm threshold (for DShot600)
0F2D 756E14        40755             mov     DShot_Frame_Length_Thr, #20             ; Load DShot frame length criteria
                   40756             ; Test whether signal is DShot600
0F30 75220A        40757             mov     Rcp_Outside_Range_Cnt, #10              ; Set out of range counter
0F33 1205A7        40758             call wait100ms                                          ; Wait for new RC pulse
0F36 756A10        40759             mov     DShot_Pwm_Thr, #16                              ; Load DShot regular pwm th
                             reshold
0F39 C3            40760             clr     C
0F3A E522          40761             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were acce
                             pted
0F3C 940A          40762             subb    A, #10
0F3E 755200        40763             mov     Dshot_Cmd, #0
0F41 755300        40764             mov     Dshot_Cmd_Cnt, #0
0F44 4025          40765             jc      validate_rcp_start
                   40766     
                   40767             ; Setup timers for Multishot
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   622

0F46 75E404        40768             mov     IT01CF, #RTX_PIN        ; Route RCP input to INT0
0F49 758811        40769             mov     TCON, #11h              ; Timer 0 run and INT0 edge triggered
0F4C 758E04        40770             mov     CKCON0, #04h            ; Timer 0 clock is system clock
0F4F 758909        40771             mov     TMOD, #09h              ; Timer 0 set to 16bits and gated by INT0
                   40772             ; Setup interrupts for Multishot
0F52 D2A9          40773             setb    IE_ET0                  ; Enable timer 0 interrupts
0F54 C2AB          40774             clr     IE_ET1                  ; Disable timer 1 interrupts
0F56 C2AA          40775             clr     IE_EX1                  ; Disable int1 interrupts
                   40776             ; Test whether signal is Multishot
0F58 C234          40777             clr     Flags2.RCP_DSHOT
0F5A D233          40778             setb    Flags2.RCP_MULTISHOT                    ; Set Multishot flag
0F5C 752200        40779             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
0F5F 1205A7        40780             call wait100ms                                          ; Wait for new RC pulse
0F62 C3            40781             clr     C
0F63 E522          40782             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses wer
                             e outside normal range ("900-2235us")
0F65 940A          40783             subb    A, #10
0F67 4002          40784             jc      validate_rcp_start
                   40785     
0F69 C105          40786             ajmp    init_no_signal
                   40787     
0F6B               40788     validate_rcp_start:
                   40789             ; Validate RC pulse
0F6B 12059B        40790             call wait3ms                                            ; Wait for new RC pulse
0F6E 203003        40791             jb      Flags2.RCP_UPDATED, ($+6)               ; Is there an updated RC pulse avai
                             lable - proceed
0F71 020E05        40792             ljmp    init_no_signal                                  ; Go back to detect input s
                             ignal
                   40793     
                   40794             ; Beep arm sequence start signal
0F74 C2AF          40795             clr     IE_EA                                           ; Disable all interrupts
0F76 711C          40796             call beep_f1                                            ; Signal that RC pulse is r
                             eady
0F78 711C          40797             call beep_f1
0F7A 711C          40798             call beep_f1
0F7C D2AF          40799             setb    IE_EA                                           ; Enable all interrupts
0F7E 1205AB        40800             call wait200ms  
                   40801     
                   40802             ; Arming sequence start
0F81               40803     arming_start:
0F81 203403        40804             jb      Flags2.RCP_DSHOT, ($+6) ; Disable tx programming for DShot
0F84 303A03        40805             jnb     Flags3.PGM_BIDIR, ($+6)
                   40806     
0F87 02102B        40807             ljmp    program_by_tx_checked   ; Disable tx programming if bidirectional operation
                   40808     
0F8A 12059B        40809             call wait3ms
0F8D 788C          40810             mov     Temp1, #Pgm_Enable_TX_Program; Start programming mode entry if enabled
0F8F E6            40811             mov     A, @Temp1                               
0F90 C3            40812             clr     C
0F91 9401          40813             subb    A, #1                           ; Is TX programming enabled?
0F93 5003          40814             jnc     arming_initial_arm_check        ; Yes - proceed
                   40815     
0F95 02102B        40816             jmp     program_by_tx_checked   ; No - branch
                   40817     
0F98               40818     arming_initial_arm_check:
0F98 E530          40819             mov     A, Initial_Arm                  ; Yes - check if it is initial arm sequence
0F9A C3            40820             clr     C
0F9B 9401          40821             subb    A, #1                           ; Is it the initial arm sequence?
0F9D 5003          40822             jnc     arming_check                    ; Yes - proceed
                   40823     
0F9F 02102B        40824             jmp     program_by_tx_checked   ; No - branch
                   40825     
0FA2               40826     arming_check:
                   40827             ; Initialize flash keys to valid values
0FA2 7567A5        40828             mov     Flash_Key_1, #0A5h
0FA5 7568F1        40829             mov     Flash_Key_2, #0F1h
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   623

                   40830             ; Throttle calibration and tx program entry
0FA8 7F02          40831             mov     Temp8, #2                               ; Set 1 seconds wait time
0FAA               40832     throttle_high_cal:                      
0FAA D236          40833             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
0FAC 918F          40834             call    find_throttle_gains             ; Set throttle gains
0FAE 1205A7        40835             call wait100ms                          ; Wait for new throttle value
0FB1 C2AF          40836             clr     IE_EA                           ; Disable interrupts (freeze New_Rcp value)
0FB3 C236          40837             clr     Flags2.RCP_FULL_RANGE   ; Set programmed range
0FB5 918F          40838             call    find_throttle_gains             ; Set throttle gains
0FB7 C3            40839             clr     C
0FB8 E554          40840             mov     A, New_Rcp                      ; Load new RC pulse value
0FBA 947F          40841             subb    A, #(255/2)                     ; Is RC pulse above midstick?
0FBC D2AF          40842             setb    IE_EA                           ; Enable interrupts
0FBE 406B          40843             jc      program_by_tx_checked   ; No - branch
                   40844     
0FC0 120597        40845             call wait1ms            
0FC3 C2AF          40846             clr     IE_EA                           ; Disable all interrupts
0FC5 712E          40847             call beep_f4
0FC7 D2AF          40848             setb    IE_EA                           ; Enable all interrupts
0FC9 DFDF          40849             djnz    Temp8, throttle_high_cal        ; Continue to wait
                   40850     
0FCB B144          40851             call    average_throttle
0FCD C3            40852             clr     C
0FCE EF            40853             mov     A, Temp8
0FCF 7897          40854             mov     Temp1, #Pgm_Max_Throttle        ; Store
0FD1 F6            40855             mov     @Temp1, A                       
0FD2 1205AB        40856             call wait200ms                          
0FD5 12150C        40857             call    success_beep
                   40858     
0FD8               40859     throttle_low_cal_start:
0FD8 7F0A          40860             mov     Temp8, #10                      ; Set 3 seconds wait time
0FDA               40861     throttle_low_cal:                       
0FDA D236          40862             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
0FDC 918F          40863             call    find_throttle_gains             ; Set throttle gains
0FDE 1205A7        40864             call wait100ms
0FE1 C2AF          40865             clr     IE_EA                           ; Disable interrupts (freeze New_Rcp value)
0FE3 C236          40866             clr     Flags2.RCP_FULL_RANGE   ; Set programmed range
0FE5 918F          40867             call    find_throttle_gains             ; Set throttle gains
0FE7 C3            40868             clr     C
0FE8 E554          40869             mov     A, New_Rcp                      ; Load new RC pulse value
0FEA 947F          40870             subb    A, #(255/2)                     ; Below midstick?
0FEC D2AF          40871             setb    IE_EA                           ; Enable interrupts
0FEE 50E8          40872             jnc     throttle_low_cal_start  ; No - start over
                   40873     
0FF0 120597        40874             call wait1ms            
0FF3 C2AF          40875             clr     IE_EA                           ; Disable all interrupts
0FF5 711C          40876             call beep_f1
0FF7 12059F        40877             call wait10ms
0FFA 711C          40878             call beep_f1
0FFC D2AF          40879             setb    IE_EA                           ; Enable all interrupts
0FFE DFDA          40880             djnz    Temp8, throttle_low_cal ; Continue to wait
                   40881     
1000 120D44        40882             call    average_throttle
1003 EF            40883             mov     A, Temp8
1004 2403          40884             add     A, #3                           ; Add about 1%
1006 7896          40885             mov     Temp1, #Pgm_Min_Throttle        ; Store
1008 F6            40886             mov     @Temp1, A                       
1009 F8            40887             mov     Temp1, A                                ; Min throttle in Temp1
100A 7997          40888             mov     Temp2, #Pgm_Max_Throttle
100C E7            40889             mov     A, @Temp2
100D C3            40890             clr     C
100E 9423          40891             subb    A, #35                          ; Subtract 35 (140us) from max throttle
1010 4003          40892             jc      program_by_tx_entry_limit
1012 98            40893             subb    A, Temp1                                ; Subtract min from max
1013 5006          40894             jnc     program_by_tx_entry_store
                   40895     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   624

1015               40896     program_by_tx_entry_limit:
1015 E8            40897             mov     A, Temp1                                ; Load min
1016 2423          40898             add     A, #35                          ; Make max 140us higher than min
1018 7897          40899             mov     Temp1, #Pgm_Max_Throttle        ; Store new max
101A F6            40900             mov     @Temp1, A
                   40901     
101B               40902     program_by_tx_entry_store:
101B 1205AB        40903             call wait200ms                          
101E 9166          40904             call erase_and_store_all_in_eeprom      
1020 B13B          40905             call    success_beep_inverted
                   40906     
1022               40907     program_by_tx_entry_wait:
1022 1205A7        40908             call wait100ms
1025 120C8F        40909             call    find_throttle_gains             ; Set throttle gains
1028 020E05        40910             ljmp    init_no_signal                  ; Go back
                   40911     
102B               40912     program_by_tx_checked:
                   40913             ; Initialize flash keys to invalid values
102B 756700        40914             mov     Flash_Key_1, #0
102E 756800        40915             mov     Flash_Key_2, #0
1031 1205A7        40916             call wait100ms                          ; Wait for new throttle value
1034 C3            40917             clr     C
1035 E554          40918             mov     A, New_Rcp                      ; Load new RC pulse value
1037 9401          40919             subb    A, #1                           ; Below stop?
1039 4003          40920             jc      arm_end_beep                    ; Yes - proceed
                   40921     
103B 020F81        40922             jmp     arming_start                    ; No - start over
                   40923     
103E               40924     arm_end_beep:
                   40925             ; Beep arm sequence end signal
103E C2AF          40926             clr     IE_EA                           ; Disable all interrupts
1040 120B2E        40927             call beep_f4                            ; Signal that rcpulse is ready
1043 120B2E        40928             call beep_f4
1046 120B2E        40929             call beep_f4
1049 D2AF          40930             setb    IE_EA                           ; Enable all interrupts
104B 1205AB        40931             call wait200ms
                   40932     
                   40933             ; Clear initial arm variable
104E 753000        40934             mov     Initial_Arm, #0
                   40935     
                   40936             ; Armed and waiting for power on
1051               40937     wait_for_power_on:
1051 E4            40938             clr     A
1052 F537          40939             mov     Power_On_Wait_Cnt_L, A  ; Clear wait counter
1054 F538          40940             mov     Power_On_Wait_Cnt_H, A  
1056               40941     wait_for_power_on_loop:
1056 0537          40942             inc     Power_On_Wait_Cnt_L             ; Increment low wait counter
1058 E537          40943             mov     A, Power_On_Wait_Cnt_L
105A F4            40944             cpl     A
105B 703F          40945             jnz     wait_for_power_on_no_beep; Counter wrapping (about 3 sec)
                   40946     
105D 0538          40947             inc     Power_On_Wait_Cnt_H             ; Increment high wait counter
105F 789A          40948             mov     Temp1, #Pgm_Beacon_Delay
1061 E6            40949             mov     A, @Temp1
1062 7819          40950             mov     Temp1, #25              ; Approximately 1 min
1064 14            40951             dec     A
1065 6012          40952             jz      beep_delay_set
                   40953     
1067 7832          40954             mov     Temp1, #50              ; Approximately 2 min
1069 14            40955             dec     A
106A 600D          40956             jz      beep_delay_set
                   40957     
106C 787D          40958             mov     Temp1, #125             ; Approximately 5 min
106E 14            40959             dec     A
106F 6008          40960             jz      beep_delay_set
                   40961     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   625

1071 78FA          40962             mov     Temp1, #250             ; Approximately 10 min
1073 14            40963             dec     A
1074 6003          40964             jz      beep_delay_set
                   40965     
1076 753800        40966             mov     Power_On_Wait_Cnt_H, #0         ; Reset counter for infinite delay
                   40967     
1079               40968     beep_delay_set:
1079 C3            40969             clr     C
107A E538          40970             mov     A, Power_On_Wait_Cnt_H
107C 98            40971             subb    A, Temp1                                ; Check against chosen delay
107D 401D          40972             jc      wait_for_power_on_no_beep; Has delay elapsed?
                   40973     
107F 120B7F        40974             call    switch_power_off                ; Switch power off in case braking is set
1082 120597        40975             call    wait1ms
1085 1538          40976             dec     Power_On_Wait_Cnt_H             ; Decrement high wait counter
1087 753700        40977             mov     Power_On_Wait_Cnt_L, #0 ; Set low wait counter
108A 7899          40978             mov     Temp1, #Pgm_Beacon_Strength
108C 8664          40979             mov     Beep_Strength, @Temp1
108E C2AF          40980             clr     IE_EA                           ; Disable all interrupts
1090 120B2E        40981             call beep_f4                            ; Signal that there is no signal
1093 D2AF          40982             setb    IE_EA                           ; Enable all interrupts
1095 7898          40983             mov     Temp1, #Pgm_Beep_Strength
1097 8664          40984             mov     Beep_Strength, @Temp1
1099 1205A7        40985             call wait100ms                          ; Wait for new RC pulse to be measured
                   40986     
109C               40987     wait_for_power_on_no_beep:
109C 12059F        40988             call wait10ms
109F E523          40989             mov     A, Rcp_Timeout_Cntd                     ; Load RC pulse timeout counter val
                             ue
10A1 7003          40990             jnz     wait_for_power_on_not_missing   ; If it is not zero - proceed
                   40991     
10A3 020E05        40992             jmp     init_no_signal                          ; If pulses missing - go back to de
                             tect input signal
                   40993     
10A6               40994     wait_for_power_on_not_missing:
10A6 C3            40995             clr     C
10A7 E554          40996             mov     A, New_Rcp                      ; Load new RC pulse value
10A9 9401          40997             subb    A, #1                           ; Higher than stop
10AB 500A          40998             jnc     wait_for_power_on_nonzero       ; Yes - proceed
                   40999     
10AD C3            41000             clr     C
10AE E552          41001             mov     A, Dshot_Cmd
10B0 9401          41002             subb    A, #1                           ; 1 or higher
10B2 5016          41003             jnc     check_dshot_cmd         ; Check Dshot command
                   41004     
10B4 021056        41005             ljmp    wait_for_power_on_loop  ; If not Dshot command - start over
                   41006     
10B7               41007     wait_for_power_on_nonzero:
10B7 1205A7        41008             lcall wait100ms                 ; Wait to see if start pulse was only a glitch
10BA E523          41009             mov     A, Rcp_Timeout_Cntd             ; Load RC pulse timeout counter value
10BC 7003          41010             jnz     ($+5)                           ; If it is not zero - proceed
10BE 020E05        41011             ljmp    init_no_signal                  ; If it is zero (pulses missing) - go back 
                             to detect input signal
                   41012     
10C1 755200        41013             mov     Dshot_Cmd, #0
10C4 755300        41014             mov     Dshot_Cmd_Cnt, #0
10C7 02126C        41015             ljmp init_start
                   41016     
10CA               41017     check_dshot_cmd:
10CA C3            41018             clr     C
10CB E552          41019             mov     A, Dshot_Cmd
10CD 9401          41020             subb A, #1
10CF 7017          41021             jnz     dshot_beep_2
                   41022     
10D1 C2AF          41023             clr     IE_EA
10D3 120B7F        41024             call    switch_power_off                ; Switch power off in case braking is set
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   626

10D6 7899          41025             mov     Temp1, #Pgm_Beacon_Strength
10D8 8664          41026             mov     Beep_Strength, @Temp1
10DA 120B1C        41027             call beep_f1
10DD 7898          41028             mov     Temp1, #Pgm_Beep_Strength
10DF 8664          41029             mov     Beep_Strength, @Temp1
10E1 D2AF          41030             setb    IE_EA   
10E3 1205A7        41031             call wait100ms  
10E6 415E          41032             jmp     clear_dshot_cmd
                   41033     
10E8               41034     dshot_beep_2:   
10E8 C3            41035             clr     C
10E9 E552          41036             mov     A, Dshot_Cmd
10EB 9402          41037             subb A, #2
10ED 7017          41038             jnz     dshot_beep_3
                   41039     
10EF C2AF          41040             clr     IE_EA
10F1 120B7F        41041             call    switch_power_off                ; Switch power off in case braking is set
10F4 7899          41042             mov     Temp1, #Pgm_Beacon_Strength
10F6 8664          41043             mov     Beep_Strength, @Temp1
10F8 120B22        41044             call beep_f2
10FB 7898          41045             mov     Temp1, #Pgm_Beep_Strength
10FD 8664          41046             mov     Beep_Strength, @Temp1
10FF D2AF          41047             setb    IE_EA   
1101 1205A7        41048             call wait100ms  
1104 415E          41049             jmp     clear_dshot_cmd
                   41050     
1106               41051     dshot_beep_3:           
1106 C3            41052             clr     C
1107 E552          41053             mov     A, Dshot_Cmd
1109 9403          41054             subb A, #3
110B 7017          41055             jnz     dshot_beep_4
                   41056     
110D C2AF          41057             clr     IE_EA
110F 120B7F        41058             call    switch_power_off                ; Switch power off in case braking is set
1112 7899          41059             mov     Temp1, #Pgm_Beacon_Strength
1114 8664          41060             mov     Beep_Strength, @Temp1
1116 120B28        41061             call beep_f3
1119 7898          41062             mov     Temp1, #Pgm_Beep_Strength
111B 8664          41063             mov     Beep_Strength, @Temp1
111D D2AF          41064             setb    IE_EA   
111F 1205A7        41065             call wait100ms  
1122 415E          41066             jmp     clear_dshot_cmd
                   41067     
1124               41068     dshot_beep_4:
1124 C3            41069             clr     C
1125 E552          41070             mov     A, Dshot_Cmd
1127 9404          41071             subb A, #4
1129 7017          41072             jnz     dshot_beep_5
                   41073     
112B C2AF          41074             clr     IE_EA
112D 120B7F        41075             call    switch_power_off                ; Switch power off in case braking is set
1130 7899          41076             mov     Temp1, #Pgm_Beacon_Strength
1132 8664          41077             mov     Beep_Strength, @Temp1
1134 120B2E        41078             call beep_f4
1137 7898          41079             mov     Temp1, #Pgm_Beep_Strength
1139 8664          41080             mov     Beep_Strength, @Temp1
113B D2AF          41081             setb    IE_EA   
113D 1205A7        41082             call wait100ms          
1140 415E          41083             jmp     clear_dshot_cmd
                   41084     
1142               41085     dshot_beep_5:
1142 C3            41086             clr     C
1143 E552          41087             mov     A, Dshot_Cmd
1145 9405          41088             subb A, #5
1147 7017          41089             jnz     dshot_direction_1
                   41090     
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   627

1149 C2AF          41091             clr     IE_EA
114B 120B7F        41092             call    switch_power_off                ; Switch power off in case braking is set
114E 7899          41093             mov     Temp1, #Pgm_Beacon_Strength
1150 8664          41094             mov     Beep_Strength, @Temp1
1152 120B2E        41095             call beep_f4
1155 7898          41096             mov     Temp1, #Pgm_Beep_Strength
1157 8664          41097             mov     Beep_Strength, @Temp1
1159 D2AF          41098             setb    IE_EA   
115B 1205A7        41099             call wait100ms  
115E 415E          41100             jmp     clear_dshot_cmd
                   41101     
1160               41102     dshot_direction_1:
1160 C3            41103             clr     C
1161 E552          41104             mov     A, Dshot_Cmd
1163 9407          41105             subb A, #7
1165 7019          41106             jnz     dshot_direction_2
                   41107     
1167 C3            41108             clr     C
1168 E553          41109             mov     A, Dshot_Cmd_Cnt
116A 9406          41110             subb A, #6                                      ; Needs to receive it 6 times in a 
                             row
116C 5002          41111             jnc     ($+4)                                   ; Same as "jc dont_clear_dshot_cmd"
116E 01A6          41112             ajmp wait_for_power_on_not_missing
                   41113     
1170 7401          41114             mov     A, #1
1172 303A02        41115             jnb     Flags3.PGM_BIDIR, ($+5)
1175 7403          41116             mov     A, #3
1177 7888          41117             mov     Temp1, #Pgm_Direction
1179 F6            41118             mov     @Temp1, A
117A C238          41119             clr     Flags3.PGM_DIR_REV
117C C239          41120             clr     Flags3.PGM_BIDIR_REV
117E 415E          41121             jmp     clear_dshot_cmd
                   41122     
1180               41123     dshot_direction_2:
1180 C3            41124             clr     C
1181 E552          41125             mov     A, Dshot_Cmd
1183 9408          41126             subb A, #8
1185 7019          41127             jnz     dshot_direction_bidir_off
                   41128     
1187 C3            41129             clr     C
1188 E553          41130             mov     A, Dshot_Cmd_Cnt
118A 9406          41131             subb A, #6                                      ; Needs to receive it 6 times in a 
                             row
118C 5002          41132             jnc     ($+4)                                   ; Same as "jc dont_clear_dshot_cmd"
118E 01A6          41133             ajmp wait_for_power_on_not_missing
                   41134     
1190 7402          41135             mov     A, #2
1192 303A02        41136             jnb     Flags3.PGM_BIDIR, ($+5)
1195 7404          41137             mov     A, #4
1197 7888          41138             mov     Temp1, #Pgm_Direction
1199 F6            41139             mov     @Temp1, A
119A D238          41140             setb Flags3.PGM_DIR_REV
119C D239          41141             setb Flags3.PGM_BIDIR_REV
119E 415E          41142             jmp     clear_dshot_cmd
                   41143     
11A0               41144     dshot_direction_bidir_off:
11A0 C3            41145             clr     C
11A1 E552          41146             mov     A, Dshot_Cmd
11A3 9409          41147             subb A, #9
11A5 7017          41148             jnz     dshot_direction_bidir_on
                   41149     
11A7 C3            41150             clr     C
11A8 E553          41151             mov     A, Dshot_Cmd_Cnt
11AA 9406          41152             subb A, #6                                      ; Needs to receive it 6 times in a 
                             row
11AC 5002          41153             jnc     ($+4)                                   ; Same as "jc dont_clear_dshot_cmd"
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   628

11AE 01A6          41154             ajmp wait_for_power_on_not_missing
                   41155     
11B0 303A0B        41156             jnb     Flags3.PGM_BIDIR, dshot_direction_bidir_on
                   41157     
11B3 C3            41158             clr     C
11B4 7888          41159             mov     Temp1, #Pgm_Direction
11B6 E6            41160             mov     A, @Temp1
11B7 9402          41161             subb    A, #2
11B9 F6            41162             mov     @Temp1, A
11BA C23A          41163             clr     Flags3.PGM_BIDIR
11BC 415E          41164             jmp     clear_dshot_cmd
                   41165     
11BE               41166     dshot_direction_bidir_on:
11BE C3            41167             clr     C
11BF E552          41168             mov     A, Dshot_Cmd
11C1 940A          41169             subb A, #10
11C3 7016          41170             jnz     dshot_direction_normal
                   41171     
11C5 C3            41172             clr     C
11C6 E553          41173             mov     A, Dshot_Cmd_Cnt
11C8 9406          41174             subb A, #6                                      ; Needs to receive it 6 times in a 
                             row
11CA 5002          41175             jnc     ($+4)                                   ; Same as "jc dont_clear_dshot_cmd"
11CC 01A6          41176             ajmp wait_for_power_on_not_missing
                   41177     
11CE 203A0A        41178             jb      Flags3.PGM_BIDIR, dshot_direction_normal
                   41179     
11D1 7888          41180             mov     Temp1, #Pgm_Direction
11D3 E6            41181             mov     A, @Temp1
11D4 2402          41182             add     A, #2
11D6 F6            41183             mov     @Temp1, A
11D7 D23A          41184             setb    Flags3.PGM_BIDIR
11D9 415E          41185             jmp     clear_dshot_cmd
                   41186     
11DB               41187     dshot_direction_normal: 
11DB C3            41188             clr     C
11DC E552          41189             mov     A, Dshot_Cmd
11DE 9414          41190             subb A, #20
11E0 7025          41191             jnz     dshot_direction_reverse
                   41192     
11E2 C3            41193             clr     C
11E3 E553          41194             mov     A, Dshot_Cmd_Cnt
11E5 9406          41195             subb A, #6                                      ; Needs to receive it 6 times in a 
                             row
11E7 5002          41196             jnc     ($+4)                                   ; Same as "jc dont_clear_dshot_cmd"
11E9 01A6          41197             ajmp wait_for_power_on_not_missing
                   41198     
11EB C2AF          41199             clr     IE_EA                                   ; DPTR used in interrupts
11ED 901A0B        41200             mov     DPTR, #Eep_Pgm_Direction                ; Read from flash
11F0 7400          41201             mov     A, #0
11F2 93            41202             movc    A, @A+DPTR
11F3 D2AF          41203             setb    IE_EA
11F5 7888          41204             mov     Temp1, #Pgm_Direction
11F7 F6            41205             mov     @Temp1, A
11F8 13            41206             rrc     A                                               ; Lsb to carry
11F9 C238          41207             clr     Flags3.PGM_DIR_REV
11FB C239          41208             clr     Flags3.PGM_BIDIR_REV
11FD 4002          41209             jc      ($+4)
11FF D238          41210             setb    Flags3.PGM_DIR_REV
1201 4002          41211             jc      ($+4)
1203 D239          41212             setb    Flags3.PGM_BIDIR_REV
1205 8057          41213             jmp     clear_dshot_cmd
                   41214     
1207               41215     dshot_direction_reverse:                        ; Temporary reverse
1207 C3            41216             clr     C
1208 E552          41217             mov     A, Dshot_Cmd
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   629

120A 9415          41218             subb A, #21
120C 7038          41219             jnz     dshot_save_settings
                   41220     
120E C3            41221             clr     C
120F E553          41222             mov     A, Dshot_Cmd_Cnt
1211 9406          41223             subb A, #6                                      ; Needs to receive it 6 times in a 
                             row
1213 404F          41224             jc      dont_clear_dshot_cmd
                   41225             
1215 C2AF          41226             clr     IE_EA                                   ; DPTR used in interrupts
1217 901A0B        41227             mov     DPTR, #Eep_Pgm_Direction                ; Read from flash
121A 7400          41228             mov     A, #0
121C 93            41229             movc    A, @A+DPTR
121D D2AF          41230             setb    IE_EA
121F F8            41231             mov     Temp1, A
1220 B80102        41232             cjne    Temp1, #1, ($+5)
1223 7402          41233             mov     A, #2
1225 B80202        41234             cjne    Temp1, #2, ($+5)
1228 7401          41235             mov     A, #1
122A B80302        41236             cjne    Temp1, #3, ($+5)
122D 7404          41237             mov     A, #4
122F B80402        41238             cjne    Temp1, #4, ($+5)
1232 7403          41239             mov     A, #3
1234 7888          41240             mov     Temp1, #Pgm_Direction
1236 F6            41241             mov     @Temp1, A
1237 13            41242             rrc     A                                               ; Lsb to carry
1238 C238          41243             clr     Flags3.PGM_DIR_REV
123A C239          41244             clr     Flags3.PGM_BIDIR_REV
123C 4002          41245             jc      ($+4)
123E D238          41246             setb    Flags3.PGM_DIR_REV
1240 4002          41247             jc      ($+4)
1242 D239          41248             setb    Flags3.PGM_BIDIR_REV
1244 8018          41249             jmp     clear_dshot_cmd
                   41250     
1246               41251     dshot_save_settings:
1246 C3            41252             clr     C
1247 E552          41253             mov     A, Dshot_Cmd
1249 940C          41254             subb A, #12
124B 7011          41255             jnz     clear_dshot_cmd
                   41256     
124D 7567A5        41257             mov     Flash_Key_1, #0A5h                      ; Initialize flash keys to valid va
                             lues
1250 7568F1        41258             mov     Flash_Key_2, #0F1h
1253 C3            41259             clr     C
1254 E553          41260             mov     A, Dshot_Cmd_Cnt
1256 9406          41261             subb A, #6                                      ; Needs to receive it 6 times in a 
                             row
1258 400A          41262             jc      dont_clear_dshot_cmd
                   41263     
125A 9166          41264             call erase_and_store_all_in_eeprom
125C D2AF          41265             setb    IE_EA
                   41266             
125E               41267     clear_dshot_cmd:
125E 755200        41268             mov     Dshot_Cmd, #0
1261 755300        41269             mov     Dshot_Cmd_Cnt, #0
                   41270     
1264               41271     dont_clear_dshot_cmd:
1264 756700        41272             mov     Flash_Key_1, #0                 ; Initialize flash keys to invalid values
1267 756800        41273             mov     Flash_Key_2, #0
126A 01A6          41274             jmp     wait_for_power_on_not_missing
                   41275     
                   41276     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   41277     ;
                   41278     ; Start entry point
                   41279     ;
                   41280     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   630

126C               41281     init_start:
126C C2AF          41282             clr     IE_EA
126E 120B7F        41283             call switch_power_off
1271 E4            41284             clr     A
1272 D2AF          41285             setb    IE_EA
1274 E4            41286             clr     A
1275 F55E          41287             mov     Adc_Conversion_Cnt, A
1277 F524          41288             mov     Flags0, A                               ; Clear flags0
1279 F525          41289             mov     Flags1, A                               ; Clear flags1
127B F53D          41290             mov     Demag_Detected_Metric, A        ; Clear demag metric
                   41291             ;**** **** **** **** ****
                   41292             ; Motor start beginning
                   41293             ;**** **** **** **** **** 
127D 755E08        41294             mov     Adc_Conversion_Cnt, #8                          ; Make sure a temp reading 
                             is done
1280 120597        41295             call wait1ms
1283 120600        41296             call start_adc_conversion
1286               41297     read_initial_temp:
1286 30EDFD        41298             jnb     ADC0CN0_ADINT, read_initial_temp
                   41299             Read_Adc_Result                                         ; Read initial temperature
128D E9            41302             mov     A, Temp2
128E 7001          41303             jnz     ($+3)                                                   ; Is reading below 
                             256?
                   41304     
1290 F8            41305             mov     Temp1, A                                                        ; Yes - set
                              average temperature value to zero
                   41306     
1291 885F          41307             mov     Current_Average_Temp, Temp1                     ; Set initial average tempe
                             rature
1293 120604        41308             call check_temp_voltage_and_limit_power
1296 755E08        41309             mov     Adc_Conversion_Cnt, #8                          ; Make sure a temp reading 
                             is done next time
                   41310             ; Set up start operating conditions
1299 C2AF          41311             clr     IE_EA                           ; Disable interrupts
129B 12066B        41312             call set_startup_pwm
129E 855D5B        41313             mov     Pwm_Limit, Pwm_Limit_Beg
12A1 855D5C        41314             mov     Pwm_Limit_By_Rpm, Pwm_Limit_Beg
12A4 D2AF          41315             setb    IE_EA
                   41316             ; Begin startup sequence
                   41317     IF MCU_48MHZ >= 1
                   41318             Set_MCU_Clk_48MHz
                   41324     ENDIF
12B5 303A07        41325             jnb     Flags3.PGM_BIDIR, init_start_bidir_done ; Check if bidirectional operation
                   41326     
12B8 C238          41327             clr     Flags3.PGM_DIR_REV                      ; Set spinning direction. Default f
                             wd
12BA 303502        41328             jnb     Flags2.RCP_DIR_REV, ($+5)       ; Check force direction
12BD D238          41329             setb    Flags3.PGM_DIR_REV                      ; Set spinning direction
                   41330     
12BF               41331     init_start_bidir_done:
12BF D228          41332             setb    Flags1.STARTUP_PHASE            ; Set startup phase flag
12C1 753900        41333             mov     Startup_Cnt, #0                 ; Reset counter
12C4 120AD7        41334             call comm5comm6                         ; Initialize commutation
12C7 120AFA        41335             call comm6comm1                         
12CA 12067A        41336             call initialize_timing                  ; Initialize timing
12CD 120681        41337             call    calc_next_comm_timing           ; Set virtual commutation point
12D0 12067A        41338             call initialize_timing                  ; Initialize timing
12D3 120681        41339             call    calc_next_comm_timing           
12D6 12067A        41340             call    initialize_timing                       ; Initialize timing
                   41341     
                   41342     
                   41343     
                   41344     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   41345     ;
                   41346     ; Run entry point
                   41347     ;
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   631

                   41348     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   41349     
                   41350     ; Run 1 = B(p-on) + C(n-pwm) - comparator A evaluated
                   41351     ; Out_cA changes from low to high
12D9               41352     run1:
12D9 120906        41353             call wait_for_comp_out_high     ; Wait for high
                   41354     ;               setup_comm_wait         ; Setup wait time from zero cross to commutation
                   41355     ;               evaluate_comparator_integrity   ; Check whether comparator reading has been
                              normal
12DC 120A03        41356             call wait_for_comm                      ; Wait from zero cross to commutation
12DF 120A4B        41357             call comm1comm2                 ; Commutate
12E2 120681        41358             call calc_next_comm_timing      ; Calculate next timing and wait advance timing wait
                   41359     ;               wait_advance_timing             ; Wait advance timing and start zero cross 
                             wait
                   41360     ;               calc_new_wait_times
                   41361     ;               wait_before_zc_scan             ; Wait zero cross wait and start zero cross
                              timeout
                   41362     
                   41363     ; Run 2 = A(p-on) + C(n-pwm) - comparator B evaluated
                   41364     ; Out_cB changes from high to low
12E5               41365     run2:
12E5 1208F6        41366             call wait_for_comp_out_low
                   41367     ;               setup_comm_wait
                   41368     ;               evaluate_comparator_integrity
12E8 202C03        41369             jb      Flags1.HIGH_RPM, ($+6)  ; Skip if high rpm
12EB 1205BA        41370             lcall set_pwm_limit_low_rpm
12EE 302C03        41371             jnb     Flags1.HIGH_RPM, ($+6)  ; Do if high rpm
12F1 1205EA        41372             lcall set_pwm_limit_high_rpm
12F4 120A03        41373             call wait_for_comm
12F7 120A6E        41374             call comm2comm3
12FA 120681        41375             call calc_next_comm_timing
                   41376     ;               wait_advance_timing
                   41377     ;               calc_new_wait_times
                   41378     ;               wait_before_zc_scan
                   41379     
                   41380     ; Run 3 = A(p-on) + B(n-pwm) - comparator C evaluated
                   41381     ; Out_cC changes from low to high
12FD               41382     run3:
12FD 120906        41383             call wait_for_comp_out_high
                   41384     ;               setup_comm_wait
                   41385     ;               evaluate_comparator_integrity
1300 120A03        41386             call wait_for_comm
1303 120A91        41387             call comm3comm4
1306 120681        41388             call calc_next_comm_timing
                   41389     ;               wait_advance_timing
                   41390     ;               calc_new_wait_times
                   41391     ;               wait_before_zc_scan
                   41392     
                   41393     ; Run 4 = C(p-on) + B(n-pwm) - comparator A evaluated
                   41394     ; Out_cA changes from high to low
1309               41395     run4:
1309 1208F6        41396             call wait_for_comp_out_low
                   41397     ;               setup_comm_wait
                   41398     ;               evaluate_comparator_integrity
130C 120A03        41399             call wait_for_comm
130F 120AB4        41400             call comm4comm5
1312 120681        41401             call calc_next_comm_timing
                   41402     ;               wait_advance_timing
                   41403     ;               calc_new_wait_times
                   41404     ;               wait_before_zc_scan
                   41405     
                   41406     ; Run 5 = C(p-on) + A(n-pwm) - comparator B evaluated
                   41407     ; Out_cB changes from low to high
1315               41408     run5:
1315 120906        41409             call wait_for_comp_out_high
                   41410     ;               setup_comm_wait
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   632

                   41411     ;               evaluate_comparator_integrity
1318 120A03        41412             call wait_for_comm
131B 120AD7        41413             call comm5comm6
131E 120681        41414             call calc_next_comm_timing
                   41415     ;               wait_advance_timing
                   41416     ;               calc_new_wait_times
                   41417     ;               wait_before_zc_scan
                   41418     
                   41419     ; Run 6 = B(p-on) + A(n-pwm) - comparator C evaluated
                   41420     ; Out_cC changes from high to low
1321               41421     run6:
1321 120600        41422             call start_adc_conversion
1324 1208F6        41423             call wait_for_comp_out_low
                   41424     ;               setup_comm_wait
                   41425     ;               evaluate_comparator_integrity
1327 120A03        41426             call wait_for_comm
132A 120AFA        41427             call comm6comm1
132D 120604        41428             call check_temp_voltage_and_limit_power
1330 120681        41429             call calc_next_comm_timing
                   41430     ;               wait_advance_timing
                   41431     ;               calc_new_wait_times
                   41432     ;               wait_before_zc_scan
                   41433     
                   41434             ; Check if it is direct startup
1333 302827        41435             jnb     Flags1.STARTUP_PHASE, normal_run_checks
                   41436     
                   41437             ; Set spoolup power variables
1336 855D5B        41438             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set initial max power
                   41439             ; Check startup counter
1339 7918          41440             mov     Temp2, #24                              ; Set nominal startup parameters
133B 7A0C          41441             mov     Temp3, #12
133D C3            41442             clr     C
133E E539          41443             mov     A, Startup_Cnt                          ; Load counter
1340 99            41444             subb    A, Temp2                                        ; Is counter above requirem
                             ent?
1341 400E          41445             jc      direct_start_check_rcp          ; No - proceed
                   41446     
1343 C228          41447             clr     Flags1.STARTUP_PHASE            ; Clear startup phase flag
1345 D229          41448             setb    Flags1.INITIAL_RUN_PHASE                ; Set initial run phase flag
1347 8A3B          41449             mov     Initial_Run_Rot_Cntd, Temp3     ; Set initial run rotation count
1349 855D5B        41450             mov     Pwm_Limit, Pwm_Limit_Beg
134C 855D5C        41451             mov     Pwm_Limit_By_Rpm, Pwm_Limit_Beg
134F 800C          41452             jmp     normal_run_checks
                   41453     
1351               41454     direct_start_check_rcp:
1351 C3            41455             clr     C
1352 E554          41456             mov     A, New_Rcp                              ; Load new pulse value
1354 9401          41457             subb    A, #1                                   ; Check if pulse is below stop value
1356 4003          41458             jc      ($+5)
                   41459     
1358 0212D9        41460             ljmp    run1                                            ; Continue to run 
                   41461     
135B 61E3          41462             jmp     run_to_wait_for_power_on
                   41463     
                   41464     
135D               41465     normal_run_checks:
                   41466             ; Check if it is initial run phase
135D 30291F        41467             jnb     Flags1.INITIAL_RUN_PHASE, initial_run_phase_done        ; If not initial ru
                             n phase - branch
1360 202B1C        41468             jb      Flags1.DIR_CHANGE_BRAKE, initial_run_phase_done ; If a direction change - b
                             ranch
                   41469     
                   41470             ; Decrement startup rotaton count
1363 E53B          41471             mov     A, Initial_Run_Rot_Cntd
1365 14            41472             dec     A
                   41473             ; Check number of initial rotations
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   633

1366 7006          41474             jnz     initial_run_check_startup_rot   ; Branch if counter is not zero
                   41475     
1368 C229          41476             clr     Flags1.INITIAL_RUN_PHASE                ; Clear initial run phase flag
136A D22A          41477             setb    Flags1.MOTOR_STARTED            ; Set motor started
136C 41D9          41478             jmp run1                                                ; Continue with normal run
                   41479     
136E               41480     initial_run_check_startup_rot:
136E F53B          41481             mov     Initial_Run_Rot_Cntd, A         ; Not zero - store counter
                   41482     
1370 203A07        41483             jb      Flags3.PGM_BIDIR, initial_run_continue_run      ; Check if bidirectional op
                             eration
                   41484     
1373 C3            41485             clr     C
1374 E554          41486             mov     A, New_Rcp                              ; Load new pulse value
1376 9401          41487             subb    A, #1                                   ; Check if pulse is below stop value
1378 4003          41488             jc      ($+5)
                   41489     
137A               41490     initial_run_continue_run:
137A 0212D9        41491             ljmp    run1                                            ; Continue to run 
                   41492     
137D 8064          41493             jmp     run_to_wait_for_power_on
                   41494     
137F               41495     initial_run_phase_done:
                   41496             ; Reset stall count
137F 753C00        41497             mov     Stall_Cnt, #0
                   41498             ; Exit run loop after a given time
1382 203A0F        41499             jb      Flags3.PGM_BIDIR, run6_check_timeout    ; Check if bidirectional operation
                   41500     
1385 78FA          41501             mov     Temp1, #250
1387 79A4          41502             mov     Temp2, #Pgm_Brake_On_Stop
1389 E7            41503             mov     A, @Temp2
138A 6002          41504             jz      ($+4)
                   41505     
138C 7803          41506             mov     Temp1, #3                                       ; About 100ms before stoppi
                             ng when brake is set
                   41507     
138E C3            41508             clr     C
138F E555          41509             mov     A, Rcp_Stop_Cnt                 ; Load stop RC pulse counter low byte value
1391 98            41510             subb    A, Temp1                                        ; Is number of stop RC puls
                             es above limit?
1392 504F          41511             jnc     run_to_wait_for_power_on                ; Yes, go back to wait for poweron
                   41512     
1394               41513     run6_check_timeout:
1394 E523          41514             mov     A, Rcp_Timeout_Cntd                     ; Load RC pulse timeout counter val
                             ue
1396 604B          41515             jz      run_to_wait_for_power_on                ; If it is zero - go back to wait f
                             or poweron
                   41516     
1398               41517     run6_check_dir:
1398 303A17        41518             jnb     Flags3.PGM_BIDIR, run6_check_speed              ; Check if bidirectional op
                             eration
                   41519     
139B 203805        41520             jb      Flags3.PGM_DIR_REV, run6_check_dir_rev          ; Check if actual rotation 
                             direction
139E 203507        41521             jb      Flags2.RCP_DIR_REV, run6_check_dir_change       ; Matches force direction
13A1 800F          41522             jmp     run6_check_speed
                   41523     
13A3               41524     run6_check_dir_rev:
13A3 303502        41525             jnb     Flags2.RCP_DIR_REV, run6_check_dir_change
13A6 800A          41526             jmp     run6_check_speed
                   41527     
13A8               41528     run6_check_dir_change:
13A8 202B07        41529             jb      Flags1.DIR_CHANGE_BRAKE, run6_check_speed
                   41530     
13AB D22B          41531             setb    Flags1.DIR_CHANGE_BRAKE         ; Set brake flag
13AD 855D5B        41532             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set max power while braking
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   634

13B0 6109          41533             jmp     run4                                            ; Go back to run 4, thereby
                              changing force direction
                   41534     
13B2               41535     run6_check_speed:
13B2 78F0          41536             mov     Temp1, #0F0h                            ; Default minimum speed
13B4 302B05        41537             jnb     Flags1.DIR_CHANGE_BRAKE, run6_brake_done; Is it a direction change?
                   41538     
13B7 855D5B        41539             mov     Pwm_Limit, Pwm_Limit_Beg        ; Set max power while braking
13BA 7820          41540             mov     Temp1, #20h                             ; Bidirectional braking termination
                              speed
                   41541     
13BC               41542     run6_brake_done:
13BC C3            41543             clr     C
13BD E548          41544             mov     A, Comm_Period4x_H                      ; Is Comm_Period4x more than 32ms (
                             ~1220 eRPM)?
13BF 98            41545             subb    A, Temp1
13C0 5003          41546             jnc     ($+5)                                   ; Yes - stop or turn direction 
13C2 0212D9        41547             ljmp    run1                                            ; No - go back to run 1
                   41548     
13C5 302B1B        41549             jnb     Flags1.DIR_CHANGE_BRAKE, run_to_wait_for_power_on       ; If it is not a di
                             rection change - stop
                   41550     
13C8 C22B          41551             clr     Flags1.DIR_CHANGE_BRAKE         ; Clear brake flag
13CA C238          41552             clr     Flags3.PGM_DIR_REV                      ; Set spinning direction. Default f
                             wd
13CC 303502        41553             jnb     Flags2.RCP_DIR_REV, ($+5)       ; Check force direction
13CF D238          41554             setb    Flags3.PGM_DIR_REV                      ; Set spinning direction
13D1 D229          41555             setb    Flags1.INITIAL_RUN_PHASE
13D3 753B12        41556             mov     Initial_Run_Rot_Cntd, #18
13D6 855D5B        41557             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set initial max power
13D9 41D9          41558             jmp     run1                                            ; Go back to run 1 
                   41559     
13DB               41560     run_to_wait_for_power_on_fail:  
13DB 053C          41561             inc     Stall_Cnt                                       ; Increment stall count
13DD E554          41562             mov     A, New_Rcp                              ; Check if RCP is zero, then it is 
                             a normal stop                        
13DF 6002          41563             jz      run_to_wait_for_power_on
13E1 61E6          41564             ajmp    run_to_wait_for_power_on_stall_done
                   41565     
13E3               41566     run_to_wait_for_power_on:       
13E3 753C00        41567             mov     Stall_Cnt, #0
                   41568     
13E6               41569     run_to_wait_for_power_on_stall_done:
13E6 C2AF          41570             clr     IE_EA
13E8 120B7F        41571             call switch_power_off
13EB 752400        41572             mov     Flags0, #0                              ; Clear flags0
13EE 752500        41573             mov     Flags1, #0                              ; Clear flags1
                   41574     IF MCU_48MHZ >= 1
                   41575             Set_MCU_Clk_24MHz
                   41581     ENDIF
1400 D2AF          41582             setb    IE_EA
1402 1205A7        41583             call    wait100ms                                       ; Wait for pwm to be stopped
1405 120B7F        41584             call switch_power_off
1408 78A4          41585             mov     Temp1, #Pgm_Brake_On_Stop
140A E6            41586             mov     A, @Temp1
140B 6006          41587             jz      run_to_wait_for_power_on_brake_done
                   41588     
                   41589             AcomFET_on
                   41594             BcomFET_on
                   41599             CcomFET_on
                   41604     
1413               41605     run_to_wait_for_power_on_brake_done:
1413 C3            41606             clr     C
1414 E53C          41607             mov     A, Stall_Cnt
1416 9404          41608             subb    A, #4
1418 4003          41609             jc      jmp_wait_for_power_on
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   635

141A 020E05        41610             jmp     init_no_signal
                   41611     
141D               41612     jmp_wait_for_power_on:
141D 0151          41613             jmp     wait_for_power_on                       ; Go back to wait for power on
                   41614     
                   41615     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   41616     
                   41617     ;$include (BLHeliPgm.inc) ; Include source code for programming the ESC
                +1 41618     ;**** **** **** **** ****
                +1 41619     ;
                +1 41620     ; BLHeli program for controlling brushless motors in helicopters and multirotors
                +1 41621     ;
                +1 41622     ; Copyright 2011, 2012 Steffen Skaug
                +1 41623     ; This program is distributed under the terms of the GNU General Public License
                +1 41624     ;
                +1 41625     ; This file is part of BLHeli.
                +1 41626     ;
                +1 41627     ; BLHeli is free software: you can redistribute it and/or modify
                +1 41628     ; it under the terms of the GNU General Public License as published by
                +1 41629     ; the Free Software Foundation, either version 3 of the License, or
                +1 41630     ; (at your option) any later version.
                +1 41631     ;
                +1 41632     ; BLHeli is distributed in the hope that it will be useful,
                +1 41633     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                +1 41634     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                +1 41635     ; GNU General Public License for more details.
                +1 41636     ;
                +1 41637     ; You should have received a copy of the GNU General Public License
                +1 41638     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                +1 41639     ;
                +1 41640     ;**** **** **** **** ****
                +1 41641     ;
                +1 41642     ; BLHeliTxPgm SiLabs                                      
                +1 41643     ;                                                         
                +1 41644     ; EEPROM is not available in SiLabs MCUs                  
                +1 41645     ; Therefore a segment of the flash is used as "EEPROM"    
                +1 41646     ;                                                         
                +1 41647     ;**** **** **** **** ****
                +1 41648     
                +1 41649     
                +1 41650     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 41651     ;
                +1 41652     ; Read all eeprom parameters routine
                +1 41653     ;
                +1 41654     ; No assumptions
                +1 41655     ;
                +1 41656     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
141F            +1 41657     read_all_eeprom_parameters:     
                +1 41658             ; Check initialized signature
141F 901A0D     +1 41659             mov     DPTR, #Eep_Initialized_L
1422 7820       +1 41660             mov     Temp1, #Bit_Access
1424 919F       +1 41661             call read_eeprom_byte
1426 E520       +1 41662             mov     A, Bit_Access
1428 B4550A     +1 41663             cjne    A, #055h, read_eeprom_store_defaults
142B A3         +1 41664             inc     DPTR                            ; Now Eep_Initialized_H
142C 919F       +1 41665             call read_eeprom_byte
142E E520       +1 41666             mov     A, Bit_Access
1430 B4AA02     +1 41667             cjne    A, #0AAh, read_eeprom_store_defaults
1433 8013       +1 41668             jmp     read_eeprom_read
                +1 41669     
                +1 41670     
1435            +1 41671     read_eeprom_store_defaults:
1435 7567A5     +1 41672             mov     Flash_Key_1, #0A5h
1438 7568F1     +1 41673             mov     Flash_Key_2, #0F1h
143B 120B8F     +1 41674             call set_default_parameters     
143E 9166       +1 41675             call erase_and_store_all_in_eeprom      
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   636

1440 756700     +1 41676             mov     Flash_Key_1, #0
1443 756800     +1 41677             mov     Flash_Key_2, #0
1446 801D       +1 41678             jmp     read_eeprom_exit
                +1 41679     
1448            +1 41680     read_eeprom_read:
                +1 41681             ; Read eeprom
1448 901A03     +1 41682             mov     DPTR, #_Eep_Pgm_Gov_P_Gain
144B 7880       +1 41683             mov     Temp1, #_Pgm_Gov_P_Gain 
144D 7B0A       +1 41684             mov     Temp4, #10
144F            +1 41685     read_eeprom_block1:
144F 919F       +1 41686             call read_eeprom_byte
1451 A3         +1 41687             inc     DPTR                            
1452 08         +1 41688             inc     Temp1                   
1453 DBFA       +1 41689             djnz    Temp4, read_eeprom_block1
                +1 41690     
1455 901A0F     +1 41691             mov     DPTR, #Eep_Enable_TX_Program
1458 788C       +1 41692             mov     Temp1, #Pgm_Enable_TX_Program   
145A 7B1A       +1 41693             mov     Temp4, #26      ; 26 parameters
145C            +1 41694     read_eeprom_block2:
145C 919F       +1 41695             call read_eeprom_byte
145E A3         +1 41696             inc     DPTR                            
145F 08         +1 41697             inc     Temp1           
1460 DBFA       +1 41698             djnz    Temp4, read_eeprom_block2
                +1 41699     
1462 901A29     +1 41700             mov     DPTR, #Eep_Dummy                        ; Set pointer to uncritical area
                +1 41701     
1465            +1 41702     read_eeprom_exit:
1465 22         +1 41703             ret
                +1 41704     
                +1 41705     
                +1 41706     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 41707     ;
                +1 41708     ; Erase flash and store all parameter value in EEPROM routine
                +1 41709     ;
                +1 41710     ; No assumptions
                +1 41711     ;
                +1 41712     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
1466            +1 41713     erase_and_store_all_in_eeprom:
1466 C2AF       +1 41714             clr     IE_EA                                   ; Disable interrupts
1468 91E2       +1 41715             call    read_tags
146A 91BF       +1 41716             call    erase_flash                             ; Erase flash
                +1 41717     
146C 901A00     +1 41718             mov     DPTR, #Eep_FW_Main_Revision     ; Store firmware main revision
146F 7410       +1 41719             mov     A, #EEPROM_FW_MAIN_REVISION
1471 91A4       +1 41720             call write_eeprom_byte_from_acc
                +1 41721     
1473 A3         +1 41722             inc     DPTR                                            ; Now firmware sub revision
1474 7407       +1 41723             mov     A, #EEPROM_FW_SUB_REVISION
1476 91A4       +1 41724             call write_eeprom_byte_from_acc
                +1 41725     
1478 A3         +1 41726             inc     DPTR                                            ; Now layout revision
1479 7421       +1 41727             mov     A, #EEPROM_LAYOUT_REVISION
147B 91A4       +1 41728             call write_eeprom_byte_from_acc
                +1 41729     
                +1 41730             ; Write eeprom
147D 901A03     +1 41731             mov     DPTR, #_Eep_Pgm_Gov_P_Gain
1480 7880       +1 41732             mov     Temp1, #_Pgm_Gov_P_Gain
1482 7B0A       +1 41733             mov     Temp4, #10
1484            +1 41734     write_eeprom_block1:
1484 91A3       +1 41735             call write_eeprom_byte
1486 A3         +1 41736             inc     DPTR                                            
1487 08         +1 41737             inc     Temp1                                   
1488 DBFA       +1 41738             djnz    Temp4, write_eeprom_block1
                +1 41739     
148A 901A0F     +1 41740             mov     DPTR, #Eep_Enable_TX_Program
148D 788C       +1 41741             mov     Temp1, #Pgm_Enable_TX_Program   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   637

148F 7B1A       +1 41742             mov     Temp4, #26      ; 26 parameters
1491            +1 41743     write_eeprom_block2:
1491 91A3       +1 41744             call write_eeprom_byte
1493 A3         +1 41745             inc     DPTR                                            
1494 08         +1 41746             inc     Temp1                                   
1495 DBFA       +1 41747             djnz    Temp4, write_eeprom_block2
                +1 41748     
1497 91F5       +1 41749             call    write_tags
1499 91D3       +1 41750             call write_eeprom_signature
149B 901A29     +1 41751             mov     DPTR, #Eep_Dummy                        ; Set pointer to uncritical area
149E 22         +1 41752             ret     
                +1 41753     
                +1 41754     
                +1 41755     
                +1 41756     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 41757     ;
                +1 41758     ; Read eeprom byte routine
                +1 41759     ;
                +1 41760     ; Gives data in A and in address given by Temp1. Assumes address in DPTR 
                +1 41761     ; Also assumes address high byte to be zero
                +1 41762     ;
                +1 41763     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
149F            +1 41764     read_eeprom_byte:
149F E4         +1 41765             clr     A
14A0 93         +1 41766             movc    A, @A+DPTR                      ; Read from flash
14A1 F6         +1 41767             mov     @Temp1, A
14A2 22         +1 41768             ret
                +1 41769     
                +1 41770     
                +1 41771     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 41772     ;
                +1 41773     ; Write eeprom byte routine
                +1 41774     ;
                +1 41775     ; Assumes data in address given by Temp1, or in accumulator. Assumes address in DPTR 
                +1 41776     ; Also assumes address high byte to be zero
                +1 41777     ;
                +1 41778     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
14A3            +1 41779     write_eeprom_byte:
14A3 E6         +1 41780             mov     A, @Temp1
14A4            +1 41781     write_eeprom_byte_from_acc:
14A4 438F01     +1 41782             orl     PSCTL, #01h                     ; Set the PSWE bit
14A7 538FFD     +1 41783             anl     PSCTL, #0FDh                    ; Clear the PSEE bit
14AA FF         +1 41784             mov     Temp8, A
14AB C3         +1 41785             clr     C
14AC E583       +1 41786             mov     A, DPH                          ; Check that address is not in bootloader a
                             rea
                +1 41787     IF MCU_48MHZ == 2
                +1             subb  A, #0F0h
                +1           ELSE
14AE 941C       +1 41790             subb    A, #1Ch
                +1 41791     ENDIF
14B0 4001       +1 41792             jc      ($+3)
                +1 41793     
14B2 22         +1 41794             ret
                +1 41795     
14B3 EF         +1 41796             mov     A, Temp8
14B4 8567B7     +1 41797             mov     FLKEY, Flash_Key_1              ; First key code
14B7 8568B7     +1 41798             mov     FLKEY, Flash_Key_2              ; Second key code
14BA F0         +1 41799             movx    @DPTR, A                                ; Write to flash
14BB 538FFE     +1 41800             anl     PSCTL, #0FEh                    ; Clear the PSWE bit
14BE 22         +1 41801             ret
                +1 41802     
                +1 41803     
                +1 41804     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 41805     ;
                +1 41806     ; Erase flash routine (erases the flash segment used for "eeprom" variables)
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   638

                +1 41807     ;
                +1 41808     ; No assumptions
                +1 41809     ;
                +1 41810     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
14BF            +1 41811     erase_flash:    
14BF 438F02     +1 41812             orl     PSCTL, #02h                     ; Set the PSEE bit
14C2 438F01     +1 41813             orl     PSCTL, #01h                     ; Set the PSWE bit
14C5 8567B7     +1 41814             mov     FLKEY, Flash_Key_1              ; First key code
14C8 8568B7     +1 41815             mov     FLKEY, Flash_Key_2              ; Second key code
14CB 901A0D     +1 41816             mov     DPTR, #Eep_Initialized_L        
14CE F0         +1 41817             movx    @DPTR, A
14CF 538FFC     +1 41818             anl     PSCTL, #0FCh                    ; Clear the PSEE and PSWE bits
14D2 22         +1 41819             ret
                +1 41820     
                +1 41821     
                +1 41822     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 41823     ;
                +1 41824     ; Write eeprom signature routine
                +1 41825     ;
                +1 41826     ; No assumptions
                +1 41827     ;
                +1 41828     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
14D3            +1 41829     write_eeprom_signature: 
14D3 901A0D     +1 41830             mov     DPTR, #Eep_Initialized_L
14D6 7455       +1 41831             mov     A, #055h
14D8 91A4       +1 41832             call write_eeprom_byte_from_acc
                +1 41833     
14DA 901A0E     +1 41834             mov     DPTR, #Eep_Initialized_H
14DD 74AA       +1 41835             mov     A, #0AAh
14DF 91A4       +1 41836             call write_eeprom_byte_from_acc
14E1 22         +1 41837             ret
                +1 41838     
                +1 41839     
                +1 41840     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 41841     ;
                +1 41842     ; Read all tags from flash and store in temporary storage
                +1 41843     ;
                +1 41844     ; No assumptions
                +1 41845     ;
                +1 41846     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
14E2            +1 41847     read_tags:
14E2 7A30       +1 41848             mov     Temp3, #48                              ; Number of tags
14E4 79D0       +1 41849             mov     Temp2, #Temp_Storage            ; Set RAM address
14E6 7820       +1 41850             mov     Temp1, #Bit_Access
14E8 901A40     +1 41851             mov     DPTR, #Eep_ESC_Layout           ; Set flash address
14EB            +1 41852     read_tag:       
14EB 919F       +1 41853             call read_eeprom_byte
14ED E520       +1 41854             mov     A, Bit_Access
14EF F7         +1 41855             mov     @Temp2, A                       ; Write to RAM
14F0 09         +1 41856             inc     Temp2
14F1 A3         +1 41857             inc     DPTR
14F2 DAF7       +1 41858             djnz Temp3, read_tag    
14F4 22         +1 41859             ret
                +1 41860     
                +1 41861     
                +1 41862     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 41863     ;
                +1 41864     ; Write all tags from temporary storage and store in flash
                +1 41865     ;
                +1 41866     ; No assumptions
                +1 41867     ;
                +1 41868     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
14F5            +1 41869     write_tags:
14F5 7A30       +1 41870             mov     Temp3, #48                              ; Number of tags
14F7 79D0       +1 41871             mov     Temp2, #Temp_Storage            ; Set RAM address
14F9 901A40     +1 41872             mov     DPTR, #Eep_ESC_Layout           ; Set flash address
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   639

14FC            +1 41873     write_tag:      
14FC E7         +1 41874             mov     A, @Temp2                       ; Read from RAM
14FD 91A4       +1 41875             call write_eeprom_byte_from_acc
14FF 09         +1 41876             inc     Temp2
1500 A3         +1 41877             inc     DPTR
1501 DAF9       +1 41878             djnz Temp3, write_tag   
1503 22         +1 41879             ret
                +1 41880     
                +1 41881     
                +1 41882     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 41883     ;
                +1 41884     ; Wait 1 second routine
                +1 41885     ;
                +1 41886     ; No assumptions
                +1 41887     ;
                +1 41888     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
1504            +1 41889     wait1s:
1504 7C05       +1 41890             mov     Temp5, #5
1506            +1 41891     wait1s_loop:
1506 1205AB     +1 41892             call wait200ms
1509 DCFB       +1 41893             djnz    Temp5, wait1s_loop
150B 22         +1 41894             ret
                +1 41895     
                +1 41896     
                +1 41897     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 41898     ;
                +1 41899     ; Success beep routine
                +1 41900     ;
                +1 41901     ; No assumptions
                +1 41902     ;
                +1 41903     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
150C            +1 41904     success_beep:
150C C2AF       +1 41905             clr     IE_EA                           ; Disable all interrupts
150E 120B1C     +1 41906             call beep_f1
1511 120B22     +1 41907             call beep_f2
1514 120B28     +1 41908             call beep_f3
1517 120B2E     +1 41909             call beep_f4
151A 12059F     +1 41910             call wait10ms
151D 120B1C     +1 41911             call beep_f1
1520 120B22     +1 41912             call beep_f2
1523 120B28     +1 41913             call beep_f3
1526 120B2E     +1 41914             call beep_f4
1529 12059F     +1 41915             call wait10ms
152C 120B1C     +1 41916             call beep_f1
152F 120B22     +1 41917             call beep_f2
1532 120B28     +1 41918             call beep_f3
1535 120B2E     +1 41919             call beep_f4
1538 D2AF       +1 41920             setb    IE_EA                           ; Enable all interrupts
153A 22         +1 41921             ret
                +1 41922     
                +1 41923     
                +1 41924     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                +1 41925     ;
                +1 41926     ; Success beep inverted routine
                +1 41927     ;
                +1 41928     ; No assumptions
                +1 41929     ;
                +1 41930     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
153B            +1 41931     success_beep_inverted:
153B C2AF       +1 41932             clr     IE_EA                           ; Disable all interrupts
153D 120B2E     +1 41933             call beep_f4
1540 120B28     +1 41934             call beep_f3
1543 120B22     +1 41935             call beep_f2
1546 120B1C     +1 41936             call beep_f1
1549 12059F     +1 41937             call wait10ms
154C 120B2E     +1 41938             call beep_f4
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   640

154F 120B28     +1 41939             call beep_f3
1552 120B22     +1 41940             call beep_f2
1555 120B1C     +1 41941             call beep_f1
1558 12059F     +1 41942             call wait10ms
155B 120B2E     +1 41943             call beep_f4
155E 120B28     +1 41944             call beep_f3
1561 120B22     +1 41945             call beep_f2
1564 120B1C     +1 41946             call beep_f1
1567 D2AF       +1 41947             setb    IE_EA                           ; Enable all interrupts
1569 22         +1 41948             ret
                +1 41949     
                +1 41950     
                   41951     ;$include (BLHeliBootLoad.inc) ; Include source code for bootloader
                +1 41952     ; BLHeli bootloader for SiLabs MCUs. Based upon AVRootloader (copyright HR)
                +1 41953     
  7840          +1 41954     XTAL                                    EQU     25000000        
                +1 41955     
                +1 41956     IF MCU_48MHZ == 2
                +1           BOOT_START      EQU 0F000h ; Bootloader segment address
                +1           ELSE
  1C00          +1 41959     BOOT_START                      EQU     1C00h   ; Bootloader segment address
                +1 41960     ENDIF
  1E10          +1 41961     BOOT_DELAY                      EQU     XTAL/4  ; About 250ms (don't set to fast to avoid c
                             onnection problems)
  4B00          +1 41962     BOOT_BAUDRATE                   EQU     19200   ; Only used if no baudrate detection activa
                             ted, XTAL is than important
  0006          +1 41963     BOOT_VERSION                    EQU     6               ; Version 6 (must be not changed)
  0001          +1 41964     BOOT_PAGES                      EQU     1               ; Number of flash segments for boot
                             loader
                +1 41965     
  001A          +1 41966     UART_LOOP                               EQU     26              ; Depends upon timing of pu
                             tc, getc 
  FFE6          +1 41967     BAUDTIME                                EQU     ((XTAL/BOOT_BAUDRATE)/3)-UART_LOOP
                +1 41968     
  0030          +1 41969     SUCCESS                         EQU     030h
  00C0          +1 41970     ERRORVERIFY                     EQU     0C0h
  00C1          +1 41971     ERRORCOMMAND                    EQU     0C1h
  00C2          +1 41972     ERRORCRC                                EQU     0C2h
  00C5          +1 41973     ERRORPROG                               EQU     0C5h
                +1 41974     
  A001          +1 41975     POLYNOM                         EQU     0A001h          ; CRC Polynom
                +1 41976     
  REG           +1 41977     Xl                                      EQU     R0                      ; Temporary X
  REG           +1 41978     Xh                                      EQU     R1
  REG           +1 41979     Paral                           EQU     R2                      ; Params for UART
  REG           +1 41980     Parah                           EQU     R3      
  REG           +1 41981     Cmdl                                    EQU     R4                      ; Commands
  REG           +1 41982     Cmdh                                    EQU     R5      
  REG           +1 41983     Cntl                                    EQU     R6                      ; Baudtime
  REG           +1 41984     Cnth                                    EQU     R7
                +1 41985     
----            +1 41986     DSEG AT 20h                                     
0020            +1 41987     Bit_Reg:                                DS      1                       ; Bit storage regis
                             ter
0021            +1 41988     Byte_Reg:                               DS      1                       ; Byte storage regi
                             ster
0022            +1 41989     Crcl:                           DS      1                       ; CRC 16Bit
0023            +1 41990     Crch:                           DS      1
0024            +1 41991     Baudl:                          DS      1                       ; Baudtime
0025            +1 41992     Baudh:                          DS      1
0026            +1 41993     Bit_Cnt:                                DS      1                       ; Counter in UART l
                             oops
0027            +1 41994     Byte_Cntl:                      DS      1                       ; Generic counter
0028            +1 41995     Byte_Cnth:                      DS      1                       
0029            +1 41996     BL_Flash_Key_1:         DS      1                       ; Flash keys
002A            +1 41997     BL_Flash_Key_2:         DS      1
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   641

                +1 41998     
----            +1 41999     CSEG AT BOOT_START              ; Bootloader start
1C00 C2AF       +1 42000     init:clr        IE_EA
                +1 42001             ; Select register bank 0 for main program routines
1C02 C2D3       +1 42002             clr     PSW.3                           ; Select register bank 0 for main program r
                             outines      
                +1 42003             ; Disable the WDT.
1C04 7597DE     +1 42004             mov     WDTCN, #0DEh                    ; Disable watchdog
1C07 7597AD     +1 42005             mov     WDTCN, #0ADh            
                +1 42006             ; Initialize stack
1C0A 7581C0     +1 42007             mov     SP, #0c0h                               ; Stack = 64 upper bytes of RAM
                +1 42008             ; Initialize clock
1C0D 75A900     +1 42009             mov     CLKSEL, #00h                    ; Set clock divider to 1
                +1 42010             ; Initialize VDD monitor
                +1 42011     IF MCU_48MHZ < 2
1C10 43FF80     +1 42012             orl     VDM0CN, #080h                   ; Enable the VDD monitor
                +1 42013     ENDIF
1C13 752438     +1 42014             mov     Baudl, #38h                     ; Wait 100us
1C16 752503     +1 42015             mov     Baudh, #03h
1C19 B1DB       +1 42016             acall waitf
                +1 42017             ; Initialize flash keys
1C1B 7529A5     +1 42018             mov     BL_Flash_Key_1, #0A5h   ; First key code
1C1E 752AF1     +1 42019             mov     BL_Flash_Key_2, #0F1h   ; Second key code
                +1 42020             ; Initialize ports
1C21 43F110     +1 42021             orl     RTX_MDIN, #(1 SHL RTX_PIN)              ; Set digital
1C24 53A4EF     +1 42022             anl     RTX_MDOUT, #NOT(1 SHL RTX_PIN)  ; Disable pushpull
1C27 D284       +1 42023             setb    RTX_PORT.RTX_PIN                                ; Set data high
1C29 75D4FF     +1 42024             mov     RTX_SKIP, #0FFh
1C2C 75E340     +1 42025             mov     XBR2, #40h;                                     ; Enable crossbar
                +1 42026             ; Set number of connect attempts before exiting bootloader
1C2F 7DFA       +1 42027             mov     Cmdh, #250
                +1 42028     
                +1 42029             ; Identifier scanning
1C31 7803       +1 42030     abd:    mov     Xl, #(low(BOOT_DELAY / 6)+1)
1C33 7906       +1 42031             mov     Xh, #(high(BOOT_DELAY / 6)+1)
1C35 7C01       +1 42032             mov     Cmdl, #(high((BOOT_DELAY / 6) SHR 8)+1)
1C37 752200     +1 42033             mov     Crcl, #0
1C3A 752300     +1 42034             mov     Crch, #0
1C3D 901DE8     +1 42035             mov     DPTR, #BOOT_SIGN
1C40 7B06       +1 42036             mov     Parah, #(BOOT_MSG - BOOT_SIGN)
1C42 7524E6     +1 42037             mov     Baudl, #low(BAUDTIME)
1C45 7525FF     +1 42038             mov     Baudh, #high(BAUDTIME)
                +1 42039     
1C48            +1 42040     wait_for_low:
1C48 308402     +1 42041             jnb     RTX_PORT.RTX_PIN, ($+5)
1C4B 8148       +1 42042             ajmp wait_for_low
                +1 42043     
                +1 42044             ; Identifier (BOOT_SIGN) scanning with timeout and checksum
1C4D 208408     +1 42045     id1:    jb      RTX_PORT.RTX_PIN, id3   ; Look for high
1C50 D8FB       +1 42046             djnz    Xl, id1                         ; Subtract 1 from X (BOOT_DELAY)
1C52 D9F9       +1 42047             djnz    Xh, id1
1C54 DCF7       +1 42048             djnz    Cmdl, id1 
                +1 42049     
1C56 81BA       +1 42050             ajmp    exit
                +1 42051     
1C58 308408     +1 42052     id3:    jnb     RTX_PORT.RTX_PIN, id4   ; Look for low
1C5B D8FB       +1 42053             djnz    Xl, id3                         ; Subtract 1 from X (BOOT_DELAY)
1C5D D9F9       +1 42054             djnz    Xh, id3
1C5F DCF7       +1 42055             djnz    Cmdl, id3
                +1 42056     
1C61 81BA       +1 42057             ajmp    exit
                +1 42058     
1C63 B19B       +1 42059     id4:    acall getx                              ; Read character
1C65 E4         +1 42060             clr     A                       
1C66 93         +1 42061             movc A, @A+DPTR                 ; Load BOOT_SIGN character
1C67 A3         +1 42062             inc     DPTR
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   642

1C68 C3         +1 42063             clr     C
1C69 9A         +1 42064             subb    A, Paral                                ; Compare with read character
1C6A 6004       +1 42065             jz      id5
1C6C DDC3       +1 42066             djnz    Cmdh, abd                               ; Retry if not last connect attempt
1C6E 81BA       +1 42067             ajmp    exit
                +1 42068     
1C70            +1 42069     id5:
1C70 DBDB       +1 42070             djnz    Parah, id1
                +1 42071     
1C72 B18D       +1 42072             acall getw                              ; Read CRC
1C74 6002       +1 42073             jz      ($+4)                           ; Check CRC
1C76 8131       +1 42074             ajmp    abd
                +1 42075             
                +1 42076             ; Send info about chip/bootloader (BOOT_MSG + BOOT_INFO)
1C78 7B08       +1 42077             mov     Parah, #((BOOT_INFO - BOOT_MSG) + 4)
1C7A E4         +1 42078     in1:    clr     A                       
1C7B 93         +1 42079             movc A, @A+DPTR                 ; Load character
1C7C FA         +1 42080             mov     Paral, A
1C7D A3         +1 42081             inc     DPTR
1C7E B16E       +1 42082             acall putc
1C80 DBF8       +1 42083             djnz    Parah, in1
                +1 42084     
                +1 42085     
                +1 42086             ; Main commandloop
                +1 42087             ; 0=Run/restart 
                +1 42088             ; 1=Program flash, 2=Erase flash, 3=Read flash
                +1 42089             ; 0xFF=Set address, 0xFE=Set buffer, 0xFD=Keep alive 
1C82 7A30       +1 42090     main:mov        Paral, #SUCCESS
1C84 B16E       +1 42091     mai1:acall putc
1C86 752200     +1 42092             mov     Crcl, #0                                ; Reset CRC
1C89 752300     +1 42093             mov     Crch, #0
1C8C B18D       +1 42094             acall getw                              ; Get command
1C8E EA         +1 42095             mov     A, Paral
1C8F FC         +1 42096             mov     Cmdl, A
1C90 EB         +1 42097             mov     A, Parah
1C91 FD         +1 42098             mov     Cmdh, A
1C92 C3         +1 42099             clr     C
1C93 ED         +1 42100             mov     A, Cmdh
1C94 94FE       +1 42101             subb    A, #0FEh
1C96 400E       +1 42102             jc      mai2                                    ; Jump if not set address or set bu
                             ffer 
                +1 42103     
1C98 B18D       +1 42104             acall getw                              ; Address or number of bytes
1C9A 8A27       +1 42105             mov     Byte_Cntl, Paral                ; Store number of bytes for set buffer
1C9C 8B28       +1 42106             mov     Byte_Cnth, Parah        
1C9E ED         +1 42107             mov     A, Cmdh
1C9F 30E004     +1 42108             jnb     ACC.0, mai2                     ; Jump if set buffer
                +1 42109     
1CA2 8A82       +1 42110             mov     DPL, Paral                      ; Store flash address (for set address)
1CA4 8B83       +1 42111             mov     DPH, Parah
                +1 42112     
1CA6 B18D       +1 42113     mai2:acall getw                         ; Get CRC
1CA8 7AC2       +1 42114             mov     Paral, #ERRORCRC
1CAA 70D8       +1 42115             jnz     mai1
1CAC C3         +1 42116             clr     C
1CAD ED         +1 42117             mov     A, Cmdh
1CAE 94FE       +1 42118             subb    A, #0FEh
1CB0 6019       +1 42119             jz      setbuf                          ; If command is set buffer, receive data
1CB2 50CE       +1 42120             jnc     main
                +1 42121     
1CB4 BD0029     +1 42122             cjne    Cmdh, #0, mai4                  ; Jump if command != 0 (and not set buffer)
                +1 42123     
                +1 42124             ; Run application/restart bootloader
1CB7 EC         +1 42125             mov     A, Cmdl
1CB8 600F       +1 42126             jz      rst
1CBA 752000     +1 42127     exit:mov        Bit_Access, #0                  ; Clear variable used by flash lock detect
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   643

1CBD 7521FF     +1 42128             mov     Bit_Access_Int, #0FFh   ; Set variable to indicate that program execution c
                             ame from bootloader
1CC0 752900     +1 42129             mov     BL_Flash_Key_1, #0              ; Set flash keys to invalid values
1CC3 752A00     +1 42130             mov     BL_Flash_Key_2, #0
1CC6 020000     +1 42131             ljmp    0000h
1CC9 8100       +1 42132     rst:    ajmp    init
                +1 42133     
                +1 42134             ; Set buffer
1CCB A827       +1 42135     setbuf:mov Xl, Byte_Cntl                        ; Set number of bytes 
1CCD A928       +1 42136             mov     Xh, Byte_Cnth
1CCF 08         +1 42137             inc     Xl      
1CD0 09         +1 42138             inc     Xh      
1CD1 D804       +1 42139     set4:djnz       Xl, set5
1CD3 D902       +1 42140             djnz    Xh, set5
1CD5 81DD       +1 42141             ajmp    set6
                +1 42142     
1CD7 B191       +1 42143     set5:acall getc                         ; Receive data
1CD9 EA         +1 42144             mov     A, Paral
1CDA F2         +1 42145             movx    @Xl, A                          ; Store data in XRAM
1CDB 81D1       +1 42146             ajmp    set4
                +1 42147     
1CDD 0D         +1 42148     set6:inc        Cmdh    
1CDE 81A6       +1 42149             ajmp    mai2
                +1 42150     
1CE0 C3         +1 42151     mai4:clr        C
1CE1 ED         +1 42152             mov     A, Cmdh
1CE2 9403       +1 42153             subb    A, #3
1CE4 5051       +1 42154             jnc     mai5                                    ; Jump if command >= 3
                +1 42155     
                +1 42156             ; Program/erase
1CE6 ED         +1 42157             mov     A, Cmdh
1CE7 A2E0       +1 42158             mov     C, ACC.0
1CE9 9200       +1 42159             mov     Bit_Reg.0, C    
1CEB 7AC5       +1 42160             mov     Paral, #ERRORPROG
1CED C3         +1 42161             clr     C
1CEE E582       +1 42162             mov     A, DPL
1CF0 9400       +1 42163             subb    A, #low(BOOT_START)
1CF2 E583       +1 42164             mov     A, DPH
1CF4 941C       +1 42165             subb    A, #high(BOOT_START)
1CF6 508C       +1 42166             jnc     mai1                                    ; Jump if in bootloader segment
1CF8 200010     +1 42167             jb      Bit_Reg.0, pro3         ; Jump if program command
                +1 42168     
                +1 42169             ; Erase flash
1CFB 438F02     +1 42170             orl     PSCTL, #02h                     ; Set the PSEE bit
1CFE 438F01     +1 42171             orl     PSCTL, #01h                     ; Set the PSWE bit
1D01 8529B7     +1 42172             mov     FLKEY, BL_Flash_Key_1   ; First key code
1D04 852AB7     +1 42173             mov     FLKEY, BL_Flash_Key_2   ; Second key code
1D07 F0         +1 42174             movx    @DPTR, A
1D08 300027     +1 42175             jnb     Bit_Reg.0, pro6         ; Jump if erase command
                +1 42176     
                +1 42177             ; Program flash
1D0B A827       +1 42178     pro3:mov        Xl, Byte_Cntl                   ; Set number of bytes 
1D0D A928       +1 42179             mov     Xh, Byte_Cnth
1D0F 08         +1 42180             inc     Xl      
1D10 09         +1 42181             inc     Xh      
1D11 438F01     +1 42182             orl     PSCTL, #01h                     ; Set the PSWE bit
1D14 538FFD     +1 42183             anl     PSCTL, #0FDh                    ; Clear the PSEE bit
1D17 D804       +1 42184     pro4:djnz       Xl, pro5
1D19 D902       +1 42185             djnz    Xh, pro5
1D1B A132       +1 42186             ajmp    pro6
                +1 42187     
1D1D            +1 42188     pro5:
1D1D C3         +1 42189             clr     C
1D1E E583       +1 42190             mov     A, DPH                          ; Check that address is not in bootloader a
                             rea
                +1 42191     IF MCU_48MHZ == 2
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   644

                +1             subb  A, #0F0h
                +1           ELSE
1D20 941C       +1 42194             subb    A, #1Ch
                +1 42195     ENDIF
1D22 4003       +1 42196             jc      ($+5)
                +1 42197     
1D24 A3         +1 42198             inc     DPTR                                    ; Increment flash address
1D25 A117       +1 42199             ajmp    pro4
                +1 42200     
1D27 E2         +1 42201             movx    A, @Xl                          ; Read from XRAM                
1D28 8529B7     +1 42202             mov     FLKEY, BL_Flash_Key_1   ; First key code
1D2B 852AB7     +1 42203             mov     FLKEY, BL_Flash_Key_2   ; Second key code
1D2E F0         +1 42204             movx    @DPTR, A                                ; Write to flash
1D2F A3         +1 42205             inc     DPTR                                    ; Increment flash address
1D30 A117       +1 42206             ajmp    pro4
                +1 42207     
1D32 538FFC     +1 42208     pro6:anl        PSCTL, #0FCh                    ; Clear the PSEE and PSWE bits
1D35 8182       +1 42209             ajmp    main                                    ; Successfully done erase or program
                +1 42210     
                +1 42211             ; Read flash
1D37 7AC1       +1 42212     mai5:mov        Paral, #ERRORCOMMAND    ; Illegal command
1D39 BD030C     +1 42213             cjne    Cmdh, #3, mai6                  ; Jump if not read flash command
                +1 42214     
1D3C E4         +1 42215     rd1:    clr     A
1D3D 93         +1 42216             movc    A, @A+DPTR                      ; Read from flash
1D3E A3         +1 42217             inc     DPTR                                    ; Increment flash address
1D3F FA         +1 42218             mov     Paral, A
1D40 B152       +1 42219             acall putp
1D42 DCF8       +1 42220             djnz    Cmdl, rd1                       ; Decrement bytes to read       
                +1 42221     
1D44 B14A       +1 42222             acall putw                              ; CRC
1D46 8182       +1 42223             ajmp    main
                +1 42224     
1D48 8184       +1 42225     mai6:ajmp       mai1
                +1 42226     
                +1 42227     
                +1 42228     
                +1 42229     
                +1 42230             ; Send char with crc
1D4A AA22       +1 42231     putw:mov        Paral, Crcl
1D4C AB23       +1 42232             mov     Parah, Crch
1D4E B16E       +1 42233             acall putc
1D50 EB         +1 42234             mov     A, Parah
1D51 FA         +1 42235             mov     Paral, A
1D52 EA         +1 42236     putp:mov        A, Paral
1D53 6222       +1 42237             xrl     Crcl, A
1D55 752608     +1 42238             mov     Bit_Cnt, #8
1D58 C3         +1 42239     put1:clr        C
1D59 E523       +1 42240             mov     A, Crch
1D5B 13         +1 42241             rrc     A
1D5C F523       +1 42242             mov     Crch, A
1D5E E522       +1 42243             mov     A, Crcl
1D60 13         +1 42244             rrc     A
1D61 F522       +1 42245             mov     Crcl, A
1D63 5006       +1 42246             jnc     put2
                +1 42247     
1D65 6323A0     +1 42248             xrl     Crch, #high(POLYNOM)
1D68 632201     +1 42249             xrl     Crcl, #low(POLYNOM)
                +1 42250     
1D6B D526EA     +1 42251     put2:djnz       Bit_Cnt, put1
                +1 42252     
                +1 42253     
                +1 42254             ; Send char
1D6E B1DB       +1 42255     putc:acall waitf
1D70 B1DB       +1 42256             acall waitf
1D72 75260A     +1 42257             mov     Bit_Cnt, #10
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   645

1D75 EA         +1 42258             mov     A, Paral
1D76 F4         +1 42259             cpl     A
1D77 200102     +1 42260     put3:jb Bit_Reg.1, ($+5)
1D7A D284       +1 42261             setb    RTX_PORT.RTX_PIN                ; Set pin high
1D7C 300102     +1 42262             jnb     Bit_Reg.1, ($+5)
1D7F C284       +1 42263             clr     RTX_PORT.RTX_PIN                ; Set pin low
1D81 B1DB       +1 42264             acall waitf                                                     
1D83 C3         +1 42265             clr     C
1D84 13         +1 42266             rrc     A
1D85 4002       +1 42267             jc      put4            
                +1 42268                                                     
1D87 C201       +1 42269             clr     Bit_Reg.1
                +1 42270     
1D89 D526EB     +1 42271     put4:djnz       Bit_Cnt, put3
                +1 42272     
1D8C 22         +1 42273             ret
                +1 42274     
                +1 42275     
                +1 42276             ; Receive char/word
1D8D B191       +1 42277     getw:acall getc
1D8F EA         +1 42278             mov     A, Paral
1D90 FB         +1 42279             mov     Parah, A
1D91 208402     +1 42280     getc:jb RTX_PORT.RTX_PIN, ($+5) ; Wait for high
1D94 A191       +1 42281             ajmp    getc
                +1 42282     
1D96 308402     +1 42283     get1:jnb        RTX_PORT.RTX_PIN, ($+5) ; Wait for low
1D99 A196       +1 42284             ajmp    get1
                +1 42285     
1D9B 752608     +1 42286     getx:mov        Bit_Cnt, #8
1D9E AE24       +1 42287             mov     Cntl, Baudl
1DA0 AF25       +1 42288             mov     Cnth, Baudh
1DA2 C3         +1 42289             clr     C
1DA3 EF         +1 42290             mov     A, Cnth                         ; Wait half a baud
1DA4 13         +1 42291             rrc     A
1DA5 FF         +1 42292             mov     Cnth, A
1DA6 EE         +1 42293             mov     A, Cntl
1DA7 13         +1 42294             rrc     A
1DA8 FE         +1 42295             mov     Cntl, A
1DA9 B1DF       +1 42296             acall waith
1DAB B1DB       +1 42297     get2:acall waitf                                ; Wait one baud                            
                                                  
1DAD C3         +1 42298             clr     C
1DAE EA         +1 42299             mov     A, Paral
1DAF 13         +1 42300             rrc     A
1DB0 308402     +1 42301             jnb     RTX_PORT.RTX_PIN, ($+5)                 
1DB3 4480       +1 42302             orl     A, #080h
                +1 42303     
1DB5 FA         +1 42304             mov     Paral, A
1DB6 30E703     +1 42305             jnb     ACC.7, ($+6) 
1DB9 632201     +1 42306             xrl     Crcl, #low(POLYNOM)
                +1 42307     
1DBC C3         +1 42308             clr     C
1DBD E523       +1 42309             mov     A, Crch
1DBF 13         +1 42310             rrc     A
1DC0 F523       +1 42311             mov     Crch, A
1DC2 E522       +1 42312             mov     A, Crcl
1DC4 13         +1 42313             rrc     A
1DC5 F522       +1 42314             mov     Crcl, A
1DC7 5006       +1 42315             jnc     get3                            
                +1 42316     
1DC9 6323A0     +1 42317             xrl     Crch, #high(POLYNOM)
1DCC 632201     +1 42318             xrl     Crcl, #low(POLYNOM)
                +1 42319     
1DCF D526D9     +1 42320     get3:djnz       Bit_Cnt, get2
                +1 42321     
1DD2 E522       +1 42322             mov     A, Crcl 
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   646

1DD4 6523       +1 42323             xrl     A, Crch 
1DD6 6523       +1 42324             xrl     A, Crch 
1DD8 F522       +1 42325             mov     Crcl, A
1DDA 22         +1 42326             ret
                +1 42327     
                +1 42328     
                +1 42329             ; UART delays                                                                      
                                  
1DDB AE24       +1 42330     waitf:mov       Cntl, Baudl     
1DDD AF25       +1 42331             mov     Cnth, Baudh
1DDF 0E         +1 42332     waith:inc Cntl
1DE0 0F         +1 42333             inc     Cnth
1DE1 DEFE       +1 42334     wait1:djnz Cntl, wait1
1DE3 DFFC       +1 42335             djnz Cnth, wait1
                +1 42336     
1DE5 D201       +1 42337             setb    Bit_Reg.1
1DE7 22         +1 42338             ret                                                                     
                +1 42339     
                +1 42340     
1DE8 424C4865   +1 42341     BOOT_SIGN:      DB      "BLHeli"        
1DEC 6C69                    
                +1 42342     
1DEE 34373164   +1 42343     BOOT_MSG:               DB      "471d"          ; Interface-MCU_BootlaoderRevision
                +1 42344     
1DF2 E8B20601   +1 42345     BOOT_INFO:      DB      SIGNATURE_001, SIGNATURE_002, BOOT_VERSION, BOOT_PAGES
                +1 42346     
                   42347     
                   42348     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                   42349     
                   42350     
                   42351     
                   42352     IF MCU_48MHZ == 2
                             CSEG AT 2FFDh
                             ELSE
----               42355     CSEG AT 19FDh
                   42356     ENDIF
19FD               42357     reset:
19FD 020D9B        42358     ljmp    pgm_start
                   42359     
                   42360     
                   42361     
                   42362     END
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   647

SYMBOL TABLE LISTING
------ ----- -------


N A M E                              T Y P E  V A L U E   ATTRIBUTES

ABD . . . . . . . . . . . . . . . .  C ADDR   1C31H   A   
ACC . . . . . . . . . . . . . . . .  D ADDR   00E0H   A   
ACC_ACC0. . . . . . . . . . . . . .  B ADDR   00E0H.0 A   
ACC_ACC1. . . . . . . . . . . . . .  B ADDR   00E0H.1 A   
ACC_ACC2. . . . . . . . . . . . . .  B ADDR   00E0H.2 A   
ACC_ACC3. . . . . . . . . . . . . .  B ADDR   00E0H.3 A   
ACC_ACC4. . . . . . . . . . . . . .  B ADDR   00E0H.4 A   
ACC_ACC5. . . . . . . . . . . . . .  B ADDR   00E0H.5 A   
ACC_ACC6. . . . . . . . . . . . . .  B ADDR   00E0H.6 A   
ACC_ACC7. . . . . . . . . . . . . .  B ADDR   00E0H.7 A   
ACOMFET . . . . . . . . . . . . . .  N NUMB   0003H   A   
ADC0. . . . . . . . . . . . . . . .  D ADDR   00BDH   A   
ADC0AC. . . . . . . . . . . . . . .  D ADDR   00B3H   A   
ADC0CF. . . . . . . . . . . . . . .  D ADDR   00BCH   A   
ADC0CN0 . . . . . . . . . . . . . .  D ADDR   00E8H   A   
ADC0CN0_ADBMEN. . . . . . . . . . .  B ADDR   00E8H.6 A   
ADC0CN0_ADBUSY. . . . . . . . . . .  B ADDR   00E8H.4 A   
ADC0CN0_ADCM0 . . . . . . . . . . .  B ADDR   00E8H.0 A   
ADC0CN0_ADCM1 . . . . . . . . . . .  B ADDR   00E8H.1 A   
ADC0CN0_ADCM2 . . . . . . . . . . .  B ADDR   00E8H.2 A   
ADC0CN0_ADEN. . . . . . . . . . . .  B ADDR   00E8H.7 A   
ADC0CN0_ADINT . . . . . . . . . . .  B ADDR   00E8H.5 A   
ADC0CN0_ADWINT. . . . . . . . . . .  B ADDR   00E8H.3 A   
ADC0CN1 . . . . . . . . . . . . . .  D ADDR   00B2H   A   
ADC0EOC_IRQN. . . . . . . . . . . .  N NUMB   000AH   A   
ADC0GT. . . . . . . . . . . . . . .  D ADDR   00C3H   A   
ADC0GTH . . . . . . . . . . . . . .  D ADDR   00C4H   A   
ADC0GTL . . . . . . . . . . . . . .  D ADDR   00C3H   A   
ADC0H . . . . . . . . . . . . . . .  D ADDR   00BEH   A   
ADC0L . . . . . . . . . . . . . . .  D ADDR   00BDH   A   
ADC0LT. . . . . . . . . . . . . . .  D ADDR   00C5H   A   
ADC0LTH . . . . . . . . . . . . . .  D ADDR   00C6H   A   
ADC0LTL . . . . . . . . . . . . . .  D ADDR   00C5H   A   
ADC0MX. . . . . . . . . . . . . . .  D ADDR   00BBH   A   
ADC0PWR . . . . . . . . . . . . . .  D ADDR   00DFH   A   
ADC0TK. . . . . . . . . . . . . . .  D ADDR   00B9H   A   
ADC0WC_IRQN . . . . . . . . . . . .  N NUMB   0009H   A   
ADC_CONVERSION_CNT. . . . . . . . .  D ADDR   005EH   A   
ADJUST_TIMING_TWO_STEPS . . . . . .  C ADDR   0834H   A   
ADJUST_TIMING_TWO_STEPS_FAST. . . .  C ADDR   0899H   A   
APWMFET . . . . . . . . . . . . . .  N NUMB   0000H   A   
ARMING_CHECK. . . . . . . . . . . .  C ADDR   0FA2H   A   
ARMING_INITIAL_ARM_CHECK. . . . . .  C ADDR   0F98H   A   
ARMING_START. . . . . . . . . . . .  C ADDR   0F81H   A   
ARM_END_BEEP. . . . . . . . . . . .  C ADDR   103EH   A   
AVERAGE_THROTTLE. . . . . . . . . .  C ADDR   0D44H   A   
AVERAGE_THROTTLE_DIV. . . . . . . .  C ADDR   0D63H   A   
AVERAGE_THROTTLE_MEAS . . . . . . .  C ADDR   0D54H   A   
A_. . . . . . . . . . . . . . . . .  N NUMB   0001H   A   
A_X_. . . . . . . . . . . . . . . .  N NUMB   001EH   A   
B . . . . . . . . . . . . . . . . .  D ADDR   00F0H   A   
BAUDH . . . . . . . . . . . . . . .  D ADDR   0025H   A   
BAUDL . . . . . . . . . . . . . . .  D ADDR   0024H   A   
BAUDTIME. . . . . . . . . . . . . .  N NUMB   FFE6H   A   
BCOMFET . . . . . . . . . . . . . .  N NUMB   0004H   A   
BEEP. . . . . . . . . . . . . . . .  C ADDR   0B34H   A   
BEEP_APWMFET_OFF. . . . . . . . . .  C ADDR   0B67H   A   
BEEP_APWMFET_ON . . . . . . . . . .  C ADDR   0B57H   A   
BEEP_CPWMFET_OFF. . . . . . . . . .  C ADDR   0B6CH   A   
BEEP_CPWMFET_ON . . . . . . . . . .  C ADDR   0B5CH   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   648

BEEP_DELAY_SET. . . . . . . . . . .  C ADDR   1079H   A   
BEEP_F1 . . . . . . . . . . . . . .  C ADDR   0B1CH   A   
BEEP_F2 . . . . . . . . . . . . . .  C ADDR   0B22H   A   
BEEP_F3 . . . . . . . . . . . . . .  C ADDR   0B28H   A   
BEEP_F4 . . . . . . . . . . . . . .  C ADDR   0B2EH   A   
BEEP_OFF. . . . . . . . . . . . . .  C ADDR   0B75H   A   
BEEP_ONOFF. . . . . . . . . . . . .  C ADDR   0B3CH   A   
BEEP_START. . . . . . . . . . . . .  C ADDR   0B3AH   A   
BEEP_STRENGTH . . . . . . . . . . .  D ADDR   0064H   A   
BIT_ACCESS. . . . . . . . . . . . .  D ADDR   0020H   A   
BIT_ACCESS_INT. . . . . . . . . . .  D ADDR   0021H   A   
BIT_CNT . . . . . . . . . . . . . .  D ADDR   0026H   A   
BIT_REG . . . . . . . . . . . . . .  D ADDR   0020H   A   
BL_FLASH_KEY_1. . . . . . . . . . .  D ADDR   0029H   A   
BL_FLASH_KEY_2. . . . . . . . . . .  D ADDR   002AH   A   
BOOTLOADER_DONE . . . . . . . . . .  C ADDR   0E1BH   A   
BOOT_BAUDRATE . . . . . . . . . . .  N NUMB   4B00H   A   
BOOT_DELAY. . . . . . . . . . . . .  N NUMB   1E10H   A   
BOOT_INFO . . . . . . . . . . . . .  C ADDR   1DF2H   A   
BOOT_MSG. . . . . . . . . . . . . .  C ADDR   1DEEH   A   
BOOT_PAGES. . . . . . . . . . . . .  N NUMB   0001H   A   
BOOT_SIGN . . . . . . . . . . . . .  C ADDR   1DE8H   A   
BOOT_START. . . . . . . . . . . . .  N NUMB   1C00H   A   
BOOT_VERSION. . . . . . . . . . . .  N NUMB   0006H   A   
BPWMFET . . . . . . . . . . . . . .  N NUMB   0001H   A   
BYTE_CNTH . . . . . . . . . . . . .  D ADDR   0028H   A   
BYTE_CNTL . . . . . . . . . . . . .  D ADDR   0027H   A   
BYTE_REG. . . . . . . . . . . . . .  D ADDR   0021H   A   
B_. . . . . . . . . . . . . . . . .  N NUMB   0002H   A   
B_B0. . . . . . . . . . . . . . . .  B ADDR   00F0H.0 A   
B_B1. . . . . . . . . . . . . . . .  B ADDR   00F0H.1 A   
B_B2. . . . . . . . . . . . . . . .  B ADDR   00F0H.2 A   
B_B3. . . . . . . . . . . . . . . .  B ADDR   00F0H.3 A   
B_B4. . . . . . . . . . . . . . . .  B ADDR   00F0H.4 A   
B_B5. . . . . . . . . . . . . . . .  B ADDR   00F0H.5 A   
B_B6. . . . . . . . . . . . . . . .  B ADDR   00F0H.6 A   
B_B7. . . . . . . . . . . . . . . .  B ADDR   00F0H.7 A   
B_X_. . . . . . . . . . . . . . . .  N NUMB   001FH   A   
CALC_NEW_WAIT_PER_DEMAG_DONE. . . .  C ADDR   0770H   A   
CALC_NEW_WAIT_PER_STARTUP_DONE. . .  C ADDR   0754H   A   
CALC_NEW_WAIT_TIMES . . . . . . . .  C ADDR   07FBH   A   
CALC_NEW_WAIT_TIMES_EXIT. . . . . .  C ADDR   079CH   A   
CALC_NEW_WAIT_TIMES_FAST. . . . . .  C ADDR   0880H   A   
CALC_NEW_WAIT_TIMES_FAST_DONE . . .  C ADDR   07E7H   A   
CALC_NEW_WAIT_TIMES_SETUP . . . . .  C ADDR   0745H   A   
CALC_NEXT_COMM_AVG_PERIOD_DIV . . .  C ADDR   0717H   A   
CALC_NEXT_COMM_NEW_PERIOD_DIV . . .  C ADDR   072AH   A   
CALC_NEXT_COMM_NEW_PERIOD_DIV_DONE.  C ADDR   0733H   A   
CALC_NEXT_COMM_NORMAL . . . . . . .  C ADDR   06F8H   A   
CALC_NEXT_COMM_STARTUP. . . . . . .  C ADDR   06B8H   A   
CALC_NEXT_COMM_STARTUP_AVERAGE. . .  C ADDR   06DDH   A   
CALC_NEXT_COMM_STARTUP_NO_X . . . .  C ADDR   06CAH   A   
CALC_NEXT_COMM_TIMING . . . . . . .  C ADDR   0681H   A   
CALC_NEXT_COMM_TIMING_FAST. . . . .  C ADDR   079FH   A   
CCOMFET . . . . . . . . . . . . . .  N NUMB   0005H   A   
CENTER_THROTTLE_H . . . . . . . . .  D ADDR   0034H   A   
CENTER_THROTTLE_L . . . . . . . . .  D ADDR   0033H   A   
CHECK_DSHOT_CMD . . . . . . . . . .  C ADDR   10CAH   A   
CHECK_TEMP_VOLTAGE_AND_LIMIT_POWER.  C ADDR   0604H   A   
CHECK_VOLTAGE_START . . . . . . . .  C ADDR   0660H   A   
CKCON0. . . . . . . . . . . . . . .  D ADDR   008EH   A   
CKCON1. . . . . . . . . . . . . . .  D ADDR   00A6H   A   
CLEAR_DSHOT_CMD . . . . . . . . . .  C ADDR   125EH   A   
CLEAR_RAM . . . . . . . . . . . . .  C ADDR   0DE0H   A   
CLKSEL. . . . . . . . . . . . . . .  D ADDR   00A9H   A   
CLOCK_SET_AT_48MHZ. . . . . . . . .  D ADDR   0066H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   649

CMDH. . . . . . . . . . . . . . . .    REG    R5          
CMDL. . . . . . . . . . . . . . . .    REG    R4          
CMP0CN0 . . . . . . . . . . . . . .  D ADDR   009BH   A   
CMP0CN1 . . . . . . . . . . . . . .  D ADDR   0099H   A   
CMP0MD. . . . . . . . . . . . . . .  D ADDR   009DH   A   
CMP0MX. . . . . . . . . . . . . . .  D ADDR   009FH   A   
CMP0_IRQN . . . . . . . . . . . . .  N NUMB   000CH   A   
CMP1CN0 . . . . . . . . . . . . . .  D ADDR   00BFH   A   
CMP1CN1 . . . . . . . . . . . . . .  D ADDR   00ACH   A   
CMP1MD. . . . . . . . . . . . . . .  D ADDR   00ABH   A   
CMP1MX. . . . . . . . . . . . . . .  D ADDR   00AAH   A   
CMP1_IRQN . . . . . . . . . . . . .  N NUMB   000DH   A   
CNTH. . . . . . . . . . . . . . . .    REG    R7          
CNTL. . . . . . . . . . . . . . . .    REG    R6          
COMM12_REV. . . . . . . . . . . . .  C ADDR   0A5EH   A   
COMM1COMM2. . . . . . . . . . . . .  C ADDR   0A4BH   A   
COMM23_REV. . . . . . . . . . . . .  C ADDR   0A81H   A   
COMM2COMM3. . . . . . . . . . . . .  C ADDR   0A6EH   A   
COMM34_REV. . . . . . . . . . . . .  C ADDR   0AA4H   A   
COMM3COMM4. . . . . . . . . . . . .  C ADDR   0A91H   A   
COMM45_REV. . . . . . . . . . . . .  C ADDR   0AC7H   A   
COMM4COMM5. . . . . . . . . . . . .  C ADDR   0AB4H   A   
COMM56_REV. . . . . . . . . . . . .  C ADDR   0AEAH   A   
COMM5COMM6. . . . . . . . . . . . .  C ADDR   0AD7H   A   
COMM61_REV. . . . . . . . . . . . .  C ADDR   0B0DH   A   
COMM6COMM1. . . . . . . . . . . . .  C ADDR   0AFAH   A   
COMM_EXIT . . . . . . . . . . . . .  C ADDR   0B1BH   A   
COMM_PERIOD4X_H . . . . . . . . . .  D ADDR   0048H   A   
COMM_PERIOD4X_L . . . . . . . . . .  D ADDR   0047H   A   
COMPARATOR_READ_CNT . . . . . . . .  D ADDR   0049H   A   
COMP_CHECK_TIMEOUT. . . . . . . . .  C ADDR   0943H   A   
COMP_CHECK_TIMEOUT_EXTEND_TIMEOUT .  C ADDR   0954H   A   
COMP_CHECK_TIMEOUT_NOT_TIMED_OUT. .  C ADDR   0956H   A   
COMP_CHECK_TIMEOUT_TIMEOUT_EXTENDED  C ADDR   0950H   A   
COMP_COM. . . . . . . . . . . . . .  N NUMB   0003H   A   
COMP_READ_OK. . . . . . . . . . . .  C ADDR   09B1H   A   
COMP_READ_OK_JMP. . . . . . . . . .  C ADDR   09C3H   A   
COMP_READ_WRONG . . . . . . . . . .  C ADDR   0961H   A   
COMP_READ_WRONG_EXTEND_TIMEOUT. . .  C ADDR   097AH   A   
COMP_READ_WRONG_LOAD_TIMEOUT. . . .  C ADDR   09A7H   A   
COMP_READ_WRONG_LOW_RPM . . . . . .  C ADDR   0996H   A   
COMP_READ_WRONG_NOT_STARTUP . . . .  C ADDR   096DH   A   
COMP_READ_WRONG_TIMEOUT_SET . . . .  C ADDR   098BH   A   
COMP_SCALE_SAMPLES. . . . . . . . .  C ADDR   093BH   A   
COMP_TIMED_OUT. . . . . . . . . . .  N NUMB   0002H   A   
CPWMFET . . . . . . . . . . . . . .  N NUMB   0002H   A   
CRC0CN0 . . . . . . . . . . . . . .  D ADDR   00CEH   A   
CRC0CN1 . . . . . . . . . . . . . .  D ADDR   0086H   A   
CRC0CNT . . . . . . . . . . . . . .  D ADDR   00D3H   A   
CRC0DAT . . . . . . . . . . . . . .  D ADDR   00DEH   A   
CRC0FLIP. . . . . . . . . . . . . .  D ADDR   00CFH   A   
CRC0IN. . . . . . . . . . . . . . .  D ADDR   00DDH   A   
CRC0ST. . . . . . . . . . . . . . .  D ADDR   00D2H   A   
CRC0_PAGE . . . . . . . . . . . . .  N NUMB   0000H   A   
CRCH. . . . . . . . . . . . . . . .  D ADDR   0023H   A   
CRCL. . . . . . . . . . . . . . . .  D ADDR   0022H   A   
CURRENT_AVERAGE_TEMP. . . . . . . .  D ADDR   005FH   A   
CURRENT_POWER_PWM_REG_H . . . . . .  D ADDR   005AH   A   
C_. . . . . . . . . . . . . . . . .  N NUMB   0003H   A   
C_X_. . . . . . . . . . . . . . . .  N NUMB   0020H   A   
DAMP_PWM_REG_H. . . . . . . . . . .  D ADDR   0059H   A   
DAMP_PWM_REG_L. . . . . . . . . . .  D ADDR   0058H   A   
DEBUGPIN. . . . . . . . . . . . . .  N NUMB   0000H   A   
DECODE_DEMAG_DONE . . . . . . . . .  C ADDR   0C63H   A   
DECODE_DEMAG_HIGH . . . . . . . . .  C ADDR   0C5DH   A   
DECODE_SETTINGS . . . . . . . . . .  C ADDR   0C21H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   650

DECODE_TEMP_DONE. . . . . . . . . .  C ADDR   0C6FH   A   
DECODE_TEMP_STEP. . . . . . . . . .  C ADDR   0C6BH   A   
DEFAULT_PGM_BEACON_DELAY. . . . . .  N NUMB   0004H   A   
DEFAULT_PGM_BEACON_STRENGTH . . . .  N NUMB   0050H   A   
DEFAULT_PGM_BEEP_STRENGTH . . . . .  N NUMB   0001H   A   
DEFAULT_PGM_BRAKE_ON_STOP . . . . .  N NUMB   0000H   A   
DEFAULT_PGM_CENTER_THROTTLE . . . .  N NUMB   007AH   A   
DEFAULT_PGM_COMM_TIMING . . . . . .  N NUMB   0003H   A   
DEFAULT_PGM_DEMAG_COMP. . . . . . .  N NUMB   0002H   A   
DEFAULT_PGM_DIRECTION . . . . . . .  N NUMB   0002H   A   
DEFAULT_PGM_ENABLE_POWER_PROT . . .  N NUMB   0001H   A   
DEFAULT_PGM_ENABLE_TEMP_PROT. . . .  N NUMB   0007H   A   
DEFAULT_PGM_ENABLE_TX_PROGRAM . . .  N NUMB   0001H   A   
DEFAULT_PGM_LED_CONTROL . . . . . .  N NUMB   0000H   A   
DEFAULT_PGM_MAX_THROTTLE. . . . . .  N NUMB   00FAH   A   
DEFAULT_PGM_MIN_THROTTLE. . . . . .  N NUMB   001BH   A   
DEFAULT_PGM_STARTUP_PWR . . . . . .  N NUMB   000DH   A   
DEMAG_DETECTED. . . . . . . . . . .  N NUMB   0001H   A   
DEMAG_DETECTED_METRIC . . . . . . .  D ADDR   003DH   A   
DEMAG_PWR_OFF_THRESH. . . . . . . .  D ADDR   003EH   A   
DERIVID . . . . . . . . . . . . . .  D ADDR   00ADH   A   
DEVICEID. . . . . . . . . . . . . .  D ADDR   00B5H   A   
DIRECT_START_CHECK_RCP. . . . . . .  C ADDR   1351H   A   
DIR_CHANGE_BRAKE. . . . . . . . . .  N NUMB   0003H   A   
DONT_CLEAR_DSHOT_CMD. . . . . . . .  C ADDR   1264H   A   
DP. . . . . . . . . . . . . . . . .  D ADDR   0082H   A   
DPH . . . . . . . . . . . . . . . .  D ADDR   0083H   A   
DPL . . . . . . . . . . . . . . . .  D ADDR   0082H   A   
DSHOT_BEEP_2. . . . . . . . . . . .  C ADDR   10E8H   A   
DSHOT_BEEP_3. . . . . . . . . . . .  C ADDR   1106H   A   
DSHOT_BEEP_4. . . . . . . . . . . .  C ADDR   1124H   A   
DSHOT_BEEP_5. . . . . . . . . . . .  C ADDR   1142H   A   
DSHOT_CMD . . . . . . . . . . . . .  D ADDR   0052H   A   
DSHOT_CMD_CNT . . . . . . . . . . .  D ADDR   0053H   A   
DSHOT_DIRECTION_1 . . . . . . . . .  C ADDR   1160H   A   
DSHOT_DIRECTION_2 . . . . . . . . .  C ADDR   1180H   A   
DSHOT_DIRECTION_BIDIR_OFF . . . . .  C ADDR   11A0H   A   
DSHOT_DIRECTION_BIDIR_ON. . . . . .  C ADDR   11BEH   A   
DSHOT_DIRECTION_NORMAL. . . . . . .  C ADDR   11DBH   A   
DSHOT_DIRECTION_REVERSE . . . . . .  C ADDR   1207H   A   
DSHOT_FRAME_LENGTH_THR. . . . . . .  D ADDR   006EH   A   
DSHOT_FRAME_START_H . . . . . . . .  D ADDR   006DH   A   
DSHOT_FRAME_START_L . . . . . . . .  D ADDR   006CH   A   
DSHOT_PWM_THR . . . . . . . . . . .  D ADDR   006AH   A   
DSHOT_SAVE_SETTINGS . . . . . . . .  C ADDR   1246H   A   
DSHOT_TIMER_PRESET. . . . . . . . .  D ADDR   006BH   A   
D_. . . . . . . . . . . . . . . . .  N NUMB   0004H   A   
D_X_. . . . . . . . . . . . . . . .  N NUMB   0021H   A   
EEPROM_FW_MAIN_REVISION . . . . . .  N NUMB   0010H   A   
EEPROM_FW_SUB_REVISION. . . . . . .  N NUMB   0007H   A   
EEPROM_LAYOUT_REVISION. . . . . . .  N NUMB   0021H   A   
EEP_DUMMY . . . . . . . . . . . . .  C ADDR   1A29H   A   
EEP_ENABLE_TX_PROGRAM . . . . . . .  C ADDR   1A0FH   A   
EEP_ESC_LAYOUT. . . . . . . . . . .  C ADDR   1A40H   A   
EEP_ESC_MCU . . . . . . . . . . . .  C ADDR   1A50H   A   
EEP_FW_MAIN_REVISION. . . . . . . .  C ADDR   1A00H   A   
EEP_FW_SUB_REVISION . . . . . . . .  C ADDR   1A01H   A   
EEP_INITIALIZED_H . . . . . . . . .  C ADDR   1A0EH   A   
EEP_INITIALIZED_L . . . . . . . . .  C ADDR   1A0DH   A   
EEP_LAYOUT_REVISION . . . . . . . .  C ADDR   1A02H   A   
EEP_NAME. . . . . . . . . . . . . .  C ADDR   1A60H   A   
EEP_PGM_BEACON_DELAY. . . . . . . .  C ADDR   1A1DH   A   
EEP_PGM_BEACON_STRENGTH . . . . . .  C ADDR   1A1CH   A   
EEP_PGM_BEEP_STRENGTH . . . . . . .  C ADDR   1A1BH   A   
EEP_PGM_BRAKE_ON_STOP . . . . . . .  C ADDR   1A27H   A   
EEP_PGM_CENTER_THROTTLE . . . . . .  C ADDR   1A21H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   651

EEP_PGM_COMM_TIMING . . . . . . . .  C ADDR   1A15H   A   
EEP_PGM_DEMAG_COMP. . . . . . . . .  C ADDR   1A1FH   A   
EEP_PGM_DIRECTION . . . . . . . . .  C ADDR   1A0BH   A   
EEP_PGM_ENABLE_POWER_PROT . . . . .  C ADDR   1A24H   A   
EEP_PGM_LED_CONTROL . . . . . . . .  C ADDR   1A28H   A   
EEP_PGM_MAX_THROTTLE. . . . . . . .  C ADDR   1A1AH   A   
EEP_PGM_MIN_THROTTLE. . . . . . . .  C ADDR   1A19H   A   
EEP_PGM_STARTUP_PWR . . . . . . . .  C ADDR   1A09H   A   
EEP_PGM_TEMP_PROT_ENABLE. . . . . .  C ADDR   1A23H   A   
EIE1. . . . . . . . . . . . . . . .  D ADDR   00E6H   A   
EIE2. . . . . . . . . . . . . . . .  D ADDR   00CEH   A   
EIP1. . . . . . . . . . . . . . . .  D ADDR   00F3H   A   
EIP1H . . . . . . . . . . . . . . .  D ADDR   00F5H   A   
EIP2. . . . . . . . . . . . . . . .  D ADDR   00F4H   A   
EIP2H . . . . . . . . . . . . . . .  D ADDR   00F6H   A   
EMI0CN. . . . . . . . . . . . . . .  D ADDR   00E7H   A   
ERASE_AND_STORE_ALL_IN_EEPROM . . .  C ADDR   1466H   A   
ERASE_FLASH . . . . . . . . . . . .  C ADDR   14BFH   A   
ERRORCOMMAND. . . . . . . . . . . .  N NUMB   00C1H   A   
ERRORCRC. . . . . . . . . . . . . .  N NUMB   00C2H   A   
ERRORPROG . . . . . . . . . . . . .  N NUMB   00C5H   A   
ERRORVERIFY . . . . . . . . . . . .  N NUMB   00C0H   A   
ESCNO . . . . . . . . . . . . . . .  N NUMB   000AH   A   
EVALUATE_COMPARATOR_INTEGRITY . . .  C ADDR   09E5H   A   
EVAL_COMP_CHECK_TIMEOUT . . . . . .  C ADDR   09F2H   A   
EVAL_COMP_EXIT. . . . . . . . . . .  C ADDR   0A02H   A   
EXIT. . . . . . . . . . . . . . . .  C ADDR   1CBAH   A   
E_. . . . . . . . . . . . . . . . .  N NUMB   0005H   A   
E_X_. . . . . . . . . . . . . . . .  N NUMB   0022H   A   
FETON_DELAY . . . . . . . . . . . .  N NUMB   001EH   A   
FIND_THROTTLE_GAIN. . . . . . . . .  C ADDR   0CF5H   A   
FIND_THROTTLE_GAINS . . . . . . . .  C ADDR   0C8FH   A   
FIND_THROTTLE_GAINS_BIDIR_DONE. . .  C ADDR   0CC8H   A   
FIND_THROTTLE_GAINS_NORMAL. . . . .  C ADDR   0CA3H   A   
FIND_THROTTLE_GAIN_FWD. . . . . . .  C ADDR   0CEEH   A   
FIND_THROTTLE_GAIN_LOOP . . . . . .  C ADDR   0D20H   A   
FLAGS0. . . . . . . . . . . . . . .  D ADDR   0024H   A   
FLAGS1. . . . . . . . . . . . . . .  D ADDR   0025H   A   
FLAGS2. . . . . . . . . . . . . . .  D ADDR   0026H   A   
FLAGS3. . . . . . . . . . . . . . .  D ADDR   0027H   A   
FLASH_KEY_1 . . . . . . . . . . . .  D ADDR   0067H   A   
FLASH_KEY_2 . . . . . . . . . . . .  D ADDR   0068H   A   
FLKEY . . . . . . . . . . . . . . .  D ADDR   00B7H   A   
F_. . . . . . . . . . . . . . . . .  N NUMB   0006H   A   
GET1. . . . . . . . . . . . . . . .  C ADDR   1D96H   A   
GET2. . . . . . . . . . . . . . . .  C ADDR   1DABH   A   
GET3. . . . . . . . . . . . . . . .  C ADDR   1DCFH   A   
GETC. . . . . . . . . . . . . . . .  C ADDR   1D91H   A   
GETW. . . . . . . . . . . . . . . .  C ADDR   1D8DH   A   
GETX. . . . . . . . . . . . . . . .  C ADDR   1D9BH   A   
GET_RCP_END . . . . . . . . . . . .  C ADDR   0363H   A   
G_. . . . . . . . . . . . . . . . .  N NUMB   0007H   A   
HFO0CAL . . . . . . . . . . . . . .  D ADDR   00C7H   A   
HFO1CAL . . . . . . . . . . . . . .  D ADDR   00D6H   A   
HFOCN . . . . . . . . . . . . . . .  D ADDR   00EFH   A   
HIGH_RPM. . . . . . . . . . . . . .  N NUMB   0004H   A   
H_. . . . . . . . . . . . . . . . .  N NUMB   0008H   A   
I2C0CN0 . . . . . . . . . . . . . .  D ADDR   00BAH   A   
I2C0DIN . . . . . . . . . . . . . .  D ADDR   00BCH   A   
I2C0DOUT. . . . . . . . . . . . . .  D ADDR   00BBH   A   
I2C0FCN0. . . . . . . . . . . . . .  D ADDR   00ADH   A   
I2C0FCN1. . . . . . . . . . . . . .  D ADDR   00ABH   A   
I2C0FCT . . . . . . . . . . . . . .  D ADDR   00F5H   A   
I2C0SLAD. . . . . . . . . . . . . .  D ADDR   00BDH   A   
I2C0STAT. . . . . . . . . . . . . .  D ADDR   00B9H   A   
I2C0_IRQN . . . . . . . . . . . . .  N NUMB   0012H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   652

I2CSLAVE0_PAGE. . . . . . . . . . .  N NUMB   0020H   A   
ID1 . . . . . . . . . . . . . . . .  C ADDR   1C4DH   A   
ID3 . . . . . . . . . . . . . . . .  C ADDR   1C58H   A   
ID4 . . . . . . . . . . . . . . . .  C ADDR   1C63H   A   
ID5 . . . . . . . . . . . . . . . .  C ADDR   1C70H   A   
IE. . . . . . . . . . . . . . . . .  D ADDR   00A8H   A   
IE_EA . . . . . . . . . . . . . . .  B ADDR   00A8H.7 A   
IE_ES0. . . . . . . . . . . . . . .  B ADDR   00A8H.4 A   
IE_ESPI0. . . . . . . . . . . . . .  B ADDR   00A8H.6 A   
IE_ET0. . . . . . . . . . . . . . .  B ADDR   00A8H.1 A   
IE_ET1. . . . . . . . . . . . . . .  B ADDR   00A8H.3 A   
IE_ET2. . . . . . . . . . . . . . .  B ADDR   00A8H.5 A   
IE_EX0. . . . . . . . . . . . . . .  B ADDR   00A8H.0 A   
IE_EX1. . . . . . . . . . . . . . .  B ADDR   00A8H.2 A   
IN1 . . . . . . . . . . . . . . . .  C ADDR   1C7AH   A   
INIT. . . . . . . . . . . . . . . .  C ADDR   1C00H   A   
INITIALIZED_H_DUMMY . . . . . . . .  I ADDR   008BH   A   
INITIALIZED_L_DUMMY . . . . . . . .  I ADDR   008AH   A   
INITIALIZE_TIMING . . . . . . . . .  C ADDR   067AH   A   
INITIAL_ARM . . . . . . . . . . . .  D ADDR   0030H   A   
INITIAL_RUN_CHECK_STARTUP_ROT . . .  C ADDR   136EH   A   
INITIAL_RUN_CONTINUE_RUN. . . . . .  C ADDR   137AH   A   
INITIAL_RUN_PHASE . . . . . . . . .  N NUMB   0001H   A   
INITIAL_RUN_PHASE_DONE. . . . . . .  C ADDR   137FH   A   
INITIAL_RUN_ROT_CNTD. . . . . . . .  D ADDR   003BH   A   
INIT_NO_SIGNAL. . . . . . . . . . .  C ADDR   0E05H   A   
INIT_START. . . . . . . . . . . . .  C ADDR   126CH   A   
INIT_START_BIDIR_DONE . . . . . . .  C ADDR   12BFH   A   
INPUT_HIGH_CHECK_1. . . . . . . . .  C ADDR   0E0FH   A   
INPUT_HIGH_CHECK_2. . . . . . . . .  C ADDR   0E11H   A   
INT0_INT. . . . . . . . . . . . . .  C ADDR   031CH   A   
INT0_INT_BIDIR_DO_DEADBAND. . . . .  C ADDR   0456H   A   
INT0_INT_BIDIR_FWD. . . . . . . . .  C ADDR   0430H   A   
INT0_INT_BIDIR_REV_CHK. . . . . . .  C ADDR   0435H   A   
INT0_INT_CALCULATE. . . . . . . . .  C ADDR   0417H   A   
INT0_INT_CHECK_FULL_RANGE . . . . .  C ADDR   03FDH   A   
INT0_INT_DO_THROTTLE_GAIN . . . . .  C ADDR   0475H   A   
INT0_INT_EXIT . . . . . . . . . . .  C ADDR   052BH   A   
INT0_INT_FALL_GAIN_DONE . . . . . .  C ADDR   03D8H   A   
INT0_INT_FALL_NOT_MULTISHOT . . . .  C ADDR   0385H   A   
INT0_INT_FALL_NOT_ONESHOT_125 . . .  C ADDR   03AFH   A   
INT0_INT_FALL_NOT_ONESHOT_42. . . .  C ADDR   0397H   A   
INT0_INT_GAIN_LOOP. . . . . . . . .  C ADDR   04B7H   A   
INT0_INT_GAIN_RCP_DONE. . . . . . .  C ADDR   04BFH   A   
INT0_INT_NOT_BIDIR. . . . . . . . .  C ADDR   0469H   A   
INT0_INT_NOT_DSHOT. . . . . . . . .  C ADDR   032BH   A   
INT0_INT_OUTSIDE_RANGE. . . . . . .  C ADDR   03E7H   A   
INT0_INT_PULSE_READY. . . . . . . .  C ADDR   04D4H   A   
INT0_INT_SET_MIN. . . . . . . . . .  C ADDR   040CH   A   
INT0_INT_SET_PWM_DAMP_SET . . . . .  C ADDR   050DH   A   
INT0_INT_SET_PWM_REGISTERS. . . . .  C ADDR   04F6H   A   
INT0_INT_SET_TIMEOUT. . . . . . . .  C ADDR   0528H   A   
INT0_INT_STARTUP_BOOSTED. . . . . .  C ADDR   0496H   A   
INT0_INT_STARTUP_BOOST_STALL. . . .  C ADDR   048CH   A   
INT0_INT_UNIDIR_NEG . . . . . . . .  C ADDR   046DH   A   
INT0_IRQN . . . . . . . . . . . . .  N NUMB   0000H   A   
INT1_INT. . . . . . . . . . . . . .  C ADDR   0535H   A   
INT1_IRQN . . . . . . . . . . . . .  N NUMB   0002H   A   
IP. . . . . . . . . . . . . . . . .  D ADDR   00B8H   A   
IPH . . . . . . . . . . . . . . . .  D ADDR   00F2H   A   
IP_PS0. . . . . . . . . . . . . . .  B ADDR   00B8H.4 A   
IP_PSPI0. . . . . . . . . . . . . .  B ADDR   00B8H.6 A   
IP_PT0. . . . . . . . . . . . . . .  B ADDR   00B8H.1 A   
IP_PT1. . . . . . . . . . . . . . .  B ADDR   00B8H.3 A   
IP_PT2. . . . . . . . . . . . . . .  B ADDR   00B8H.5 A   
IP_PX0. . . . . . . . . . . . . . .  B ADDR   00B8H.0 A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   653

IP_PX1. . . . . . . . . . . . . . .  B ADDR   00B8H.2 A   
IT01CF. . . . . . . . . . . . . . .  D ADDR   00E4H   A   
I_. . . . . . . . . . . . . . . . .  N NUMB   0009H   A   
JMP_WAIT_FOR_POWER_ON . . . . . . .  C ADDR   141DH   A   
J_. . . . . . . . . . . . . . . . .  N NUMB   000AH   A   
K_. . . . . . . . . . . . . . . . .  N NUMB   000BH   A   
LED_0 . . . . . . . . . . . . . . .  N NUMB   0005H   A   
LED_0_DONE. . . . . . . . . . . . .  C ADDR   0D83H   A   
LED_1 . . . . . . . . . . . . . . .  N NUMB   0006H   A   
LED_1_DONE. . . . . . . . . . . . .  C ADDR   0D8CH   A   
LED_2 . . . . . . . . . . . . . . .  N NUMB   0007H   A   
LED_2_DONE. . . . . . . . . . . . .  C ADDR   0D95H   A   
LED_3_DONE. . . . . . . . . . . . .  C ADDR   0D9AH   A   
LED_CONTROL . . . . . . . . . . . .  C ADDR   0D77H   A   
LEGACY_PAGE . . . . . . . . . . . .  N NUMB   0000H   A   
LFO0CN. . . . . . . . . . . . . . .  D ADDR   00B1H   A   
LOAD_MIN_TIME . . . . . . . . . . .  C ADDR   0798H   A   
LOAD_MIN_TIME_FAST. . . . . . . . .  C ADDR   07E5H   A   
LOW_RPM_PWR_SLOPE . . . . . . . . .  D ADDR   003FH   A   
L_. . . . . . . . . . . . . . . . .  N NUMB   000CH   A   
MAI1. . . . . . . . . . . . . . . .  C ADDR   1C84H   A   
MAI2. . . . . . . . . . . . . . . .  C ADDR   1CA6H   A   
MAI4. . . . . . . . . . . . . . . .  C ADDR   1CE0H   A   
MAI5. . . . . . . . . . . . . . . .  C ADDR   1D37H   A   
MAI6. . . . . . . . . . . . . . . .  C ADDR   1D48H   A   
MAIN. . . . . . . . . . . . . . . .  C ADDR   1C82H   A   
MAX_THROTTLE_H. . . . . . . . . . .  D ADDR   0036H   A   
MAX_THROTTLE_L. . . . . . . . . . .  D ADDR   0035H   A   
MCU_48MHZ . . . . . . . . . . . . .  N NUMB   0001H   A   
MIN_THROTTLE_H. . . . . . . . . . .  D ADDR   0032H   A   
MIN_THROTTLE_L. . . . . . . . . . .  D ADDR   0031H   A   
MOTOR_STARTED . . . . . . . . . . .  N NUMB   0002H   A   
MUX_A . . . . . . . . . . . . . . .  N NUMB   0000H   A   
MUX_B . . . . . . . . . . . . . . .  N NUMB   0002H   A   
MUX_C . . . . . . . . . . . . . . .  N NUMB   0001H   A   
M_. . . . . . . . . . . . . . . . .  N NUMB   000DH   A   
NEW_RCP . . . . . . . . . . . . . .  D ADDR   0054H   A   
NORMAL_RUN_CHECKS . . . . . . . . .  C ADDR   135DH   A   
N_. . . . . . . . . . . . . . . . .  N NUMB   000EH   A   
O_. . . . . . . . . . . . . . . . .  N NUMB   000FH   A   
P0. . . . . . . . . . . . . . . . .  D ADDR   0080H   A   
P0MASK. . . . . . . . . . . . . . .  D ADDR   00FEH   A   
P0MAT . . . . . . . . . . . . . . .  D ADDR   00FDH   A   
P0MDIN. . . . . . . . . . . . . . .  D ADDR   00F1H   A   
P0MDOUT . . . . . . . . . . . . . .  D ADDR   00A4H   A   
P0SKIP. . . . . . . . . . . . . . .  D ADDR   00D4H   A   
P0_B0 . . . . . . . . . . . . . . .  B ADDR   0080H.0 A   
P0_B1 . . . . . . . . . . . . . . .  B ADDR   0080H.1 A   
P0_B2 . . . . . . . . . . . . . . .  B ADDR   0080H.2 A   
P0_B3 . . . . . . . . . . . . . . .  B ADDR   0080H.3 A   
P0_B4 . . . . . . . . . . . . . . .  B ADDR   0080H.4 A   
P0_B5 . . . . . . . . . . . . . . .  B ADDR   0080H.5 A   
P0_B6 . . . . . . . . . . . . . . .  B ADDR   0080H.6 A   
P0_B7 . . . . . . . . . . . . . . .  B ADDR   0080H.7 A   
P0_DIGITAL. . . . . . . . . . . . .  N NUMB   FFF0H   A   
P0_INIT . . . . . . . . . . . . . .  N NUMB   00FFH   A   
P0_PUSHPULL . . . . . . . . . . . .  N NUMB   00E0H   A   
P0_SKIP . . . . . . . . . . . . . .  N NUMB   00FFH   A   
P1. . . . . . . . . . . . . . . . .  D ADDR   0090H   A   
P1MASK. . . . . . . . . . . . . . .  D ADDR   00EEH   A   
P1MAT . . . . . . . . . . . . . . .  D ADDR   00EDH   A   
P1MDIN. . . . . . . . . . . . . . .  D ADDR   00F2H   A   
P1MDOUT . . . . . . . . . . . . . .  D ADDR   00A5H   A   
P1SKIP. . . . . . . . . . . . . . .  D ADDR   00D5H   A   
P1_B0 . . . . . . . . . . . . . . .  B ADDR   0090H.0 A   
P1_B1 . . . . . . . . . . . . . . .  B ADDR   0090H.1 A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   654

P1_B2 . . . . . . . . . . . . . . .  B ADDR   0090H.2 A   
P1_B3 . . . . . . . . . . . . . . .  B ADDR   0090H.3 A   
P1_B4 . . . . . . . . . . . . . . .  B ADDR   0090H.4 A   
P1_B5 . . . . . . . . . . . . . . .  B ADDR   0090H.5 A   
P1_B6 . . . . . . . . . . . . . . .  B ADDR   0090H.6 A   
P1_B7 . . . . . . . . . . . . . . .  B ADDR   0090H.7 A   
P1_DIGITAL. . . . . . . . . . . . .  N NUMB   003FH   A   
P1_INIT . . . . . . . . . . . . . .  N NUMB   0000H   A   
P1_PUSHPULL . . . . . . . . . . . .  N NUMB   003FH   A   
P1_SKIP . . . . . . . . . . . . . .  N NUMB   003FH   A   
P2. . . . . . . . . . . . . . . . .  D ADDR   00A0H   A   
P2MASK. . . . . . . . . . . . . . .  D ADDR   00FCH   A   
P2MAT . . . . . . . . . . . . . . .  D ADDR   00FBH   A   
P2MDIN. . . . . . . . . . . . . . .  D ADDR   00F3H   A   
P2MDOUT . . . . . . . . . . . . . .  D ADDR   00A6H   A   
P2SKIP. . . . . . . . . . . . . . .  D ADDR   00CCH   A   
P2_B0 . . . . . . . . . . . . . . .  B ADDR   00A0H.0 A   
P2_B1 . . . . . . . . . . . . . . .  B ADDR   00A0H.1 A   
P2_B2 . . . . . . . . . . . . . . .  B ADDR   00A0H.2 A   
P2_B3 . . . . . . . . . . . . . . .  B ADDR   00A0H.3 A   
P2_PUSHPULL . . . . . . . . . . . .  N NUMB   0001H   A   
P3. . . . . . . . . . . . . . . . .  D ADDR   00B0H   A   
P3MDIN. . . . . . . . . . . . . . .  D ADDR   00F4H   A   
P3MDOUT . . . . . . . . . . . . . .  D ADDR   009CH   A   
P3_B0 . . . . . . . . . . . . . . .  B ADDR   00B0H.0 A   
P3_B1 . . . . . . . . . . . . . . .  B ADDR   00B0H.1 A   
PARAH . . . . . . . . . . . . . . .    REG    R3          
PARAL . . . . . . . . . . . . . . .    REG    R2          
PCA0. . . . . . . . . . . . . . . .  D ADDR   00F9H   A   
PCA0CENT. . . . . . . . . . . . . .  D ADDR   009EH   A   
PCA0CLR . . . . . . . . . . . . . .  D ADDR   009CH   A   
PCA0CN0 . . . . . . . . . . . . . .  D ADDR   00D8H   A   
PCA0CN0_CCF0. . . . . . . . . . . .  B ADDR   00D8H.0 A   
PCA0CN0_CCF1. . . . . . . . . . . .  B ADDR   00D8H.1 A   
PCA0CN0_CCF2. . . . . . . . . . . .  B ADDR   00D8H.2 A   
PCA0CN0_CF. . . . . . . . . . . . .  B ADDR   00D8H.7 A   
PCA0CN0_CR. . . . . . . . . . . . .  B ADDR   00D8H.6 A   
PCA0CP0 . . . . . . . . . . . . . .  D ADDR   00FBH   A   
PCA0CP1 . . . . . . . . . . . . . .  D ADDR   00E9H   A   
PCA0CP2 . . . . . . . . . . . . . .  D ADDR   00EBH   A   
PCA0CPH0. . . . . . . . . . . . . .  D ADDR   00FCH   A   
PCA0CPH1. . . . . . . . . . . . . .  D ADDR   00EAH   A   
PCA0CPH2. . . . . . . . . . . . . .  D ADDR   00ECH   A   
PCA0CPL0. . . . . . . . . . . . . .  D ADDR   00FBH   A   
PCA0CPL1. . . . . . . . . . . . . .  D ADDR   00E9H   A   
PCA0CPL2. . . . . . . . . . . . . .  D ADDR   00EBH   A   
PCA0CPM0. . . . . . . . . . . . . .  D ADDR   00DAH   A   
PCA0CPM1. . . . . . . . . . . . . .  D ADDR   00DBH   A   
PCA0CPM2. . . . . . . . . . . . . .  D ADDR   00DCH   A   
PCA0H . . . . . . . . . . . . . . .  D ADDR   00FAH   A   
PCA0L . . . . . . . . . . . . . . .  D ADDR   00F9H   A   
PCA0MD. . . . . . . . . . . . . . .  D ADDR   00D9H   A   
PCA0POL . . . . . . . . . . . . . .  D ADDR   0096H   A   
PCA0PWM . . . . . . . . . . . . . .  D ADDR   00F7H   A   
PCA0_IRQN . . . . . . . . . . . . .  N NUMB   000BH   A   
PCA0_PAGE . . . . . . . . . . . . .  N NUMB   0000H   A   
PCA_INT . . . . . . . . . . . . . .  C ADDR   0544H   A   
PCA_INT_EXIT. . . . . . . . . . . .  C ADDR   058DH   A   
PCA_INT_HI_PWM. . . . . . . . . . .  C ADDR   055DH   A   
PCA_INT_SET_PWM . . . . . . . . . .  C ADDR   0565H   A   
PCON0 . . . . . . . . . . . . . . .  D ADDR   0087H   A   
PCON1 . . . . . . . . . . . . . . .  D ADDR   009AH   A   
PFE0CN. . . . . . . . . . . . . . .  D ADDR   00C1H   A   
PG2_PAGE. . . . . . . . . . . . . .  N NUMB   0010H   A   
PG3_PAGE. . . . . . . . . . . . . .  N NUMB   0020H   A   
PGM_BEACON_DELAY. . . . . . . . . .  I ADDR   009AH   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   655

PGM_BEACON_STRENGTH . . . . . . . .  I ADDR   0099H   A   
PGM_BEEP_STRENGTH . . . . . . . . .  I ADDR   0098H   A   
PGM_BIDIR . . . . . . . . . . . . .  N NUMB   0002H   A   
PGM_BIDIR_REV . . . . . . . . . . .  N NUMB   0001H   A   
PGM_BRAKE_ON_STOP . . . . . . . . .  I ADDR   00A4H   A   
PGM_CENTER_THROTTLE . . . . . . . .  I ADDR   009EH   A   
PGM_COMM_TIMING . . . . . . . . . .  I ADDR   0092H   A   
PGM_DEMAG_COMP. . . . . . . . . . .  I ADDR   009CH   A   
PGM_DIRECTION . . . . . . . . . . .  I ADDR   0088H   A   
PGM_DIR_REV . . . . . . . . . . . .  N NUMB   0000H   A   
PGM_ENABLE_POWER_PROT . . . . . . .  I ADDR   00A1H   A   
PGM_ENABLE_TEMP_PROT. . . . . . . .  I ADDR   00A0H   A   
PGM_ENABLE_TX_PROGRAM . . . . . . .  I ADDR   008CH   A   
PGM_INPUT_POL . . . . . . . . . . .  I ADDR   0089H   A   
PGM_LED_CONTROL . . . . . . . . . .  I ADDR   00A5H   A   
PGM_MAX_THROTTLE. . . . . . . . . .  I ADDR   0097H   A   
PGM_MIN_THROTTLE. . . . . . . . . .  I ADDR   0096H   A   
PGM_START . . . . . . . . . . . . .  C ADDR   0D9BH   A   
PGM_STARTUP_PWR . . . . . . . . . .  I ADDR   0086H   A   
PGM_STARTUP_PWR_DECODED . . . . . .  I ADDR   00A6H   A   
PMATCH_IRQN . . . . . . . . . . . .  N NUMB   0008H   A   
POLYNOM . . . . . . . . . . . . . .  N NUMB   A001H   A   
POWER_ON_WAIT_CNT_H . . . . . . . .  D ADDR   0038H   A   
POWER_ON_WAIT_CNT_L . . . . . . . .  D ADDR   0037H   A   
POWER_PWM_REG_H . . . . . . . . . .  D ADDR   0057H   A   
POWER_PWM_REG_L . . . . . . . . . .  D ADDR   0056H   A   
PREV_COMM_H . . . . . . . . . . . .  D ADDR   0043H   A   
PREV_COMM_L . . . . . . . . . . . .  D ADDR   0042H   A   
PREV_COMM_X . . . . . . . . . . . .  D ADDR   0044H   A   
PREV_PREV_COMM_H. . . . . . . . . .  D ADDR   0046H   A   
PREV_PREV_COMM_L. . . . . . . . . .  D ADDR   0045H   A   
PRO3. . . . . . . . . . . . . . . .  C ADDR   1D0BH   A   
PRO4. . . . . . . . . . . . . . . .  C ADDR   1D17H   A   
PRO5. . . . . . . . . . . . . . . .  C ADDR   1D1DH   A   
PRO6. . . . . . . . . . . . . . . .  C ADDR   1D32H   A   
PROGRAM_BY_TX_CHECKED . . . . . . .  C ADDR   102BH   A   
PROGRAM_BY_TX_ENTRY_LIMIT . . . . .  C ADDR   1015H   A   
PROGRAM_BY_TX_ENTRY_STORE . . . . .  C ADDR   101BH   A   
PROGRAM_BY_TX_ENTRY_WAIT. . . . . .  C ADDR   1022H   A   
PRTDRV. . . . . . . . . . . . . . .  D ADDR   00F6H   A   
PSCTL . . . . . . . . . . . . . . .  D ADDR   008FH   A   
PSW . . . . . . . . . . . . . . . .  D ADDR   00D0H   A   
PSW_AC. . . . . . . . . . . . . . .  B ADDR   00D0H.6 A   
PSW_CY. . . . . . . . . . . . . . .  B ADDR   00D0H.7 A   
PSW_F0. . . . . . . . . . . . . . .  B ADDR   00D0H.5 A   
PSW_F1. . . . . . . . . . . . . . .  B ADDR   00D0H.1 A   
PSW_OV. . . . . . . . . . . . . . .  B ADDR   00D0H.2 A   
PSW_PARITY. . . . . . . . . . . . .  B ADDR   00D0H.0 A   
PSW_RS0 . . . . . . . . . . . . . .  B ADDR   00D0H.3 A   
PSW_RS1 . . . . . . . . . . . . . .  B ADDR   00D0H.4 A   
PUT1. . . . . . . . . . . . . . . .  C ADDR   1D58H   A   
PUT2. . . . . . . . . . . . . . . .  C ADDR   1D6BH   A   
PUT3. . . . . . . . . . . . . . . .  C ADDR   1D77H   A   
PUT4. . . . . . . . . . . . . . . .  C ADDR   1D89H   A   
PUTC. . . . . . . . . . . . . . . .  C ADDR   1D6EH   A   
PUTP. . . . . . . . . . . . . . . .  C ADDR   1D52H   A   
PUTW. . . . . . . . . . . . . . . .  C ADDR   1D4AH   A   
PWM_LIMIT . . . . . . . . . . . . .  D ADDR   005BH   A   
PWM_LIMIT_BEG . . . . . . . . . . .  D ADDR   005DH   A   
PWM_LIMIT_BY_RPM. . . . . . . . . .  D ADDR   005CH   A   
P_. . . . . . . . . . . . . . . . .  N NUMB   0010H   A   
Q_. . . . . . . . . . . . . . . . .  N NUMB   0011H   A   
RCP_DIR_REV . . . . . . . . . . . .  N NUMB   0005H   A   
RCP_DSHOT . . . . . . . . . . . . .  N NUMB   0004H   A   
RCP_FULL_RANGE. . . . . . . . . . .  N NUMB   0006H   A   
RCP_IN. . . . . . . . . . . . . . .  N NUMB   0004H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   656

RCP_MULTISHOT . . . . . . . . . . .  N NUMB   0003H   A   
RCP_ONESHOT125. . . . . . . . . . .  N NUMB   0001H   A   
RCP_ONESHOT42 . . . . . . . . . . .  N NUMB   0002H   A   
RCP_OUTSIDE_RANGE_CNT . . . . . . .  D ADDR   0022H   A   
RCP_STOP_CNT. . . . . . . . . . . .  D ADDR   0055H   A   
RCP_TIMEOUT_CNTD. . . . . . . . . .  D ADDR   0023H   A   
RCP_UPDATED . . . . . . . . . . . .  N NUMB   0000H   A   
RD1 . . . . . . . . . . . . . . . .  C ADDR   1D3CH   A   
READ_ALL_EEPROM_PARAMETERS. . . . .  C ADDR   141FH   A   
READ_EEPROM_BLOCK1. . . . . . . . .  C ADDR   144FH   A   
READ_EEPROM_BLOCK2. . . . . . . . .  C ADDR   145CH   A   
READ_EEPROM_BYTE. . . . . . . . . .  C ADDR   149FH   A   
READ_EEPROM_EXIT. . . . . . . . . .  C ADDR   1465H   A   
READ_EEPROM_READ. . . . . . . . . .  C ADDR   1448H   A   
READ_EEPROM_STORE_DEFAULTS. . . . .  C ADDR   1435H   A   
READ_INITIAL_TEMP . . . . . . . . .  C ADDR   1286H   A   
READ_TAG. . . . . . . . . . . . . .  C ADDR   14EBH   A   
READ_TAGS . . . . . . . . . . . . .  C ADDR   14E2H   A   
REF0CN. . . . . . . . . . . . . . .  D ADDR   00D1H   A   
REG0CN. . . . . . . . . . . . . . .  D ADDR   00C9H   A   
REG1CN. . . . . . . . . . . . . . .  D ADDR   00C6H   A   
RESET . . . . . . . . . . . . . . .  C ADDR   19FDH   A   
REVID . . . . . . . . . . . . . . .  D ADDR   00B6H   A   
RST . . . . . . . . . . . . . . . .  C ADDR   1CC9H   A   
RSTSRC. . . . . . . . . . . . . . .  D ADDR   00EFH   A   
RTX_MDIN. . . . . . . . . . . . . .  D ADDR   00F1H   A   
RTX_MDOUT . . . . . . . . . . . . .  D ADDR   00A4H   A   
RTX_PIN . . . . . . . . . . . . . .  N NUMB   0004H   A   
RTX_PORT. . . . . . . . . . . . . .  D ADDR   0080H   A   
RTX_SKIP. . . . . . . . . . . . . .  D ADDR   00D4H   A   
RUN1. . . . . . . . . . . . . . . .  C ADDR   12D9H   A   
RUN2. . . . . . . . . . . . . . . .  C ADDR   12E5H   A   
RUN3. . . . . . . . . . . . . . . .  C ADDR   12FDH   A   
RUN4. . . . . . . . . . . . . . . .  C ADDR   1309H   A   
RUN5. . . . . . . . . . . . . . . .  C ADDR   1315H   A   
RUN6. . . . . . . . . . . . . . . .  C ADDR   1321H   A   
RUN6_BRAKE_DONE . . . . . . . . . .  C ADDR   13BCH   A   
RUN6_CHECK_DIR. . . . . . . . . . .  C ADDR   1398H   A   
RUN6_CHECK_DIR_CHANGE . . . . . . .  C ADDR   13A8H   A   
RUN6_CHECK_DIR_REV. . . . . . . . .  C ADDR   13A3H   A   
RUN6_CHECK_SPEED. . . . . . . . . .  C ADDR   13B2H   A   
RUN6_CHECK_TIMEOUT. . . . . . . . .  C ADDR   1394H   A   
RUN_TO_WAIT_FOR_POWER_ON. . . . . .  C ADDR   13E3H   A   
RUN_TO_WAIT_FOR_POWER_ON_BRAKE_DONE  C ADDR   1413H   A   
RUN_TO_WAIT_FOR_POWER_ON_FAIL . . .  C ADDR   13DBH   A   
RUN_TO_WAIT_FOR_POWER_ON_STALL_DONE  C ADDR   13E6H   A   
R_. . . . . . . . . . . . . . . . .  N NUMB   0012H   A   
SBCON1. . . . . . . . . . . . . . .  D ADDR   0094H   A   
SBRL1 . . . . . . . . . . . . . . .  D ADDR   0095H   A   
SBRLH1. . . . . . . . . . . . . . .  D ADDR   0096H   A   
SBRLL1. . . . . . . . . . . . . . .  D ADDR   0095H   A   
SBUF0 . . . . . . . . . . . . . . .  D ADDR   0099H   A   
SBUF1 . . . . . . . . . . . . . . .  D ADDR   0092H   A   
SCALE_THROTTLE_CAL. . . . . . . . .  C ADDR   0BFBH   A   
SCON0 . . . . . . . . . . . . . . .  D ADDR   0098H   A   
SCON0_MCE . . . . . . . . . . . . .  B ADDR   0098H.5 A   
SCON0_RB8 . . . . . . . . . . . . .  B ADDR   0098H.2 A   
SCON0_REN . . . . . . . . . . . . .  B ADDR   0098H.4 A   
SCON0_RI. . . . . . . . . . . . . .  B ADDR   0098H.0 A   
SCON0_SMODE . . . . . . . . . . . .  B ADDR   0098H.7 A   
SCON0_TB8 . . . . . . . . . . . . .  B ADDR   0098H.3 A   
SCON0_TI. . . . . . . . . . . . . .  B ADDR   0098H.1 A   
SCON1 . . . . . . . . . . . . . . .  D ADDR   00C8H   A   
SCON1_OVR . . . . . . . . . . . . .  B ADDR   00C8H.7 A   
SCON1_PERR. . . . . . . . . . . . .  B ADDR   00C8H.6 A   
SCON1_RBX . . . . . . . . . . . . .  B ADDR   00C8H.2 A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   657

SCON1_REN . . . . . . . . . . . . .  B ADDR   00C8H.4 A   
SCON1_RI. . . . . . . . . . . . . .  B ADDR   00C8H.0 A   
SCON1_TBX . . . . . . . . . . . . .  B ADDR   00C8H.3 A   
SCON1_TI. . . . . . . . . . . . . .  B ADDR   00C8H.1 A   
SET4. . . . . . . . . . . . . . . .  C ADDR   1CD1H   A   
SET5. . . . . . . . . . . . . . . .  C ADDR   1CD7H   A   
SET6. . . . . . . . . . . . . . . .  C ADDR   1CDDH   A   
SETBUF. . . . . . . . . . . . . . .  C ADDR   1CCBH   A   
SETUP_COMM_WAIT . . . . . . . . . .  C ADDR   09C7H   A   
SETUP_ZC_SCAN_TIMEOUT . . . . . . .  C ADDR   08BDH   A   
SETUP_ZC_SCAN_TIMEOUT_STARTUP_DONE.  C ADDR   08DAH   A   
SET_DEFAULT_PARAMETERS. . . . . . .  C ADDR   0B8FH   A   
SET_PWM_LIMIT_HIGH_RPM. . . . . . .  C ADDR   05EAH   A   
SET_PWM_LIMIT_HIGH_RPM_INC_LIMIT. .  C ADDR   05FAH   A   
SET_PWM_LIMIT_HIGH_RPM_STORE. . . .  C ADDR   05FBH   A   
SET_PWM_LIMIT_LOW_RPM . . . . . . .  C ADDR   05BAH   A   
SET_PWM_LIMIT_LOW_RPM_EXIT. . . . .  C ADDR   05E7H   A   
SET_STARTUP_PWM . . . . . . . . . .  C ADDR   066BH   A   
SFRPAGE . . . . . . . . . . . . . .  D ADDR   00A7H   A   
SFRPGCN . . . . . . . . . . . . . .  D ADDR   00CFH   A   
SFRSTACK. . . . . . . . . . . . . .  D ADDR   00D7H   A   
SIGNATURE_001 . . . . . . . . . . .  N NUMB   00E8H   A   
SIGNATURE_002 . . . . . . . . . . .  N NUMB   00B2H   A   
SKIP_T2_INT . . . . . . . . . . . .  D ADDR   0065H   A   
SMB0ADM . . . . . . . . . . . . . .  D ADDR   00D6H   A   
SMB0ADR . . . . . . . . . . . . . .  D ADDR   00D7H   A   
SMB0CF. . . . . . . . . . . . . . .  D ADDR   00C1H   A   
SMB0CN0 . . . . . . . . . . . . . .  D ADDR   00C0H   A   
SMB0CN0_ACK . . . . . . . . . . . .  B ADDR   00C0H.1 A   
SMB0CN0_ACKRQ . . . . . . . . . . .  B ADDR   00C0H.3 A   
SMB0CN0_ARBLOST . . . . . . . . . .  B ADDR   00C0H.2 A   
SMB0CN0_MASTER. . . . . . . . . . .  B ADDR   00C0H.7 A   
SMB0CN0_SI. . . . . . . . . . . . .  B ADDR   00C0H.0 A   
SMB0CN0_STA . . . . . . . . . . . .  B ADDR   00C0H.5 A   
SMB0CN0_STO . . . . . . . . . . . .  B ADDR   00C0H.4 A   
SMB0CN0_TXMODE. . . . . . . . . . .  B ADDR   00C0H.6 A   
SMB0DAT . . . . . . . . . . . . . .  D ADDR   00C2H   A   
SMB0FCN0. . . . . . . . . . . . . .  D ADDR   00C3H   A   
SMB0FCN1. . . . . . . . . . . . . .  D ADDR   00C4H   A   
SMB0FCT . . . . . . . . . . . . . .  D ADDR   00EFH   A   
SMB0RXLN. . . . . . . . . . . . . .  D ADDR   00C5H   A   
SMB0TC. . . . . . . . . . . . . . .  D ADDR   00ACH   A   
SMB0_PAGE . . . . . . . . . . . . .  N NUMB   0020H   A   
SMBUS0_IRQN . . . . . . . . . . . .  N NUMB   0007H   A   
SMOD1 . . . . . . . . . . . . . . .  D ADDR   0093H   A   
SP. . . . . . . . . . . . . . . . .  D ADDR   0081H   A   
SPI0CFG . . . . . . . . . . . . . .  D ADDR   00A1H   A   
SPI0CKR . . . . . . . . . . . . . .  D ADDR   00A2H   A   
SPI0CN0 . . . . . . . . . . . . . .  D ADDR   00F8H   A   
SPI0CN0_MODF. . . . . . . . . . . .  B ADDR   00F8H.5 A   
SPI0CN0_NSSMD0. . . . . . . . . . .  B ADDR   00F8H.2 A   
SPI0CN0_NSSMD1. . . . . . . . . . .  B ADDR   00F8H.3 A   
SPI0CN0_RXOVRN. . . . . . . . . . .  B ADDR   00F8H.4 A   
SPI0CN0_SPIEN . . . . . . . . . . .  B ADDR   00F8H.0 A   
SPI0CN0_SPIF. . . . . . . . . . . .  B ADDR   00F8H.7 A   
SPI0CN0_TXNF. . . . . . . . . . . .  B ADDR   00F8H.1 A   
SPI0CN0_WCOL. . . . . . . . . . . .  B ADDR   00F8H.6 A   
SPI0DAT . . . . . . . . . . . . . .  D ADDR   00A3H   A   
SPI0FCN0. . . . . . . . . . . . . .  D ADDR   009AH   A   
SPI0FCN1. . . . . . . . . . . . . .  D ADDR   009BH   A   
SPI0FCT . . . . . . . . . . . . . .  D ADDR   00F7H   A   
SPI0_IRQN . . . . . . . . . . . . .  N NUMB   0006H   A   
SPI0_PAGE . . . . . . . . . . . . .  N NUMB   0020H   A   
STALL_CNT . . . . . . . . . . . . .  D ADDR   003CH   A   
STARTUP_CNT . . . . . . . . . . . .  D ADDR   0039H   A   
STARTUP_PHASE . . . . . . . . . . .  N NUMB   0000H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   658

STARTUP_POWER_TABLE . . . . . . . .  C ADDR   0080H   A   
STARTUP_ZC_TIMEOUT_CNTD . . . . . .  D ADDR   003AH   A   
START_ADC_CONVERSION. . . . . . . .  C ADDR   0600H   A   
STORE_TIMES_DECREASE. . . . . . . .  C ADDR   085CH   A   
STORE_TIMES_DECREASE_FAST . . . . .  C ADDR   08AFH   A   
STORE_TIMES_EXIT. . . . . . . . . .  C ADDR   087DH   A   
STORE_TIMES_INCREASE. . . . . . . .  C ADDR   084DH   A   
STORE_TIMES_INCREASE_FAST . . . . .  C ADDR   08A6H   A   
STORE_TIMES_UP_OR_DOWN. . . . . . .  C ADDR   0847H   A   
STORE_TIMES_UP_OR_DOWN_FAST . . . .  C ADDR   08A0H   A   
SUCCESS . . . . . . . . . . . . . .  N NUMB   0030H   A   
SUCCESS_BEEP. . . . . . . . . . . .  C ADDR   150CH   A   
SUCCESS_BEEP_INVERTED . . . . . . .  C ADDR   153BH   A   
SWITCH_POWER_OFF. . . . . . . . . .  C ADDR   0B7FH   A   
S_. . . . . . . . . . . . . . . . .  N NUMB   0013H   A   
T0_INT. . . . . . . . . . . . . . .  C ADDR   008DH   A   
T1_DSHOT_INC_CMD_CNT. . . . . . . .  C ADDR   023DH   A   
T1_DSHOT_SET_CMD. . . . . . . . . .  C ADDR   0233H   A   
T1_INT. . . . . . . . . . . . . . .  C ADDR   0090H   A   
T1_INT_BIDIR_FWD. . . . . . . . . .  C ADDR   0258H   A   
T1_INT_BIDIR_REV_CHK. . . . . . . .  C ADDR   025DH   A   
T1_INT_DECODE . . . . . . . . . . .  C ADDR   00F2H   A   
T1_INT_DECODE_LSB . . . . . . . . .  C ADDR   0178H   A   
T1_INT_DECODE_MSB . . . . . . . . .  C ADDR   00FDH   A   
T1_INT_FRAME_FAIL . . . . . . . . .  C ADDR   02C8H   A   
T1_INT_FRAME_TIME_SCALED. . . . . .  C ADDR   00CCH   A   
T1_INT_LSB_FAIL . . . . . . . . . .  C ADDR   016FH   A   
T1_INT_MSB_FAIL . . . . . . . . . .  C ADDR   00F4H   A   
T1_INT_NOT_BIDIR. . . . . . . . . .  C ADDR   0269H   A   
T1_INT_STARTUP_BOOSTED. . . . . . .  C ADDR   02A4H   A   
T1_INT_STARTUP_BOOST_STALL. . . . .  C ADDR   029AH   A   
T1_INT_XOR_OK . . . . . . . . . . .  C ADDR   0200H   A   
T1_INT_ZERO_RCP_CHECKED . . . . . .  C ADDR   02B9H   A   
T1_NORMAL_RANGE . . . . . . . . . .  C ADDR   023FH   A   
T2_INT. . . . . . . . . . . . . . .  C ADDR   02D1H   A   
T2_INT_EXIT . . . . . . . . . . . .  C ADDR   0304H   A   
T2_INT_RCP_STOP . . . . . . . . . .  C ADDR   02F9H   A   
T2_INT_START. . . . . . . . . . . .  C ADDR   02E6H   A   
T3_INT. . . . . . . . . . . . . . .  C ADDR   0309H   A   
T3_PENDING. . . . . . . . . . . . .  N NUMB   0000H   A   
TCON. . . . . . . . . . . . . . . .  D ADDR   0088H   A   
TCON_IE0. . . . . . . . . . . . . .  B ADDR   0088H.1 A   
TCON_IE1. . . . . . . . . . . . . .  B ADDR   0088H.3 A   
TCON_IT0. . . . . . . . . . . . . .  B ADDR   0088H.0 A   
TCON_IT1. . . . . . . . . . . . . .  B ADDR   0088H.2 A   
TCON_TF0. . . . . . . . . . . . . .  B ADDR   0088H.5 A   
TCON_TF1. . . . . . . . . . . . . .  B ADDR   0088H.7 A   
TCON_TR0. . . . . . . . . . . . . .  B ADDR   0088H.4 A   
TCON_TR1. . . . . . . . . . . . . .  B ADDR   0088H.6 A   
TEMP1 . . . . . . . . . . . . . . .    REG    R0          
TEMP2 . . . . . . . . . . . . . . .    REG    R1          
TEMP3 . . . . . . . . . . . . . . .    REG    R2          
TEMP4 . . . . . . . . . . . . . . .    REG    R3          
TEMP5 . . . . . . . . . . . . . . .    REG    R4          
TEMP6 . . . . . . . . . . . . . . .    REG    R5          
TEMP7 . . . . . . . . . . . . . . .    REG    R6          
TEMP8 . . . . . . . . . . . . . . .    REG    R7          
TEMP_AVERAGE_DEC. . . . . . . . . .  C ADDR   0633H   A   
TEMP_AVERAGE_INC. . . . . . . . . .  C ADDR   0636H   A   
TEMP_AVERAGE_INC_DEC. . . . . . . .  C ADDR   0627H   A   
TEMP_AVERAGE_UPDATED. . . . . . . .  C ADDR   063DH   A   
TEMP_AVERAGE_UPDATED_LOAD_ACC . . .  C ADDR   063BH   A   
TEMP_CHECK_EXIT . . . . . . . . . .  C ADDR   065FH   A   
TEMP_LIMIT. . . . . . . . . . . . .  N NUMB   0031H   A   
TEMP_LIMIT_STEP . . . . . . . . . .  N NUMB   0009H   A   
TEMP_PROT_LIMIT . . . . . . . . . .  D ADDR   0069H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   659

TEMP_STORAGE. . . . . . . . . . . .  I ADDR   00D0H   A   
TEST_THROTTLE_GAIN. . . . . . . . .  C ADDR   0D23H   A   
TEST_THROTTLE_GAIN_MULT . . . . . .  C ADDR   0D30H   A   
TH0 . . . . . . . . . . . . . . . .  D ADDR   008CH   A   
TH1 . . . . . . . . . . . . . . . .  D ADDR   008DH   A   
THROTTLE_GAIN . . . . . . . . . . .  D ADDR   0060H   A   
THROTTLE_GAIN_BD_REV. . . . . . . .  D ADDR   0062H   A   
THROTTLE_GAIN_BD_REV_M. . . . . . .  D ADDR   0063H   A   
THROTTLE_GAIN_M . . . . . . . . . .  D ADDR   0061H   A   
THROTTLE_HIGH_CAL . . . . . . . . .  C ADDR   0FAAH   A   
THROTTLE_LOW_CAL. . . . . . . . . .  C ADDR   0FDAH   A   
THROTTLE_LOW_CAL_START. . . . . . .  C ADDR   0FD8H   A   
TIMER0_IRQN . . . . . . . . . . . .  N NUMB   0001H   A   
TIMER0_X. . . . . . . . . . . . . .  D ADDR   0040H   A   
TIMER1_IRQN . . . . . . . . . . . .  N NUMB   0003H   A   
TIMER2_IRQN . . . . . . . . . . . .  N NUMB   0005H   A   
TIMER2_PAGE . . . . . . . . . . . .  N NUMB   0010H   A   
TIMER2_X. . . . . . . . . . . . . .  D ADDR   0041H   A   
TIMER3_IRQN . . . . . . . . . . . .  N NUMB   000EH   A   
TIMER3_PAGE . . . . . . . . . . . .  N NUMB   0010H   A   
TIMER4_IRQN . . . . . . . . . . . .  N NUMB   0013H   A   
TIMER4_PAGE . . . . . . . . . . . .  N NUMB   0010H   A   
TL0 . . . . . . . . . . . . . . . .  D ADDR   008AH   A   
TL1 . . . . . . . . . . . . . . . .  D ADDR   008BH   A   
TMOD. . . . . . . . . . . . . . . .  D ADDR   0089H   A   
TMR2. . . . . . . . . . . . . . . .  D ADDR   00CCH   A   
TMR2CN0 . . . . . . . . . . . . . .  D ADDR   00C8H   A   
TMR2CN0_T2SPLIT . . . . . . . . . .  B ADDR   00C8H.3 A   
TMR2CN0_T2XCLK0 . . . . . . . . . .  B ADDR   00C8H.0 A   
TMR2CN0_T2XCLK1 . . . . . . . . . .  B ADDR   00C8H.1 A   
TMR2CN0_TF2CEN. . . . . . . . . . .  B ADDR   00C8H.4 A   
TMR2CN0_TF2H. . . . . . . . . . . .  B ADDR   00C8H.7 A   
TMR2CN0_TF2L. . . . . . . . . . . .  B ADDR   00C8H.6 A   
TMR2CN0_TF2LEN. . . . . . . . . . .  B ADDR   00C8H.5 A   
TMR2CN0_TR2 . . . . . . . . . . . .  B ADDR   00C8H.2 A   
TMR2CN1 . . . . . . . . . . . . . .  D ADDR   00FDH   A   
TMR2H . . . . . . . . . . . . . . .  D ADDR   00CDH   A   
TMR2L . . . . . . . . . . . . . . .  D ADDR   00CCH   A   
TMR2RL. . . . . . . . . . . . . . .  D ADDR   00CAH   A   
TMR2RLH . . . . . . . . . . . . . .  D ADDR   00CBH   A   
TMR2RLL . . . . . . . . . . . . . .  D ADDR   00CAH   A   
TMR3. . . . . . . . . . . . . . . .  D ADDR   0094H   A   
TMR3CN0 . . . . . . . . . . . . . .  D ADDR   0091H   A   
TMR3CN1 . . . . . . . . . . . . . .  D ADDR   00FEH   A   
TMR3H . . . . . . . . . . . . . . .  D ADDR   0095H   A   
TMR3L . . . . . . . . . . . . . . .  D ADDR   0094H   A   
TMR3RL. . . . . . . . . . . . . . .  D ADDR   0092H   A   
TMR3RLH . . . . . . . . . . . . . .  D ADDR   0093H   A   
TMR3RLL . . . . . . . . . . . . . .  D ADDR   0092H   A   
TMR4. . . . . . . . . . . . . . . .  D ADDR   00A4H   A   
TMR4CN0 . . . . . . . . . . . . . .  D ADDR   0098H   A   
TMR4CN0_T4SPLIT . . . . . . . . . .  B ADDR   0098H.3 A   
TMR4CN0_T4XCLK0 . . . . . . . . . .  B ADDR   0098H.0 A   
TMR4CN0_T4XCLK1 . . . . . . . . . .  B ADDR   0098H.1 A   
TMR4CN0_TF4CEN. . . . . . . . . . .  B ADDR   0098H.4 A   
TMR4CN0_TF4H. . . . . . . . . . . .  B ADDR   0098H.7 A   
TMR4CN0_TF4L. . . . . . . . . . . .  B ADDR   0098H.6 A   
TMR4CN0_TF4LEN. . . . . . . . . . .  B ADDR   0098H.5 A   
TMR4CN0_TR4 . . . . . . . . . . . .  B ADDR   0098H.2 A   
TMR4CN1 . . . . . . . . . . . . . .  D ADDR   00FFH   A   
TMR4H . . . . . . . . . . . . . . .  D ADDR   00A5H   A   
TMR4L . . . . . . . . . . . . . . .  D ADDR   00A4H   A   
TMR4RL. . . . . . . . . . . . . . .  D ADDR   00A2H   A   
TMR4RLH . . . . . . . . . . . . . .  D ADDR   00A3H   A   
TMR4RLL . . . . . . . . . . . . . .  D ADDR   00A2H   A   
T_. . . . . . . . . . . . . . . . .  N NUMB   0014H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   660

UART0_IRQN. . . . . . . . . . . . .  N NUMB   0004H   A   
UART0_PAGE. . . . . . . . . . . . .  N NUMB   0020H   A   
UART1FCN0 . . . . . . . . . . . . .  D ADDR   009DH   A   
UART1FCN1 . . . . . . . . . . . . .  D ADDR   00D8H   A   
UART1FCN1_RFRQ. . . . . . . . . . .  B ADDR   00D8H.3 A   
UART1FCN1_RIE . . . . . . . . . . .  B ADDR   00D8H.0 A   
UART1FCN1_RXTO0 . . . . . . . . . .  B ADDR   00D8H.1 A   
UART1FCN1_RXTO1 . . . . . . . . . .  B ADDR   00D8H.2 A   
UART1FCN1_TFRQ. . . . . . . . . . .  B ADDR   00D8H.7 A   
UART1FCN1_TIE . . . . . . . . . . .  B ADDR   00D8H.4 A   
UART1FCN1_TXHOLD. . . . . . . . . .  B ADDR   00D8H.5 A   
UART1FCN1_TXNF. . . . . . . . . . .  B ADDR   00D8H.6 A   
UART1FCT. . . . . . . . . . . . . .  D ADDR   00FAH   A   
UART1LIN. . . . . . . . . . . . . .  D ADDR   009EH   A   
UART1_IRQN. . . . . . . . . . . . .  N NUMB   0011H   A   
UART1_PAGE. . . . . . . . . . . . .  N NUMB   0020H   A   
UART_LOOP . . . . . . . . . . . . .  N NUMB   001AH   A   
U_. . . . . . . . . . . . . . . . .  N NUMB   0015H   A   
VALIDATE_RCP_START. . . . . . . . .  C ADDR   0F6BH   A   
VDM0CN. . . . . . . . . . . . . . .  D ADDR   00FFH   A   
V_. . . . . . . . . . . . . . . . .  N NUMB   0016H   A   
WAIT1 . . . . . . . . . . . . . . .  C ADDR   1DE1H   A   
WAIT100MS . . . . . . . . . . . . .  C ADDR   05A7H   A   
WAIT10MS. . . . . . . . . . . . . .  C ADDR   059FH   A   
WAIT1MS . . . . . . . . . . . . . .  C ADDR   0597H   A   
WAIT1S. . . . . . . . . . . . . . .  C ADDR   1504H   A   
WAIT1S_LOOP . . . . . . . . . . . .  C ADDR   1506H   A   
WAIT200MS . . . . . . . . . . . . .  C ADDR   05ABH   A   
WAIT30MS. . . . . . . . . . . . . .  C ADDR   05A3H   A   
WAIT3MS . . . . . . . . . . . . . .  C ADDR   059BH   A   
WAITF . . . . . . . . . . . . . . .  C ADDR   1DDBH   A   
WAITH . . . . . . . . . . . . . . .  C ADDR   1DDFH   A   
WAITXMS_M . . . . . . . . . . . . .  C ADDR   05B1H   A   
WAITXMS_O . . . . . . . . . . . . .  C ADDR   05AFH   A   
WAIT_ADVANCE_TIMING . . . . . . . .  C ADDR   07EBH   A   
WAIT_BEFORE_ZC_SCAN . . . . . . . .  C ADDR   08B5H   A   
WAIT_BEFORE_ZC_SCAN_EXIT. . . . . .  C ADDR   08F5H   A   
WAIT_FOR_COMM . . . . . . . . . . .  C ADDR   0A03H   A   
WAIT_FOR_COMM_WAIT. . . . . . . . .  C ADDR   0A3AH   A   
WAIT_FOR_COMP_OUT_HIGH. . . . . . .  C ADDR   0906H   A   
WAIT_FOR_COMP_OUT_LOW . . . . . . .  C ADDR   08F6H   A   
WAIT_FOR_COMP_OUT_START . . . . . .  C ADDR   0914H   A   
WAIT_FOR_LOW. . . . . . . . . . . .  C ADDR   1C48H   A   
WAIT_FOR_POWER_ON . . . . . . . . .  C ADDR   1051H   A   
WAIT_FOR_POWER_ON_LOOP. . . . . . .  C ADDR   1056H   A   
WAIT_FOR_POWER_ON_NONZERO . . . . .  C ADDR   10B7H   A   
WAIT_FOR_POWER_ON_NOT_MISSING . . .  C ADDR   10A6H   A   
WAIT_FOR_POWER_ON_NO_BEEP . . . . .  C ADDR   109CH   A   
WDTCN . . . . . . . . . . . . . . .  D ADDR   0097H   A   
WRITE_EEPROM_BLOCK1 . . . . . . . .  C ADDR   1484H   A   
WRITE_EEPROM_BLOCK2 . . . . . . . .  C ADDR   1491H   A   
WRITE_EEPROM_BYTE . . . . . . . . .  C ADDR   14A3H   A   
WRITE_EEPROM_BYTE_FROM_ACC. . . . .  C ADDR   14A4H   A   
WRITE_EEPROM_SIGNATURE. . . . . . .  C ADDR   14D3H   A   
WRITE_TAG . . . . . . . . . . . . .  C ADDR   14FCH   A   
WRITE_TAGS. . . . . . . . . . . . .  C ADDR   14F5H   A   
WT_ADV_START_H. . . . . . . . . . .  D ADDR   004BH   A   
WT_ADV_START_L. . . . . . . . . . .  D ADDR   004AH   A   
WT_COMM_START_H . . . . . . . . . .  D ADDR   0051H   A   
WT_COMM_START_L . . . . . . . . . .  D ADDR   0050H   A   
WT_ZC_SCAN_START_H. . . . . . . . .  D ADDR   004DH   A   
WT_ZC_SCAN_START_L. . . . . . . . .  D ADDR   004CH   A   
WT_ZC_TOUT_START_H. . . . . . . . .  D ADDR   004FH   A   
WT_ZC_TOUT_START_L. . . . . . . . .  D ADDR   004EH   A   
W_. . . . . . . . . . . . . . . . .  N NUMB   0017H   A   
XBR0. . . . . . . . . . . . . . . .  D ADDR   00E1H   A   
A51 MACRO ASSEMBLER  BLHELI_S                                                             04/01/2025 17:15:30 PAGE   661

XBR1. . . . . . . . . . . . . . . .  D ADDR   00E2H   A   
XBR2. . . . . . . . . . . . . . . .  D ADDR   00E3H   A   
XH. . . . . . . . . . . . . . . . .    REG    R1          
XL. . . . . . . . . . . . . . . . .    REG    R0          
XTAL. . . . . . . . . . . . . . . .  N NUMB   7840H   A   
X_. . . . . . . . . . . . . . . . .  N NUMB   0018H   A   
Y_. . . . . . . . . . . . . . . . .  N NUMB   0019H   A   
Z_. . . . . . . . . . . . . . . . .  N NUMB   001AH   A   
_EEP_MAIN_REARM_START . . . . . . .  C ADDR   1A10H   A   
_EEP_PGM_BEC_VOLTAGE_HIGH . . . . .  C ADDR   1A20H   A   
_EEP_PGM_DAMPING_FORCE. . . . . . .  C ADDR   1A16H   A   
_EEP_PGM_ENABLE_PWM_INPUT . . . . .  C ADDR   1A25H   A   
_EEP_PGM_GOV_I_GAIN . . . . . . . .  C ADDR   1A04H   A   
_EEP_PGM_GOV_MODE . . . . . . . . .  C ADDR   1A05H   A   
_EEP_PGM_GOV_P_GAIN . . . . . . . .  C ADDR   1A03H   A   
_EEP_PGM_GOV_RANGE. . . . . . . . .  C ADDR   1A17H   A   
_EEP_PGM_GOV_SETUP_TARGET . . . . .  C ADDR   1A11H   A   
_EEP_PGM_INPUT_POL. . . . . . . . .  C ADDR   1A0CH   A   
_EEP_PGM_LOW_VOLTAGE_LIM. . . . . .  C ADDR   1A06H   A   
_EEP_PGM_MAIN_SPOOLUP_TIME. . . . .  C ADDR   1A22H   A   
_EEP_PGM_MOTOR_GAIN . . . . . . . .  C ADDR   1A07H   A   
_EEP_PGM_MOTOR_IDLE . . . . . . . .  C ADDR   1A08H   A   
_EEP_PGM_PWM_DITHER . . . . . . . .  C ADDR   1A26H   A   
_EEP_PGM_PWM_FREQ . . . . . . . . .  C ADDR   1A0AH   A   
_EEP_PGM_STARTUP_ACCEL. . . . . . .  C ADDR   1A13H   A   
_EEP_PGM_STARTUP_METHOD . . . . . .  C ADDR   1A18H   A   
_EEP_PGM_STARTUP_RPM. . . . . . . .  C ADDR   1A12H   A   
_EEP_PGM_THROTTLE_RATE. . . . . . .  C ADDR   1A1EH   A   
_EEP_PGM_VOLT_COMP. . . . . . . . .  C ADDR   1A14H   A   
_PGM_BEC_VOLTAGE_HIGH . . . . . . .  I ADDR   009DH   A   
_PGM_DAMPING_FORCE. . . . . . . . .  I ADDR   0093H   A   
_PGM_ENABLE_PWM_INPUT . . . . . . .  I ADDR   00A2H   A   
_PGM_GOV_I_GAIN . . . . . . . . . .  I ADDR   0081H   A   
_PGM_GOV_MODE . . . . . . . . . . .  I ADDR   0082H   A   
_PGM_GOV_P_GAIN . . . . . . . . . .  I ADDR   0080H   A   
_PGM_GOV_RANGE. . . . . . . . . . .  I ADDR   0094H   A   
_PGM_GOV_SETUP_TARGET . . . . . . .  I ADDR   008EH   A   
_PGM_LOW_VOLTAGE_LIM. . . . . . . .  I ADDR   0083H   A   
_PGM_MAIN_REARM_START . . . . . . .  I ADDR   008DH   A   
_PGM_MAIN_SPOOLUP_TIME. . . . . . .  I ADDR   009FH   A   
_PGM_MOTOR_GAIN . . . . . . . . . .  I ADDR   0084H   A   
_PGM_MOTOR_IDLE . . . . . . . . . .  I ADDR   0085H   A   
_PGM_PWM_DITHER . . . . . . . . . .  I ADDR   00A3H   A   
_PGM_PWM_FREQ . . . . . . . . . . .  I ADDR   0087H   A   
_PGM_STARTUP_ACCEL. . . . . . . . .  I ADDR   0090H   A   
_PGM_STARTUP_METHOD . . . . . . . .  I ADDR   0095H   A   
_PGM_STARTUP_RPM. . . . . . . . . .  I ADDR   008FH   A   
_PGM_THROTTLE_RATE. . . . . . . . .  I ADDR   009BH   A   
_PGM_VOLT_COMP. . . . . . . . . . .  I ADDR   0091H   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
